{
    "title": "TIPS: Transformer Based Indoor Positioning System Using Both CSI and DoA of WiFi Signal",
    "url": "https://openalex.org/W4312268162",
    "year": 2022,
    "authors": [
        {
            "id": "https://openalex.org/A5011823085",
            "name": "Zhongfeng Zhang",
            "affiliations": [
                "Hanyang University"
            ]
        },
        {
            "id": "https://openalex.org/A5009921296",
            "name": "Hongxin Du",
            "affiliations": [
                "Hanyang University"
            ]
        },
        {
            "id": "https://openalex.org/A5100723992",
            "name": "Seungwon Choi",
            "affiliations": [
                "Hanyang University"
            ]
        },
        {
            "id": "https://openalex.org/A5021420311",
            "name": "Sung Ho Cho",
            "affiliations": [
                "Hanyang University"
            ]
        }
    ],
    "references": [
        "https://openalex.org/W2964029185",
        "https://openalex.org/W2762812602",
        "https://openalex.org/W2596636257",
        "https://openalex.org/W3111367006",
        "https://openalex.org/W4210659589",
        "https://openalex.org/W2962291197",
        "https://openalex.org/W2557998141",
        "https://openalex.org/W2341720557",
        "https://openalex.org/W2796601718",
        "https://openalex.org/W2100989187",
        "https://openalex.org/W3018493579",
        "https://openalex.org/W2939481405",
        "https://openalex.org/W2963330196",
        "https://openalex.org/W2955256308",
        "https://openalex.org/W2792312025",
        "https://openalex.org/W2938514801",
        "https://openalex.org/W3088369757",
        "https://openalex.org/W1978067818",
        "https://openalex.org/W2991570458",
        "https://openalex.org/W2888967269",
        "https://openalex.org/W3009492968",
        "https://openalex.org/W2309512289",
        "https://openalex.org/W2979431265",
        "https://openalex.org/W2890784233",
        "https://openalex.org/W3198844990",
        "https://openalex.org/W3088141759",
        "https://openalex.org/W2774472083",
        "https://openalex.org/W2051376734",
        "https://openalex.org/W6739901393",
        "https://openalex.org/W2014758824",
        "https://openalex.org/W2743415265",
        "https://openalex.org/W3038512956",
        "https://openalex.org/W2776252545",
        "https://openalex.org/W2753866421",
        "https://openalex.org/W2113638573",
        "https://openalex.org/W2339497643",
        "https://openalex.org/W2136274821",
        "https://openalex.org/W2885195348",
        "https://openalex.org/W6780226713",
        "https://openalex.org/W1490921409",
        "https://openalex.org/W6631190155",
        "https://openalex.org/W2944432420",
        "https://openalex.org/W1522301498",
        "https://openalex.org/W4385245566"
    ],
    "abstract": "In a channel state information (CSI) based indoor positioning system, the positioning performance becomes susceptible to multipath fading effects especially in non-line-of-sight environments. We propose a transformer-based indoor positioning system (TIPS) to address this challenge. The proposed TIPS utilizes a self-attention mechanism to process the continuous WiFi CSI observed from predetermined routes as fingerprints in a given indoor environment. Each route is then considered a sentence, whereas the position along the route is treated as a word in terms of natural language processing. Consequently, the problem of predicting the position with the fingerprints can then be considered the task of predicting the current word with previous words, which can be efficiently solved using the proposed TIPS. In order to fully exploit the relations among positions, we propose embedding the information of the direction of arrival (DoA) on top of the collected CSI as inputs to the TIPS. Thus, the transformer of the proposed TIPS can better capture the dependencies of the positions in the route and significantly boost positioning accuracy. To exhibit the superiority of the proposed TIPS in a radio frequency (RF) environment, we demonstrate a hardware implementation of an RF testbed consisting of an emulator of WiFi access point and user equipment. Through extensive computer simulations and experimental tests, it is demonstrated that the proposed TIPS can reduce the positioning error down to 20 cm, which is a significant improvement compared to the current state-of-the-art models.",
    "full_text": "Received 27 September 2022, accepted 14 October 2022, date of publication 19 October 2022, date of current version 26 October 2022.\nDigital Object Identifier 10.1 109/ACCESS.2022.3215504\nTIPS: Transformer Based Indoor Positioning\nSystem Using Both CSI and\nDoA of WiFi Signal\nZHONGFENG ZHANG\n , HONGXIN DU, SEUNGWON CHOI\n, (Member, IEEE),\nAND SUNG HO CHO\n, (Member, IEEE)\nDepartment of Electronic Engineering, Hanyang University, Seoul 04763, South Korea\nCorresponding author: Seungwon Choi (choi@dsplab.hanyang.ac.kr)\nThis work was supported by the National Research Foundation (NRF), South Korea, under Grant NRF-2022R1A2C2008783.\nABSTRACT In a channel state information (CSI) based indoor positioning system, the positioning\nperformance becomes susceptible to multipath fading effects especially in non-line-of-sight environments.\nWe propose a transformer-based indoor positioning system (TIPS) to address this challenge. The proposed\nTIPS utilizes a self-attention mechanism to process the continuous WiFi CSI observed from predetermined\nroutes as ﬁngerprints in a given indoor environment. Each route is then considered a sentence, whereas\nthe position along the route is treated as a word in terms of natural language processing. Consequently,\nthe problem of predicting the position with the ﬁngerprints can then be considered the task of predicting the\ncurrent word with previous words, which can be efﬁciently solved using the proposed TIPS. In order to\nfully exploit the relations among positions, we propose embedding the information of the direction of arrival\n(DoA) on top of the collected CSI as inputs to the TIPS. Thus, the transformer of the proposed TIPS can better\ncapture the dependencies of the positions in the route and signiﬁcantly boost positioning accuracy. To exhibit\nthe superiority of the proposed TIPS in a radio frequency (RF) environment, we demonstrate a hardware\nimplementation of an RF testbed consisting of an emulator of WiFi access point and user equipment. Through\nextensive computer simulations and experimental tests, it is demonstrated that the proposed TIPS can reduce\nthe positioning error down to 20 cm, which is a signiﬁcant improvement compared to the current state-of-\nthe-art models.\nINDEX TERMS CSI, DoA, indoor positioning system, transformer.\nI. INTRODUCTION\nThe accurate positioning of mobile user equipment (UE) is\nof great help in providing location-related services such as\nnavigation, virtual reality, and motion tracking [1], [2], [3].\nIt is also beneﬁcial to smart buildings [4], the Internet of\nThings [5], and machine type communication [6]. A global\npositioning system (GPS) enables accurate localization in\nthe outdoor environment, whereas the GPS signals degrade\nsigniﬁcantly in an indoor environment [7], resulting in\npoor indoor positioning accuracy. Therefore, the GPS is not\napplicable in the robot or drone navigation cases, which\nThe associate editor coordinating the review of this manuscript and\napproving it for publication was Zihuai Lin\n.\nrequire a high degree of centimeter-level positioning preci-\nsion. The prevalent indoor positioning technologies include\nultra-wideband, Bluetooth, ZigBee, WiFi, geomagnetic\n[8], [9], [10]. Among these technologies, WiFi has been\nextensively researched over the last few decades owing to\nits widespread deployment and low cost. As a state-of-the-\nart technology, WiFi ﬁngerprinting indoor localization sys-\ntems (IPS) have been largely studied for both localization\n[11], [12], [13], [14], tracking [15], and activity recognition\n[16], [17] applications. The radio frequency (RF) charac-\nteristics of WiFi signals at each location are unique due\nto their different propagation paths, and the RF character-\nistics can be considered unique ﬁngerprints. With all the\nﬁngerprints of locations collected and stored in the database\nVOLUME 10, 2022 This work is licensed under a Creative Commons Attribution 4.0 License. For more information, see https://creativecommons.org/licenses/by/4.0/ 111363\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nbeforehand, accurate localization can be achieved by com-\nparing the received WiFi signal with the data in the database.\nThe construction of a WiFi-based IPS comprises two phases.\nOne is the ofﬂine phase, during which the ﬁngerprints\n(RF characteristics) of the WiFi signal at the reference\npoints (RP) are collected to construct the database for the\nIPS. The other is the online phase, during which the ﬁn-\ngerprints available in the database are compared with the\nnew ﬁngerprints of the WiFi signal received at the test\npositions.\nThe ﬁngerprinting-based IPS requires a site survey pro-\ncess where a radio map is created by measuring the signal\ncharacteristics of the predetermined positions in the indoor\nenvironment. By comparing the signal received at a RP and\nthe one stored in the radio map, the position with the ﬁnger-\nprint that has the highest correlation with the ﬁngerprint of\nthe test position is determined as the predicted position of\nthe UE. A WiFi-based IPS can employ either the received\nsystem strength indicator (RSSI) or channel state information\n(CSI) as ﬁngerprints for reference positions. The RSSI is\na single value representing the received power level, which\ncan ﬂuctuate signiﬁcantly in both line-of-sight (LOS) and\nnon-line-of-sight (NLOS) environments [18]. By contrast,\nCSI provides ﬁne-grained signal information provided by\nmultiple subcarriers (SCs) in orthogonal frequency-division\nmultiplexing (OFDM) symbols available in WiFi signals.\nIn the presence of the multipath effect, CSI is more stable than\nRSSI [19], [20], [21]. Consequently, CSI-based IPSs have\ngained momentum in recent years.\nRecently, deep learning (DL) based algorithms are gain-\ning a keen interest in the application of IPS. Some related\nworks [22], [23], [24], [25], [26] have shown that the DL algo-\nrithms such as dense neural network (DNN), convolutional\nneural network (CNN), long short-term memory (LSTM),\netc. can help the IPS better capture the correlation between the\nﬁngerprint and corresponding position, which consequently\nenhances the accuracy compared to the conventional meth-\nods [27], [28]. Although the DL algorithms commonly used\nin IPS can reduce the positioning error down to 1-2 meter,\nit is still challenging for the IPS to reach centimeter level\naccuracy considering many adverse indoor signal environ-\nments involving the signal instabilities caused by multipath\nfading effects. In this paper, we claim that the centimeter level\naccuracy can be achieved by adopting direction of arrival\n(DoA) as well as CSI as the ﬁngerprints of the radio map\nbecause the DoA of the WiFi signal has been proven to be\nstable in [26]. In order to integrate the two heterogeneous\nﬁngerprints, DoA and CSI, we adopt the transformer neural\nnetwork [29], which converts the indoor positioning task into\nthe problem of language processing.\nThe main contributions of this paper are as follows.\n• We propose a transformer-based IPS with an extremely\nhigh positioning accuracy. To the best of our knowledge,\nthis paper is the ﬁrst to apply the self-attention mecha-\nnism provided by a transformer to the indoor positioning\nproblem utilizing the WiFi signals.\nTABLE 1. Acronyms and corresponding explanations.\n• We propose utilizing both the CSI extracted and the DoA\nestimated from the received WiFi signal by embedding\nthem together during the preprocessing stage. Then,\nthe embedded data are fed to the proposed transformer\nbased indoor positioning system (TIPS) to learn the rela-\ntionship between the positions and their corresponding\nCSI & DoA.\n• We demonstrate the superiority of the proposed TIPS\nthrough extensive computer simulations, utilizing the\nray-tracing technique to simulate an indoor environment\nwith rich multipath propagation. Then, we evaluate and\nanalyze the performance of the TIPS trained on differ-\nent types of datasets, i.e., CSI-only dataset, DoA-only\ndataset, and CSI & DoA dataset, as well as the impact of\nthe input batch size.\n• We implemented an RF testbed using multiple universal\nsoftware radio peripherals (USRPs) and a central pro-\ncessing unit (CPU) to emulate a single access point (AP)\nand UE. The RF experiments were conducted to verify\nthe high accuracy of the proposed TIPS by comparing it\nwith state-of-the-art solutions.\nThe remainder of this paper is organized as follows.\nSection II describes the related works on the ﬁngerprinting-\nbased IPS. Section III brieﬂy explains the CSI and DoA\n111364 VOLUME 10, 2022\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nthat are utilized as ﬁngerprints. Section IV introduces the\nproposed TIPS and details the ﬁngerprinting technique.\nSection V presents the transformer model adopted for TIPS\nand describes the CSI and DoA preprocessing processes.\nSection VI explains the detailed training process and demon-\nstrates the performance of TIPS under various scenarios\nthrough computer simulations. Section VII shows the exper-\nimental results with RF signals and veriﬁes the superior\nperformance of TIPS by comparing it with other positioning\nsolutions. Finally, Section VIII concludes the paper.\nII. RELATED WORKS\nThis sections describes the previous works on the\nﬁngerprinting-based IPS using WiFi signal. The\nﬁngerprinting-based IPS employs matching algorithms to\nestimate the position of the target. Prior to applying the\nalgorithms, a site survey process is carried out. During the\nsite survey process, a radio map consisting of the signal\ncharacteristics of WiFi signal of each predetermined locations\nis created.\nIn [28], the authors adopt an ﬁngerprinting-based IPS uti-\nlizing a probabilistic algorithm to model the RSSI received\nfrom an AP as random variable over time and space. With a\nradio map consisting the information of the RSSI at different\nlocations, the Horus system estimates the location of the UE\nby calculating the probability distribution of the measured\nRSSI. However, the performance is limited by the instability\nof the RSSI due to multipath effects in indoor environment.\nIn [27], the authors calculate the time-reversal resonance\nstrength and Euclidean distance between the target location\nand the RP using multidimensional scaling analysis. Then,\nan optimized kNN algorithm is used to predict the loca-\ntions. In [30], a passive radio map is utilized to address the\nlocalization problem by matching the CSI anomalies to the\nﬁngerprint database via a probabilistic algorithm. In [22],\nWang et al. propose DeepFi, a DL solution, to solve the local-\nization problem. A greedy learning algorithm is employed\nto train the proposed DL network to reduce complexity.\nSubsequently, a probabilistic method with a radial basis func-\ntion is used to estimate the location. However, the greedy\nlearning algorithm does not guarantee optimized weights for\nthe networks. Gao et al. in [31] adopt a DL network to\nestimate the location and activity of a person using radio\nimages transformed from CSI measurements from multiple\nchannels. In [32], a partially connected neural network is\nproposed to make the best use of both the amplitude and\nphase of the CSI given in a phasor format. However, the pro-\nposed networks may suffer from slow training and instability\nwhen dealing with complex nonlinear problems. In [33],\nthe authors propose an autoencoder-based indoor positioning\nmethod, which utilizes data of reduced dimension by an\nautoencoder from the data collected data by smartphones.\nChen et al. in [34] propose transforming the CSI amplitude\ninto a time-frequency matrix, which is treated as image data\nand used to train a CNN-based model for localization. In [24],\nWang et al. propose to estimate the DoA with the phase\ndifference of WiFi signal. The DoA values of a given location\nare more robust than that of the phase due to the stability of\nthe phase difference. Then, they adopt the two dimensional\nconvolutional neural network (2DCNN) to process the DoA\nimages to exploit the time-frequency features. In [23], the\nauthors propose utilizing the software-deﬁned radio to cap-\nture WiFi beacon frames passively. A feed-forward neural\nnetwork and one dimensional convolutional neural network\n(1DCNN) deep learning models are adopted to use full SCs\ncollected from the SDR. In [26], the authors propose a deep\nresidual sharing learning based IPS which uses the 2DCNN\nto exploit both frequency and time features in bimodal CSI\ndata. In [25], Zhang et al. propose utilizing the trajectory CSI\nto enhance the robustness of the instability of RF signals in the\nindoor environment. They employ an 1DCNN to extract the\nspatial information from the trajectory CSI. Then, an LSTM\nis used to further extract temporal information from the spa-\ntial information. Both the spacial and temporal information\nare used to enhance the robustness and accuracy of the IPS.\nTABLE 2. Accuracy comparison for representative IPS.\nIII. CSI AND DoA PRELIMINARY\nThis section describes the two components, CSI and DoA,\nused in this paper to construct the ﬁngerprinting-based IPS.\nTo explain how to combine these two different compo-\nnents, a brief introduction to the multiple signal classiﬁcation\n(MUSIC) algorithm and the spatial smoothing method will be\nprovided for estimating the DoA.\nA. CHANNEL STATE INFORMATION\nThe CSI of the WiFi signal can be extracted from the SCs\nof IEEE 802.11 ac based OFDM symbols. The ﬁne-grained\ncharacteristics of the wireless channel are then available in\nthe extracted CSI. Various CSI observations can be reﬂected\nat different positions in an indoor environment due to the RF\nfront-end impairment between the AP and UE. This property\nmakes CSI an ideal choice as ﬁngerprints for ﬁngerprinting-\nbased radio maps.\nIn an OFDM system, the received signal can be\nexpressed as\nr =h ·t +n, (1)\nwhere t and r denote the signal vectors from the transmit (Tx)\nand receive (Rx) signals, respectively. n denotes the additive\nVOLUME 10, 2022 111365\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nwhite Gaussian noise vector and h denotes the channel vector\nthat carries the CSI.\nThe ith SC channel hi is a complex-valued quantity that can\nbe written as\nhi =|hi|ej̸ hi , i =1,..., Ns, (2)\nwhere |hi|and ̸ hi are the magnitude and phase of the chan-\nnel, respectively, for the ith SC. Ns is the number of SCs\nin an OFDM symbol. Note that we only use the magnitude\nof channel hi because the phase information ̸ hi is unstable\nowing to the random jitters and noise caused by the imperfect\nhardware of the RF transceiver [22].\nB. DIRECTION OF ARRIVAL\nWe consider a typical far-ﬁeld signal scenario, in which\nsignals are transmitted from several sources. The impinging\nsignal received by an M-element uniform linear array (ULA)\ncan be expressed as\ny(ti) =\nK∑\nk=1\na(θk )sk (ti) +n(ti), i =1,..., T , (3)\nwhere K is the number of far-ﬁeld sources, T is the number\nof snapshots, and the source signal sk (ti) ∈C is received at\nsnapshot ti from the angle θk . The array steering vector a(θk )\nis given by\nam(θk ) =e−jm(2πλ)d sin θk , (4)\nwhere λ = c0/fc is the wavelength of the signal with the\nSC frequency being fc, and c0 being the speed of light.\nThe distance between antenna elements of the ULA is d. The\nobjective of the DoA is to estimate the angle θk .\nIn this paper, we use the MUSIC algorithm to estimate the\nDoA of the impinging signals. The MUSIC algorithm [35]\nis a subspace-based algorithm that provides super-resolution\nwith lower computational complexity compared to other DoA\ntechniques [36]. The essential idea behind the MUSIC algo-\nrithm is to conduct eigenvalue decomposition (EVD) or sin-\ngular value decomposition (SVD) on the sample covariance\nmatrix (SCM) of the received signal to acquire the signal and\nnoise subspaces that are orthogonal to each other. The two\northogonal subspaces are used to construct a pseudo spectrum\nwith the largest peaks corresponding to the DoA. SCM can be\nwritten as\nRxx =1\nT\nT∑\ni=1\ny(ti)y(ti)H , (5)\nIn an indoor environment, multipath signal propagation\nmakes the impinging signals coherent, of which the SCM is a\nsingular matrix. In such a case, the MUSIC algorithm fails;\ntherefore, it is necessary to apply smoothing technologies to\nSCM to obtain a non-singular matrix. Spatial smoothing [37]\nis performed by splitting the ULA into L subarrays, and the\nSCM can be written as\nRs\nxx =1\nL\nL∑\nl=1\nR(l)\nxx. (6)\nThe rank of Rs\nxx is the sum of the ranks of signal the space\nand noise subspace. We can construct the MUSIC pseudo-\nspectrum by taking EVD or SVD on the SCM, as in (5).\nP(θ) = 1\naH (θ)VnVHn aH (θ), (7)\nwhere a is the steering vector, as in (4), and Vn is a matrix\nspanning the noise subspace.\nThe K largest peaks in the result of (7) correspond to\nthe DoAs of the signals impinging on the ULA from K\nsources. The DoAs estimated using the MUSIC algorithm\nare the inputs to the proposed model, which are detailed in\nSection IV.\nIV. SYSTEM MODEL\nThis section describes the proposed TIPS architecture. The\nﬁngerprinting technique, including the online and ofﬂine\nphases of constructing an IPS, is explained.\nA. SYSTEM OVERVIEW\nFigure 1 shows the architectural overview of the proposed\nTIPS. The TIPS comprises three main modules: WiFi AP,\npreprocessor, and DL model. The WiFi AP equipped with\nan M-element ULA receives WiFi uplink signals from a\nsingle UE. The objective of the preprocessor is to extract the\nCSI and estimate the DoA from the received WiFi signal.\nThe extracted CSI and estimated DoA corresponding to each\nposition are stored in the database. The data in the database\nare then used as the input to the DL model for the training\nprocess. The training process is performed using a graphics\nprocessing unit (GPU) for a speed-up operation. The output\nof the DL model is the prediction of the UE’s current position.\nB. FINGERPRINTING TECHNIQUE\nThe proposed TIPS based on ﬁngerprints has two phases:\nofﬂine phase and online phase.\nDuring the ofﬂine phase, the WiFi signal from prede-\ntermined routes is measured. As shown in Figure 1, there\nare four predetermined routes 1, 2, 3, and 4. We adopted\nthe data collection method proposed in [25] to collect the\nWiFi signals continuously along each route. The collected\nWiFi signal is preprocessed in the preprocessor to extract\nthe CSI and estimate the DoA using equations (2) and (7),\nrespectively, as brieﬂy explained in Section II. Subsequently,\nthe CSI and DoA corresponding to all to-be-estimated posi-\ntions along each route are stored in the database. The CSI\nand DoA, along with the label (i.e., the correct position\ncorresponding to the CSI and DoA), are fed as input to the\ntransformer. More details regarding the training process are\nprovided in Section V-C. After the training is complete, the\ntrained model, including the neural network structure and its\noptimized weights, is available during the online phase.\nDuring the online phase, the test data are collected and\npreprocessed in the preprocessor to extract the CSI and esti-\nmate the DoA, similar to the collection and preprocessing\nof training data during the ofﬂine phase. Subsequently, the\n111366 VOLUME 10, 2022\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nFIGURE 1. The proposed TIPS system overview.\ntransformer model, which has been trained during the ofﬂine\nphase, is employed to predict the exact position correspond-\ning to the current test data input. The model is evaluated in\nterms of positioning accuracy obtained from the difference\nbetween the predicted and actual positions.\nV. TRANSFORMER FOR IPS\nThis section explains the transformer DL model for the IPS\nin detail. First, the CSI and DoA data processing for the\ninput data to the transformer is introduced. Then, the adopted\ntransformer structure is presented. Finally, we demonstrate\nthe application of the transformer model to an IPS.\nA. TRANSFORMER MODEL\nThe objective of the desired model is to predict the current\nposition by capturing the long-term dependencies from a\ncontinuous WiFi signal collected from predetermined routes.\nTo achieve this goal, we adopt a transformer-based neural\nnetwork model, which was initially introduced for the task\nof natural language processing (NLP) [29]. The original\ntransformer has an encoder and decoder structure; however,\nin contrast to the original transformer model, we used the\ngenerative pretrained transformer (GPT) model [38], which\nhas only the decoder part. GPT is an autoregressive model\nthat predicts words at the current time step based on the\nwords generated from the previous time steps. The follow-\ning words are then predicted based on the output of the\ncurrent time step in addition to the previously generated\nwords. In particular, GPT is advantageous in the applications\nthat predict sequential outputs based on previous predictions,\nwhich we believe is suitable for achieving the objective of\npredicting the next position based on previous positions.\nA simpliﬁed blog diagram of the transformer model is shown\nin Figure 2.\nFIGURE 2. Adopted transformer model.\nThe self-attention mechanism used by the transformer\nmodels discards sequential operations in favor of parallel\ncomputation, which is entirely different from recurrent neural\nnetworks (RNNs) [39]. Consequently, the transformer model\nis unaware of the order of the input sequence. In other\nwords, the positional information denoted as #1, #2,...,\nas shown in Figure 2, is lost. To compensate for the\nloss of positional information, position-dependent signals\nare generated based on the index of each sample of the\ninput sequence through positional encoding. The generated\nVOLUME 10, 2022 111367\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nposition-dependent signals are added to the correspond-\ning samples of the processed data sequence, Xp, which is\nexplained in detail in Section IV-B.\nThe transformer consists of several decoder layers. In each\ndecoder layer, a self-attention layer, normalization layer, and\nfeedforward network are included.\nIn the self-attention layer, a masked self-attention mech-\nanism is employed to prevent the prediction of the current\nposition (e,g., #7), from attending to future positions. Instead\nof attending to future positions, the model only attends to past\npositions, for example, from #1 to #6. The decoder produces\nthe joint probability of the current position as the product of\nthe conditional probabilities of the previous positions.\np(yn) =\nn−1∏\ni=1\np(xi\np|x1\np,..., xi−1\np ). (8)\nThe normalization layer [40] normalizes the distribution of\nthe intermediate layers and stabilizes the gradients of loss;\ntherefore, faster training and better generalization can be\nachieved. Finally, the feedforward network transforms the\nattention vector, i.e., the output of the self-attention layer,\ninto a nonlinear representation that suits the input of the next\ndecoder layer.\nB. DATA PREPROCESSING\nThe input to the original transformer is a sequence of a\nsentence consisting of a ﬁxed number of words. However,\nwe modiﬁed the model for the IPS application to make it\ncompatible with the inputs of CSI and DoA continuously\ncollected from predetermined routes.\nFIGURE 3. Data processing of embedding the CSI and DoA.\nThe CSI can be considered as a multivariate time series\ndata, Xcsi ∈ RW ×d = [x1\ncsi,x2\ncsi,..., xW\ncsi]T . Each feature\nvector corresponding to a single time step t is xt\ncsi ∈ Rd ,\nwhere d is the number of variables in one vector. The raw\nDoA can also be considered as time series data but with\nonly a single integer value for a single time step, Xdoa ∈\nZW ×1 =[x1\ndoa,x2\ndoa,..., xW\ndoa]T falls within the range from\n−90◦ to 90 ◦. However, we add 90 ◦ to the raw DoA so\nthat it falls within the range from 0 ◦ to 180 ◦ because the\nembedding layer in the neural network takes only a positive\ninteger as input. The DoA is then linearly projected onto a\nd-dimensional vector space via an embedding table, as shown\nin Figure 3. The embedded vector can be expressed as:\nut\ndoa =Wext\ndoa +be, t =1,..., W , (9)\nwhere We ∈Rd×1 and be ∈Rd are trainable parameters\noptimized during the training of the neural network. ut\ndoa ∈\nRd ,t = 0,..., W is the embedded output, which corre-\nsponds to a word vector in the case of an NLP transformer.\nThe embedded data Udoa ∈RW ×d =[u1\ndoa,u2\ndoa,..., uW\ndoa]T\nare added to XCSI to form the processed data Xp ∈RW ×d =\n[x1\np,x2\np,..., xW\np ]\nVI. COMPUTER SIMULATIONS\nThis section introduces a modeled indoor propagation envi-\nronment for computer simulations performed using MAT-\nLAB. First, we explain how the datasets are prepared to\ntrain the transformer model shown in Section IV. A detailed\nexplanation of the transformer training process is provided.\nFinally, the performance of the proposed TIPS in various\nscenarios is evaluated and analyzed.\nA. INDOOR PROPAGATION ENVIRONMENT\nFigure 4 shows the 8 m ×5 m indoor propagation envi-\nronment for which the simulations are carried out. The blue\npoints and red points in the ﬁgure denote the RPs and APs,\nrespectively.\nThe indoor propagation environment employs four APs,\neach of which is equipped with 8-antenna element ULA. The\nchannel bandwidth is set to 20 MHz, corresponding to 56 SCs\nfor each OFDM symbol of IEEE 802.11ac. CSI is generated\nusing the ray-tracing technique [41] implemented in MAT-\nLAB. The ray-tracing technique can help build multipath\nchannel models for indoor environments.\nIn our simulations, a UE with a single antenna transmits\nWiFi OFDM signals from all the predetermined RPs. Each\nAP extracts the CSI and estimates the DoA from the received\nWiFi signals as ﬁngerprints. Predetermined RPs are uni-\nformly distributed with a spacing of 10 cm. The total number\nof RPs is 79 ×49 =3871 points, with 49 points along the\nx-axis and 79 points along the y-axis. Note that the number\nof the RPs used in the simulations is not the same as shown\nin Figure 4.\nWe set the parameters of the ray propagation model to\nconsider only the LOS and ﬁrst-order reﬂection. The number\nof rays is of size NAP ×NUE, where NRP is the number of\nAPs, and NUE is the number of RPs. Hence, the size of the\nrays generated using the ray-tracing technique is 4 ×3871 in\nour simulation. A visualization of the rays at an arbitrary RP\nis shown in Figure 5. From the ﬁgure, three APs have LOS\npropagation to the RP, whereas the signal emitted from the\nremaining AP only reaches the RP via reﬂection without LOS\npropagation. The different colors denote different path losses\nin decibels (dB).\n111368 VOLUME 10, 2022\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nFIGURE 4. Indoor propagation environment.\nFIGURE 5. Visualization of rays received at an arbitrary RP.\nB. PREPARATION OF DATASETS\nThe four APs receive 802.11 ac packets transmitted from a\nsingle UE at each of the RPs in the modeled indoor environ-\nment shown in Figure 4. The CSI extracted from the received\nWiFi signal is a complex-valued variable including both the\nmagnitude and phase for 56 SCs as shown in (2), of which\nwe only use the magnitude. Consequently, the data size of\nthe CSI is Ns ×Ntx-rx ×NAP ×NUE, where Ns is the number\nof SCs, Ntx-rx is the number of Tx-Rx antenna pairs. There-\nfore, in our simulation, the size of the dataset is 56 ×8 ×\n4 ×3871. As explained in Section IV-B, the DoA estimated\nfrom the received WiFi signal is a real-valued variable rang-\ning from 0 ◦to 180 ◦. Consequently, the data size of the DoA\nis 1 ×NAP ×NUE, i.e., 1 ×4 ×3871 in our simulation.\nTo extensively evaluate the performance of our transformer\nmodel under various SNR scenarios, we generate WiFi sig-\nnals under SNR scenarios from 0 to 30 dB. For each SNR,\nwe generate 100 WiFi signal samples, which are then divided\ninto 80 training data samples and 20 validation data samples.\nIn addition, 20 WiFi signal samples are generated as test data\nsamples.\nFIGURE 6. The CSI of 79 RPs along eight arbitrary routes.\nWe divide the 3871 RPs into 49 routes, along each of which\nthere are 79 RPs. Each route can be considered a sentence in\nterms of NLP, whereas the CSI measured at each RP along the\nroute can be considered an individual word. Figure 6 shows\nthe CSI measured at 79 RPs along eight arbitrary routes from\na total of 49 routes. The lines with different colors in each\nsubplot denote the CSI of each SC. To match the data size of\nthe CSI with that of the input of the transformer, we combine\nthe dimensions of Ns, Ntx-rx, and NAP into one dimension\nof size 1792, i.e., 56 (number of SCs) ×8 (number of Rx\nantennas) ×4 (number of APs). The CSI dataset is then\nreshaped to a size of 79 ×49 ×1792. Likewise, the DoA\ndataset is reshaped to 79 ×49 ×4. Table 3 lists the datasets\ncorresponding to the environmental parameters.\nC. TRAINING PROCESS\nThe processed CSI and DoA, as shown in Figure 3, are\nﬁrst mapped into the corresponding dmodel-dimensional input\nembeddings via the embedding lookup table. The processed\ndata are then fed into the transformer model. CSI and DoA\ncan be considered ﬁngerprints of RPs. The label of the ﬁn-\ngerprint is ci,i ∈ Z,i = 0,1,..., 3870 corresponding to\nthe position. The position-prediction task is to estimate the\nprobability for a given position (or a sequence of positions)\nbased on the transformer outputs for the previous positions.\nThe probability estimation is calculated by putting the output\nof the transformer model into a linear layer followed by a log-\nsoftmax function. Then, a cross-entropy loss for updating the\nmodel’s weights via backpropagation is calculated. We use\nthe Adam optimizer [42] with a learning rate of 0.0001 to\naccelerate the gradient descent algorithm. The number of\ntransformer layers ltr is set to three, and the number of\nattention heads per layer htr is set to four.\nVOLUME 10, 2022 111369\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nTABLE 3. Detailed dataset information.\nFIGURE 7. Transformer training process.\nAll the routes can be trained together simultaneously by\nenabling the parallel processing due to the fact the training\nfor each route is independent of that for the other routes.\nAs shown in Figure 7, the input data of size K ×L in the\nﬁrst batch B1 are fed to the transformer to be trained at once,\nwhere K is the number of samples trained in a route at once\nand L is the number of routes. K is 40, and L is 49 in our\nsimulation. After the ﬁrst batch is trained, the samples at\npositions from 2 to K +1 of all routes of the next batch B2 are\nfed to the transformer to be trained. The training continues\nuntil the training for the last batch BM is completed. Note\nthat the data at the same positions on different routes can\nbe trained together without interference because the train-\ning for each route is independent of one another. We may\nconsider changing the sample size K to adjust the sequence\nlength. With a larger K, the model can capture longer-\nterm dependencies among positions and vice versa. Table 4\nsummarizes the hyper-parameter settings for our transformer\nmodel.\nTABLE 4. Hyper-parameter settings.\nFIGURE 8. Positioning error of models trained on datasets including only\nCSI under different SNRs.\nD. PERFORMANCE OF THE PROPOSED TIPS\nTRAINED ON CSI-ONLY DATASET\nWe conducted experiments to investigate the performance of\nTIPS as a function of the SNRs, while the training datasets are\ngenerated only with the CSI of WiFi signals. First, our model\nis trained with the CSI generated under six different SNR\nvalues, i.e., 5, 10, 15, 20, 25, and 30 dB. Then, our transformer\nmodel is trained with CSI in an environment where the SNR\nvalue varies between 0 dB and 30 dB.\nFigure 8 compares the positioning error in centimeters as\na function of the SNR for the seven different models. As the\nSNR increases, the positioning error decreases for the models\ntrained on datasets of 5 dB, 25 dB, 30 dB, and all SNRs.\nThe models trained on datasets with 10 dB and 15 dB SNR\nexhibit relatively superior performance when SNR varies\nfrom 10 dB to 24 dB. However, it can also be observed that\nthe performance superiority of the model trained on a dataset\nof 15 dB (10 dB) is slightly reduced when the SNR becomes\ngreater than 15 dB (20 dB). This observation implies that\nthe transformer model trained in a noisy environment does\nnot necessarily exhibit a better performance in a noise-free\nenvironment.\nIt is also observed that, for lower SNRs, i.e., from 0-9 dB,\nthe model trained on datasets of all SNRs shows the best\nperformance because the model is better aware of the data\n111370 VOLUME 10, 2022\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\ngenerated from the lower SNRs, which are included in\nthe training dataset. However, this model appears to per-\nform worse than the other models for higher SNRs, i.e.,\nfrom 14-30 dB, due to the erroneous information caused\nby the heavily noisy training samples. The models trained\non datasets with an SNR of 25 or 30 dB exhibit superior\nperformance than other models for the high SNR range, i.e.,\nfrom 25-30 dB.\nE. PERFORMANCE OF THE TIPS TRAINED ON\nDoA-ONLY DATASET\nWe conducted experiments to investigate the performance of\nTIPS as a function of the SNRs, while the training datasets\nare composed of only the DoA of WiFi signals. First, our\ntransformer model is trained with the DoA estimated under\nﬁve different values for SNR, i.e., 10, 15, 20, 25, and\n30 dB. Subsequently, our model is trained with the DoA\nestimated in an environment where the SNR value varies\nbetween 0 and 30 dB.\nFIGURE 9. Positioning error of models trained on datasets including only\nDoA under different SNRs.\nFigure 9 compares the positioning error in centimeters as\na function of the SNR for the six different models. As the\nSNR increases, the positioning error does not decrease in the\nsame manner as when the training dataset is the CSI-only\ndataset. It can be observed that the models trained on DoA-\nonly datasets perform excellently when the SNR of the test\ndata is the same as that of the training data. However, the\nmodels exhibit signiﬁcant performance degradation when the\nSNR of the test dataset does not match that of the training\ndataset.\nThe model trained on the dataset generated under all SNRs\nexhibit the worst performance. This is a substantial limitation\nconcerning the ability of the model to learn the similarities of\nthe DoA under different SNRs. Consequently, the DoA-only\ndatasets prove to be of little help in training the model.\nF. PERFORMANCE OF THE TIPS TRAINED ON\nBOTH CSI AND DoA\nWe conducted experiments to investigate the performance of\nTIPS as a function of SNRs, while the training datasets are\ncomposed of CSI & DoA of WiFi signals. We compared the\nperformance of the models trained on DoA-only datasets and\nthose trained on CSI & DoA datasets under ﬁve different\nSNRs, i.e., 10, 15, 20, 25, and 30 dB.\nFigure 10 compares the positioning error in centimeters as\na function of the SNR for ten different models. The dotted\nlines denote the models trained on DoA-only datasets, and\nthe solid lines denote the models trained on the CSI & DoA\ndatasets. It can be observed that the models trained on\nCSI & DoA datasets have a much lower positioning error\nthan those trained on DoA-only datasets when the SNR of\nthe test data is the same as that of the training data. However,\nthe models show signiﬁcant performance degradation which\nbears a strong resemblance to the models trained on DoA-\nonly datasets. This indicates that the DoA plays a predomi-\nnant role during the training process compared with the CSI\nwhen the WiFi signal is generated under a single SNR.\nFIGURE 10. Positioning error of models trained on CSI & DoA datasets\nunder different SNRs.\nIt has been observed that the models trained on CSI-only\ndatasets exhibit more consistent and better performance as\na function of SNR than those trained on DoA-only datasets.\nWe compare the performance of the models trained on CSI-\nonly datasets and the model trained on CSI & DoA datasets,\nwhere the SNR varies between 0 and 30 dB.\nFigure 11 compares the positioning error in centimeters\nas a function of the SNR for the eight different models. The\nmodel trained on CSI & DoA datasets, where the SNR varies\nbetween 0 and 30 dB, exhibits the best performance. This\nindicates that the model can learn more beneﬁcial informa-\ntion from both the CSI & DoA datasets, where the SNR has\na wider range than the CSI-only dataset.\nG. IMPACT OF BATCH SIZE K\nThe performance of the proposed transformer model was\nobserved with various values for the batch size K, which\nshould be determined on account of a trade-off between the\ndependencies among the positions and the time for training\nthe model.\nThe transformer model can attend to more ﬁngerprints of\nprevious positions with a larger K, corresponding to longer-\nterm dependencies among positions. Thus, the model can\nselectively pay more attention (by assigning a larger signif-\nicance probability) to positions where multipath fading has\nless severe impacts. The transformer model is more likely to\nVOLUME 10, 2022 111371\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nFIGURE 11. Positioning error comparison for the models trained on the\nCSI-only and CSI & DoA datasets.\ncorrectly predict the subsequent position with more exposure\nto effective ﬁngerprints. However, longer dependencies may\nlead to a longer time required for the model to converge.\nFurthermore, if the value of K is too large, the model per-\nformance may be degraded unless the transformer model can\nhandle the large size of the long input data sequence.\nIn contrast, short-term dependencies among positions,\nwhich correspond to a small K, can accelerate the training\nspeed; however, the performance may not be satisfactory due\nto the lack of effective ﬁngerprints to which the transformer\ncan attend for predicting the next position.\nTable 5 shows the training time and training loss of\nthe proposed TIPS for various values of the batch size K.\nAs the batch size K increases, the training time increases,\nand the training loss reduces because the model can enhance\nits ability to capture the long-term dependencies of the input\nsequence. However, when the batch size K exceeds 40, the\ndecreasing rate of the training loss becomes signiﬁcantly\nsmall, but the increasing rate of the training time remains\nalmost the same. Hence, considering the training loss and the\ncost of the training time, we conclude that a batch size K equal\nto 40 is an optimal value for our model.\nH. TRAINING TIME COMPARISON\nThe training time of the model is observed for different\ndatasets, i.e., the CSI-only dataset and CSI & DoA dataset.\nTo be speciﬁc, we measured the training time and training\nloss to evaluate the training time provided by the CSI-only\nand CSI & DoA datasets.\nTable 6 shows the training loss and training time for\ntwo different training datasets, i.e., the CSI-only dataset and\nCSI & DoA dataset. The model trained on CSI-only has\n0.07 training loss with 170-second training time, whereas the\nmodel trained on CSI & DoA dataset has only 0.02 training\nloss with only 65-second training time. In other words, the\nmodel trained on CSI & DoA dataset converges much faster\nthan the model trained on the CSI-only dataset. The intuition\nbehind the fast training with CSI & DoA dataset is that\nthe embedding of CSI and DoA can help the transformer\nTABLE 5. Model’s training time and training loss for different batch\nsize K.\nTABLE 6. Comparison of training time and loss of models training on\ndifferent types of datasets.\nmodel more effectively and optimally allocate attention to the\nprevious positions where the ﬁngerprints can be utilized for\npredicting the current position.\nI. IMPACT OF ANTENNA ARRAY SIZE AND\nSIGNAL BANDWIDTH\nHaving noticed that the IPS performance might seriously be\naffected by the antenna array size as well as the bandwidth of\nthe WiFi signal, we summarise in this subsection the impact\nof antenna array size and signal bandwidth obtained from\nvarious computer simulations.\nTo evaluate the actual effects of antenna array size and\nsignal bandwidth on the performance of our proposed TIPS,\nwe generated the datasets of both the CSI and DoA under\ndifferent antenna array size and signal bandwidth. The model\nis trained for 200 epochs with the batch size K being equal\nto 40. Figure 12 shows the cumulative probability over the\ndistance error in centimeters under four different cases of\nantenna array size and signal bandwidth. As the ﬁgure illus-\ntrates, the positioning error decreases as the signal band-\nwidth increases with the 2-dimensional antenna array size\nbeing ﬁxed to 4 ×4. The positioning error is within 20 cm\nfor signal bandwidth 80MHz, 40MHz, and 20MHz with a\nprobability of 90%, 70%, and 60%,respectively. It can be\nobserved that the larger signal bandwidth contributes to the\nmore accurate positioning. It is because the richer position-\nrelated CSI from the wider signal bandwidth can result in the\nbetter performance. Note that, as the bandwidth of the WiFi\nsignal gets larger, more SCs of the OFDM symbol can be\nutilized for constructing the radio map. On the other hand,\nas the size of the 2-dimensional antenna array decreases from\n4 ×4 to 2 ×2 with the bandwidth being ﬁxed to 20MHz,\nthe performance of the IPS is degraded. With antenna size\nof 2 ×2, the probability of holding the positioning error\nwithin 20 cm decreases to 50% compared to the case of\n111372 VOLUME 10, 2022\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nFIGURE 12. Predetermined routes in the indoor RF environment.\n4 ×4 antenna array that provides the probability of 60%.\nThe main reason is that the larger antenna size can lead to\nthe better DoA resolution, which results in the more accurate\npositioning.\nVII. EXPERIMENTAL RESULTS WITH RF SIGNALS\nThis section introduces the RF experiments conducted using a\ntestbed implemented for the proposed TIPS. The RF WiFi sig-\nnals are collected along the predetermined routes and prepro-\ncessed to extract CSI and DoA. As explained in Section IV-B,\nthe preprocessed CSI and DoA are then embedded together\nto prepare for model training. We observed the impact of data\nscaling on model training and compared the performance of\nthe proposed TIPS and other state-of-the-art indoor position-\ning methods.\nA. RF TESTBED\nWe implemented an RF testbed for the proposed TIPS using\nUSRPs and a CPU. USRPs, which are frequently used for\nSDR communication applications, are reconﬁgurable RF\ndevices consisting of an RF front end, an analog-to-digital\nconverter, and a frequency down-converter.\nFigure 13 shows the implemented RF testbed consisting of\nﬁve USRPs. Among the ﬁve USRPs, we used four USRPs\n(Ettus X310 [43]), each of which provides two Rx chan-\nnels, to implement a single AP. Each channel is connected\nto an omnidirectional antenna (VERT2450 [44]). The eight\nantennas constitute an 8-element ULA for the DoA estima-\ntion. For UE, we used a single USRP (Ettus X310) with a\nsingle Tx channel connected to an omnidirectional antenna\n(VERT2450) as the RF transceiver. The host PC executes the\nUSRP hardware driver (UHD) using MATLAB to control all\nthe ﬁve USRPs, including four USRPs for the AP and one\nUSRP for the UE. An Ethernet switch connects all the USRPs\nwith the host PC via 10 gigabit Ethernet cables for data packet\ntransmission. For time synchronization among Rx channels at\nthe AP, we used OctoClock (CDA-2990 [45]) to synchronize\nFIGURE 13. The RF testbed located in an indoor RF environment.\nthe eight Rx channels of the AP to the common timing source\nprovided by the OctoClock.\nTo acquire an accurate DoA estimation, it is critical to\nalign the phase among the eight Rx channels of the AP.\nDue to the random phase offset incurred at each channel\nof the USRPs [46], the DoA estimation becomes infeasible.\nTo tackle the phase offset problem, we implemented phase\ncalibration for the alignment of the phase among USRP chan-\nnels before performing DoA estimation. For phase calibra-\ntion, we utilized an 8-way splitter to distribute the sinusoidal\ncalibration signal to each Rx channel of the AP with RF\ncables of identical length. We estimate and compensate for\nthe phase difference among the eight Rx channels using the\nreceived sinusoidal signal.\nB. PREPARATION OF DATASETS\nTo evaluate the performance of the proposed TIPS in an\nindoor RF environment, we predetermined 16 routes, as illus-\ntrated in Figure 14. Each route consists of 480 uniformly\ndistributed virtual RPs (VRPs) with a spacing of 1 cm. Note\nthat the spacing can be set to different values for different\nresolutions.\nThe UE continuously transmits the 802.11ac WiFi signal\ngenerated by MATLAB while moving along each of the\n16 routes. The WiFi signal emitted from the moving UE is\nreceived by the AP located at a ﬁxed location. The AP then\nVOLUME 10, 2022 111373\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nFIGURE 14. Predetermined routes in the indoor RF environment.\nextracts the CSI and estimates the DoA from the received\nWiFi signal. Consequently, the CSI dataset has a size of\n480 ×16 ×448, where 480 is the number of VRPs, 16 is\nthe total number of routes, and 448 is the dimension of the\nvariable for each VRP determined by the number of SCs\nand channels (448 =56 ×8). For each VRP, only a single\nDoA value is estimated, and the DoA dataset has a size of\n480 ×16 ×1.\nFigure 15 shows the CSI measured by the eight Rx chan-\nnels of the AP at 480 VRPs along a single route. The lines\nwith different colors in each subplot correspond to the CSI of\neach SC.\nC. EXPERIMENTAL PROCEDURES\nTo further explain the application of the proposed TIPS in\nthe indoor RF environment, Figure 16 shows the ﬂowchart of\nthe experimental procedures. As shown in the ﬂowchart, the\nmultiple USRPs are phase aligned through phase calibration\nbefore the reception of the WiFi signal. Then, the received\nWiFi signals at all 480 VRPs are through the process of\nresampling and denoising so that the extracted WiFi CSI of\neach VRP should become of the same sample length with\nless noise. With the preprocessed WiFi signal, we employ\nthe MUSIC algorithm to estimate the DoA of the WiFi signal\nat each VRP. Both the WiFi CSI and DoA are embedded as\nexplained in Section V-B to form the dataset of 480 VRPs.\nWe perform the data scaling on the dataset in order to stan-\ndardize the dataset. The standardized dataset is then used to\ntrain the adopted transformer model. Note that the training\nprocess is detailed in Section VI-C.\nD. IMPACT OF DATA SCALING\nWe observed the impact of data standardization on the train-\ning process of the transformer model. Our model is trained\nwith two different datasets; one is composed of raw data, and\nthe other is composed of data standardized to have zero mean\nand unit variance. As shown in Figure 17, the model trained\nFIGURE 15. CSI of 480 VRPs along a single route measured from eight Rx\nchannels of AP.\nFIGURE 16. Flowchart of the experimental procedures.\nFIGURE 17. Model’s training loss over epochs.\non the dataset without standardization fails to converge and\nmaintains a high training loss throughout 30 epochs. In con-\ntrast, the model trained on the standardized dataset converges\nwithin ten epochs and exhibits a signiﬁcantly low training\nloss. This implies that data standardization is essential for the\ntraining process of the proposed TIPS.\n111374 VOLUME 10, 2022\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\nE. PERFORMANCE COMPARISON WITH\nEXISTING METHODS\nWe compare the performance of the proposed TIPS with\nthat of state-of-the-art solutions, i.e., 1DCNN-LSTM [25],\nConFi [34], DeepFi [22], and Horus [28]. 1DCNN-LSTM uti-\nlizes a CNN and LSTM neural structure to extract spatial and\ntemporal information from the trajectory CSI. ConFi employs\na CNN with CSI input collected at multiple time instances\nand antennas while considering the input as an image. DeepFi\nuses a deep neural network with the CSI amplitude as its\ninput. Horus estimates the target position using a probabilistic\nmodel with the signal strength vector from multiple APs.\nFigure 18 shows the cumulative probability over the dis-\ntance error in meters for all state-of-the-art methods and the\nproposed TIPS. It can be observed that the proposed TIPS\nsigniﬁcantly outperforms 1DCNN-LSTM, ConFi, DeepFi,\nand Horus with a probability of 70%, 85%, and 100% within\na 10 cm, 12 cm, and 20 cm distant error, respectively.\nFIGURE 18. Positioning accuracy of the proposed TIPS and existing\nmethods.\nVIII. CONCLUSION\nThis paper proposed TIPS, a transformer-based indoor posi-\ntioning system that uses WiFi signals. First, we extract the\nCSI and estimate the DoA from the Wi-Fi signal transmitted\nfrom predetermined positions. Subsequently, the extracted\nCSI and estimated DoA are preprocessed and embedded to be\nfed to the transformer model to learn the correlations between\nthe ﬁngerprints and their corresponding positions. Using the\nattention mechanism, the transformer model can predict the\ncurrent locations by effectively attending to the ﬁngerprints of\nthe previous position, which signiﬁcantly boosts positioning\naccuracy. We evaluated the superior performance of TIPS\nthrough extensive MATLAB simulations under a modeled\nmultipath propagation environment. The TIPS trained on the\nCSI & DoA dataset were demonstrated to achieve the highest\npositioning accuracy with a short training time. To evaluate\nthe performance of TIPS in a real-world RF environment,\nwe implemented an RF testbed that included a single AP\nand UE with ﬁve USRPs. The results show that TIPS exhibits\nthe highest positioning accuracy compared to state-of-the-\nart indoor positioning methods, with a probability of 100%\nwithin a 20 cm distance error.\nREFERENCES\n[1] F. Zafari, A. Gkelias, and K. K. Leung, ‘‘A survey of indoor localization\nsystems and technologies,’’ IEEE Commun. Surveys Tuts., vol. 21, no. 3,\npp. 2568–2599, 3rd Quart., 2017.\n[2] L. Barreto, A. Amaral, and T. Pereira, ‘‘Industry 4.0 implications in logis-\ntics: An overview,’’ Proc. Manuf., vol. 13, pp. 1245–1252, Jan. 2017.\n[3] J. Lin, W. Yu, N. Zhang, X. Yang, H. Zhang, and W. Zhao, ‘‘A sur-\nvey on Internet of Things: Architecture, enabling technologies, security\nand privacy, and applications,’’ IEEE Internet Things J., vol. 4, no. 5,\npp. 1125–1142, Oct. 2017.\n[4] S. Subedi and J.-Y . Pyun, ‘‘A survey of smartphone-based indoor position-\ning system using RF-based wireless technologies,’’ Sensors, vol. 20, no. 24,\np. 7230, Dec. 2020.\n[5] P. S. Farahsari, A. Farahzadi, J. Rezazadeh, and A. Bagheri, ‘‘A survey\non indoor positioning systems for IoT-based applications,’’ IEEE Internet\nThings J., vol. 9, no. 10, pp. 7680–7699, May 2022.\n[6] S. Horsmanheimo, S. Lembo, L. Tuomimaki, S. Huilla, P. Honkamaa,\nM. Laukkanen, and P. Kemppi, ‘‘Indoor positioning platform to support\n5G location based services,’’ in Proc. IEEE Int. Conf. Commun. Workshops\n(ICC Workshops), May 2019, pp. 1–6.\n[7] A. Yassin, Y . Nasser, M. Awad, A. Al-Dubai, R. Liu, C. Yuen, R. Raulefs,\nand E. Aboutanios, ‘‘Recent advances in indoor localization: A survey on\ntheoretical approaches and applications,’’ IEEE Commun. Surveys Tuts.,\nvol. 19, no. 2, pp. 1327–1346, 2nd Quart., 2016.\n[8] P. Kriz, F. Maly, and T. Kozel, ‘‘Improving indoor localization using\nBluetooth low energy beacons,’’ Mobile Inf. Syst., vol. 2016, pp. 1–11,\nMar. 2016.\n[9] X.-H. Li and T. Zhang, ‘‘Research on improved UWB localization algo-\nrithm in NLOS environment,’’ in Proc. Int. Conf. Intell. Transp., Big Data\nSmart City (ICITBS), Jan. 2018, pp. 707–711.\n[10] H. Liu, H. Darabi, P. Banerjee, and J. Liu, ‘‘Survey of wireless indoor\npositioning techniques and systems,’’ IEEE Trans. Syst., Man, Cybern. C,\nAppl. Rev., vol. 37, no. 6, pp. 1067–1080, Nov. 2007.\n[11] Y . He, Y . Chen, Y . Hu, and B. Zeng, ‘‘WiFi vision: Sensing, recogni-\ntion, and detection with commodity MIMO-OFDM WiFi,’’ IEEE Internet\nThings J., vol. 7, no. 9, pp. 8296–8317, Sep. 2020.\n[12] Y . Duan, K.-Y . Lam, V . C. S. Lee, W. Nie, K. Liu, H. Li, and C. J. Xue,\n‘‘Data rate ﬁngerprinting: A WLAN-based indoor positioning technique\nfor passive localization,’’ IEEE Sensors J., vol. 19, no. 15, pp. 6517–6529,\nAug. 2019.\n[13] X. Dang, X. Tang, Z. Hao, and Y . Liu, ‘‘A device-free indoor localization\nmethod using CSI with Wi-Fi signals,’’ Sensors, vol. 19, no. 14, p. 3233,\nJul. 2019.\n[14] Y . Yin, C. Song, M. Li, and Q. Niu, ‘‘A CSI-based indoor ﬁngerprinting\nlocalization with model integration approach,’’ Sensors, vol. 19, no. 13,\np. 2998, Jul. 2019.\n[15] S. Shi, S. Sigg, L. Chen, and Y . Ji, ‘‘Accurate location tracking from CSI-\nbased passive device-free probabilistic ﬁngerprinting,’’ IEEE Trans. Veh.\nTechnol., vol. 67, no. 6, pp. 5217–5230, Jun. 2018.\n[16] F. Wang, J. Feng, Y . Zhao, X. Zhang, S. Zhang, and J. Han, ‘‘Joint activity\nrecognition and indoor localization with WiFi ﬁngerprints,’’ IEEE Access,\nvol. 7, pp. 80058–80068, 2019.\n[17] J. Zhang, F. Wu, B. Wei, Q. Zhang, H. Huang, S. W. Shah, and J. Cheng,\n‘‘Data augmentation and dense-LSTM for human activity recognition\nusing WiFi signal,’’ IEEE Internet Things J., vol. 8, no. 6, pp. 4628–4641,\nMar. 2021.\n[18] E. Ben Hamida and G. Chelius, ‘‘Investigating the impact of human activity\non the performance of wireless networks—An experimental approach,’’\nin Proc. IEEE Int. Symp. World Wireless, Mobile Multimedia Networks\n(WoWMoM), Jun. 2010, pp. 1–8.\n[19] W. Liu, Q. Cheng, Z. Deng, H. Chen, X. Fu, X. Zheng, S. Zheng, C. Chen,\nand S. Wang, ‘‘Survey on CSI-based indoor positioning systems and recent\nadvances,’’ in Proc. Int. Conf. Indoor Positioning Indoor Navigat. (IPIN),\nSep. 2019, pp. 1–8.\n[20] Y . Wang, C. Xiu, X. Zhang, and D. Yang, ‘‘WiFi indoor localization with\nCSI ﬁngerprinting-based random forest,’’ Sensors, vol. 18, no. 9, p. 2869,\nSep. 2018.\nVOLUME 10, 2022 111375\nZ. Zhang et al.: TIPS Using Both CSI and DoA of WiFi Signal\n[21] L. Tang, Z. Zhang, Y . Zhao, T. Feng, W.-C. Wong, and H. K. Garg,\n‘‘A comparison of WiFi-based indoor positioning methods,’’ in Proc. 13th\nInt. Conf. Signal Process. Commun. Syst. (ICSPCS), Dec. 2019, pp. 1–6.\n[22] X. Wang, L. Gao, S. Mao, and S. Pandey, ‘‘CSI-based ﬁngerprinting for\nindoor localization: A deep learning approach,’’ IEEE Trans. Veh. Technol.,\nvol. 66, no. 1, pp. 763–776, Jan. 2016.\n[23] E. Schmidt, D. Inupakutika, R. Mundlamuri, and D. Akopian, ‘‘SDR-ﬁ:\nDeep-learning-based indoor positioning via software-deﬁned radio,’’ IEEE\nAccess, vol. 7, pp. 145784–145797, 2019.\n[24] X. Wang, X. Wang, and S. Mao, ‘‘Deep convolutional neural networks for\nindoor localization with CSI images,’’ IEEE Trans. Netw. Sci. Eng., vol. 7,\nno. 1, pp. 316–327, Jan. 2020.\n[25] Z. Zhang, M. Lee, and S. Choi, ‘‘Deep-learning-based Wi-Fi indoor posi-\ntioning system using continuous CSI of trajectories,’’ Sensors, vol. 21,\nno. 17, p. 5776, Aug. 2021.\n[26] X. Wang, X. Wang, and S. Mao, ‘‘Indoor ﬁngerprinting with bimodal CSI\ntensors: A deep residual sharing learning approach,’’ IEEE Internet Things\nJ., vol. 8, no. 6, pp. 4498–4513, Mar. 2021.\n[27] Q. Song, S. Guo, X. Liu, and Y . Yang, ‘‘CSI amplitude ﬁngerprinting-\nbased NB-IoT indoor localization,’’ IEEE Internet Things J., vol. 5, no. 3,\npp. 1494–1504, Jun. 2017.\n[28] M. Youssef and A. Agrawala, ‘‘The Horus WLAN location determination\nsystem,’’ in Proc. 3rd Int. Conf. Mobile Syst., Appl., Services (MobiSys),\n2005, pp. 205–218.\n[29] A. Vaswani, N. Shazeer, N. Parmar, J. Uszkoreit, L. Jones, A. N. Gomez,\nL. Kaiser, and I. Polosukhin, ‘‘Attention is all you need,’’ 2017,\narXiv:1706.03762.\n[30] J. Xiao, K. Wu, Y . Yi, L. Wang, and L. M. Ni, ‘‘Pilot: Passive device-free\nindoor localization using channel state information,’’ in Proc. IEEE 33rd\nInt. Conf. Distrib. Comput. Syst., Jul. 2013, pp. 236–245.\n[31] Q. Gao, J. Wang, X. Ma, X. Feng, and H. Wang, ‘‘CSI-based device-free\nwireless localization and activity recognition using radio image features,’’\nIEEE Trans. Veh. Technol., vol. 66, no. 11, pp. 10346–10356, Nov. 2017.\n[32] M. Kim, C. Kim, D. Han, and J.-K.-K. Rhee, ‘‘CompFi: Partially connected\nneural network using complex CSI data for indoor localization,’’ in Proc.\nIEEE 91st Veh. Technol. Conf. (VTC-Spring), May 2020, pp. 1–5.\n[33] Z. E. Khatab, A. Hajihoseini, and S. A. Ghorashi, ‘‘A ﬁngerprint method\nfor indoor localization using autoencoder based deep extreme learning\nmachine,’’IEEE Sensors Lett., vol. 2, no. 1, pp. 1–4, Mar. 2018.\n[34] H. Chen, Y . Zhang, W. Li, X. Tao, and P. Zhang, ‘‘ConFi: Convolutional\nneural networks based indoor Wi-Fi localization using channel state infor-\nmation,’’IEEE Access, vol. 5, pp. 18066–18074, 2017.\n[35] R. O. Schmidt, ‘‘Multiple emitter location and signal parameter estima-\ntion,’’ IEEE Trans. Antennas Propag., vol. AP-34, no. 3, pp. 276–280,\nMar. 1986.\n[36] S. Chen, X. Li, and Z. Shao, ‘‘Study on the performance of DOA estimation\nalgorithms,’’ in Proc. IEEE Int. Conf. Commun. Problem-Solving (ICCP),\nOct. 2015, pp. 475–477.\n[37] T.-J. Shan, M. Wax, and T. Kailath, ‘‘On spatial smoothing for direction-\nof-arrival estimation of coherent signals,’’ IEEE Trans. Acoust., Speech,\nSignal Process., vol. ASSP-33, no. 4, pp. 806–811, Apr. 1985.\n[38] A. Radford, ‘‘Language models are unsupervised multitask learners,’’\nOpenAI Blog, vol. 1, no. 8, p. 9, 2019.\n[39] A. Sherstinsky, ‘‘Fundamentals of recurrent neural network (RNN) and\nlong short-term memory (LSTM) network,’’ Phys. D, Nonlinear Phenom-\nena, vol. 404, Mar. 2020, Art. no. 132306.\n[40] J. L. Ba, J. R. Kiros, and G. E. Hinton, ‘‘Layer normalization,’’ 2016,\narXiv:1607.06450.\n[41] Z. Yun and M. F. Iskander, ‘‘Ray tracing for radio propagation modeling:\nPrinciples and applications,’’ IEEE Access, vol. 3, pp. 1089–1100, 2015.\n[42] D. P. Kingma and J. Ba, ‘‘Adam: A method for stochastic optimization,’’\n2014, arXiv:1412.6980.\n[43] X300/X310. (2021). X300/x310 Ettus Knowledge Base. Accessed:\nMay 25, 2022. [Online]. Available: https://kb.ettus.com/index.php?title=\nX300/X310&oldid=5092\n[44] VERT 2450. (2016). Antennas ettus Knowledge Base Accessed:\nMay 25, 2022. [Online]. Available: https://kb.ettus.com/index.php?title=\nAntennas&oldid=3098\n[45] OctoClock CDA-2990. (2020). Octoclock CDA-2990 Ettus Knowledge\nBase. Accessed: May 25, 2022. [Online]. Available: https://kb.ettus.com/\nindex.php?title=OctoClock_CDA-2990&oldid=4916\n[46] H. Fu, S. Abeywickrama, C. Yuen, and M. Zhang, ‘‘A robust phase-\nambiguity-immune DOA estimation scheme for antenna array,’’ IEEE\nTrans. Veh. Technol., vol. 68, no. 7, pp. 6686–6696, Jul. 2019.\nZHONGFENG ZHANG received the B.S. degree\nin electronic engineering from Yanbian University,\nin 2017. He is currently pursuing the Ph.D. degree\nwith the Department of Electronics and Com-\nputer Engineering, Hanyang University, Seoul,\nSouth Korea. His current research interests include\nbeamforming, indoor positioning systems, wire-\nless communications, mmWave communication,\nand MIMO systems.\nHONGXIN DU received the B.S. degree in\nelectronic engineering from Yanbian University,\nin 2020. He is currently pursuing the M.S. degree\nwith the Department of Electronics and Com-\nputer Engineering, Hanyang University, Seoul,\nSouth Korea. His current research interests include\nDoA, beamforming, wireless communications,\nand DL.\nSEUNGWON CHOI (Member, IEEE) received\nthe M.S. degree in computer engineering and the\nPh.D. degree in electrical engineering from Syra-\ncuse University, Syracuse, NY , USA, in 1985 and\n1988, respectively. From 1988 to 1989, he was\nan Assistant Professor with the Department of\nElectrical and Computer Engineering, Syracuse\nUniversity. He joined Hanyang University, Seoul,\nSouth Korea, as an Assistant Professor, in 1992,\nwhere he is currently a Professor with the School\nof Electrical and Computer Engineering. His research interests include soft-\nware reconﬁguration, and digital communications with a recent focus on the\nimplementation of various kinds of MIMO systems for mobile communica-\ntion systems.\nSUNG HO CHO (Member, IEEE) received the\nPh.D. degree in electrical and computer engineer-\ning from The University of Utah, Salt Lake City,\nUT, USA, in 1989. From 1989 to 1992, he was a\nSenior Member of Technical Staff with the Elec-\ntronics and Telecommunications Research Insti-\ntute (ETRI), Daejeon, South Korea. He joined the\nDepartment of Electronic Engineering, Hanyang\nUniversity, Seoul, South Korea, in 1992, where\nhe is currently a Full Professor. He has been the\nDirector of the Radar Computing Laboratory, since 2010. His research inter-\nests include applied signal processing, machine learning, radar computing,\ndigital health, and radar-based smart space.\n111376 VOLUME 10, 2022"
}