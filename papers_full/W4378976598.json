{
    "title": "Zero-shot Interpretable Phenotyping of Postpartum Hemorrhage Using Large Language Models",
    "url": "https://openalex.org/W4378976598",
    "year": 2023,
    "authors": [
        {
            "id": "https://openalex.org/A2889180838",
            "name": "Emily Alsentzer",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2565753041",
            "name": "Matthew J. Rasmussen",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2531894670",
            "name": "Romy Fontoura",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A4378990179",
            "name": "Alexis L. Cull",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A4226755506",
            "name": "Brett Beaulieu-Jones",
            "affiliations": [
                "University of Chicago"
            ]
        },
        {
            "id": "https://openalex.org/A2099799017",
            "name": "Kathryn J Gray",
            "affiliations": [
                "Massachusetts General Hospital",
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2116978417",
            "name": "David W Bates",
            "affiliations": [
                "Harvard University",
                "Boston University",
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A1354848730",
            "name": "Vesela P. Kovacheva",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2889180838",
            "name": "Emily Alsentzer",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2565753041",
            "name": "Matthew J. Rasmussen",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2531894670",
            "name": "Romy Fontoura",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A4378990179",
            "name": "Alexis L. Cull",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A4226755506",
            "name": "Brett Beaulieu-Jones",
            "affiliations": []
        },
        {
            "id": "https://openalex.org/A2099799017",
            "name": "Kathryn J Gray",
            "affiliations": [
                "Brigham and Women's Hospital",
                "Massachusetts General Hospital",
                "University of Chicago"
            ]
        },
        {
            "id": "https://openalex.org/A2116978417",
            "name": "David W Bates",
            "affiliations": [
                "Brigham and Women's Hospital",
                "Boston University",
                "Harvard University"
            ]
        },
        {
            "id": "https://openalex.org/A1354848730",
            "name": "Vesela P. Kovacheva",
            "affiliations": [
                "Brigham and Women's Hospital"
            ]
        }
    ],
    "references": [
        "https://openalex.org/W2105637130",
        "https://openalex.org/W4318025694",
        "https://openalex.org/W3149192496",
        "https://openalex.org/W2131668595",
        "https://openalex.org/W1969208427",
        "https://openalex.org/W2799271499",
        "https://openalex.org/W3135072344",
        "https://openalex.org/W2317648909",
        "https://openalex.org/W2138162199",
        "https://openalex.org/W2808129629",
        "https://openalex.org/W2883657435",
        "https://openalex.org/W2593739814",
        "https://openalex.org/W1995972830",
        "https://openalex.org/W4309650827",
        "https://openalex.org/W6778883912",
        "https://openalex.org/W4385573087",
        "https://openalex.org/W2529846601",
        "https://openalex.org/W2786382895",
        "https://openalex.org/W4311897989",
        "https://openalex.org/W3127014827",
        "https://openalex.org/W4250116679",
        "https://openalex.org/W3009514415",
        "https://openalex.org/W4224266443",
        "https://openalex.org/W1504813440",
        "https://openalex.org/W2057529206",
        "https://openalex.org/W2989208149",
        "https://openalex.org/W2181857903"
    ],
    "abstract": "Many areas of medicine would benefit from deeper, more accurate phenotyping, but there are limited approaches for phenotyping using clinical notes without substantial annotated data. Large language models (LLMs) have demonstrated immense potential to adapt to novel tasks with no additional training by specifying task-specific i nstructions. We investigated the per-formance of a publicly available LLM, Flan-T5, in phenotyping patients with postpartum hemorrhage (PPH) using discharge notes from electronic health records ( n =271,081). The language model achieved strong performance in extracting 24 granular concepts associated with PPH. Identifying these granular concepts accurately allowed the development of inter-pretable, complex phenotypes and subtypes. The Flan-T5 model achieved high fidelity in phenotyping PPH (positive predictive value of 0.95), identifying 47% more patients with this complication compared to the current standard of using claims codes. This LLM pipeline can be used reliably for subtyping PPH and outperformed a claims-based approach on the three most common PPH subtypes associated with uterine atony, abnormal placentation, and obstetric trauma. The advantage of this approach to subtyping is its interpretability, as each concept contributing to the subtype determination can be evaluated. Moreover, as definitions may change over time due to new guidelines, using granular concepts to create complex phenotypes enables prompt and efficient updating of the algorithm. Using this lan-guage modelling approach enables rapid phenotyping without the need for any manually annotated training data across multiple clinical use cases.",
    "full_text": "Zero-shot Interpretable Phenotyping of Postpartum\nHemorrhage Using Large Language Models\nEmily Alsentzer1, Matthew J Rasmussen2, Romy Fontoura2, Alexis L Cull2, Brett Beaulieu-\nJones3, Kathryn J Gray4,5, David W Bates1,6, and Vesela P Kovacheva2 ,‡\n1Division of General Internal Medicine and Primary Care, Brigham and Women’s Hospital, Boston, USA \n2Department of Anesthesiology, Perioperative and Pain Medicine, Brigham and Women’s Hospital, Boston, MA \n3Section of Biomedical Data Science, Department of Medicine, University of Chicago, Chicago, IL\n4Center for Genomic Medicine, Massachusetts General Hospital, Boston, MA\n5Division of Maternal-Fetal Medicine, Brigham and Women’s Hospital, Boston, MA\n6Department of Health Care Policy and Management, Harvard T. H. Chan School of Public Health, Boston, USA\n‡Corresponding author. Email: vkovacheva@bwh.harvard.edu\nMany areas of medicine would benefit from deeper, more accurate phenotyping, but there are \nlimited appr oaches for phenotyping using clinical notes without substantial annotated data. \nLarge language models (LLMs) have demonstrated immense potential to adapt to novel tasks \nwith no additional training by specifying task-specific i nstructions. We  investigated the per-\nformance of a publicly available LLM, Flan-T5, in phenotyping patients with postpartum \nhemorrhage (PPH) using discharge notes from electronic health records (n=271,081). The \nlanguage model achieved strong performance in extracting 24 granular concepts associated \nwith PPH. Identifying these granular concepts accurately allowed the development of inter-\npretable, complex phenotypes and subtypes. The Flan-T5 model achieved high fidelity in \nphenotyping PPH (positive predictive value of 0.95), identifying 47% more patients with this \ncomplication compared to the current standard of using claims codes. This LLM pipeline \ncan be used reliably for subtyping PPH and outperformed a claims-based approach on  the \nthree most common PPH subtypes  associated with uterine atony, abnormal placentation, \nand obstetric trauma. The advantage of this appr oach  to subtyping is its interpretability, \nas each concept contributing to the subtype determination can be evaluated. Moreover, as \ndefinitions may change over time due to new g uidelines, using granular concepts to create \ncomplex phenotypes enables prompt and efficient updating of the a lgorithm. Using this lan-\nguage modelling approach enables rapid phenotyping without the need for any manually \nannotated training data across multiple clinical use cases.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nNOTE: This preprint reports new research that has not been certified by peer review and should not be used to guide clinical practice.\nMain\nRobust phenotyping is essential to multiple clinical and research workflows, such as clinical diag-\nnosis [1], novel phenotype discovery [2], clinical trial screening [3], comparative effectiveness re-\nsearch [4], quality improvement [5], and genome-wide and phenome-wide association studies [6].\nThe wide adoption of electronic health records (EHR) has enabled the development of digital phe-\nnotyping approaches, which seek to leverage the large amounts of electronic patient data, stored as\nstructured data (e.g. diagnosis codes, medications, and laboratory results) and unstructured clini-\ncal notes, to characterize a patient’s clinical presentation. Currently, many phenotyping approaches\nutilize diagnosis codes such as the International Classification of Diseases (ICD) [7] or a combi-\nnation of rules based on structured data [8,9]. While structured data is readily available and easily\ncomputable, structured data often reflect billing processes rather than disease course and do not\ncapture the nuanced clinical narrative found in the EHR notes [10,11].\nNatural language processing (NLP) methods have increasingly been used to enable more\nprecise, multi-modal phenotyping by automating data extraction from unstructured clinical notes.\nMost approaches are rule-based, relying on keywords [12], regular expressions [13], and/or exist-\ning NLP tools that extract medical ontology concepts [14,15] to identify relevant information from\nnotes. These approaches produce interpretable phenotypes, but often have low recall due to the use\nof hand-crafted features. In contrast, supervised machine learning based phenotyping approaches\nallow for learning useful features and may produce less brittle models [11,16,17]. However, super-\nvised machine learning models have been difficult to implement because they require substantial\nclinician-annotated data for training robust models.\nRecent advances in training large language models (LLMs) offer an opportunity to develop\ngeneralizable phenotypes without substantial annotated data. A common paradigm in NLP has\nbeen to first pretrain a model via a self-supervised learning objective on large amounts of unla-\nbeled text and then fine-tune the model on a specific downstream task of interest using labeled\ntraining data. However, more recent work has demonstrated the ability of LLMs to adapt to new\ntasks without any gradient updates or fine-tuning, simply by specifying task instructions via text\ninteraction with the model [18–20]. For example, Agrawal et al. found that GPT-3 can perform\nfew-shot information extraction on several clinical tasks, including acronym disambiguation, co-\nreference resolution, and medication extraction [21]. Contemporaneous to this work, McInerney et\nal. show that Flan-T5 can perform feature extraction from clinical notes to enable training of risk\nprediction models [22]. The zero- and few-shot capabilities of these models (i.e., their ability to\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \ngeneralize to novel tasks with zero or limited examples) can enable rapid development of models\nfor diverse clinical applications where labeled data is sparse or expensive to acquire.\nIn this work, we investigate the utility of LLMs for zero-shot phenotyping using clinical\nnotes. As a proof of concept, we focus on phenotyping postpartum hemorrhage (PPH), the leading\ncause of severe maternal morbidity and mortality. Globally, PPH complicates 2-3% of all preg-\nnancies and accounts for 140,000 maternal deaths annually [23]. The current PPH definition is\nbased on the documentation of estimated blood loss of at least 1000 mL following delivery [24].\nPPH is typically identified in large epidemiological studies using diagnosis codes [7,25]; however,\nsuch codes have limited accuracy [7]. More comprehensive PPH phenotype definitions have been\ndeveloped [8], but there is limited work in incorporating clinical notes into PPH phenotype defini-\ntions [26]. Furthermore, several subtypes of PPH exist, each of which is associated with different\netiologies, management, and outcomes. Clinical guidelines recommend prompt identification of\nthe PPH subtype of PPH in order to initiate appropriate interventions [24]. However, to the best of\nour knowledge, there are no digital phenotyping algorithms for PPH subtypes.\nThe goal of this study was to develop a robust and interpretable approach for rapid phe-\nnotyping and subtyping of postpartum hemorrhage (PPH) patients. We leveraged Flan-T5, an\nopen-source LLM, to perform zero-shot extraction of PPH-related concepts from obstetric dis-\ncharge summaries, and we used the extracted concepts to perform interpretable PPH phenotyping\nand subtyping. We validated the extracted concepts using manual expert chart review and found\nthat Flan-T5 can extract PPH-related concepts with strong performance and can identify PPH pa-\ntients and subtypes of PPH that are missed by common structured data approaches. This two-step\nextract-then-phenotype approach allows for greater interpretability compared to end-to-end su-\npervised machine learning models and better recall compared to more brittle keyword or regex\nrules-based models. Furthermore, the open-source Flan-T5 LLMs can be run locally behind a hos-\npital firewall, limiting concerns regarding the security, privacy, and run-time costs of the models.\nOur findings highlight the potential for LLMs to annotate clinical notes and facilitate rapid and\naccurate phenotyping for diverse clinical outcomes.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nResults\nStudy cohort. We identified 138,648 unique individuals with an obstetric encounter resulting in\nbirth after 20 gestational weeks at the Mass General Brigham (MGB) hospitals in Boston, MA,\nfrom 1998-2015. There were a total of 503,991 discharge summaries for patients in this initial co-\nhort. We leveraged discharge summaries for NLP-based phenotyping, as postpartum hemorrhage\n(PPH) typically develops within 24 hours after delivery, and patients are not discharged until at\nleast 24 hours post-delivery. As not every discharge note described a delivery encounter, we de-\nveloped a combination of terms to identify delivery-related discharge notes with high recall (See\nMethods). After filtering discharge summaries that did not describe a delivery encounter, our final\nstudy cohort was comprised of 131,284 unique patients with 271,081 discharge summaries (Figure\n1a). Each patient had an average of 2.1 obstetric discharge summary notes (SD = 1.4), consisting\nof 807.6 words on average (SD = 923.1). The cohort characteristics are summarized in Figure\n1b-e.\nZero-shot extraction of PPH-related concepts with NLP.We developed a list of 24 PPH-related\nconcepts based on an extensive literature review and discussion with expert physicians (V .K. and\nK.G.; full list and definitions in Supplemental Table 1). We identified the PPH-related concepts\nin all discharge summaries by prompting the 11 billion parameter Flan-T5 model (Flan-T5-XXL),\nto either answer a yes/no question regarding the presence of a condition, medication, or procedure\n(e.g., uterine atony) or to extract a specific measurement (e.g., estimated blood loss; Figure 2a).\nThis approach allows for extraction of concepts from unstructured text without requiring data to\nfurther train the model.\nWe evaluated the Flan-T5 model performance on a random sample of 1,175 manually an-\nnotated discharge summaries with PPH ICD diagnosis codes. Discharge summaries with PPH\ndiagnosis codes were used to enrich for obstetric discharge summaries more likely to contain\nPPH-related concepts. The Flan-T5 performance is summarized in Table 1. We compared the\nFlan-T5 NLP models to regular expressions constructed for each PPH-related concept (Figure 3;\nSupplemental Table 2). Regular expressions were selected as the baseline approach because they\ncan similarly be constructed with minimal “training” data. Our primary evaluation metric for the\nclassification tasks was binary F1 score, which is useful for imbalanced datasets with rare labels\nwhere performance on the positive class is most important. The Flan-T5 model achieved a binary\nF1 score of 0.75 or higher on 21 of 23 binary concepts, exceeding a 0.9 binary F1 score on 12 of the\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nPPH concepts. Flan-T5 significantly outperformed the corresponding regular expression for nine\nbinary PPH-related concepts (all p-values < 0.05). Furthermore, the model extracted estimated\nblood loss values with a recall of 0.745, precision of 0.905, and note level accuracy of 95.1%.\nWhile regular expressions achieved similar performance on simpler extraction tasks, such as iden-\ntification of medication use, the Flan-T5 model outperformed regular expressions on concepts that\nare expressed in clinical notes in variable formats, such as coagulation disorders. The model was\nable to infer the presence of some concepts; however, this contributed to higher false positive rates\nif there was no explicit presence of the concept in the notes. For example, the notes that contained\npostpartum ‘dilation and curettage’ were also often predicted to be positive for ‘manual removal of\nplacenta’; the latter procedure commonly precedes curettage. The false negatives were commonly\ndue to unusual abbreviations or concepts with multiple misspellings. For example, in one of the\nnotes containing the following text ‘500ccf/b d&c for retained POC’, the model correctly identified\nthe concept ‘retained products of conception’ but was unable to extract the blood loss, in this case\n‘500’ or identify ‘dilation and curettage’.\nWhile prompts were developed solely on notes from a single hospital site, we found that the\nmodel generalized well to notes from other MGB hospitals. There was no substantial difference in\nperformance across hospital sites (Supplemental Table 3).\nNLP-based Identification of PPH cases. We leveraged the extracted concepts to identify deliv-\neries with postpartum hemorrhage (Figure 2b). The Flan-T5 model extracted the estimated blood\nloss values and delivery type (cesarean or vaginal) from all notes in the cohort (n= 271,081). Sub-\nsequently, we classified notes as describing PPH if patients had blood loss greater than 500 mL for\nvaginal deliveries or greater than 1000 mL for cesarean deliveries. This matched the PPH definition\nused in the hospitals during the study period (See Methods). There were 2,598 discharge summary\nnotes for 2,270 deliveries in our study cohort with PPH, according to the model. The prevalence\nof each PPH-related concept in the deliveries with PPH identified based on model-extracted blood\nloss can be found in Table 2.\nWe evaluated the PPH phenotyping algorithm by comparing the model performance on a\nrandom sample of 300 expert-annotated discharge summary notes predicted by Flan-T5 to describe\ndeliveries with PPH. The gold-standard discharge summaries were annotated via manual medical\nrecord review. The positive predictive value of the NLP-based PPH phenotyping algorithm is\n0.95. The NLP-based approach allows identification of PPH cases that lack any PPH International\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nClassification of Diseases (ICD) diagnosis codes associated with the delivery. Of the 285 discharge\nsummaries with confirmed PPH, 148 and 136 did not have an associated PPH ICD code according\nto the definitions in Butwick et al. [7] and Zheutlin et al. [8], respectively. Over 47% of the\ndischarge summaries with PPH would not have been identified using PPH ICD codes alone.\nWe further examined the relationship between model-extracted estimated blood loss and\npresence of PPH ICD codes on the entire notes cohort (n = 271,081). As the blood loss amount\nincreases, there is more likely to be a PPH ICD code associated with the admission, as expected\n(Fig. 4, Supplemental Figure 2). When no estimated blood loss is extracted, the prevalence of PPH\nICD codes is less than 5%. When the extracted blood loss values are between 1000 and 1500mL,\ncriteria which meet both historical and current definitions of PPH, less than 50% of notes have an\nassociated PPH ICD code.\nNLP-based Classification of PPH subtypes. Finally, we leverage the extracted PPH concepts to\nclassify deliveries with PPH into four subtypes corresponding to distinct causes of PPH: uter-\nine atony (“tone”), retained products of conception and placenta accreta spectrum, (“tissue”),\nbirth or surgical trauma, (‘trauma’) and coagulation abnormalities (“thrombin”; Figure 2E). We\nconstructed composite phenotypes for each subtype based on the presence of one or more NLP-\nextracted PPH terms (See Methods). Using these NLP-based subtyping algorithms, we estimate\nthat 29.9% of predicted PPH deliveries in our study cohort are due to uterine atony, 26.8% are\ndue to retained products of conception, 24.0% are due to trauma, and 5.7% are due to coagulation\nabnormalities.\nWe validated the subtyping algorithm via an expert manual medical record review of the\n285 confirmed PPH deliveries. The PPH subtype could be determined via manual review of the\ndischarge summary in 73% of notes. We found that the NLP-based approach can achieve strong\nperformance in subtype classification of those notes across three of the four subtypes, significantly\noutperforming an ICD-based approach to PPH subtyping for the “tone”, “tissue”, and ”trauma”\nsubtypes with binary F1 score by 50.6%, 66.5%, and 17.8%, respectively (p-value < 0.01; Table\n3).\nDiscussion\nLarge language models (LLMs) hold immense potential to improve the administration and practice\nof medicine. In this study, we report the first evaluation of a large language model for zero-shot\nphenotyping using clinical notes. As a proof-of-concept, we focused on postpartum hemorrhage,\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nthe leading cause of maternal morbidity and mortality. We developed a set of 24 postpartum-\nhemorrhage-related concepts, which included binary identification of a concept or value extraction\nof a specific measurement. We found that the Flan-T5 model extracted most concepts with high\nprecision and recall, enabling the creation of an interpretable postpartum hemorrhage phenotype\nthat identified significantly more deliveries with postpartum hemorrhage than would be identified\nby using diagnosis codes alone. Furthermore, these granular concepts can be used for the precise\nand interpretable identification of the subtypes of postpartum hemorrhage based on the underlying\netiology.\nInterestingly, we found that the Flan-T5 model can achieve strong performance despite not\nbeing specifically trained on specialized EHR data or medical information. This is consistent\nwith prior work that has investigated the utility of GPT-3 in performing few-shot extraction from\nclinical text [27]. The Flan-T5 performance was best for concrete concepts where the prompt could\nsufficiently describe how the concept might be described in a clinical note. The model was resilient\nto misspellings and medical abbreviations. Flan-T5 provided the greatest benefit over regular\nexpressions on more complex concepts, such as coagulation disorders and retained products of\nconception, which vary in how they are documented. However, the model had lower performance\nwhen differentiating closely related concepts, such as manual extraction of the placenta and dilation\nand curettage, suggesting that clinical instruction-tuning or the use of few-shot exemplars may be\nbeneficial to improve performance.\nOur proposed approach demonstrates how complex large language models can be leveraged\nto create downstream interpretable models. The “extract-then-phenotype” approach enables easy\nvalidation of extracted concepts and rapid updating of phenotype definitions. In this work, we\nchose a postpartum hemorrhage definition that was valid at the time of clinical care [28]. Since\n2018, the definition of PPH has changed to include only those cases with blood loss of more than\n1000 ml, regardless of the type of delivery [24]. The advantage of our approach is that in such\ncases, the algorithm can quickly be adapted to remain relevant.\nThe challenges in identifying patients with PPH are well recognized. Currently, most epi-\ndemiological studies rely on ICD diagnostic codes to develop the PPH phenotype. While ICD\ncodes are available as structured data in EHR and many large datasets, the studies using ICD\ncodes demonstrate an underestimation of the incidence of PPH compared to EBL [7] or manual\nchart review [29]. In addition, studies have demonstrated positive predictive power of 74.5% and\nonly 9% overall prevalence of PPH ICD codes in all patients resenting for cesarean delivery [7].\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nZero-shot phenotyping with LLMs enabled us to rapidly identify delivery encounters with postpar-\ntum hemorrhage using clinical notes, enabling identification of PPH cases that would have been\nmissed by PPH ICD codes. Our analysis of PPH ICD code prevalence by extracted estimated\nblood loss (EBL) revealed that there are many clinical notes with EBL values that meet our PPH\ndefinition, yet do not have associated PPH ICD codes. There are several possible explanations for\nthis, including preemption of additional blood loss with appropriate medication, inaccurate EBL\nmeasurements that do not clinically correlate with the severity of the patient’s presentation, and\nincorrect extraction of EBL. Nevertheless, these findings underscore the limitations of traditional\nPPH phenotyping approaches based on claims data alone.\nWe also created interpretable algorithms to classify different etiology-based subtypes of PPH.\nThis type of analysis is rarely done in other studies as all subtypes are rarely documented [26] Most\nstudies have focused on atonic PPH, which is identified based on the use of uterotonic medications,\nsometimes available as structured data [30]. In this work, drug administration was not part of the\nhistorical medical record and could not be easily retrieved. Our approach using granular concepts\nfrom clinical notes allowed for improved classification based on the presence of inadequate uterine\ntone even when specific medications were not mentioned. Furthermore, this approach is easily\nportable across institutions as evidenced by the stable performance across two different hospitals\nin our cohort. The NLP model outperformed an ICD-based approach for three of the four subtypes,\nonly underperforming on the “thrombin” subtype, which had a substantially lower than the other\nsubtypes prevalence of 6.3% in our evaluation cohort. These approaches for subtyping PPH create\nnew opportunities for investigation of different PPH etiologies and for prompt identification of\nPPH subtypes at the bedside to initiate personalized clinical interventions.\nOur work has some limitations. By focusing on discharge notes during the delivery admis-\nsion, we may have missed cases of delayed or recurrent postpartum hemorrhage, which may have\nhappened later in the postpartum period. Future work could modify the pipeline to analyze later\npostpartum events. The discharge notes may also reflect institution-specific clinical practices, e.g.,\nthe notes may not include some relevant elements such as estimated blood loss and the clinician’s\nsubjective decision to administer medication or perform a procedure. To mitigate this, we selected\na long study period and analyzed notes from several hospitals. Another limitation of using Flan-T5\nfor phenotyping is the size of the model, which, while significantly smaller than many other LLMs,\nstill requires substantial computational resources. Future work could train a clinical instruction-\ntuned model, which we expect can achieve comparable performance with fewer parameters [31].\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nFinally, we did not train Flan-T5 on our phenotyping task or consider recent LLMs such as Chat-\nGPT and GPT-4 in this work. While these models have demonstrated outstanding performance,\nthey are closed models that can require substantial costs when run over lengthy clinical notes.\nWe opt for evaluation of an open-sourced language model which limits security, privacy, and cost\nconcerns.\nWe investigated the utility of an open-source large language model in performing inter-\npretable, zero-shot clinical phenotyping and subtyping. This approach offers a major advantage\ncompared to existing methods for phenotyping from clinical notes, which rely on manually anno-\ntated training data. Zero-shot phenotyping approaches have the potential to accelerate research and\nimprove clinical operations and medicine by enabling the rapid identification of patient cohorts,\nwhich are critical for precise disease investigations and the development of personalized medicine\ntools.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nMethods\nCohort construction. Mass General Brigham (MGB) is an integrated healthcare system of tertiary\nand community hospitals and associated outpatient practices across New England. We leveraged\nMGB’s Research Patient Data Repository (RPDR) [32] to retrieve the data for all MGB patients\nwith a pregnancy related ICD (International Classification of Diseases) or DRG (Diagnoses Re-\nlated Groups) code according to the enhanced delivery identification method [33]. The available\ndata includes self-reported race and ethnicity, date of birth, insurance information, ICD and DRG\ncodes, and EHR notes. We restricted the cohort to patients with delivery prior to 5/1/2015, when\nMGB transitioned to using EPIC’s electronic health record system, to enrich for delivery notes\nwith longer narrative sections and less structured data collection. The discharge summaries were\nfiltered to remove duplicates, draft notes, and any notes from the emergency department. The\npatient’s race, ethnicity, delivery hospital, and age at delivery were extracted from Mass General\nBrigham’s RPDR. This study was approved by the Mass General Brigham Institutional Review\nBoard, protocol #2020P002859, with a waiver of patient consent.\nIdentification of delivery discharge summaries. The discharge summaries retrieved from RPDR\ncould pertain to any hospital admission during the time window. We compared three approaches\nfor identifying the subset of discharge summaries that described an obstetric encounter: a regex\napproach, an ICD code approach, and a language modelling approach.\nThe first approach involved the development of a regular expression algorithm. We selected\nall discharge summaries containing any of the following terms: “labor “, “delivery”, “l&d”, “ce-\nsarean section”, “c-section”, “estimated edc”, or “pregnancy”. This approach was designed to\noptimize for recall, but it may produce false positive examples when there are discharge notes for\nadmissions in the weeks prior and following a delivery. In the second approach, we retrieved all\ndischarge summaries that had a pregnancy-related ICD or DRG code (and do not have an excluded\ncode) within x days of the date of the discharge summary, where x may be 0, 2, 7, or 14 days.\nThis time-based linking is necessary because there is no encounter linking between billing data\nand clinical notes in our data repository. In the final approach, we split each note into chunks\ncontaining 512 tokens and prompted Flan-T5 with the following question: “Answer the following\nyes/no question. Does this discharge summary note mention a woman’s delivery? note: note”,\nwhere note corresponds to the text of each chunk. If the model responded “yes” for any of the\ndischarge summary sections, we labeled the discharge summary as related to a delivery encounter.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nSee below methods for additional details about the Flan-T5 model.\nWe evaluated each of the approaches on 100 randomly sampled discharge summaries. We\nfound that the language modelling approach yielded the highest overall performance with a macro\nF1 of 0.936 (Supplemental Table 4) but opted to use the regex approach for creation of the final\ncohort given its 100% recall.\nZero-Shot Natural Language Processing to Extract PPH Concepts.\nWe utilized Flan-T5, an instruction-tuned LLM that can be applied to unseen tasks with-\nout any additional model training [20], to extract PPH-related concepts from obstetric discharge\nsummaries. Flan-T5 takes as input a prompt describing the task and generates a text output. We\nleverage Flan-T5 for two broad classes of tasks: binary classification and text extraction. Iden-\ntification of estimated blood loss is framed as a text extraction task, and all other PPH-related\nconcepts are framed as binary classification tasks.\nWe developed and evaluated the Flan-T5 models on a set of 1225 manually labelled discharge\nsummaries with ICD codes related to PPH, as defined in Zheutlin et al [8]. We performed stratified\nsampling to set aside 50 discharge summaries for a small development cohort to conduct minimal\nprompt engineering for each PPH-related concept, and the remaining 1175 discharge summaries\nserved as our test set. Importantly, there was no overlap in patients between the development\nand test sets. Furthermore, we only included discharge summaries from a single MGB hospital\n(Brigham and Women’s Hospital) in the development set in order to evaluate the generalizability\nof the models to notes from other hospitals in the MGB system.\nWe performed minimal prompt engineering, constructing one to five prompts for each PPH-\nrelated concept. We selected the optimal prompt via binary F1 performance on the development\nset. Example prompts for PPH-related concepts are in Table 4. For the most complex concepts,\nsuch as “placenta accreta spectrum”, “PPH due to surgical causes”, “coagulation disorders with\nincreased risk of bleeding”, and “misoprostol (used as uterotonic)”, we chained together several\nseparate prompts to generate more nuanced predictions. If any of the prompts labeled a concept as\npresent, we considered the concept present.\nThe length of discharge summaries often exceeded the max length of the input for Flan-T5\nmodels. To address this, we split each discharge summary into text chunks of 512 tokens with a\nstride of 128, generated a prediction for each text chunk, and aggregated the resulting predictions.\nFor binary classification tasks, we considered the label as positive if any of the text chunks have a\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \npositive label. For the text extraction tasks, we took the union of all segments extracted from each\ntext chunk. We also performed post-processing to extract numbers from the generated text. This\npost-processing was necessary for text extraction tasks because the model can extract random text\nfrom the text chunk if a particular text chunk does not contain the information to extract (e.g., a\nmeasurement for estimated blood loss).\nWe experimented with Flan-T5 models of varying sizes on our development set and found\nthat the 11 billion parameter Flan-T5-XXL model performed substantially better than the smaller\nmodels (Supplemental Table 5). All analyses in this paper use the Flan-T5-XXL model down-\nloaded from the HuggingFace model hub at https://huggingface.co/google/flan-t5-xxl. Text was\ngenerated using greedy decoding with max new tokens set to 5 and temperature of 1.0. We per-\nformed inference using a single 16 GB RTX A4000. The Hugging Face accelerate library with\nDeepSpeed integration was used to speed up inference by enabling a batch size of 48 on a single\nGPU [34].\nWe performed inference using Flan-T5 on all delivery-related discharge summaries for each\nPPH-related concept. We compared the Flan-T5 model to regular expressions constructed for\neach concept. Regular expressions are the most pertinent baseline because they similarly do not\nrequire model training. We compared model performance on the distinct test set of 1175 manually\nannotated discharge summaries.\nCreation of an NLP-based PPH phenotyping algorithm. During the study period, the hospitals\nused a PPH definition based on the estimated blood loss (EBL)> 500mL during a vaginal delivery\nor > 1000mL during a cesarean delivery [28], and we leveraged the extracted PPH-related concepts\nto identify PPH deliveries. We focused on the phenotyping of primary PPH, as patients with\nsecondary PPH may develop PPH after discharge [28]. Concretely, we identify a PPH delivery\nif the sum of all extracted EBL values is > 500 and the model predicts a vaginal delivery or if\nthe model sum of all extracted EBL values is > 1000 and the model predicts a cesarean delivery.\nIn cases where multiple EBL were extracted with the same value, we assumed that these were\nmultiple mentions of the same EBL in the note and did not sum the values. In cases where the\nextracted EBL was a single digit, we assumed the EBL was reported in liters and converted the\nextracted values to milliliters.\nWe identified PPH deliveries from our entire cohort of delivery discharge summaries and\nreport characteristics of the identified PPH deliveries. We evaluated the positive predictive value\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nof our approach by manually annotating the EBL and cesarean status of a random sample of 300\ndischarge summaries that the model predicts as describing a PPH delivery. We measured the ability\nof the NLP-approach to identify PPH cases missed by ICD-based definitions of PPH [7, 8, 35] by\ncalculating the fraction of confirmed PPH cases that have PPH-related ICD codes.\nCreation of an NLP-based PPH subtyping algorithm. We used the extracted PPH-related con-\ncepts to develop four composite PPH subtyping algorithms corresponding to distinct causes of\nPPH: uterine atony (“tone”), retained products of conception, (“tissue”), trauma (“trauma”), and\ncoagulation abnormalities (“thrombin”) [36] (Table 5). We labeled a PPH delivery with the “tone”\nsubtype if the discharge summary contained any of the following: mention of uterine atony, ad-\nministration of methylergonovine, administration of carboprost or administration of misoprostol\nas a uterotonic. We labeled a PPH delivery with the “tissue” subtype if the discharge summary\ncontained any of the following: placenta accreta spectrum or retained products of conception, di-\nlatation and curettage, or manual extraction of the placenta. We labeled a PPH delivery with the\n“trauma” subtype if the discharge summary contained documentation of any of the following: uter-\nine rupture, O’Leary stitches, PPH due to surgical causes (e.g. damage to the uterine artery), or\nlaceration with no other PPH subtype mentioned. We labeled a PPH delivery with the “throm-\nbin” subtype if the discharge summary contained any of the following: mention of disseminated\nintravascular coagulation, transfusion of platelets, transfusion of cryoprecipitate, or transfusion of\nfrozen fresh plasma in ratio with red blood cells higher than 1:1:1.\nWe performed subtyping on all deliveries that the NLP-based model predicted as describing\npostpartum hemorrhage. We validated the performance of the classification algorithms via manual\nchart review of the confirmed PPH deliveries identified above (See “Identification of deliveries\nwith PPH”). We compared the NLP-based approach to a subtyping approach that leveraged ICD\ncodes. The ICD definitions for each subtype based on conversion from ICD10 codes [26] are in\nTable 5.\nValidation of model performance. We performed manual annotation of discharge summaries\nto assess the performance of our models for extracting PPH-related concepts, identifying patients\nwith PPH, and classifying subtypes of PPH. In each use case, one of four annotators with expe-\nrience in reading obstetrics notes (M.R., R.F., A.G., and V .K.) first annotated the notes with the\nrelevant PPH-related concepts or subtypes, and a clinician (V .K. and K.G.) subsequently reviewed\nall annotations.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nWe extended PRAnCER (Platform Enabling Rapid Annotation for Clinical Entity Recogni-\ntion) [37], an annotation tool for clinical text, to collect annotations for the PPH-related concepts.\nDuring the annotation process, the annotator highlights a span of text in the note and assigns it\nto the corresponding label. Regular expressions are used initially to highlight potential annota-\ntions, and the annotator can confirm or reject the regex “pre-annotation”. We found that this pre-\nannotation process can accelerate the annotation workflow and improve annotator recall. However,\nit does have the potential to induce over-reliance on the pre-annotations. An image of the modified\nannotation tool is found in Supplemental Figure 1.\nStatistical analyses. We performed a McNemar test to assess whether there is a significant dif-\nference in performance between our NLP-based approach and a regular expression approach for\nextracting PPH-related concepts. We similarly used a McNemar test to compare the NLP-based\nand ICD-based approaches for subtyping PPH deliveries.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nData availability. The MGB data used in this  study contains identifiable protected health in-\nformation and therefore cannot be shared publicly. MGB investigators with an appropriate IRB \napproval can contact the authors directly regarding data access.\nAcknowledgements. KJG reports funding from NIH/NHLBI grants K08 HL146963-02, K08 \nHL146963-02S1, and R03 HL162756.  VPK reports funding from the NIH/NHLBI  grants \n1K08HL161326-01A1, Anesthesia Patient Safety  Foundation (APSF), and BWH IGNITE  Award. \nThe funders played no role in study  design, data collection, analysis and  interpretation of data, or \nthe writing of this manuscript.\nCompeting interests. KJG has served as a consultant to Illumina Inc., Aetion, Roche, and Bil-\nlionToOne outside the scope of the submitted work. DWB reports grants and personal fees from\nEarlySense, personal fees from CDI Negev, equity from Valera Health, equity from CLEW, eq-\nuity from MDClone, personal fees and equity from AESOP Technology, personal fees and equity\nfrom FeelBetter, and grants from IBM Watson Health, outside the submitted work. VPK reports\nconsulting fees from Avania CRO unrelated to the current work.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nPatients with pregnancy 1998-2015138,648 patients503,991 notes Final Cohort 131,284 patients271,081 notes\nER visit only4,086 patients138,598 notesDuplicates / Drafts205patients7,722notes\nNon-delivery3,073 patients86,590 notes\na\nb4/27/23, 3:16 PM donut_by_hospital.html\nﬁle:///Users/emilya/Documents/Documents_EmilysMacBookPro/postdoc/pregnancy complications/ﬁgures/donut_by_hospital.html 1/1\n4/27/23, 3:16 PM donut_by_age.html\nﬁle:///Users/emilya/Documents/Documents_EmilysMacBookPro/postdoc/pregnancy complications/ﬁgures/donut_by_age.html 1/1\n4/27/23, 3:17 PM donut_by_race.html\nﬁle:///Users/emilya/Documents/Documents_EmilysMacBookPro/postdoc/pregnancy complications/ﬁgures/donut_by_race.html 1/1\n4/27/23, 3:17 PM donut_by_ethnicity.html\nﬁle:///Users/emilya/Documents/Documents_EmilysMacBookPro/postdoc/pregnancy complications/ﬁgures/donut_by_ethnicity.html 1/1\nNon-Hispanic(62.5%)\nUnknown(22.1%)\nHispanic(9.1%)Declined(6.3%)\nWhite(57.3%)Black(12.5%)\nAsian(8.9%)\nOther(14.7%)\nUnknown(5.4%) Declined(1.2%)\n31-35(35.1%)\n26-30(23.6%)\n21-25(11.9%)\n<=20(6.0%)>40(4.5%)\n36-40(18.9%)\nc d e\nBWH(62.1%)\nMGH(36.1%)\nNSM(0.7%)NWH(1.1%)\nFigure 1: Obstetric delivery cohort. (a) Inclusion criteria for identifying delivery-related discharge summaries. The final\ncohort consists of 271,081 discharge notes for 131,284 women with an obstetric encounter at Mass General Brigham hospitals\nfrom 1998-2015. (b-e) Characteristics of the cohort based on (b) delivery hospital and (c) patient age at delivery, (d) patient\nrace, and (e) patient ethnicity. ER, emergency room; MGH, Massachusetts General Hospital; BWH, Brigham and Women’s\nHospital, NSM, North Shore Medical Center, NWH, Newton Wellesley Hospital\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \na Answer the following yes/no question. Does the following discharge summary mention uterine atony during the current delivery? note: < note text >\nAnswer the following yes/no question. Does the following discharge summary mention the procedure curretage (D&C) during the current delivery?note: < note text >\nExtract the estimated blood loss (EBL) in the following discharge summary. If you can\\'t find the answer, please respond \"unanswerable\".note: < note text >…\n…Additional Prompts \nBRIEF RESUME OF HOSPITAL COURSE31 yo G4P4 admitted in active labor at 40+2 wks. Progressed to SVD of liveborn male infant. PP course complicated by PPH, uterine atony, and total EBL of approx. 2 L. Her hemorrhage resolved with D&C and placement of a Bakri balloon. Post-operatively, … 2 liters\nUterine atonyUterine rupturePlacenta previaMisoprostolCarboprostDilation & curettage\nEstimated blood loss…\nb c\nCesarean section?Yes\nNo\nEBL > 1L?YesNo\nEBL > 500mL?YesNo\nInterpretable phenotyping based on estimated blood loss\nZero-shot extraction of postpartum hemorrhage concepts\nInterpretable subtyping based on etiology \nTone\nTissue\nTraumaThrombin\nModel OutputsDischarge Summary\nPresence of PPH conceptsUterine atony, administration of uterotonicsPlacenta accreta spectrum, retained products of conception, D&C, manual extractionUterine rupture, surgical trauma, O’Leary sutures, laceration (if no other PPH cause)Coagulation disorders with increased of bleeding\nFigure 2: Overview of zero-shot NLP pipeline for accurate and interpretable postpartum hemorrhage (PPH) pheno-\ntyping. (a) Zero-shot extraction of PPH concepts using Flan-T5. We constructed either yes/no or extraction prompts for\neach PPH concept, concatenated the discharge summary of interest, and fed the combined input into Flan-T5. This process\nenabled the rapid extraction of PPH-related information from notes with no training data. (b) We leveraged the extracted\nconcepts to perform interpretable phenotyping of PPH defined as cesarean deliveries with at least 1L or vaginal deliveries\nwith at least 500mL of estimated blood loss. (c) We used the extracted concepts to perform interpretable subtyping of PPH\nbased on the underlying etiology. We assigned a delivery note to the “tone”, “tissue”, “trauma”, or “thrombin” subtype if any\nof the concepts associated with the subtype are present. PPH, postpartum hemorrhage; EBL, estimated blood loss\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nConcept (n) Sensitivity Specificity PPV Binary F1 Accuracy\nLaceration (n=421) 0.976 0.996 0.993 0.984 0.989\nBakri balloon (n=46) 0.957 1.000 1.000 0.978 0.998\nCesarean delivery (n=470) 0.983 0.970 0.957 0.970 0.975\nMethylergonovine (n=104) 0.952 0.996 0.961 0.957 0.992\nPlacenta previa (n=170) 0.982 0.986 0.923 0.952 0.986\nFresh frozen plasma (n=79) 0.962 0.995 0.938 0.950 0.993\nCarboprost (n=49) 0.898 0.999 0.978 0.936 0.995\nMisoprostol as a uterotonic (n=112) 0.938 0.991 0.913 0.925 0.986\nHysterectomy (n=55) 0.982 0.993 0.871 0.923 0.992\nO’Leary sutures (n=12) 0.917 0.999 0.917 0.917 0.998\nUterine atony (n=107) 0.850 0.999 0.989 0.915 0.986\nRetained products of conception (n=102) 0.892 0.993 0.929 0.910 0.985\nDirect mention of PPH (n=362) 0.881 0.963 0.914 0.897 0.938\nPacked red blood cells (n=165) 0.945 0.971 0.843 0.891 0.968\nAbruption of the placenta (n=47) 0.915 0.994 0.860 0.887 0.991\nCoagulation disorders (n=44) 0.795 0.996 0.897 0.843 0.989\nCryoprecipitate (n=29) 1.000 0.990 0.725 0.841 0.991\nDilation and curettage (n=122) 0.762 0.990 0.894 0.823 0.966\nPlatelets (n=29) 1.000 0.986 0.644 0.784 0.986\nPlacenta accreta spectrum (n=45) 0.822 0.987 0.712 0.763 0.980\nManual extraction of placenta (n=110) 0.782 0.972 0.741 0.761 0.954\nPPH due to surgical causes (n=27) 0.741 0.983 0.513 0.606 0.978\nUterine rupture (n=5) 1.000 0.992 0.357 0.526 0.992\nConcept (n) Sensitivity PPV Note Acc.\nEstimated blood loss (n=212) 0.745 0.905 0.951\nTable 1: Performance of the zero-shot Flan-T5 model in identifying postpartum hemorrhage (PPH) concepts in dis-\ncharge summaries. We assessed model performance on 1175 manually annotated notes with PPH ICD diagnostic codes. We\nreport the prevalence of each concept in the annotated test set. We report model sensitivity, specificity, positive predictive\nvalue (PPV), binary F1 score, and accuracy for binary concepts, and we report sensitivity, PPV , and note-level accuracy in\nextracting the correct estimated blood loss values. PPH, postpartum hemorrhage\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \n0.0 0.2 0.4 0.6 0.8 1.0\nBinary F1\nplacental abruption (n=47)\nuterine rupture (n=5)\ncoagulation disorders (n=44)\nmanual extraction of placenta (n=110)\nretained products of conception (n=102)\ndilation & curettage (n=122)\nplatelets (n=29)\ncryoprecipitate (n=29)\nPPH (n=362)\ncarboprost (n=49)\nmisoprostol as a uterotonic (n=112)\nplacenta accreta spectrum (n=45)\no'leary sutures (n=12)\nsurgical causes of PPH (n=27)\ncesarean delivery (n=470)\nmethylergonovine (n=104)\nplacenta previa (n=170)\npacked red blood cells (n=165)\nuterine atony (n=107)\nbakri balloon (n=46)\nlaceration (n=421)\nfresh frozen plasma (n=79)\nhysterectomy (n=55)\n**\n* *\n**\n**\n**\n**\n**\n**\n**\n**\n**\nLLM\nRegex\nFigure 3: Comparison of the Flan-T5 language model and regular expression approaches for zero-shot extraction of\npostpartum hemorrhage (PPH)-related concepts. The prevalence of each concept in the annotated test set is reported and\ncompared to the model performance according to binary F1 score. The stars (*) denote that there is a significant difference\nusing the McNemar test (p <0.05) between the regex and language model performance. PPH, postpartum hemorrhage.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \n0.0 0.2 0.4 0.6 0.8 1.0\nProportion of notes with PPH ICD Code\nNot Documented\n<= 500\n501-1000\n1001-1500\n1501-2000\n> 2000\nDocumented EBL\nFigure 4: Prevalence of postpartum hemorrhage (PPH) international classification of diseases (ICD) codes in notes\nwith varying estimated blood loss (EBL). The y-axis depicts the range of estimated blood loss (EBL) values extracted from\nthe delivery note by Flan-T5 (if any), and the x-axis denotes the proportion of notes in each EBL category with a postpartum\nhemorrhage ICD diagnostic code. PPH ICD codes are defined according to the definition in Zheutlin et al. [8]. Refer to\nsupplemental Figure 2 for a similar plot using the PPH ICD definition from Butwick et al. [7]. PPH, postpartum hemorrhage;\nICD, international classification of diseases; EBL, estimated blood loss.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nConcept Prevalence (%)\nCesarean delivery 1002 (44.14)\nDirect mention of PPH 915 (40.31)\nLaceration 735 (32.38)\nPacked red blood cells 681 (30.00)\nManual extraction of placenta 532 (23.44)\nMisoprostol as a uterotonic 361 (15.90)\nDilation and curettage 339 (14.93)\nMethylergonovine 325 (14.32)\nFresh frozen plasma 319 (14.05)\nRetained products of conception 302 (13.30)\nUterine atony 261 (11.50)\nPlacenta previa 201 (8.85)\nHysterectomy 185 (8.15)\nCarboprost 159 (7.00)\nPlatelets 147 (6.48)\nPlacenta accreta spectrum 141 (6.21)\nPPH due to surgical causes 135 (5.95)\nBakri balloon 132 (5.82)\nCoagulation disorders 129 (5.68)\nAbruption of the placenta 129 (5.68)\nCryoprecipitate 113 (4.98)\nUterine rupture 106 (4.67)\nO’Leary sutures 40 (1.76)\nTable 2: Prevalence of each postpartum hemorrhage (PPH)-related concept in the deliveries with predicted PPH.Both\nthe count and percentage of each concept are reported. The prevalence is reported in the 2,270 deliveries that the natural\nlanguage processing (NLP)-based model labelled as describing postpartum hemorrhage. PPH, postpartum hemorrhage;\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nSubtype Prevalence (%) Method Sensitivity PPV Binary F1 Acc. P-value\nTone 41.8 NLP 0.931 0.964 0.947 0.957 <0.001ICD 0.644 0.667 0.655 0.716\nTissue 38.9 NLP 0.827 0.957 0.887 0.918 <0.001ICD 0.370 0.909 0.526 0.740\nTrauma 40.9 NLP 0.671 0.826 0.740 0.808 0.018ICD 0.576 0.690 0.628 0.721\nThrombin 6.3 NLP 0.385 0.714 0.500 0.952 1.0ICD 0.462 0.600 0.522 0.947\nTable 3: Comparison of NLP and ICD approaches for PPH subtyping. The true prevalence of each subtype and the\nNLP and ICD model performance are shown. Note that a single episode of postpartum hemorrhage can be classified with\nmultiple subtypes. The model evaluation was performed on 285 notes with confirmed PPH via manual annotation. In 27.0%\nof the notes, the annotators were unable to determine a PPH subtype from the discharge summary alone (not shown). These\nnotes were excluded to avoid inflation of false positives in the ICD model in cases where subtype information was captured\nelsewhere in the medical record. NLP, natural language processing; PPH, postpartum hemorrhage; ICD, international classi-\nfication of diseases.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nConcept Prompt\nDirect mention of PPH Answer the following yes/no question. Does the follow-\ning discharge summary mention postpartum hemorrhage\n(PPH) during the current delivery?\nnote: <note>\nMethylergonovine Answer the following yes/no question. Does the following\ndischarge summary mention the drug methergine (methy-\nlergonovine)?\nnote: <note>\nEstimated blood loss Extract the estimated blood loss (EBL) in the following\ndischarge summary. If you can ´t find the answer, please re-\nspond ”unanswerable”.\nnote: <note>\nPlacenta accreta spectrum\nAnswer the following yes/no question. Does the following\ndischarge summary mention placenta percreta during the\ncurrent delivery?\nnote: <note>\nAnswer the following yes/no question. Does the follow-\ning discharge summary mention placenta increta during\nthe current delivery?\nnote: <note>\nAnswer the following yes/no question. Does the following\ndischarge summary mention placenta accreta during the\ncurrent delivery?\nnote: <note>\nTable 4: Example prompts provided to Flan-T5 to perform zero-shot extraction of postpartum hemorrhage (PPH)-\nrelated concepts. We include prompts representative of different types of information retrieval (e.g. presence of a condition,\npresence of a drug, quantitative value extraction, and multi-prompt concept extraction). “<note>” refers to the full text of\nthe note. If the entire note can not fit into a single context window of the model, the text is split into chunks, and the prompt is\nconcatenated to each chunk separately and input into the model. The remaining prompts can be found in our accompanying\nGithub repository. PPH, postpartum hemorrhage; EBL, estimated blood loss.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nSubtype NLP-based definition ICD-based definition\nTone uterine atony; methergine / methyler-\ngonovine; carboprost; misoprostol as a\nuterotonic\n666.1x\nTissue placenta accreta spectrum; retained prod-\nucts of conception; dilatation and curet-\ntage; manual extraction of the placenta\n666.0x\nTrauma uterine rupture; PPH due to surgical\ncauses; O’Leary stitches; laceration (if no\nother subtype is valid)\n665.x or (664.x if no 666.x)\nThrombin coagulation disorders with increased risk\nof bleeding; administration of platelets,\nfresh frozen plasma, or cryoprecipitate in\na ratio with red blood cells higher than\n1:1:1\n666.3x\nTable 5: Postpartum hemorrhage (PPH) subtype definitions. The natural language processing (NLP)-based approach that\nleverages the extracted PPH concepts is on the left. A note is labelled with a given subtype if any of the concepts are present in\nthe note. One exception is the “laceration” concept, which only signifies the “trauma” subtype if no other subtypes have been\nassigned to the note. The baseline international classification of diseases (ICD)-based approach is on the right. Similarly, a\nnote is assigned to a subtype if any of the ICD codes are present. Here x refers to any number 0 − 9, meaning that any more\nspecific ICD code under that in the ICD ontology will suffice. For example, 666.14 is a valid ICD code for the “tone“ subtype.\n664.x only signifies the “trauma” subtype if no 666.x ICD code is present (i.e. there are no other attributable causes of the\nhemorrhage). These rules for the “laceration” subtype are designed to mitigate false positives due to lacerations during the\ndelivery that do not result in significant hemorrhage. NLP, natural language processing; PPH, postpartum hemorrhage; ICD,\ninternational classification of diseases.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \nReferences\n1. Yu, S. et al.Toward high-throughput phenotyping: unbiased automated feature extraction and\nselection from knowledge sources. Journal of the American Medical Informatics Association:\nJAMIA 22, 993–1000 (2015).\n2. Nakamaru, R. et al. Phenotyping of Elderly Patients With Heart Failure Focused on Noncar-\ndiac Conditions: A Latent Class Analysis From a Multicenter Registry of Patients Hospitalized\nWith Heart Failure. Journal of the American Heart Association12, e027689 (2023).\n3. Bennett, W. L. et al.Patient Recruitment Into a Multicenter Clinical Cohort Linking Electronic\nHealth Records From 5 Health Systems: Cross-sectional Analysis.Journal of Medical Internet\nResearch 23, e24003 (2021).\n4. Richesson, R. L. et al. Electronic health records based phenotyping in next-generation clin-\nical trials: a perspective from the NIH Health Care Systems Collaboratory. Journal of the\nAmerican Medical Informatics Association : JAMIA20, e226–e231 (2013).\n5. Post, A. R. et al. Temporal Abstraction-based Clinical Phenotyping with Eureka! AMIA\nAnnual Symposium Proceedings2013, 1160–1169 (2013).\n6. Denny, J. C. et al. Systematic comparison of phenome-wide association study of electronic\nmedical record data and genome-wide association study data.Nature Biotechnology31, 1102–\n1110 (2013).\n7. Butwick, A. J., Walsh, E. M., Kuzniewicz, M., Li, S. X. & Escobar, G. J. Accuracy of in-\nternational classification of diseases, ninth revision, codes for postpartum hemorrhage among\nwomen undergoing cesarean delivery. Transfusion 58, 998–1005 (2018).\n8. Zheutlin, A. B. et al.A comprehensive digital phenotype for postpartum hemorrhage. Journal\nof the American Medical Informatics Association: JAMIA29, 321–328 (2022).\n9. Kirby, J. C. et al.PheKB: a catalog and workflow for creating electronic phenotype algorithms\nfor transportability. Journal of the American Medical Informatics Association : JAMIA23,\n1046–1052 (2016).\n10. Liao, K. P. et al. Development of phenotype algorithms using electronic medical records and\nincorporating natural language processing. The BMJ350, h1885 (2015).\n11. Zeng, Z., Deng, Y ., Li, X., Naumann, T. & Luo, Y . Natural Language Processing for EHR-\nBased Computational Phenotyping. IEEE/ACM transactions on computational biology and\nbioinformatics 16, 139–153 (2019).\n12. Aramaki, E., Imai, T., Miyo, K. & Ohe, K. Patient status classification by using rule based\nsentence extraction and bm25 knn-based classifier. Ini2b2 Workshop on Challenges in Natural\nLanguage Processing for Clinical Data(2006).\n13. Sharma, H. et al. Developing a portable natural language processing based phenotyping sys-\ntem. BMC Medical Informatics and Decision Making19, 78 (2019).\n14. Chase, H. S., Mitrani, L. R., Lu, G. G. & Fulgieri, D. J. Early recognition of multiple sclerosis\nusing natural language processing of the electronic health record. BMC Medical Informatics\nand Decision Making17, 24 (2017).\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \n15. Chapman, W. W., Fizman, M., Chapman, B. E. & Haug, P. J. A comparison of classification\nalgorithms to automatically identify chest x-ray reports that support pneumonia. Journal of\nbiomedical informatics34, 4–14 (2001).\n16. Yang, S., Varghese, P., Stephenson, E., Tu, K. & Gronsbell, J. Machine learning approaches for\nelectronic health records phenotyping: a methodical review. Journal of the American Medical\nInformatics Association30, 367–381 (2023).\n17. Gehrmann, S. et al.Comparing rule-based and deep learning models for patient phenotyping.\narXiv preprint arXiv:1703.08705(2017).\n18. Brown, T. B. et al.Language models are few-shot learners. ArXiv abs/2005.14165 (2020).\n19. Ouyang, L. et al. Training language models to follow instructions with human feedback\n(2022). ArXiv:2203.02155 [cs].\n20. Chung, H. W. et al. Scaling Instruction-Finetuned Language Models (2022).\nArXiv:2210.11416 [cs].\n21. Agrawal, M., Hegselmann, S., Lang, H., Kim, Y . & Sontag, D. A. Large language models are\nzero-shot clinical information extractors. ArXiv abs/2205.12689 (2022).\n22. McInerney, D. J., Young, G., van de Meent, J.-W. & Wallace, B. C. CHiLL: Zero-shot Custom\nInterpretable Feature Extraction from Clinical Notes with Large Language Models (2023).\nArXiv:2302.12343 [cs].\n23. Collaborators, G. B. D. M. M. Global, regional, and national levels of maternal mortality,\n1990-2015: a systematic analysis for the Global Burden of Disease Study 2015. Lancet 388,\n1775–1812 (2016).\n24. Committee on Practice Bulletins-Obstetrics. Practice Bulletin No. 183: Postpartum Hemor-\nrhage. Obstetrics and Gynecology130, e168–e186 (2017).\n25. Corbetta-Rastelli, C. M. et al. Postpartum Hemorrhage Trends and Outcomes in the United\nStates, 2000-2019. Obstetrics and Gynecology141, 152–161 (2023).\n26. Walther, D. et al. Hospital discharge data is not accurate enough to monitor the incidence of\npostpartum hemorrhage. PloS One16, e0246119 (2021).\n27. Agrawal, M., Hegselmann, S., Lang, H., Kim, Y . & Sontag, D. Large Language Models are\nFew-Shot Clinical Information Extractors (2022). ArXiv:2205.12689 [cs].\n28. American College of Obstetricians and Gynecologists. ACOG Practice Bulletin: Clinical\nManagement Guidelines for Obstetrician-Gynecologists Number 76, October 2006: postpar-\ntum hemorrhage. Obstetrics and Gynecology108, 1039–1047 (2006).\n29. He, M. et al. Validation of algorithms to identify adverse perinatal outcomes in the Medicaid\nAnalytic Extract database. Pharmacoepidemiology and Drug Safety29, 419–426 (2020).\n30. Ende, H. B. et al. Development of clinical risk-prediction models for uterine atony follow-\ning vaginal and cesarean delivery. International Journal of Obstetric Anesthesia51, 103550\n(2022).\n31. Lehman, E. et al.Do we still need clinical language models?arXiv preprint arXiv:2302.08091\n(2023).\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint \n32. Nalichowski, R., Keogh, D., Chueh, H. C. & Murphy, S. N. Calculating the Benefits of a\nResearch Patient Data Repository. AMIA Annual Symposium Proceedings2006, 1044 (2006).\n33. Kuklina, E. V .et al.An enhanced method for identifying obstetric deliveries: implications for\nestimating maternal morbidity. Maternal and Child Health Journal12, 469–477 (2008).\n34. Sylvain Gugger, T. W. P. S. Z. M. S. M., Lysandre Debut. Accelerate: Training and inference at\nscale made simple, efficient and adaptable. https://github.com/huggingface/accelerate (2022).\n35. Goffman, D. et al. A Framework for Improving Characterization of Obstetric Hemorrhage\nUsing Informatics Data. Obstetrics and Gynecology134, 1317–1325 (2019).\n36. Evensen, A., Anderson, J. M. & Fontaine, P. Postpartum Hemorrhage: Prevention and Treat-\nment. American Family Physician95, 442–449 (2017).\n37. Levy, A. & Agrawal, M. PRAnCER (2023). Original-date: 2020-10-25T17:54:35Z.\nAll rights reserved. No reuse allowed without permission. \n(which was not certified by peer review) is the author/funder, who has granted medRxiv a license to display the preprint in perpetuity. \nThe copyright holder for this preprintthis version posted June 1, 2023. ; https://doi.org/10.1101/2023.05.31.23290753doi: medRxiv preprint "
}