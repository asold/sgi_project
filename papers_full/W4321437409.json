{
    "title": "Colorectal cancer lymph node metastasis prediction with weakly supervised transformer-based multi-instance learning",
    "url": "https://openalex.org/W4321437409",
    "year": 2023,
    "authors": [
        {
            "id": "https://openalex.org/A2347245083",
            "name": "Tan Luxin",
            "affiliations": [
                "Peking University Cancer Hospital",
                "Peking University"
            ]
        },
        {
            "id": "https://openalex.org/A2045444899",
            "name": "Li huan",
            "affiliations": [
                "Peking University Cancer Hospital",
                "Peking University"
            ]
        },
        {
            "id": "https://openalex.org/A2986473141",
            "name": "Yu JinZe",
            "affiliations": [
                "Beihang University"
            ]
        },
        {
            "id": "https://openalex.org/A4281956472",
            "name": "Zhou, Haoyi",
            "affiliations": [
                "Beihang University"
            ]
        },
        {
            "id": "https://openalex.org/A1842122615",
            "name": "Wang Zhi",
            "affiliations": []
        },
        {
            "id": "https://openalex.org/A2349140919",
            "name": "Niu Zhi-yong",
            "affiliations": []
        },
        {
            "id": "https://openalex.org/A2020626240",
            "name": "Li Jianxin",
            "affiliations": [
                "Beihang University"
            ]
        },
        {
            "id": "https://openalex.org/A2103336347",
            "name": "Li Zhongwu",
            "affiliations": [
                "Peking University",
                "Peking University Cancer Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2347245083",
            "name": "Tan Luxin",
            "affiliations": [
                "Peking University",
                "Peking University Cancer Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2045444899",
            "name": "Li huan",
            "affiliations": [
                "Peking University",
                "Peking University Cancer Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2986473141",
            "name": "Yu JinZe",
            "affiliations": [
                "Beihang University"
            ]
        },
        {
            "id": "https://openalex.org/A4281956472",
            "name": "Zhou, Haoyi",
            "affiliations": [
                "Beihang University"
            ]
        },
        {
            "id": "https://openalex.org/A1842122615",
            "name": "Wang Zhi",
            "affiliations": [
                "Beihang University"
            ]
        },
        {
            "id": "https://openalex.org/A2349140919",
            "name": "Niu Zhi-yong",
            "affiliations": [
                "Peking University",
                "Peking University Cancer Hospital"
            ]
        },
        {
            "id": "https://openalex.org/A2020626240",
            "name": "Li Jianxin",
            "affiliations": []
        },
        {
            "id": "https://openalex.org/A2103336347",
            "name": "Li Zhongwu",
            "affiliations": []
        }
    ],
    "references": [
        "https://openalex.org/W3128646645",
        "https://openalex.org/W2302003756",
        "https://openalex.org/W1598584994",
        "https://openalex.org/W2796409016",
        "https://openalex.org/W3004053956",
        "https://openalex.org/W3080854745",
        "https://openalex.org/W3206785039",
        "https://openalex.org/W3115168802",
        "https://openalex.org/W3089090082",
        "https://openalex.org/W3167269280",
        "https://openalex.org/W3093416812",
        "https://openalex.org/W2062177968",
        "https://openalex.org/W2302302587",
        "https://openalex.org/W3082636273",
        "https://openalex.org/W2945807221",
        "https://openalex.org/W2808210572",
        "https://openalex.org/W2956228567",
        "https://openalex.org/W2962939528",
        "https://openalex.org/W3091149861",
        "https://openalex.org/W3034534840",
        "https://openalex.org/W2971045153",
        "https://openalex.org/W3135547872",
        "https://openalex.org/W3201905155",
        "https://openalex.org/W3205605830",
        "https://openalex.org/W2996780833",
        "https://openalex.org/W3041937667",
        "https://openalex.org/W2805735218",
        "https://openalex.org/W3011974116",
        "https://openalex.org/W2975180264",
        "https://openalex.org/W2982406227",
        "https://openalex.org/W4211168195",
        "https://openalex.org/W3009926465",
        "https://openalex.org/W3167514989",
        "https://openalex.org/W2140340422",
        "https://openalex.org/W2044608166",
        "https://openalex.org/W2773510519",
        "https://openalex.org/W3123414476",
        "https://openalex.org/W2537275935",
        "https://openalex.org/W4313160863",
        "https://openalex.org/W3098637688",
        "https://openalex.org/W4226512818",
        "https://openalex.org/W3176719058",
        "https://openalex.org/W3119441468"
    ],
    "abstract": null,
    "full_text": "Vol.:(0123456789)1 3\nMedical & Biological Engineering & Computing (2023) 61:1565–1580 \nhttps://doi.org/10.1007/s11517-023-02799-x\nORIGINAL ARTICLE\nColorectal cancer lymph node metastasis prediction with weakly \nsupervised transformer‑based multi‑instance learning\nLuxin Tan1 · Huan Li1 · Jinze Yu2,3,4 · Haoyi Zhou2,5 · Zhi Wang6 · Zhiyong Niu6 · Jianxin Li2,3 · Zhongwu Li1 \nReceived: 10 August 2022 / Accepted: 31 January 2023 / Published online: 21 February 2023 \n© The Author(s) 2023\nAbstract\nLymph node metastasis examined by the resected lymph nodes is considered one of the most important prognostic factors for \ncolorectal cancer (CRC). However, it requires careful and comprehensive inspection by expert pathologists. To relieve the \npathologists’ burden and speed up the diagnostic process, in this paper, we develop a deep learning system with the binary \npositive/negative labels of the lymph nodes to solve the CRC lymph node classification task. The multi-instance learning \n(MIL) framework is adopted in our method to handle the whole slide images (WSIs) of gigapixels in size at once and get \nrid of the labor-intensive and time-consuming detailed annotations. First, a transformer-based MIL model, DT-DSMIL, is \nproposed in this paper based on the deformable transformer backbone and the dual-stream MIL (DSMIL) framework. The \nlocal-level image features are extracted and aggregated with the deformable transformer, and the global-level image features \nare obtained with the DSMIL aggregator. The final classification decision is made based on both the local and the global-level \nfeatures. After the effectiveness of our proposed DT-DSMIL model is demonstrated by comparing its performance with its \npredecessors, a diagnostic system is developed to detect, crop, and finally identify the single lymph nodes within the slides \nbased on the DT-DSMIL and the Faster R-CNN model. The developed diagnostic model is trained and tested on a clinically \ncollected CRC lymph node metastasis dataset composed of 843 slides (864 metastasis lymph nodes and 1415 non-metastatic \nlymph nodes), achieving the accuracy of 95.3% and the area under the receiver operating characteristic curve (AUC) of 0.9762 \n(95% confidence interval [CI]: 0.9607–0.9891) for the single lymph node classification. As for the lymph nodes with micro-\nmetastasis and macro-metastasis, our diagnostic system achieves the AUC of 0.9816 (95% CI: 0.9659–0.9935) and 0.9902 \n(95% CI: 0.9787–0.9983), respectively. Moreover, the system shows reliable diagnostic region localizing performance: the \nmodel can always identify the most likely metastases, no matter the model’s predictions or manual labels, showing great \npotential in avoiding false negatives and discovering incorrectly labeled slides in actual clinical use.\nKeywords Colorectal cancer · Lymph node metastasis · Whole slide image · Multi-instance learning · Vision transformer · \nDeep learning · Computer-aided diagnosing\n1 Introduction\nColorectal cancer (CRC) accounts for approximately 10% \nof all cancer cases diagnosed and cancer-related deaths \nworldwide. CRC is also the third most common cancer in \nmales and the second most common cancer in females [1 ]. \nThe number of new CRC cases worldwide is estimated to \nincrease to 2.5 million by 2035 [2 ]. Surgical resection of \nthe tumor and associated regional lymph nodes remains the \nmost effective treatment for CRC. Lymph node metastasis \nexamined by the removed lymph nodes is considered one of \nthe most important prognostic factors for the disease, which \nrequires careful and comprehensive inspection by expert \npathologists. The 7th and 8th editions of the American Joint \nLuxin Tan, Huan Li and Jinze Yu contributed equally to this work.\n * Zhiyong Niu \n niuzhiyong@blothealth.com\n * Jianxin Li \n lijx@act.buaa.edu.cn\n * Zhongwu Li \n zhwuli@hotmail.com\nExtended author information available on the last page of the article\n1566 Medical & Biological Engineering & Computing (2023) 61:1565–1580\n1 3\nCommittee on Cancer have recommended the examination \nof at least 12 lymph nodes during surgical resection for CRC \n[3], which poses a significant challenge to the intensity and \naccuracy of the work for pathologists together with the \nincreasing number of slides produced clinically.\nAutomated cancer detection in whole slide images (WSIs) \nhas been a long-standing research area for decades since the \ntraditional manual annotating procedure is time-consuming \nand error-prone. The application of deep learning to analyze \nWSIs is becoming increasingly important. Recent promising \nresults in cancer diagnosis and detection, tumor micro-envi-\nronment phenotype classification, and prognosis prediction \nreveal the great potential of WSI diagnostic methods based on \ndeep learning [4–6]. These achievements can be attributed to \nthe advances in computer vision and medical image analysis \nalgorithms. However, these methods are still restricted by the \nhigh demand for a large-scale, thoroughly annotated dataset.\nThe typical paradigm of processing WSIs is the patch-\nwise processing method, which crops the gigapixel slide \nimages into thousands of image patches with smaller dimen-\nsions, e.g., 224 × 224 pixels [7]. The patches are examined \nby a patch-wise classification network, e.g., a convolutional \nneural network (CNN), to obtain positive probability or \nto segment diagnostic regions within each patch, includ-\ning tumor areas, stroma or smooth muscle, necrosis, and \nfibrosis [8 ]. The patch-wise results are further aggregated \nby simple aggregation methods like max or average pooling \nfor slide-level tasks to obtain final global prediction results. \nThe aforementioned patch-wise classification and global \nslide-wise aggregation procedure rely on patch-wise or even \npixel-wise annotations, which are costly, time-consuming, \nand problematic due to the severely imbalanced data distri-\nbution between negative and positive patches and common \nand cancerous cells.\nTo address the issues mentioned above in patch-based \nfully supervised learning methods, some recent methods \nhave studied WSI classification and segmentation systems \nin a weakly supervised manner that exploits slide-level diag-\nnostic labels, which are readily available in the standard clin-\nical systems or lymph-node level labels that can be collected \nrelatively painlessly and achieved promising results [9, 10]. \nA typical solution for the weakly supervised WSI classifica-\ntion task in which only slide-level labels are available is the \nmulti-instance learning (MIL) framework. In the MIL prob-\nlem setting, if at least one patch with tumor cells is contained \nin the slide, the slide is labeled as positive. Some early works \nfollowing the problem setting still exhibit the patch-wise \nclassification manner but cast the slide-level labels to the \npatches with the highest probabilities instead of relying on \nthe patch-wise labels [11, 12]. However, they still rely on \nthe patch-level classifier to get the patch probabilities, and \nthe final slide scores are acquired by simply averaging the \npatch scores with the same weights. Some other works train \na small model to predict a weight for each patch score in the \nweighted averaging procedure or make the final decision on \nthe patch predicted classes [13, 14].\nInstead of averaging the patch scores to get the final slide \npredictions, some more recent works generate a feature vec-\ntor for each patch and obtain a final global feature vector \nfor the entire slide by aggregating the patch-level features. \nThe global classification prediction is obtained by a classi-\nfier with the global-level feature instead of combining the \npatch-level prediction scores. Such works aggregate the \npatch-level scores with untrainable methods like concat-\nenate [15, 16] and trainable methods like RNNs [17, 18], \ngraphs [ 19, 20], and attention-based models [ 21–24]. The \nMIL-RNN model [17] casts the slide labels to the patches \nwith the highest probability in the patch-level prediction and \nproposes to aggregate patch features with the highest prob-\nabilities with an RNN model. The DSMIL model [24] pro-\nposes to aggregate all patch features with the MIL attention \nmechanism. The CLAM model [25] aggregates the patch \nfeatures with attention scores predicted for the patches, and \nan additional auxiliary clustering task is performed on the \npatches based on the ranking of the attention scores. And \nthe most recent works directly apply the vision transform-\ners, which are composed of procedures the same as the MIL \nframework like patching, feature extraction, feature aggre-\ngation, and decision-making to the WSI classification task \n[23]. With the MIL framework, only a label for the entire \nslide is required in the training phase, thus alleviating the \nheavy burden brought by the detailed annotations.\nIn addition to the benign and malignant classification as \nwell as the genotyping of the entire slide as a whole [22, 26, \n27], some previous works focus on other tasks like detect-\ning DNA damage or mitotic figures with object detection \nmethods, segmenting nuclei, glands, and different kinds \nof tissues with semantic segmentation methods and active \nlearning [28–32].\nIn this study, we first develop a weakly supervised WSI \nclassification model, DT-DSMIL, to identify metastasis in \nCRC lymph nodes with a transformer-based MIL model. \nIn the DT-DSMIL model, the slides are first cropped into \nsmaller patches, and their features are extracted by an Ima-\ngeNet-pretrained ResNet-50 model. And then, the patch fea-\nture tokens are further processed and aggregated with each \nother with an encoder-only version of the deformable trans-\nformer model and the deformable attention mechanism. At \nthe end of the model, a dual-stream MIL aggregator [24] is \nadopted to discover the critical patches within the slide and \ngenerate a global-level feature vector for the entire slide. The \nfinal slide-level classification results are made by a global-\nlevel classifier with the extracted global-level slide feature. \nDT-DSMIL is trained with slide-level labels only, while it \nis able to discover and illustrate the diagnostic regions and \ncomponents with visualization maps.\n1567Medical & Biological Engineering & Computing (2023) 61:1565–1580 \n1 3\nFurthermore, based on the proposed DT-DSMIL model \nand the Faster R-CNN model, we developed a two-stage \ndiagnostic system for the single lymph node classification \ntask. The lymph nodes within the slides are detected and \nthen cropped with the Faster R-CNN model in the first stage \nand then classified as negative or positive with the proposed \nDT-DSMIL model in the second. The lymph nodes within \nthe slide are annotated with bounding boxes and correspond-\ning binary positive/negative labels. The developed diagnostic \nsystem is trained with the annotations, and its performance \nfor both tasks is evaluated. Furthermore, an extensive evalu-\nation is performed on different subsets of the test dataset, \nincluding lymph nodes with or without neoadjuvant chemo-\ntherapy, lymph nodes with different histologic subtypes, and \nlymph nodes with different metastatic foci sizes. Visualized \nheatmaps are generated in the inference stage to interpret the \nprediction results and localize the tumor regions.\nThe main contributions of this paper can be summarized \nas follows:\n1. We propose a novel and effective transformer-based MIL \nmodel, DT-DSMIL, for the CRC LN metastasis classifi-\ncation task. The DT-DSMIL can be trained with only the \nslide-level binary labels already available in the clinical \nmedical record database to identify the WSIs and further \nlocalize the diagnostic regions. The performance of the \nproposed DT-DSMIL model is evaluated and compared \nwith its predecessors.\n2. Based on the proposed DT-DSMIL model, we develop \na diagnostic system to detect, crop, and identify every \nsingle lymph node in the WSIs. Extensive artificial eval-\nuations of the performance in identifying the majority \ntypes of metastases and localizing the diagnostic and \ntumor areas are carried out by expert pathologists on \ndifferent subsets of the data.\n3. We collected a clinical CRC LN metastasis dataset of 843 \nWSIs from 357 patients from 2019 to 2021. The dataset \nis annotated with slide-level binary positive/negative \nlabels, bounding boxes, and binary labels for the lymph \nnodes in the slides. The test set is further annotated with \ndot annotations on the tumor areas and re-checked by \ntwo qualified pathologists blindly and independently. The \nproposed model and the developed diagnostic system are \ntrained and evaluated with the dataset.\n2  Materials and methods\n2.1  Data collection\nThis study enrolled 843 digital slide images from 357 \npatients who underwent radical resection of primary CRC \nin Peking University Cancer Hospital between January \n2019 and January 2021. Hematoxylin and eosin (H&E) \nstained sections are scanned with the Aperio AT2 digital \npathology scanner (Leica Biosystems) with 40 × magnifica-\ntion and visualized with the Aperio ImageScope software. \nThe corresponding complete clinical data and histopathol-\nogy reports are collected for all slides. Slides with histo-\nlogical artifacts such as over fixation, poor staining, and \nbubbles are excluded, while slides with pen markers are \nadopted.\nAmong these 843 slides, 556 with positive lymph \nnodes are labeled positive, while the remaining 287 are \nlabeled negative. For the slides labeled as positive, at least \none positive lymph node (with metastasis) is contained, \nwhile for the slides labeled as negative, all the contained \nlymph nodes are negative and with no metastasis. Besides \nthe binary labels, bounding boxes for lymph nodes and \nother isolated separatable tissues, such as tumor depos-\nits, vessels, and fat within the slides, are collected for \nthe single lymph node detection and classification task. \nIrregular structureless collections of lymphoid tissue with \nno fibrous capsule located in the fibro-adipose connective \ntissues are not counted as lymph nodes. Acellular mucin \npools found in lymph nodes after neoadjuvant therapy \nare considered negative lymph nodes. Examples of the \ncollected slides and their annotations, to be detailedly \nintroduced later, are shown in Fig.  1.\nFor lymph node-level data composition, a total num-\nber of 2279 nodes are included. Eight hundred sixty-four \n(approximately 2/5) nodes are positive, and the remaining \n1415 lymph nodes are negative. Irregular structureless \ncollections of lymphoid tissue with no fibrous capsule \nlocated in the fibro adipose connective tissue are not \ncounted as lymph nodes. Acellular mucin pools found \nin lymph nodes after neoadjuvant therapy are considered \nnegative lymph nodes. The ground truth slide-level labels \nare determined by the slides’ clinical reports.\n2.2  Software and hardware requirements\nAll experiments are conducted on a high-performance \ncomputing cluster in the Beijing Advanced Innovation \nCentre for Big Data and Brain Computing. In particular, \nthe experiments are conducted with one NVIDIA Tesla \nA100 PCI-E 40 GB GPU with the support of CUDA 11.3 \nand cuDNN 8.2 for GPU acceleration. PyTorch 1.11 is \nemployed for model building and training, OpenSlide \nPython 1.12 for WSI file loading, and Python 3.8 for cod -\ning. Annotating for validating and testing is performed \nwith the Automated Slide Analysis Platform (ASAP) with \nversion 1.9.\n1568 Medical & Biological Engineering & Computing (2023) 61:1565–1580\n1 3\n2.3  MIL‑based slide classification with DT‑DSMIL \nmodel\nThe overall framework of the proposed DT-DSMIL \nmodel is illustrated in Fig.  2, which is composed of four \ncomponents: a patch-wise feature extractor, a trans-\nformer-based local-level feature aggregator, a dual-\nstream MIL-based global-level feature aggregator to \nfind out the most decisive patch within the entire slide \nand generate the global-level slide feature, and the final \nclassifier to make the decision for each slide based on \nthe feature for the critical patch and the feature for the \nentire slide.\nIn the preprocessing and the feature extraction phase, for \neach slide, the tissue regions are segmented by threshold-\ning the saturation channel, and the regions are cropped into \nsmaller patches with the same size as the ImageNet dataset \n( 256 × 256 pixels) at the magnification of 10× and with no \noverlapping. A 2048-d feature vector is generated for each \npatch with the patch-wise feature extractor implemented by \nan ImageNet pre-trained ResNet-50 model. The final clas-\nsification layer of the model is removed, and thus the output \nof the modified ResNet-50 model is a feature vector with a \nlength of 2048. Position embeddings are added to the patch \nfeatures before the local-level feature aggregator. The simple \nsinusoidal absolute position embedding is adopted in our \nmodel. The position embedding vectors are the same length \nas the patch features (that is, 2048-d in our model). For the \nidx-th patch at position (xidx, yidx) , its 2048-d position embed-\nding is divided into two 1024-d vectors, for the x -axis and \nthe y-axis separately. For each 1024-d vector at the position \npos in either axis, its value at the dimension of 2i or 2i + 1 is:\nPE (pos,2i) = sin /parenleft.s1pos∕10000 2i∕dmodel\n/parenright.s1\nPE (pos,2i+1) = cos /parenleft.s1pos∕10000 2i∕dmodel\n/parenright.s1\nThe two 1024-d position embeddings for the x  or y \ndimension are concatenated, and a final 2048-d position \nembedding for both dimensions is acquired. A dimension-\nwise addition is performed between the position embed-\ndings and the features.\nThe transformer-based local-level feature aggregator is \nimplemented with an encoder-only version of the deform-\nable transformer. The position-embedded local-level patch \nfeature tokens are given to the transformer model as input, \nand the encoder of the transformer, which is composed \nof several stacked transformer blocks with multi-head \ndeformable self-attention, feed-forward network, layer \nnormalization, and GeLU activation function, aggregates \nthe input feature tokens with each other based on their \ncorrelations. The output of the transformer encoder is the \ncontext-aggregated local-level patch feature tokens.\nThen, instead of the decoder part of the original trans-\nformer model, the dual-stream MIL aggregator is adopted \nto generate global-level slide features based on the most \ndecisive patch within each slide. The most decisive patch \nis discovered with a local-level instance classifier g inst \nwhich predicts a score cidx = ginst\n/parenleft.s1fidx\n/parenright.s1 for the idx-th patch \nfeature token, and the token feature fmax with maximum \nprediction score cmax is chosen as the most decisive patch \nfeature token. Then the token fmax is aggregated with all \nthe tokens by the MIL attention mechanism, which can be \nviewed as a simplified version of the original self-attention \nas shown in Fig.  3: only the attention scores between the \nselected token fmax and other tokens are computed, result-\ning one context aggregated global-level token fslide . Then a \nglobal-level classifier gslide is applied to obtain a prediction \nscore cslide for fslide . Then the final prediction score c for \nthe entire slide is obtained by averaging the global-level \nprediction score and the local-level prediction score:\nc = 1\n2\n/parenleft.s1cmax + cslide\n/parenright.s1\nFig. 1  Examples of the col-\nlected slides in our dataset and \ntheir annotations\n\n1569Medical & Biological Engineering & Computing (2023) 61:1565–1580 \n1 3\n2.4  Metastases location with patch intensity \nand attention maps\nOur developed diagnostic system is capable of locating \ndiagnose-related decisive components within each slide \nwith patch probability maps derived from the instance-\nlevel classifier and attention maps derived from the DSMIL \naggregator.\nThe patch probability maps and the attention maps \ndescribe the prediction process from two aspects: the \npatch probability maps obtained by the instance-level \nclassifier reveal the probability of each patch being posi-\ntive in the local-level patch classification task. The patch \nwithin each image with the highest probability score is \nof the most importance and with the highest probability \nof containing tumor cells. However, the final loss value \ncomputation involves only one patch with the highest \nprobability. Thus, the local-level prediction task train-\ning and its supervision signal are rather noisy. Therefore, \nthe localization performance of the patch probability \nmaps is unreliable, as shown in the artificial visualiza-\ntion result analysis. As the patch probability maps can-\nnot sufficiently represent the entire slides, we introduce \nthe attention scores generated by the global-level DSMIL \naggregator, which represents the correlation between all \nother patches and the most decisive patch of each slide. \nThe attention scores are extracted and visualized, result-\ning in an attention map for each slide. The higher atten-\ntion weights mean that the corresponding patches are of \nhigher importance in the global-level slide prediction. \nThe attention maps describe the patches from a global \nview of a higher level. The attention scores for the patches \nreveal a higher connection with the tumor areas than the \nprobability scores in the manual analysis. Furthermore, \nthe visualized maps can serve as practical tools to avoid \nundetected positive and false negatives in actual clinical \nuse, given the patch intensity and attention maps. The \npathologists can easily double-check the model’s predic -\ntions by only reviewing the regions of the highest impor -\ntance in the two maps.\nFig. 2  Diagram for the DT-DSMIL model, composed of a deformable transformer encoder and a dual-stream MIL attention head\nFig. 3  Diagram of the MIL \nattention mechanism in the \nDSMIL attention head, which \ncan be viewed as a simplified \nversion of the multi-head self-\nattention mechanism\n\n1570 Medical & Biological Engineering & Computing (2023) 61:1565–1580\n1 3\n2.5  Diagnostic system for single lymph node \ndetection, cropping, and classification\nAfter proposing and evaluating the novel DT-DSMIL \nmodel, a diagnostic system for detecting, cropping, and \nclassifying the single lymph nodes in the slides is devel-\noped based on the DT-DSMIL model and the Faster R-CNN \nmodel. The developed diagnostic system comprises two \nstages: one for distinguishing and localizing the lymph \nnodes against other tissues in the WSIs and another for \nclassifying these lymph nodes as positive or negative. The \noverall architecture of the developed diagnostic system is \nillustrated in Fig.  4.\nThe first stage is accomplished with a lymph node \ndetector based on Faster R-CNN [12]. Tissues within the \nWSIs are localized and classified as lymph nodes or other \nisolated tissues such as tumor deposits, vessels, and fat. \nSingle lymph node images are cropped from the entire \nWSIs according to the model’s prediction. This stage is \nperformed on WSIs at 5× magnification to improve effi-\nciency and reduce the computational cost, which is ade -\nquate for the pathologists to distinguish different tissue \ntypes.\nThe second stage is performed on the single-node \nimages acquired in the first stage, where the output of the \nfirst stage, i.e., the lymph nodes, are further classified as \npositive or negative by applying the proposed DT-DSMIL \nmodel. The training and inference procedure is the same \nas for the entire slides, except that the input data is the \ncropped single lymph node images instead of the complete \nFig. 4  Diagram for the overall structure of the developed diagnostic \nsystem for single lymph node detection and classification, composed \nof data preprocessing, lymph node detection with a Faster R-CNN \nmodel, and classification of benign and malignant lymph nodes with a \nDT-DSMIL model\n1571Medical & Biological Engineering & Computing (2023) 61:1565–1580 \n1 3\nslides, and the image patching and feature extraction are \nconducted at the magnification of 20× for higher accuracy. \nTo make the diagnostic system more applicable in actual \nclinical use, the ResNet-50 patch feature aggregator is fur -\nther pretrained by the SimCLR framework with the data \nin the training set after loading the ImageNet-pretrained \nweights to help the model get more information about the \nreal-clinical data.\nWith the diagnostic system, not only the number of the \nlymph nodes within the slides but the benign and malig-\nnant of each lymph node can be obtained, which is con-\nsistent with the practice of clinically histopathological \ndiagnosis.\n2.6  Statistics\nThe performance of the proposed WSI classification model \nis measured by accuracy, area under the receiver oper -\nating characteristic curve (AUROC, or AUC), precision, \nrecall, and the F1 score. The 95% confidence intervals \nfor AUC values are calculated with DeLong’s method. In \nour DT-DSMIL model, the final binary classifier predicts \na probability score for each slide ranging from 0 to 1, \nwhich means the likelihood of the slide being positive, and \nthe discriminative threshold is calculated and set accord-\ning to the performance on the validation set. Probability \nscores higher than the above threshold are classified as \npositive, and scores lower than the threshold are classified \nas negative.\n3  Results\n3.1  Experimental settings\nTo evaluate the performance of our proposed DT-DSMIL \nmodel, experiments are conducted using the collected \nWSIs introduced in the Data Collection chapter. The WSIs \nare randomly split into training, validation, and testing \nsets with a ratio of 70:10:20, keeping the positive/negative \nclass distribution and regardless of the patient’s informa-\ntion, resulting in 590, 84, and 169 slides in each dataset. \nThe number of lymph nodes contained in the images in \neach dataset is 1598, 231, and 450, separately. After the \ndataset splitting phase, slides in the testing set are further \nverified, re-checked, and more detailed annotated with dots \non the diagnostic regions for each positive lymph node \nby two qualified pathologists blindly and independently. \nAs the testing set is treated separately and annotated in \nmore detail, and an additional manual analysis procedure \nis conducted on the testing set introduced below, the cross-\nvalidation method is not used.\nFirst, for the proposed DT-DSMIL model, the whole \nslide image classification task is performed: patch fea-\ntures are extracted for the entire slides, and the classifi-\ncation results for the whole of the slides are calculated. \nThe performance metrics are obtained with the trained \nmodel, and a comparison is conducted between the DT-\nDSMIL model and its predecessors to demonstrate its \neffectiveness.\nThen, for the proposed diagnostic system, the single \nlymph node detection and classification task is per -\nformed: the lymph nodes within the slides are detected \nfirst, and then, the classification result for each single \nlymph node is obtained in a similar way to the above. \nThe performance metrics for the LN detection conducted \nby a Faster R-CNN model and the LN classification con-\nducted by a proposed DT-DSMIL task are calculated \nand reported. Furthermore, more detailed performance \nanalyses are performed. Specifically, we compare the \nDT-DSMIL model performance concerning the follow -\ning aspects: performance with or without neoadjuvant \nchemotherapy; performance in different subtypes, includ-\ning adenocarcinoma, mucinous carcinoma, and signet ring \ncarcinoma; performance with different metastatic foci \nsizes. Moreover, the tumor morphologies relevant to the \nmodel’s decision-making are discovered with visualized \nprobability maps and attention maps. Finally, artificial \nexamination progress is conducted for the failure cases, \nespecially the false negative ones. In such progress, we \nfound out that our model is capable of localizing diag-\nnostic regions even though the final prediction made by \nthe model is false. Our model can help to reduce omitted \npositive nodes in manual annotations.\n3.2  Evaluation of the DT‑DSMIL model\nAs introduced above, the DSMIL model and its predecessors \n(the DSMIL and the DT-MIL model) are trained and evalu-\nated with the entire slides in the dataset, and performance \nmetrics, including AUC, accuracy, precision, recall, and F1 \nscore, are calculated. Results are shown in Table 1. The table \nshows that our proposed DT-DSMIL model outperforms its \npredecessors.\nTable 1  Performance of our proposed DT-DSMIL and its predeces-\nsors. The highest value in each metric is marked in bold\nModel AUC F1 Precision Recall Accuracy\nDSMIL 0.9369 87.27 79.29 97.04 86.98\nDTMIL 0.9743 93.58 89.35 98.22 91.24\nDT-DSMIL (ours) 0.9769 94.37 93.49 95.27 93.50\n1572 Medical & Biological Engineering & Computing (2023) 61:1565–1580\n1 3\n3.3  Evaluation of the diagnostic system\n3.3.1  Numerical metrics of lymph node detection \nand classification\nTo meet clinical requirements, a diagnostic system is devel-\noped to detect and further classify lymph nodes in the slides, \nand the system’s performance is evaluated on the testing \nset. The diagnostic system’s first stage, the Faster R-CNN \nmodel, is trained and evaluated with the entire slides. Its \naccuracy achieves 96.02%, obtained through manual analysis \nby experts of the test detection results. The trained Faster \nR-CNN model infers on the entire dataset, including the \ntraining, validation, and testing set. The obtained inference \nresults, single lymph node images, are taken as the input of \nthe diagnostic system’s second stage, which is a DT-DSMIL \nmodel. Detected lymph nodes are labeled as malignant or \nbenign depending on whether they contain tumor cells, and \nnon-lymph-node tissues misdetected as lymph nodes are \nlabeled as benign. Performance metrics, including AUC, \naccuracy, precision, recall, and F1 score for the second-stage \nDT-DSMIL model, are obtained by training and evaluating \nusing the single lymph node images. The model performs \nwell for metastatic foci in lymph nodes, with an AUC of \n0.9762 (95% confidence interval [CI]: 0.9607–0.9891) and \nan accuracy of 95.33%, and the ROC curve is shown in \nFig. 5. The precision of the single lymph node classification \nis 0.9411, the recall is 0.9231, and the F1 score is 0.9320.\n3.3.2  Model performance on cases \nwith or without neoadjuvant chemotherapy\nAmong the 450 lymph nodes in the test set, 44 are from \n32 patients with neoadjuvant chemotherapy (NACT). These \nlymph nodes produce a post-treatment response, such as \nmetastatic tumor shrinkage, mucin pools, fibrosis, or foamy \nhistiocytes, but the residual tumor can still be seen in all of \nthem. The ROC curves of our model on cases with or with-\nout NACT are shown in Fig.  6. The model performs well \nin both, with an AUC of 0.9814 (95% CI: 0.9660–0.9943) \nand 0.9741 (95% CI: 0.9546–0.9889), respectively. And \nthe accuracy of cases with or without NACT is 91.9% and \n93.2%.\n3.3.3  Model performance in different histologic subtypes\nThe positive lymph nodes in the test set are divided into \nthree groups, the adenocarcinoma, the mucinous carci-\nnoma, and the signet ring carcinoma, according to differ -\nent histological subtypes of the metastatic lesions, and the \nROC curves of each group are shown in Fig.  7. Our DT-\nDSMIL model performs well on the adenocarcinoma and the \nmucinous carcinoma group, with the AUC of 0.9835 (95% \nCI: 0.9717–0.9937) and 0.9872 (95% CI: 0.9732–0.9969) \nand the accuracy of 96.0% and 100%, respectively. In \ncontrast, the performance is relatively poor in the signet \nring carcinoma group, with an AUC of 0.9068 ((95% CI: \n0.8068–0.9787) and an accuracy of 60.0%. In addition, there \nare four lymph nodes with micropapillary adenocarcinoma, \nthree correctly identified, while the remaining one with a \nmaximum diameter of less than 0.2 mm is omitted.\n3.3.4  Model performance regarding metastatic foci size\nAccording to the CAP Cancer Reporting Protocols (Colon \nand Rectum, Resection, version 4.2.0.1) [33], isolated tumor \ncells (ITCs) are defined as single tumor cells or small clus-\nters of tumor cells measuring less than 0.2 mm. Metastatic \ndeposits with the size of 0.2–2.0 mm are called micro-metas-\ntasis, and deposits larger than 2.0 mm are called macro-\nmetastasis. The ROC curves of our model in identifying \nlesions of different sizes are shown in Fig.  8. Our model \nperforms well for micro-metastasis and macro-metastasis, \nwith the AUC of 0.9816 (95% CI: 0.9659–0.9935) and \n0.9902 (95% CI: 0.9787–0.9983) and the accuracy of 92.6% \nand 98.3%, respectively. In contrast, the performance is \nrelatively poor in ITCs, with an AUC of 0.8120 (95% CI: \n0.6930–0.9030) and an accuracy of 27.3%.\n3.4  Diagnostic morphology in lymph node \nclassification\nOur model is able to interpret its classification result with \nthe visualization heatmaps, including the patch-wise classi-\nfication probability maps and the attention maps. As shown \nin Fig. 9, the tumor morphologies related to the prediction \nare highlighted. Both maps are assessed by the pathologists, \nand we find out that the attention maps, which reveal the \nFig. 5  The ROC curve of our model in lymph node classification\n1573Medical & Biological Engineering & Computing (2023) 61:1565–1580 \n1 3\nconnection and the importance of each patch in the global-\nlevel feature extraction and decision-making, are more \nclosely associated with the location of the lesions and thus \nare more vital. In the attention maps, tumor cells are par -\nticularly distinguishable. In identifying adenocarcinoma, \nour model is more sensitive to glandular, cribriform, and \npapillary structures. Even in lymph nodes with ITCs, tumors \nwith typical glandular structures can be clearly identified \n(Fig.  9a–c). In identifying mucinous and signet ring car -\ncinoma, our model is relatively poor at identifying tumors \nFig. 6  The ROC curve of our model on cases with or without neoadjuvant chemotherapy\nFig. 7  The ROC curve of our model in different histologic subtypes\n1574 Medical & Biological Engineering & Computing (2023) 61:1565–1580\n1 3\nwith scattered or solid structures. Only if tumor cells form \na cord or papillary shape can be identified by our model \n(Fig.  9d–f). As for the probability maps, fibers are more \nevident than tumors, especially in lymph nodes after NACT \n(Fig. 9g–i). The poor performance of the probability maps \ngenerated by the local-level patch-wise classification might \nbe caused by the noisy supervision signals in the training \nscheme. Therefore, attention maps should be chosen as the \nsignificant visualization tool in our model.\n3.5  Error case analysis\nAmong the 450 single-lymph node images in the test set, \ntwelve are predicted to be false-negative, and nine are false-\npositive. Among the false-negative lymph nodes predicted, \neight are ITCs with adenocarcinoma and signet ring carci-\nnoma, two are micro-metastasis with signet ring carcinoma \nand micropapillary adenocarcinoma, and the remaining two \nare signet ring carcinoma macro-metastasis. Among the \nfalse-positive lymph nodes predicted, four delineated lymph \nnodes have tumor deposits outside, two are identified as the \nfibrous capsule of the lymph nodes by the pathologists, one \nis a deformed lymphocyte mass, and the last one is a lym-\nphatic sinus.\nIn our artificial failure case evaluation and verification \nprogress, we found that a positive lymph node with adeno-\ncarcinoma micro-metastasis is mislabeled as negative, and \nthe model is able to identify it correctly. The metastatic site \nof this lymph node has a typical glandular structure, but the \ntumor cells are slightly deformed due to the production.\n4  Discussion\nThe presence of metastasis in lymph nodes is a critical \nprognostic indicator for patients with CRC and an essential \ndeterminant of clinical decision-making [34]. To meet the \naccuracy requirement in the histopathologic diagnosis of \ntumors and reduce the increasing burden on the pathologist, \nthe application of machine learning, particularly deep learn-\ning, has been seen as a milestone for the healthcare sector in \nthe next decade [35].\nFig. 8  The ROC curve of our model regarding metastatic foci size\n1575Medical & Biological Engineering & Computing (2023) 61:1565–1580 \n1 3\nIn this paper, we propose a new MIL-based WSI diagnostic \nmodel, DT-DSMIL, for CRC lymph node metastasis classi-\nfication and develop a two-stage diagnostic system to distin-\nguish different single lymph nodes in the WSIs. Our model \nonly requires the positive/negative labels for entire slides or \nsingle lymph nodes while able to identify the critical and diag-\nnostic regions and thus substantially reduces the requirement \nof detailed annotations and reduces experts’ heavy burden of \ncareful patch-wise or even pixel-wise annotation compared with \nprevious computational histopathology diagnostic systems.\nOur model performs well in classification tasks on \nall tumor subtypes except for the identification of ITCs. \nAlthough previous works have proposed different algorithms \nwith different advantages, identifying ITCs in lymph nodes \nis still one of the most challenging points in developing \ncomputer-aided methods for identifying lymph node metas-\ntases. In the study of Chuang et al., their model’s perfor -\nmance of detecting ITCs in lymph nodes of CRC achieves \nan AUC of 0.7844 in a single-lymph-node-level test set \nwith five samples [36]. However, the predictive accuracy \nof micro-metastasis and macro-metastasis may be more \nclinically significant than that of ITCs. In clinical practice, \nITCs are recorded as N0, and the number of lymph nodes is \npresented separately in the pathology reports [37, 38]. The \nnodes indeed considered eroded by cancer are those eroded \nby micro-metastasis and macro-metastasis [39].\nThe misclassified positive lymph nodes, or the false \nnegatives, can be divided into two categories through \nartificial analysis of the incorrect predictions: small clus-\nters of adenocarcinoma metastasis without clear glan-\ndular structure and signet ring carcinoma metastasis. \nWhat they have in common is that they have no appar -\nent morphological features, which are not the charac-\nteristics of tumor cells but a feature of how the tumor \ncells cluster. Our model is more sensitive to glandular, \ncribriform, and papillary structures but not scattered or \ndiffuse distribution. This pattern has been found in other \nprevious studies as well. For example, in the study of \nHu et al., the false-negative rate in signet ring cells is \n6.67%, and in poorly differentiated adenocarcinoma is \n15.11% [40]. The sensitivity of our system to adenocarci-\nnoma structures is also reflected in tumor deposits [41]. \nIn the absence of lymph node metastasis, tumor depos-\nits are recorded as N1c. In our model, four of the nine \nFig. 9  Examples of visualiza-\ntion images for lymph node \nclassification task. In each \nrow, the first figure is a color-\nprocessed lymph node image \n(a, d, and g), the second (b, e, \nand h), and the third (c, f, and \ni) is an attention map and a \nprobability map corresponding \nto the lymph node image. a–c \nAn example of ITCs shows that \ntumors with typical glandular \nstructures could be identified. \nd–f An example of mucinous \ncarcinoma with signet ring \ncarcinoma shows that our model \nis poor at identifying tumors \nwith scattered or solid structures \nin the attention maps. g–i An \nexample of a post-treatment \nlymph node shows that fibers \nare more evident than tumors in \nthe probability maps\n\n1576 Medical & Biological Engineering & Computing (2023) 61:1565–1580\n1 3\nfalse-positive lymph nodes are due to the identification \nof tumor deposits.\nIn addition to classifying the lymph nodes, our model \ncan effectively identify tumor-related diagnostic compo-\nnents in the positive lymph nodes with the DSMIL atten-\ntion head. Two visualization maps, including the prob-\nability map generated by the patch-level classifier and the \nattention map generated by the global-level feature aggre-\ngator, are developed to explain the model’s predictions and \nto realize local-level patch predictions. And as previously \ndescribed, the attention maps are more informative and of \nhigher importance. However, from the visualization maps, \nwe can find out that the final predictions are determined \nby patches with metastasis and patches with fibrosis. The \nprobability map always highlights part of fibrosis in addi-\ntion to the tumor cells. This may explain why our model \nperforms better in cases with NACT than without NACT.\n5  Limitations and future work\nThough our proposed DT-DSMIL significantly outper -\nforms its predecessors in most performance metrics by a \nlarge margin, its recall deteriorates, and recall is a more \nconcerned score in pathological diagnosis. To compen-\nsate for this, we choose a higher magnification, 20× for \nthe single lymph node classification task, instead of the \nmagnification of 10× for the whole slide classification. \nHowever, the backbone of our DT-DSMIL model, the \ndeformable transformer, keeps the spatial dimensions \nin the input, which results in memory inefficiency, \nespecially when faced with sparse slides, and limits the \nchoice of maximum magnification. For example, in cases \nwhere multiple lymph nodes are placed on the same slide \nbut far apart, the blanks must be kept in the input feature \nmap. Thus, one possible direction is dealing with the \ninput slides’ sparsity.\nBesides, though our model only requires the binary \nlabels for the slides to accomplish slide-level classifica-\ntion, the bounding boxes and binary labels for each lymph \nnode are still needed in developing the diagnostic system \nfor detecting and classifying single lymph nodes. Having \nwitnessed the recent progress in weakly supervised object \ndetection in natural images, we believe it is possible to \naccomplish such single lymph node-level tasks with a total \nnumber of all lymph nodes and malignant lymph nodes \namong them. And recent progress in semi-supervised \nlearning and domain adaptive learning can help introduce \nmore data from different data sources to improve the mod-\nel’s performance [42]. Therefore, they are also the direc-\ntions of our follow-up research.\nFurthermore, it is acceptable in clinical practice to \nachieve nearly 100% accuracy and accurate localization \nperformance with a small number of detailed annotations, \nsuch as the dot annotations collected in our study but only \nused in the manual result analysis stage, not the model \ndevelopment. Thus, weakly supervised methods that can \nachieve higher performance with few annotations and \nmethods like human-in-the-loop and active learning mod-\nels that can progressively collect annotations for the most \ncritical and informative samples can be of great potential.\n6  Conclusion\nIn this paper, we first developed a weakly supervised WSI \nclassification model, DT-DSMIL, based on the transformer \nmodel and the multi-instance learning framework to iden-\ntify metastasis in CRC lymph nodes with merely slide-level \ndiagnostic labels instead of detailed annotations. Then, a \ndiagnostic system for detecting and further classifying each \nsingle lymph node in the slides is developed with a Faster \nR-CNN object detector and the proposed DT-DSMIL model. \nThough such coarse-grained annotations do not provide spa-\ntial information on the metastasis within lymph nodes, our \nmodel can still find the most diagnose-related components. \nThe proposed model and the developed system are able to \nsolve actual problems in clinical practice, and future work can \nbe done to improve performance further.\nAuthor contribution Z. Li and J. Li conceived and designed the experi-\nments. The experiments were conducted by L. Tan, H. Li, J. Yu, Z. \nNiu, and Z. Wang. J. Yu and H. Zhou contributed reagents/materials/\nanalysis tools. L. Tan and J. Yu analyzed the data. L. Tan, H. Li, and \nJ. Yu wrote the paper. Z. Li revised this paper. All authors contributed \nto the article and approved the submitted version.\nFunding This study was supported by the PKU-Baidu Fund (No.\nA002292), the Capital’s Funds for Health Improvement and Research \n(grant number 2022–2-1024), the Peking University Medicine Seed \nFund for Interdisciplinary Research (grant number BUM2020MX009), \nthe Capital’s Funds for Health Improvement and Research (grant \nnumber 2018–2-1022), the Beijing Municipal Science and Technol-\nogy Commission Capital Characteristic Clinical Application Research \n(grant number Z141107002514077), the National Natural Science \nFoundation of China (grant number 81872309), and the National Natu-\nral Science Foundation of China (grant number 61501039).\nData availability The datasets used and analyzed during the current \nstudy are available from the corresponding author upon reasonable \nrequest.\nDeclarations \nEthics approval All analyses of human data conducted in this study \nwere approved by the Ethics Committee of Peking University Cancer \nHospital. Written informed consent was obtained from all participants. \nThis study was performed under the Declaration of Helsinki.\nCompeting interests The authors declare no competing interests.\n1577Medical & Biological Engineering & Computing (2023) 61:1565–1580 \n1 3\nOpen Access This article is licensed under a Creative Commons Attri-\nbution 4.0 International License, which permits use, sharing, adapta-\ntion, distribution and reproduction in any medium or format, as long \nas you give appropriate credit to the original author(s) and the source, \nprovide a link to the Creative Commons licence, and indicate if changes \nwere made. The images or other third party material in this article are \nincluded in the article's Creative Commons licence, unless indicated \notherwise in a credit line to the material. If material is not included in \nthe article's Creative Commons licence and your intended use is not \npermitted by statutory regulation or exceeds the permitted use, you will \nneed to obtain permission directly from the copyright holder. To view a \ncopy of this licence, visit http:// creat iveco mmons. org/ licen ses/ by/4. 0/.\nReferences\n 1. Sung H, Ferlay J, Siegel RL, Laversanne M, Soerjomataram I, \nJemal A, Bray F (2021) Global Cancer Statistics 2020: GLO-\nBOCAN estimates of incidence and mortality worldwide for 36 \ncancers in 185 countries. CA Cancer J Clin 71(3):209–249\n 2. Arnold M, Sierra MS, Laversanne M, Soerjomataram I, Jemal \nA, Bray F (2017) Global patterns and trends in colorectal cancer \nincidence and mortality. Gut 66(4):683–691\n 3. Onitilo AA, Stankowski RV, Engel JM, Doi SA: Adequate lymph \nnode recovery improves survival in colorectal cancer patients. J \nSurg Oncol 2013, 107(8):828–834.\n 4. Saltz J, Gupta R, Hou L, Kurc T, Singh P, Nguyen V, Samaras D, \nShroyer KR, Zhao T, Batiste R et al (2018) Spatial organization \nand molecular correlation of tumor-infiltrating lymphocytes using \ndeep learning on pathology images. Cell Rep 23(1):181-193.e187\n 5. Skrede OJ, De Raedt S, Kleppe A, Hveem TS, Liestøl K, Maddi-\nson J, Askautrud HA, Pradhan M, Nesheim JA, Albregtsen F et al \n(2020) Deep learning for prediction of colorectal cancer outcome: \na discovery and validation study. Lancet 395(10221):350–360\n 6. Xu L, Walker B, Liang PI, Tong Y, Xu C, Su YC, Karsan A (2020) \nColorectal cancer detection based on deep learning. J Pathol \nInform 11:28\n 7. Kiehl L, Kuntz S, Höhn J, Jutzi T, Krieghoff-Henning E, Kather \nJN, Holland-Letz T, Kopp-Schneider A, Chang-Claude J, Brobeil \nA et al (2021) Deep learning can predict lymph node status directly \nfrom histology in colorectal cancer. Eur J Cancer 157:464–473\n 8. Yamashita R, Long J, Longacre T, Peng L, Berry G, Martin B, \nHiggins J, Rubin DL, Shen J (2021) Deep learning model for \nthe prediction of microsatellite instability in colorectal cancer: a \ndiagnostic study. Lancet Oncol 22(1):132–141\n 9. Srinidhi CL, Ciga O, Martel AL (2021) Deep neural network models for \ncomputational histopathology: a survey. Med Image Anal 67:101813\n 10. Mun Y, Paik I, Shin SJ, Kwak TY, Chang H (2021) Yet Another \nAutomated Gleason Grading System (YAAGGS) by weakly \nsupervised deep learning. NPJ Digit Med 4(1):99\n 11. Lerousseau M, Vakalopoulou M, Classe M, Adam J, Battis-\ntella E, Carré A, Estienne T, Henry T, Deutsch E, Paragios N: \nWeakly supervised multiple instance learning histopathological \ntumor segmentation. In: International Conference on Medical \nImage Computing and Computer-Assisted Intervention: 2020: \nSpringer; 2020: 470–479.\n 12. Cruz-Roa A, Basavanhally A, González F, Gilmore H, Feld -\nman M, Ganesan S, Shih N, Tomaszewski J, Madabhushi A: \nAutomatic detection of invasive ductal carcinoma in whole \nslide images with convolutional neural networks. In: Medical \nImaging 2014: Digital Pathology: 2014: SPIE; 2014: 904103.\n 13. Hou L, Samaras D, Kurc TM, Gao Y, Davis JE, Saltz JH: \nPatch-based convolutional neural network for whole slide \ntissue image classification. In: Proceedings of the IEEE \nconference on computer vision and pattern recognition: 2016; \n2016: 2424–2433.\n 14. Xu X, Hou R, Zhao W, Teng H, Sun J, Zhao J: A weak super -\nvision-based framework for automatic lung cancer classifica-\ntion on whole slide image. In: 2020 42nd Annual International \nConference of the IEEE Engineering in Medicine & Biology \nSociety (EMBC): 2020: IEEE; 2020: 1372–1375.\n 15. Zhang Z, Chen P, McGough M, Xing F, Wang C, Bui M, Xie Y, \nSapkota M, Cui L, Dhillon J (2019) Pathologist-level interpret-\nable whole-slide cancer diagnosis with deep learning. Nature \nMachine Intelligence 1(5):236–245\n 16. Ehteshami Bejnordi B, Mullooly M, Pfeiffer RM, Fan S, Vacek \nPM, Weaver DL, Herschorn S, Brinton LA, van Ginneken B, \nKarssemeijer N (2018) Using deep convolutional neural net -\nworks to identify and classify tumor-associated stroma in diag-\nnostic breast biopsies. Mod Pathol 31(10):1502–1512\n 17. Campanella G, Hanna MG, Geneslaw L, Miraflor A (2019) Wer-\nneck Krauss Silva V, Busam KJ, Brogi E, Reuter VE, Klimstra \nDS, Fuchs TJ: Clinical-grade computational pathology using \nweakly supervised deep learning on whole slide images. Nat \nMed 25(8):1301–1309\n 18. Xu B, Liu J, Hou X, Liu B, Garibaldi J, Ellis IO, Green A, Shen \nL, Qiu G: Look, investigate, and classify: a deep hybrid atten-\ntion method for breast cancer classification. In: 2019 IEEE 16th \ninternational symposium on biomedical imaging (ISBI 2019): \n2019: IEEE; 2019: 914–918.\n 19. Raju A, Yao J, Haq MM, Jonnagaddala J, Huang J: Graph atten-\ntion multi-instance learning for accurate colorectal cancer stag-\ning. In: International Conference on Medical Image Computing \nand Computer-Assisted Intervention: 2020: Springer; 2020: \n529–539.\n 20. Zhao Y, Yang F, Fang Y, Liu H, Zhou N, Zhang J, Sun J, Yang S, \nMenze B, Fan X: Predicting lymph node metastasis using histo-\npathological images based on multiple instance learning with deep \ngraph convolution. In: Proceedings of the IEEE/CVF Conference on \nComputer Vision and Pattern Recognition: 2020; 2020: 4837–4846.\n 21. Wang S, Zhu Y, Yu L, Chen H, Lin H, Wan X, Fan X, Heng \nP-A (2019) RMDL: Recalibrated multi-instance deep learning \nfor whole slide gastric image classification. Med Image Anal \n58:101549\n 22. Lu MY, Williamson DFK, Chen TY, Chen RJ, Barbieri M, Mahmood \nF (2021) Data-efficient and weakly supervised computational pathol-\nogy on whole-slide images. Nat Biomed Eng 5(6):555–570\n 23. Li H, Yang F, Zhao Y, Xing X, Zhang J, Gao M, Huang J, Wang L, \nYao J: DT-MIL: deformable transformer for multi-instance learn-\ning on histopathological image. In: International Conference on \nMedical Image Computing and Computer-Assisted Intervention: \n2021: Springer; 2021: 206–216.\n 24. Li B, Li Y, Eliceiri KW (2021) Dual-stream multiple instance \nlearning network for whole slide image classification with self-\nsupervised contrastive learning. Conf Comput Vis Pattern Rec-\nognit Workshops 2021:14318–14328\n 25. Lu MY, Williamson DF, Chen TY, Chen RJ, Barbieri M, \nMahmood F (2021) Data-efficient and weakly supervised com-\nputational pathology on whole-slide images. Nature biomedical \nengineering 5(6):555–570\n 26. Bilal M, Raza SEA, Azam A, Graham S, Ilyas M, Cree IA, Snead \nD, Minhas F, Rajpoot NM (2021) Development and validation of \na weakly supervised deep learning framework to predict the status \nof molecular pathways and key mutations in colorectal cancer \nfrom routine histology images: a retrospective study. Lancet Digit \nHealth 3(12):e763–e772\n 27. Xu B, Liu J, Hou X, Liu B, Garibaldi J, Ellis IO, Green A, Shen \nL, Qiu G (2020) Attention by selection: a deep selective attention \napproach to breast cancer classification. IEEE Trans Med Imaging \n39(6):1930–1941\n1578 Medical & Biological Engineering & Computing (2023) 61:1565–1580\n1 3\n 28. Rosati R, Romeo L, Silvestri S, Marcheggiani F, Tiano L, Frontoni \nE (2020) Faster R-CNN approach for detection and quantifica-\ntion of DNA damage in comet assay images. Comput Biol Med \n123:103912\n 29. Graham S, Chen H, Gamper J, Dou Q, Heng PA, Snead D, Tsang \nYW, Rajpoot N (2019) MILD-Net: minimal information loss \ndilated network for gland instance segmentation in colon histol-\nogy images. Med Image Anal 52:199–211\n 30. Qu H, Wu P, Huang Q, Yi J, Yan Z, Li K, Riedlinger GM, De \nS, Zhang S, Metaxas DN (2020) Weakly supervised deep nuclei \nsegmentation using partial points annotation in histopathology \nimages. IEEE Trans Med Imaging 39(11):3655–3666\n 31. Schmitz R, Madesta F, Nielsen M, Krause J, Steurer S, Wer -\nner R, Rösch T (2021) Multi-scale fully convolutional neural \nnetworks for histopathology image segmentation: from nuclear \naberrations to the global tissue architecture. Med Image Anal \n70:101996\n 32. Ho DJ, Yarlagadda DVK, D’ Alfonso TM, Hanna MG, Gra -\nbenstetter A, Ntiamoah P, Brogi E, Tan LK, Fuchs TJ (2021) \nDeep multi-magnification networks for multi-class breast \ncancer image segmentation. Comput Med Imaging Graph \n88:101866\n 33. Colloge of American Pathologists, [interne], Cancer Protocol \nTemplates (Colon and Rectum, Resection, version 4.2.0.1)\n 34. Dekker E, Tanis PJ, Vleugels JLA, Kasi PM, Wallace MB (2019) \nColorectal cancer. Lancet 394(10207):1467–1480\n 35. Acs B, Rantalainen M, Hartman J (2020) Artificial intelligence \nas the next step towards precision pathology. J Intern Med \n288(1):62–81\n 36. Chuang WY, Chen CC, Yu WH, Yeh CJ, Chang SH, Ueng \nSH, Wang TH, Hsueh C, Kuo CF, Yeh CY (2021) Identifica-\ntion of nodal micrometastasis in colorectal cancer using deep \nlearning on annotation-free whole-slide images. Mod Pathol \n34(10):1901–1911\n 37. Mescoli C, Albertoni L, Pucciarelli S, Giacomelli L, Russo \nVM, Fassan M, Nitti D, Rugge M (2012) Isolated tumor cells \nin regional lymph nodes as relapse predictors in stage I and II \ncolorectal cancer. J Clin Oncol 30(9):965–971\n 38. Sloothaak DA, Sahami S, van der Zaag-Loonen HJ, van der Zaag \nES, Tanis PJ, Bemelman WA, Buskens CJ (2014) The prognos-\ntic value of micrometastases and isolated tumour cells in histo-\nlogically negative lymph nodes of patients with colorectal can-\ncer: a systematic review and meta-analysis. Eur J Surg Oncol \n40(3):263–269\n 39. Jin M, Frankel WL (2018) Lymph node metastasis in colorectal \ncancer. Surg Oncol Clin N Am 27(2):401–412\n 40. Hu Y, Su F, Dong K, Wang X, Zhao X, Jiang Y, Li J, Ji J, Sun \nY (2021) Deep learning system for lymph node quantification \nand metastatic cancer identification from whole-slide pathology \nimages. Gastric Cancer 24(4):868–877\n 41. Amin MB ES, Greene FL, et al., eds. AJCC Cancer Staging Man-\nual. 8th ed. New York, , 2017. NS.\n 42. Yu J, Liu J, Wei X, Zhou H, Nakata Y, Gudovskiy D, Okuno T, Li \nJ, Keutzer K, Zhang S: MTTrans: Cross-domain object detection \nwith mean teacher transformer. In: 2022; Cham: Springer Nature \nSwitzerland; 2022: 629–645.\nPublisher's note Springer Nature remains neutral with regard to \njurisdictional claims in published maps and institutional affiliations.\nLuxin Tan  received a Bachelor \nof Medicine and graduated from \nSouthern Medical University. \nShe is now a postgraduate stu-\ndent majoring in clinical pathol-\nogy at Peking University Health \nScience Center under the super -\nvision of Associate Professor \nZhongwu Li. She is mainly \nfocusing on artificial intelligence \nin pathology images of colorec-\ntal cancer and prognostic study \nof immunotherapy in colorectal \ncancer. \n \nHuan Li  received a Master of \nClinical Pathology and graduated \nfrom Peking University, and she \nnow works in the Department of \nPathology of Tsinghua Chang \nGung Hospital in Beijing. During \nher undergraduate period, her \nmajor was clinical medicine, dur-\ning which she mastered basic \nmedical knowledge and profes-\nsional skills. During her studies \nin Peking University Cancer \nHospital, she mainly focused on \nclinical standardized training and \nscientific research training. Clini-\ncal work mainly focuses on gross \nspecimen examination, histopathological diagnosis, immunohistochem-\nistry result evaluation, and standardized writing reports. Scientific \nresearch training focuses on immunohistochemistry experiments, data \ninformation integration, and paper writing. Due to her excellent aca-\ndemic performance, she won the annual pathology scholarship and the \nexcellent poster of the Chinese Pathology Annual Conference. She is \nmainly focusing on the molecular genetics of rectal mucosal melanoma \nand has published a paper in BMC Cancer. With the continuous devel-\nopment of artificial intelligence in the medical field, digital pathology \nhas become more and more popular. She also explored the application \nof artificial intelligence in pathology images of colorectal cancer .\nJinze Yu  is currently working \ntoward the Ph.D. degree in Com-\nputer Science and Technology at \nBeihang University and received \nthe B.S. degrees in Computer \nScience and Technology, and \nBiomedical Engineering from \nBeihang University, Beijing, \nChina, in 2020. His research \ninterests include computer vision \nand medical image analysis .\n1579Medical & Biological Engineering & Computing (2023) 61:1565–1580 \n1 3\nHaoyi Zhou  received the B.S. in \nAircraft Design and Engineering \nfrom Beihang University, Bei-\njing, China, in 2013, and the \nPh.D. degree in Computer Sci-\nence and Technology from Bei-\nhang University, Beijing, China, \nin 2021. He is currently an \nAssistant Professor in Beihang \nUniversity, Beijing, China, with \nthe College of Software, and he \nhas interests in machine learning \nand data mining research .\nZhi Wang , born in September \n1987, graduated from Peking \nUnion Medical College, China, \nwith a medical doctor’s degree \nand studied oncology. He now \nworks as chief executive officer \nin Blot Info & Tech (Beijing) Co. \nLtd .\nZhiyong Niu , born in July 1987, \ngraduated from Tianjin Univer -\nsity, China, with a master’s \ndegree. He studies computer \nvision, medical image process-\ning, and deep learning. He now \nworks as a senior engineer in \nBlot Info & Tech (Beijing) Co. \nLtd. \nJianxin Li  is currently a Professor \nwith the State Key Laboratory of \nSoftware Development Environ-\nment and Beijing Advanced \nInnovation Center for Big Data \nand Brain Computing in Beihang \nUniversity. His current research \ninterests include social networks, \nmachine learning, big data, and \ntrustworthy computing. Dr. Li \nhas published research papers in \ntop-tier journals and confer -\nences, including the IEEE \nTPAMI, TKDE, TDSC, TC, \nACM TOIS, TKDD, NeurIPS, \nKDD, AAAI, and WWW. \nZhongwu Li  M.D, Ph.D., is an \nAssociate Professor of the \nDepartment of Pathology, Peking \nUniversity Cancer Hospital. In \n2006, he received a Ph.D. degree \nin oncology from Peking Univer-\nsity. From October 2015 to Octo-\nber 2016, he was a visiting \nscholar at the University of Cali-\nfornia, San Francisco (UCSF). \nHe has been engaged in patho-\nlogical diagnosis for 16 years and \nhas accumulated rich clinical \nexperience in gastrointestinal \ntumors, neuroendocrine tumors, \nmalignant melanoma, etc. He \nalso serves as a member of the digestive disease group of pathology of \nthe Chinese Medical Association, Director of the Youth Council of the \nBeijing Anti-Cancer Association, and Vice chairman of the CSCO mela-\nnoma professional youth committee. He participated in the preparation \nof consensus and guidelines related to gastrointestinal and pancreatic \nneuroendocrine tumors, colorectal cancer, and melanoma. His research \nwork mainly focuses on the pathology and molecular mechanism of \ngastrointestinal tumors and malignant melanoma. As the first author and \nthe corresponding author, he published more than 40 SCI articles on \nOncogene, BMC Cancer, Theranostics, and other famous Journals. \n1580 Medical & Biological Engineering & Computing (2023) 61:1565–1580\n1 3\nAuthors and Affiliations\nLuxin Tan1 · Huan Li1 · Jinze Yu2,3,4 · Haoyi Zhou2,5 · Zhi Wang6 · Zhiyong Niu6 · Jianxin Li2,3 · Zhongwu Li1 \n Luxin Tan \n tanluxin@foxmail.com\n Huan Li \n leehuan14@163.com\n Jinze Yu \n yujinze@buaa.edu.cn\n Haoyi Zhou \n zhouhy@act.buaa.edu.cn\n Zhi Wang \n zhiwang@blothealth.com\n1 Key Laboratory of Carcinogenesis and Translational \nResearch (Ministry of Education), Department of Pathology, \nPeking University Cancer Hospital & Institute, \nBeijing 100142, China\n2 Beijing Advanced Innovation Center for Big Data and Brain \nComputing, Beihang University, Beijing 100191, China\n3 School of Computer Science and Engineering, Beihang \nUniversity, Beijing 100191, China\n4 Shenyuan Honors College, Beihang University, \nBeijing 100191, China\n5 College of Software, Beihang University, Beijing 100191, \nChina\n6 Blot Info & Tech (Beijing) Co. Ltd, Beijing, China"
}