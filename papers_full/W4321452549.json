{
  "title": "Single-cell biological network inference using a heterogeneous graph transformer",
  "url": "https://openalex.org/W4321452549",
  "year": 2023,
  "authors": [
    {
      "id": "https://openalex.org/A2748277261",
      "name": "Anjun Ma",
      "affiliations": [
        "The Ohio State University Comprehensive Cancer Center – Arthur G. James Cancer Hospital and Richard J. Solove Research Institute",
        "The Ohio State University"
      ]
    },
    {
      "id": "https://openalex.org/A2099521366",
      "name": "Xiaoying Wang",
      "affiliations": [
        "Shandong University"
      ]
    },
    {
      "id": "https://openalex.org/A2102418880",
      "name": "Jingxian Li",
      "affiliations": [
        "Shandong University",
        "University of Missouri"
      ]
    },
    {
      "id": "https://openalex.org/A2793275989",
      "name": "Cankun Wang",
      "affiliations": [
        "The Ohio State University"
      ]
    },
    {
      "id": "https://openalex.org/A1983914940",
      "name": "Tong Xiao",
      "affiliations": [
        "The Ohio State University Comprehensive Cancer Center – Arthur G. James Cancer Hospital and Richard J. Solove Research Institute"
      ]
    },
    {
      "id": "https://openalex.org/A2105020221",
      "name": "Yuntao Liu",
      "affiliations": [
        "Shandong University"
      ]
    },
    {
      "id": "https://openalex.org/A2005151083",
      "name": "Cheng Hao",
      "affiliations": [
        "The Ohio State University"
      ]
    },
    {
      "id": "https://openalex.org/A2130970972",
      "name": "Juexin Wang",
      "affiliations": [
        "University of Missouri"
      ]
    },
    {
      "id": "https://openalex.org/A2079581369",
      "name": "Yang Li",
      "affiliations": [
        "The Ohio State University"
      ]
    },
    {
      "id": "https://openalex.org/A2333873106",
      "name": "Yuzhou Chang",
      "affiliations": [
        "The Ohio State University",
        "The Ohio State University Comprehensive Cancer Center – Arthur G. James Cancer Hospital and Richard J. Solove Research Institute"
      ]
    },
    {
      "id": "https://openalex.org/A2276986423",
      "name": "Jinpu Li",
      "affiliations": [
        "University of Missouri",
        "Shandong University"
      ]
    },
    {
      "id": "https://openalex.org/A2788354788",
      "name": "Duolin Wang",
      "affiliations": [
        "University of Missouri"
      ]
    },
    {
      "id": "https://openalex.org/A2580416962",
      "name": "Yuexu Jiang",
      "affiliations": [
        "University of Missouri"
      ]
    },
    {
      "id": "https://openalex.org/A2003401606",
      "name": "Li Su",
      "affiliations": [
        "University of Missouri"
      ]
    },
    {
      "id": "https://openalex.org/A2136095299",
      "name": "Gang Xin",
      "affiliations": [
        "The Ohio State University Comprehensive Cancer Center – Arthur G. James Cancer Hospital and Richard J. Solove Research Institute"
      ]
    },
    {
      "id": "https://openalex.org/A2202745608",
      "name": "Shaopeng Gu",
      "affiliations": [
        "The Ohio State University"
      ]
    },
    {
      "id": "https://openalex.org/A2306024828",
      "name": "Zihai Li",
      "affiliations": [
        "The Ohio State University Comprehensive Cancer Center – Arthur G. James Cancer Hospital and Richard J. Solove Research Institute"
      ]
    },
    {
      "id": "https://openalex.org/A2150410584",
      "name": "Bingqiang Liu",
      "affiliations": [
        "Shandong University"
      ]
    },
    {
      "id": "https://openalex.org/A2094446072",
      "name": "Dong Xu",
      "affiliations": [
        "University of Missouri"
      ]
    },
    {
      "id": "https://openalex.org/A2092676467",
      "name": "Qin Ma",
      "affiliations": [
        "The Ohio State University",
        "The Ohio State University Comprehensive Cancer Center – Arthur G. James Cancer Hospital and Richard J. Solove Research Institute"
      ]
    }
  ],
  "references": [
    "https://openalex.org/W2912390237",
    "https://openalex.org/W3013823153",
    "https://openalex.org/W3159800610",
    "https://openalex.org/W4241787340",
    "https://openalex.org/W3164692211",
    "https://openalex.org/W3027051073",
    "https://openalex.org/W2984472267",
    "https://openalex.org/W3129866267",
    "https://openalex.org/W3081980960",
    "https://openalex.org/W4212836561",
    "https://openalex.org/W3138479716",
    "https://openalex.org/W2911286998",
    "https://openalex.org/W2616922646",
    "https://openalex.org/W3027637917",
    "https://openalex.org/W2767452318",
    "https://openalex.org/W2052588711",
    "https://openalex.org/W2794480084",
    "https://openalex.org/W4225278475",
    "https://openalex.org/W2952382191",
    "https://openalex.org/W2147714160",
    "https://openalex.org/W2964315448",
    "https://openalex.org/W2782454362",
    "https://openalex.org/W3047725782",
    "https://openalex.org/W3132661792",
    "https://openalex.org/W4313373244",
    "https://openalex.org/W2128918628",
    "https://openalex.org/W2141826840",
    "https://openalex.org/W3111500257",
    "https://openalex.org/W2801787974",
    "https://openalex.org/W1839411228",
    "https://openalex.org/W2255625722",
    "https://openalex.org/W2892174427",
    "https://openalex.org/W2143034553",
    "https://openalex.org/W1967293175",
    "https://openalex.org/W2936189785",
    "https://openalex.org/W2263310282",
    "https://openalex.org/W2775770348",
    "https://openalex.org/W3005642547",
    "https://openalex.org/W2981320919",
    "https://openalex.org/W2098180441",
    "https://openalex.org/W2072319964",
    "https://openalex.org/W2059495814",
    "https://openalex.org/W1988587254",
    "https://openalex.org/W2794898956",
    "https://openalex.org/W2587454956",
    "https://openalex.org/W1999045579",
    "https://openalex.org/W3158161412",
    "https://openalex.org/W1991640996",
    "https://openalex.org/W2166022914",
    "https://openalex.org/W2896763394",
    "https://openalex.org/W2044987040",
    "https://openalex.org/W1514511317",
    "https://openalex.org/W2127436481",
    "https://openalex.org/W2030775773",
    "https://openalex.org/W2012938206",
    "https://openalex.org/W1485566685",
    "https://openalex.org/W2998577482",
    "https://openalex.org/W2581841075",
    "https://openalex.org/W3082334884",
    "https://openalex.org/W3139292272",
    "https://openalex.org/W2949637707",
    "https://openalex.org/W3044388039",
    "https://openalex.org/W2989628906",
    "https://openalex.org/W3106106305",
    "https://openalex.org/W2609417438",
    "https://openalex.org/W3028851061",
    "https://openalex.org/W2884299098",
    "https://openalex.org/W3037659634",
    "https://openalex.org/W2782224331",
    "https://openalex.org/W4243074797",
    "https://openalex.org/W3131634425",
    "https://openalex.org/W2965118801",
    "https://openalex.org/W3047141442",
    "https://openalex.org/W3175918402",
    "https://openalex.org/W6894082363",
    "https://openalex.org/W3212255565",
    "https://openalex.org/W2908485946",
    "https://openalex.org/W2889795168",
    "https://openalex.org/W4321452549",
    "https://openalex.org/W2943478641"
  ],
  "abstract": null,
  "full_text": "Article https://doi.org/10.1038/s41467-023-36559-0\nSingle-cell biological network inference\nusing a heterogeneous graph transformer\nAnjun Ma 1,2,7, Xiaoying Wang3,7, Jingxian Li3,C a n k u nW a n g1, Tong Xiao2,\nYuntao Liu3,H a oC h e n g1,J u e x i nW a n g4,5,Y a n gL i1, Yuzhou Chang1,2,J i n p uL i5,6,\nDuolin Wang 4,5,Y u e x uJ i a n g4,5,L iS u5,6,G a n gX i n2, Shaopeng Gu1,Z i h a iL i2,\nBingqiang Liu 3,8 , Dong Xu 4,5,6,8 &Q i nM a1,2,8\nSingle-cell multi-omics (scMulti-omics) allows the quantiﬁc a t i o no fm u l t i p l e\nmodalities simultaneously to capturethe intricacy of complex molecular\nmechanisms and cellular heterogeneity. Existing tools cannot effectively infer\nthe active biological networks in diverse cell types and the response of these\nnetworks to external stimuli. Here wepresent DeepMAPS for biological net-\nwork inference from scMulti-omics. It models scMulti-omics in a hetero-\ngeneous graph and learns relations among cells and genes within both local\nand global contexts in a robust manner using a multi-head graph transformer.\nBenchmarking results indicate DeepMAPS performs better than existing tools\nin cell clustering and biological network construction. It also showcases\ncompetitive capability in deriving cell-type-speciﬁc biological networks in lung\ntumor leukocyte CITE-seq data and matched diffuse small lymphocytic lym-\nphoma scRNA-seq and scATAC-seq data. In addition, we deploy a DeepMAPS\nwebserver equipped with multiple functionalities and visualizations to\nimprove the usability and reproducibility of scMulti-omics data analysis.\nSingle-cell sequencing, such as single-cell RNA sequencing\n(scRNA-seq) and single-cell ATAC sequencing (scATAC-seq),\nreshapes the investigation of cellular heterogeneity and yields\ninsights in neuroscience, cancer biology, immuno-oncology, and\ntherapeutic responsiveness\n1,2. However, an individual single-cell\nmodality only reﬂects a snapshot of genetic features and partially\ndepicts the peculiarity of cells, leading to characterization biases\nin complex biological systems\n2,3. Single-cell multi-omics (scMulti-\nomics) allows the quantiﬁcation of multiple modalities simulta-\nneously to fully capture the intricacy of complex molecular\nmechanisms and cellular heterogeneity. Such analyses advance\nvarious biological studies when paired with robust computational\nanalysis methods\n4.\nThe existing tools for integrative analyses of scMulti-omics data,\ne.g., Seurat5,M O F A +6,H a r m o n y7, and totalVI8, reliably predict cell\ntypes and states, remove batch effects, and reveal relationships or\nalignments among multiple modalities. However, most existing\nmethods do not explicitly consider the topological information shar-\ning among cells and modalities. Hence, they cannot effectively infer\nthe active biological networks of diverse cell types simultaneously with\ncell clustering and have limited power to elucidate the response of\nthese complex networks to external stimuli in speciﬁcc e l lt y p e s .\nRecently, graph neural networks (GNN) have shown strength in\nlearning low-dimensional representations of individual cells by pro-\npagating neighbor cell features and constructing cell-cell relations in a\nglobal cell graph\n9,10. For example, our in-house tool scGNN, a GNN\nReceived: 16 October 2022\nAccepted: 6 February 2023\nCheck for updates\n1Department of Biomedical Informatics, College of Medicine, The Ohio State University, Columbus, OH, USA.2Pelotonia Institute for Immuno-Oncology, The\nJames Comprehensive Cancer Center, The Ohio State University, Columbus, OH, USA.3School of Mathematics, Shandong University, Jinan, Shandong,\nChina.4Department of Electrical Engineering and Computer Science, University of Missouri, Columbia, MO, USA.5Christopher S. Bond Life Sciences Center,\nUniversity of Missouri, Columbia, MO, USA.6Institute for Data Science and Informatics, University of Missouri, Columbia, MO, USA.7These authors contributed\nequally: Anjun Ma, Xiaoying Wang.8These authors jointly supervised this work: Bingqiang Liu, Dong Xu, Qin Ma.e-mail: bingqiang@sdu.edu.cn;\nxudong@missouri.edu; qin.ma@osumc.edu\nNature Communications|          (2023) 14:964 1\n1234567890():,;\n1234567890():,;\nmodel, has demonstrated superior cell clustering and gene imputation\nperformance based on large-scale scRNA-seq data11.F u r t h e r m o r e ,a\nheterogeneous graph with different types of nodes and edges has been\nwidely used to model a multi-relational knowledge graph\n12.I tp r o v i d e s\na natural representation framework for integrating scMulti-omics data\nand learning the underlying cell-type-speciﬁc biological networks.\nMoreover, a recent development in the attention mechanism for\nmodeling and integrating heterogeneous relationships has made deep\nlearning models explainable and enabled the inference of cell-type-\nspeciﬁc biological networks\n12,13.\nIn this work, we developed DeepMAPS (Deep learning-based\nMulti-omics Analysis Platform for Single-cell data), a heterogeneous\ngraph transformer framework for cell-type-speciﬁc biological network\ninference from scMulti-omics data. This framework uses an advanced\nGNN model, i.e., heterogeneous graph transformer (HGT), which has\nthe following advantages: (i) It formulates an all-in-one heterogeneous\ngraph that includes cells and genes as nodes, and the relations among\nthem as edges. (ii) The model captures both neighbor and global\ntopological features among cells and genes to construct cell-cell rela-\ntions and gene-gene relations simultaneously\n9,14–16. (iii) The attention\nmechanism in this HGT model enables the estimation of the impor-\ntance of genes to speciﬁc cells, which can be used to discriminate gene\ncontributions and enhances biological interpretability. (iv) This model\nis hypothesis-free and does not rely on the constraints of gene co-\nexpressions, thus potentially inferring gene regulatory relations that\nother tools usually cannotﬁnd. It is noteworthy that DeepMAPS is\nimplemented into a code-free, interactive, and non-programmatic\ninterface, along with a Docker, to lessen the programming burden for\nscMulti-omics data.\nResults\nOverview of DeepMAPS\nOverall, DeepMAPS is an end-to-end and hypotheses-free framework\nto infer cell-type-speciﬁc biological networks from scMulti-omics data.\nThere areﬁve major steps in the DeepMAPS framework (Fig.1 and\nMethods). (i) Data are preprocessed by removing low-quality cells and\nlowly-expressed genes, and then different normalization methods are\napplied according to the speciﬁcd a t at y p e s .A ni n t e g r a t e dc e l l - g e n e\nmatrix is generated to represent the combined activity of each gene in\neach cell. Different data integration methods are applied for different\nscMulti-omics data types\n5–8. (ii) A heterogeneous graph is built from\nthe integrated matrix, including cells and genes as nodes and the\nexistence of genes in cells as edges. (iii) An HGT model is built to jointly\nlearn the low-dimensional embedding for cells and genes and generate\nan attention score to indicate the importance of a gene to a cell. (iv)\nCell clustering and functional gene modules are predicted based on\nHGT-learned embeddings and attention scores. (v) Diverse biological\nnetworks, e.g., gene regulatory networks (GRN) and gene association\nnetworks, are inferred in each cell type.\nTo learn joint representations of cells and genes, weﬁrst generate\na cell-gene matrix integrating the information of the input scMulti-\nomics data. A heterogeneous graph with cell nodes and gene nodes is\nthen constructed, wherein an unweighted cell-gene edge represents\nthe existence of gene activity of a gene in a cell, and the initial\nembedding of each node is learned from the gene-cell integrated\nmatrix via two-layer GNN graph autoencoders (Methods). Such a het-\nerogeneous graph offers an opportunity to clearly represent and\norganically integrate scMulti-omics data so that biologically mean-\ningful features can be learned synergistically. The entire hetero-\ngeneous graph is then sent to a graph autoencoder to learn the\nrelations between the cells and genes and update the embedding of\neach node. Here, DeepMAPS adopts a heterogeneous multi-head\nattention mechanism to model the overall topological information\n(global relationships) and neighbor message passing (local relation-\nships) on the heterogeneous graph. The heterogeneous graph\nrepresentation learning provides a way to enable the embedding of\ncells and genes simultaneously using the transformer in DeepMAPS.\nThe initial graph determines the path of message passing and how the\nattention scores can be calculated in DeepMAPS.\nIn each HGT layer, each node (either a cell or a gene) is considered\na target, and its 1-hop neighbors as sources. DeepMAPS evaluates the\nimportance of its neighbor nodes and the amount of information that\ncan be passed to the target based on the synergy of node embedding\n(i.e., attention scores). As a result, cells and genes with highly positive\ncorrelated embeddings are more likely to pass messages within each\nother, thus maximizing the similarity and disagreement of the\nembeddings. To make the unsupervised training process feasible on a\nlarge heterogeneous graph, DeepMAPS is performed on 50 subgraphs\nsampled from the heterogeneous graph, covering a minimum of 30%\nof cells and genes to train for the shared parameters between different\nnodes, information which is later used for testing of the whole graph.\nAs an important training outcome, an attention score is given to\nrepresent the importance of a gene to a cell. A high attention score for\na gene to a cell implies that the gene is relatively important for deﬁning\ncell identity and characterizing cell heterogeneity. This discrimination\nallows for the construction of reliable gene association networks in\neach cell cluster as theﬁnal output of DeepMAPS. We then build a\nSteiner Forest Problem (SFP) model\n17 to identify genes with higher\nattention scores and similar embedding features to a cell cluster. The\ngene-gene and gene-cell relations in the optimized solution of the SFP\nmodel mirror the embedding similarity of genes and the attention\nimportance of genes to each cell cluster. A gene association network\ncan be established by genes with the highest importance in char-\nacterizing the identity of that cell cluster based on their attention\nscores and embedding similarities, and these genes are considered to\nbe cell-type-active.\nDeepMAPS achieves superior performances in cell clustering\nand biological network inference from scMulti-omics data\nWe benchmarked the cell clustering performance of DeepMAPS on ten\nscMulti-omics datasets, including three multiple scRNA-seq datasets\n(R-bench-1, 2, and 3), three CITE-seq datasets (C-bench-1, 2, and 3), and\nfour matched scRNA-seq and scATAC-seq (scRNA-ATAC-seq) datasets\nmeasured from the same cell (A-bench-1, 2, 3, and 4) (Supplementary\nData 1). Speciﬁcally, the six R-bench and C-bench datasets have\nbenchmark annotations provided in their original manuscripts, while\nthe four A-bench datasets do not. These datasets cover the number of\ncells ranging from 3,009 to 32,029; an average read depth (consider-\ning scRNA-seq data only) ranging from 2,885 to 11,127; and a zero-\nexpression rate (considering scRNA-seq data only) from 82 to 96%\n(Supplementary Data 1).\nWe compared DeepMAPS with four benchmarking tools (Seurat\nv3 and v4\n5,18,M O F A+6, TotalVI8,H a r m o n y7,a n dG L U E19 (Methods)) in\nterms of the Average Silhouette Width (ASW), Calinski-Harabasz (CH),\nDavies-Bouldin Index (DBI), and Adjusted Rand Index (ARI) to evaluate\ncell clustering performance. For each dataset, we trained DeepMAPS\non 36 parameter combinations, including the number of heads,\nlearning rate, and the number of training epochs. To ensure fairness,\neach benchmarking tool was also tuned with different parameter\ncombinations (Methods). DeepMAPS achieves the best performance\ncomparing all benchmark tools in all test datasets in terms of ARI (for\nR-benches and C-benches) and ASW (for A-benches) (Fig.2a, Supple-\nmentary Figs. 1–3, and Source Data 1-3). We also noticed that Seurat\nwas the second-best performed tool, with small variances for different\nparameter selections in all benchmark datasets. We selected the\ndefault parameter per data type based on the performance of para-\nmeter combinations on the grid-search benchmarking. The parameter\ncombination with the highest median ARI/ASW scores averaged in all\nbenchmark datasets was considered as the default parameters for the\ncorresponding data type.\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 2\nAdditional benchmarking experiments were carried out to justify\nthe selection of different integration methods inDeepMAPS. Speciﬁ-\ncally, for the analysis of scRNA-ATAC-seq data, we designed an inte-\ngration method using gene velocity to balance the weight between gene\nexpressions and chromatin accessibilities in characterizing cell activities\nand states (Methods). This integration process can ensure harmonizing\ndatasets (especially for multiple scRNA-seq data) and generate an\nintegrated matrix (with genes as rows and cells as columns) as the input\nfor HGT. Our results showed that, for benchmark data 1 and 2 (A-bench-\n1a n d−2), the velocity-based approach showed signiﬁcantly (p-value\n<0.05) higher ASW scores than the weighted nearest neighbor (WNN)\napproach in Seurat v 4.0 on all grid-search parameter combinations\n(Supplementary Fig. 4 and Source Data 4). We reason that with the\ninclusion of velocity information, the modality weight between gene\nGene\nCell\nPreprocessing Data \nintegration\nNetwork \ninference\nInput ClusteringThe HGT \nframework\nCell\n1ytiladoM2ytiladoM\nLoss\nGraph autoencoder\nCell \nclusters\nBiological gene \nnetworks\nGenes\nCells\nEmbeddings\nEmbeddings\nWhole graph testing\nSubgraph model training\nEpoch 1\nSubgraph_1\nSubgraph_2\nSubgraph_50\nĂ\nEpoch 2\nSubgraph_1\nSubgraph_2\nSubgraph_50\nĂ\nEpoch 100\nSubgraph_1\nSubgraph_2\nSubgraph_50\nĂ\nĂĂ\na\nb\nc\ns2\ns1\nt\nMulti-head\nMessage passing Target aggregation\nH=3\nQuery\nKey\nValue \nprojection\nKey\nValue \nprojection\nW ATT\nW ATT\nW MSG\nW MSG\nNode \nsoftma\nx\nReLUAtt(s1, t)\nAtt(s2, t)\nMutual attention\nAn HGT layer\nGene\nCell\nPreprocessing Data \nintegration\nNetwork \ninference\nInput ClusteringThe HGT \nframework\nCell\n1ytiladoM2ytiladoM\nLoss\nGraph autoencoder\nCell \nclusters\nBiological gene \nnetworks\nGenes\nCells\nEmbeddings\nEmbeddings\nWhole graph testing\nSubgraph model training\nEpoch 1\nSubgraph_1\nSubgraph_2\nSubgraph_50\nĂ\nEpoch 2\nSubgraph_1\nSubgraph_2\nSubgraph_50\nĂ\nEpoch 100\nSubgraph_1\nSubgraph_2\nSubgraph_50\nĂ\nĂĂ\na\nb\nc\ns2\ns1\nt\nMulti-head\nMessage passing Target aggregation\nH=3\nQuery\nKey\nValue \nprojection\nKey\nValue \nprojection\nW ATT\nW ATT\nW MSG\nW MSG\nNode \nsoftma\nx\nReLUAtt(s1, t)\nAtt(s2, t)\nMutual attention\nAn HGT layer\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 3\nexpression and chromatin accessibility that contribute to recognize cell\ntypes are better balanced (Supplementary Fig. 5). The comparison of\nmodality weight of scATAC-seq in different cell clusters by using or\nwithout using the velocity-weighted balance method. In addition, we\ncompared different clustering methods (i.e., Leiden, Louvain, and SLM)\nin DeepMAPS and compared the impact of clustering resolutions (i.e.,\n0.4, 0.8, 1.2, and 1.6) to cell clustering results. We found no signiﬁcant\ndifferences among these clustering methods, and Louvain showed\nslightly better performance than the other two (Supplementary Fig. 6\nand Source Data 5). Lastly, DeepMAPS achieved higher scores than\nother tools when selecting the same clustering resolution. We also\nfound that, in most cases, higher resolution lower cell clustering pre-\ndiction scores; therefore, we selected resolution at 0.4 as the default\nparameter in DeepMAPS (Supplementary Fig. 7 and Source Data 6–8).\nFig. 1 | The workﬂow of DeepMAPS and HGT illustration. aThe overall frame-\nwork of DeepMAPS. Five main steps were included in carrying out cell clustering\nand biological gene network inference from the input scMulti-omics data.b The\ngraph autoencoder was inserted with a HGT model. The integrated cell-gene matrix\nwas used to build a heterogeneous graph include all cells (green) and genes (pur-\nple) as nodes. The HGT model is trained on multiple subgraphs (50 subgraphs as an\nexample) that cover nodes in the whole graph as many as possible. Each subgraph is\nused to train the model with 100 epochs; thus, the whole training process iterates\n5,000 times. The trained model is then applied to the whole graph to learn and\nupdate the embeddings of each node.c An illustration of embedding update\nprocess of the target node in a single HGT layer. The red circle in the upper panel\nindicates the target node and the black circle indicates the source nodes. Arrows\nrepresents for the connection between a target node and source nodes. Colored\nrectangles represent for embeddings of different nodes. The zoom in detailed\nprocess in the bottom panel shows the massage passing process and attention\nmechanism. Theﬁnal output of one HGT layer is an update of node embedding for\nall nodes. HGT heterogeneous graph transformer.\na\nASW\nARI\n0.6\n0\n0.2\n0.8\n1.0\n0.4\n0.6\n0\n0.2\n0.8\n1.0\n0.4\nR-test C-test A-test-1 A-test-2 A-test-3\nb\nd\nf\nDeepMAPS\nC-test\nC-test\nMOFA+\ne\nDeepMAPS\nPDX1\nPDX2\nK562\nHCT116\nHeLa\nA-test-1\nDeepMAPS\nPDX1\nPDX2\nK562\nHCT116\nHeLa\nA-test-1\nMOFA+\nPDX1\nPDX2\nK562\nHCT116\nHeLa\nA-test-1\nMOFA+\nPDX1\nPDX2\nK562\nHCT116\nHeLa\nA-test-1\nSeurat\nPDX1\nPDX2\nK562\nHCT116\nHeLa\nA-test-1\nSeurat\nPDX1\nPDX2\nK562\nHCT116\nHeLa\nA-test-1\nSeurat\nR-test\nSeurat\nR-test\nMesenchymal\nEndothelial\nLeukocyte\nUrothelium \nbasal\nBladder\nSeurat\nR-test\nMesenchymal\nEndothelial\nLeukocyte\nUrothelium \nbasal\nBladder\nMOFA+\nR-test\nMOFA+\nR-test\nMesenchymal\nEndothelial\nLeukocyte\nUrothelium \nbasal\nBladder\nMOFA+\nR-test\nMesenchymal\nEndothelial\nLeukocyte\nUrothelium \nbasal\nBladder\nDeepMAPS\nR-test\nDeepMAPS\nR-test\nUrothelium \nbasal\nBladder\nMesenchymal\nEndothelial\nLeukocyte\nDeepMAPS\nR-test\nUrothelium \nbasal\nBladder\nMesenchymal\nEndothelial\nLeukocyte\nSeurat\nC-test\nSeurat\nC-test\nTotalVI\nC-test\nTotalVI\nC-test\n0.5ASW\n0.3\n0.7\n0.9\nscRNA-ATAC-seq\nA-bench-1 A-bench-2 A-bench-3 A-bench-4\n0.2\n0.6\n0.5ARI\n0.3\n0.4\n0.7\n0.8\n0.9\nMultiple scRNA-seq CITE-seq\nR-bench-1 R-bench-2 R-bench-3 C-bench-1 C-bench-2 C-bench-3\nc\nDeepMAPS\nSeurat\nHarmony\nMOFA+\nTotalVI\nTools for \nbenchmarking the \nthree data types\n0.1\nGLUE\nARI\n0.8\n0.5\n0.6\n0.9\n1.0\n0.7\np=0.0079\np=0.15\nA-test-1\np=0.0022\np=0.0022\np=1.7e-05\n0.6\n0.4\n0.7\n0.8\n0.5 ARI\nC-test\nARI0.4\n0.2\n0.6\nR-test\np=1e-8\np=3e-7\nARI\n0.8\n0.5\n0.6\n0.9\n1.0\n0.7\np=0.0079\np=0.15\nA-test-1\np=0.0022\np=0.0022\np=1.7e-05\n0.6\n0.4\n0.7\n0.8\n0.5 ARI\nC-test\nARI0.4\n0.2\n0.6\nR-test\np=1e-8\np=3e-7\na\nASW\nARI\n0.6\n0\n0.2\n0.8\n1.0\n0.4\n0.6\n0\n0.2\n0.8\n1.0\n0.4\nR-test C-test A-test-1 A-test-2 A-test-3\nb\nd\nf\nDeepMAPS\nC-test\nC-test\nMOFA+\ne\nDeepMAPS\nPDX1\nPDX2\nK562\nHCT116\nHeLa\nA-test-1\nMOFA+\nPDX1\nPDX2\nK562\nHCT116\nHeLa\nA-test-1\nSeurat\nPDX1\nPDX2\nK562\nHCT116\nHeLa\nA-test-1\nSeurat\nR-test\nMesenchymal\nEndothelial\nLeukocyte\nUrothelium \nbasal\nBladder\nMOFA+\nR-test\nMesenchymal\nEndothelial\nLeukocyte\nUrothelium \nbasal\nBladder\nDeepMAPS\nR-test\nUrothelium \nbasal\nBladder\nMesenchymal\nEndothelial\nLeukocyte\nSeurat\nC-test\nTotalVI\nC-test\n0.5ASW\n0.3\n0.7\n0.9\nscRNA-ATAC-seq\nA-bench-1 A-bench-2 A-bench-3 A-bench-4\n0.2\n0.6\n0.5ARI\n0.3\n0.4\n0.7\n0.8\n0.9\nMultiple scRNA-seq CITE-seq\nR-bench-1 R-bench-2 R-bench-3 C-bench-1 C-bench-2 C-bench-3\nc\nDeepMAPS\nSeurat\nHarmony\nMOFA+\nTotalVI\nTools for \nbenchmarking the \nthree data types\n0.1\nGLUE\nARI\n0.8\n0.5\n0.6\n0.9\n1.0\n0.7\np=0.0079\np=0.15\nA-test-1\np=0.0022\np=0.0022\np=1.7e-05\n0.6\n0.4\n0.7\n0.8\n0.5 ARI\nC-test\nARI0.4\n0.2\n0.6\nR-test\np=1e-8\np=3e-7\nFig. 2 | Benchmarking of DeepMAPS in terms of cell clustering. aBenchmark cell\nclustering results of ten datasets in ARI for the three multiple scRNA-seq data and\nthe three CITE-seq data with benchmark labels, and ASW for the four scRNA-ATAC-\nseq data without benchmark labels. Each box showcases the minimum,ﬁrst quar-\ntile, median, third quartile, and maximum ARI or AWS results of a tool using dif-\nferent parameter settings (DeepMAPS:n = 96, Seurat:n = 16 for RNA-RNA and CITE-\nseq and 36 for RNA-ATAC, Harmony:n =3 6 ,M O F A+:n = 36, TotalVI:n = 48, and\nGLUE: n = 72). Dots represent outliers.b Results comparison onﬁve independent\ndatasets. No repeated experiment was conducted.c Robustness test of DeepMAPS\nusing the cell cluster leave-out method for the three independent test datasets with\nbenchmarking cell labels.p-values were calculated based on two-tail t.test. Each box\nshowcases the minimum,ﬁrst quartile, median, third quartile, and maximum ARI\nresults of a tool performed on different data subsets (R-test:n =5 ,C - t e s t :n =2 0 ,\nand A-test-1:n = 5). Dots represent outliers.d–f UMAP comparison of R-test, C-test,\nand A-test-1 datasets between DeepMAPS and other tools using the original cell\nlabels. Source data are provided as a Source Dataﬁle. ASW average Silhouette\nwidth, ARI adjusted rand index.\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 4\nWe further independently tested our default parameter selection\non ﬁve independent datasets, named R-test, C-test, A-test-1,−2, and−3,\nby comparing our results with the same benchmarking tools using\ntheir default parameters. For the three test datasets with benchmark-\ning cell labels, DeepMAPS performs the best in terms of ARI score,\nwhile for the two scRNA-ATAC-seq datasets without cell labels, the\nbenchmarking tools in the comparison achieve similar performance\n(Fig. 2b and Source Data 9). In order to evaluate the robustness of\nDeepMAPS, a leave-one-out test was performed on the three inde-\npendent test datasets with benchmark labels (Fig.2c and Source\nData 10). Weﬁrst removed all cells in a cell cluster based on benchmark\nlabels and then applied DeepMAPS and other tools on the remaining\ncells. For each dataset, the leave-one-out results of DeepMAPS were\nbetter than the other tools with higher ARI scores, indicating that the\nmessage passing and attention mechanism used in DeepMAPS main-\ntains cell-cell relations in a robust manner.\nThe cell clustering UMAP on the three independent datasets with\nbenchmarking labels showcased that the latent representations\nobtained in DeepMAPS can better preserve the heterogeneity of\nscRNA-seq data (Fig.2d–f). For the R-test dataset, all tools showed the\nability to separate mesenchymal, leukocyte, and endothelial cells, but\nfailed to separate urothelium basal cells and bladder cells. However,\ncells on the DeepMAPS UMAP are more compact, and the bladder cells\n(red dots) are grouped better than MOFA + and Seurat (Fig.2d). For the\nC-test dataset, cells in the same cluster are more ordered and compact\n(e.g., the B cell cluster and NK cell cluster), while cells from different\nclusters are more apart from each other on DeepMAPS UMAP (e.g.,\nCD8 cell clusters and CD4 cell clusters). (Fig.2e). For the A-test-1\ndataset, DeepMAPS was the only toolthat accurately separated each\ncell type. In contrast, Seurat and MOFA + mistakenly divided the PDX1\nor PDX2 population into two clusters and included more mis-\nmatches (Fig.2f).\nDeepMAPS can infer statistically signiﬁcant and biologically\nmeaningful gene association networks from scMulti-omics data\nWe evaluated the two kinds of biological networks that DeepMAPS can\ninfer, gene association network and GRN, in terms of centrality scores\nand functional enrichment. For the R-test dataset (Fig.3a) and C-test\ndataset (Fig.3b), we used two centrality scores, closeness centrality\n(CC) and eigenvector centrality (EC), that have been used in previous\na\nCC\n0\n0.3\n0.15\n0.6\nDeepMAPS IRIS3 All gene\np-value = 0.004\np-value = 0.004\np-value = 0.004\np-value = 0.004\nEC\n0\n0.2\n0.4\n0.6\n0.8\nDeepMAPS IRIS3 All gene\np-value =9.9e-04\np-value = 0.011\np-value =9.9e-04\np-value = 0.011\nb\nEC\n0\n0.2\n0.4\n0.6\n0.8\nDeepMAPS IRIS3 All gene\np-value = 3.9e-07\np-value = 0.124\np-value = 3.9e-07\np-value = 0.124\n hcirne ylno RSTC fo #\nmret lanoitcnuf eno\n80\n0\n40\n120\n160\n80\n0\n40\n120\n160\n80\n0\n40\n120\n160\nReactome DoRothEA TRRUST v2\nF1 score\n0.06\n0\n0.02\n0.08\n0.12\n0.1\n0\n0.05\n0.15\n0.2\n0.02\n0\n0.04\n0.08\nDeepMAPSDeepMAPS\nIRIS3\n(scRNA-seq)\nIRIS3\n(scRNA-seq)\nSCENIC\n(scRNA-seq) \nSCENIC\n(scRNA-seq) \nIRIS3 (GAS)IRIS3 (GAS)\nSCENIC (GAS) SCENIC (GAS) \nMAESTRO\n(scATAC-seq)\nMAESTRO\n(scATAC-seq)\nMAESTRO\n(scRNA-ATAC-seq) \nMAESTRO\n(scRNA-ATAC-seq) \nPrecision\nRecall\nc\nd\ne\nHigh\nLow\nScaled value\nHigh\nLow\nScaled value\nCC\n0\n0.05\n0.10\n0.15\n0.20\nDeepMAPS IRIS3 All gene\np-value = 1.7e-07\np-value =2.1e-05\np-value = 1.7e-07\np-value =2.1e-05\n0.45\n0.04\n0.10 0.06\n era taht sFT euqinu #\ndehcirne lanoitcnuf\n80\n0\n40\n120\n160\n100\n0\n50\n150\n200\n0\n80\n40\n120\n160\na\nCC\n0\n0.3\n0.15\n0.6\nDeepMAPS IRIS3 All gene\np-value = 0.004\np-value = 0.004\nEC\n0\n0.2\n0.4\n0.6\n0.8\nDeepMAPS IRIS3 All gene\np-value =9.9e-04\np-value = 0.011\nb\nEC\n0\n0.2\n0.4\n0.6\n0.8\nDeepMAPS IRIS3 All gene\np-value = 3.9e-07\np-value = 0.124\n hcirne ylno RSTC fo #\nmret lanoitcnuf eno\n80\n0\n40\n120\n160\n80\n0\n40\n120\n160\n80\n0\n40\n120\n160\nReactome DoRothEA TRRUST v2\nF1 score\n0.06\n0\n0.02\n0.08\n0.12\n0.1\n0\n0.05\n0.15\n0.2\n0.02\n0\n0.04\n0.08\nDeepMAPS\nIRIS3\n(scRNA-seq)\nSCENIC\n(scRNA-seq) \nIRIS3 (GAS)\nSCENIC (GAS) \nMAESTRO\n(scATAC-seq)\nMAESTRO\n(scRNA-ATAC-seq) \nPrecision\nRecall\nc\nd\ne\nHigh\nLow\nScaled value\nCC\n0\n0.05\n0.10\n0.15\n0.20\nDeepMAPS IRIS3 All gene\np-value = 1.7e-07\np-value =2.1e-05\n0.45\n0.04\n0.10 0.06\n era taht sFT euqinu #\ndehcirne lanoitcnuf\n80\n0\n40\n120\n160\n100\n0\n50\n150\n200\n0\n80\n40\n120\n160\nFig. 3 | Evaluation and comparison of gene association network inference of\nDeepMAPS. a, b Closeness centrality (CC) and eigenvector centrality (EC) were\nused to indicate the compactness and importance of genes to the network. We\ncompared our results with IRIS3 and a background network using all genes for the\nR-test dataset (n =5 )a and C-test dataset (n =1 4 )b. p-values were calculated using a\ntwo-tail t-test.c Comparison of the number of unique TFs in GRNs that showed\nsigniﬁcantly enriched biological functions in three public databases. Each box\ncontains the results of six scRNA-ATAC-seq datasets (n =6 ) .d Comparison of the\nnumber of cell-type-speciﬁc regulons in GRNs signiﬁcantly enriched in only one\nbiological function/pathway in the three public databases (n =6 ) .e The F1 score\ncomparisons of regulons enriched to only one function/pathway using three\ndatabases (n = 6). The mean value of precision and recall scores of the selected six\nscRNA-ATAC-seq datasets were max-min scaled and shown in the heatmap with\ndarker blue indicating high values and lighter blue indicating low values. Source\ndata are provided as a Source Dataﬁle. Each box in Fig.3 showcases the minimum,\nﬁrst quartile, median, third quartile, and maximum score of the corresponding\ncriteria. CC closeness centrality, EC eigenvector centrality, CTSR cell-type-speciﬁc\nregulon.\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 5\nsingle-cell gene association network evaluations20,t oc o m p a r et h e\nidentiﬁed gene association networks from all the tools in this com-\nparison. CC reﬂects the average connectivity of a node to all others in a\nnetwork, and EC reﬂects the importance of a node based on its con-\nnected nodes. Both CC and EC can interpret node’si nﬂuence in iden-\ntifying genes that may play more critical roles in the network. A gene\nassociation network with higher node centrality indicates that the\ndetected genes are more likely to be involved in critical and functional\nbiological systems. We also constructed gene co-expression networks\nas a background using all genes in a dataset by calculating Pearson’s\ncorrelation coefﬁcients of gene expression in a cell cluster.p-value =\n0.05 was set as the edge cutoff. We compared cell-type-active gene\nassociation networks generated in DeepMAPS with those generated in\nIRIS3\n15 and the background co-expression networks. The average CC\nand EC of networks constructed by DeepMAPS in R-test and C-test\ndatasets showed signiﬁcantly higher scores than IRIS3 and the back-\nground co-expression networks (Source Data 11). We reason that the\ngene association network generated in DeepMAPS is not only co-\nexpressed but also of great attention impact on cells; thus, genes in the\nnetwork tend to be more important to the cell type.\nTo evaluate whether DeepMAPS can identify biologically mean-\ningful GRNs in speciﬁc cell types, we performed enrichment tests on\nbasic gene regulatory modules (i.e., regulons\n14), with three public\nfunctional databases, Reactome21, DoRothEA22, and TRRUST v223.T o\navoid any bias in comparison, we compared cell-type-speciﬁcG R N s\ninferred from DeepMAPS with (i) IRIS3 and SCENIC14 on the scRNA-seq\nmatrix, (ii) IRIS3 and SCENIC on a gene-cell matrix recording the gene\nactivity scores (GAS) calculated in DeepMAPS based on the velocity-\nbased integration method, (iii) MAESTRO\n24 on scATAC-seq matrix, and\n(iv) MAESTRO on original scRNA-seq and scATAC-seq matrix. The six\ndatasets collected from human tissue were used (i.e., A-test-1, A-bench-\n2, A-bench-3, A-bench-4, A-test-1, A-test-2). Weﬁrst showcased that the\nGRNs identiﬁed in DeepMAPS included more unique transcription\nfactor (TF) regulations than the other tools, except for the enrichment\nto the DoRothEA database (Fig.3c and Source Data 12). We considered\nthat a highly cell-type-speciﬁc regulon (CTSR) might represent only\none signiﬁcant enriched functionality; alternatively, a generic regulon\nmight improperly contain genes involved in several pathways.\nTherefore, we compared the number of CTSRs enriched to one func-\ntion/pathway across different tools. DeepMAPS outperformed\n(p-value<0.05) other tools on most of the six scRNA-ATAC-seq datasets\nin terms of the number of regulons that enrich only one function/\npathway and the enrichment F1 scores (Fig.3d, e and Source Data 12).\nFor the F1 score of the enrichment test to the TRRUST v2 database,\nDeepMAPS (median F1 score is 0.026) was slightly lower than IRIS3\nusing the GAS matrix (median F1 score is 0.031). We also noticed that\nall tools did not achieve good enrichments in the TRRUST v2 database\nmainly due to the small number of genes (on average, 10 genes are\nregulated by one TF; 795 TFs in total). SCENIC also showed competitive\nscaled precision scores (scaled mean: 0.47 for Reactome, 0.66 for\nDoRothEA, and 0.61 for TRRUST v2), while achieving lower scaled\nrecall scores, making the F1 scores smaller than DeepMAPS for most\ndatasets. IRIS3 and SCENIC performed on the GAS matrix showed\nbetter enrichment results than using scRNA-seq data only, indicating\nthat integrating information from scRNA-ATAC-seq data is more useful\nfor GRN inference than using scRNA-seq data alone.\nDeepMAPS accurately identiﬁes cell types and infers cell-cell\ncommunication in PBMC and lung tumor immune CITE-seq data\nWe present a case study that applies DeepMAPS to a published mixed\nperipheral blood mononuclear cells (PBMC) and lung tumor leuko-\ncytes CITE-seq dataset (10× Genomics online resource, Supplementary\nData 1) to demonstrate capacity in modeling scMulti-omics in char-\nacterizing cell identities. The dat a s e ti n c l u d e sR N A sa n dp r o t e i n s\nmeasured on 3485 cells. DeepMAPS identi ﬁed 13 cell clusters,\nincluding four CD4\n+ T cell groups (naive, central memory (CM), tissue-\nresident memory (TRM), and regulatory (Treg)), two CD8+ Tc e l l\ngroups (CM and TRM), a natural killer cell group, a memory B cell\ngroup, a plasma cell group, two monocyte groups, one tumor-\nassociated macrophage (TAM) group, and a dendritic cell (DC)\ngroup. We annotated each cluster by visualizing the expression levels\nof curated maker genes and proteins (Fig.4a, b and Supplementary\nData 2). Compared to cell types identiﬁed using only proteins or RNA,\nwe isolated or accurately annotated cell populations that could not be\ncharacterized using the individual modality analysis. For example, the\nDC cluster was only successfully identiﬁed using the integrated protein\nand RNA. By combining signals captured from both RNA and proteins,\nDeepMAPS successfully identiﬁed biologically reasonable and mean-\ningful cell types in the CITE-seq data.\nWe then compared the modality correlation between the two cell\ntypes. We used the top differentially expressed genes and proteins\nbetween memory B cells and plasma cells, and performed hierarchical\nclustering of the correlation matrix. The result clearly stratiﬁed these\nfeatures into two anticorrelated modules: one associated with memory\nB cells and the other with plasma cells (Fig.4c). Furthermore, we found\nthat the features in the two modules signiﬁcantly correlated with the\naxis of maturation captured by our HGT embeddings (Supplementary\nFig. 8 and Supplementary Data 3). For example, one HGT embedding\n(the 51\nst) showed distinctive differences between plasma cells and\nmemory B cells (Fig.4d, e). Similarﬁndings were also observed when\ncomparing EM CD8+ Tc e l l sw i t hT R MC D 8+ T cells (Fig.4f). Never-\ntheless, it is possible to identify a representative HGT embedding (56th)\nthat maintains embedding signals for a deﬁned separation of the two\ngroups (Fig.4g, h). These results point to any two cell clusters con-\nsisting of coordinated activation and repression of multiple genes and\nproteins, leading to a gradual transition in cell state that can be cap-\ntured by a speciﬁc dimension of the DeepMAPS latent HGT space. On\nthe other hand, we generated the gene-associated networks with genes\nshowing high attention scores for EM CD8\n+ T cells, TRM CD8+ Tc e l l s ,\nmemory B cells, and plasma cells and observed diverse patterns\n(Supplementary Fig. 9).\nBased on the cell types and raw data of gene and protein\nexpressions, we inferred cell–cell communications and constructed\ncommunication networks among different cell types within multiple\nsignaling pathways using CellChat\n25 (Fig.4i). For example, we observed\na CD6-ALCAM signaling pathway existing between DC (source) and\nTRM CD4\n+ T cells (target) in the lung cancer tumor microenvironment\n(TME). Previous studies have shown that ALCAM on antigen-\npresenting DCs interacts with CD6 on the T cell surface and con-\ntributes to T cell activation and proliferation\n26–28. As another example,\nwe identiﬁed the involvement of the NECTIN-TIGIT signaling pathway\nduring the interaction between the TAM (source) and TRM CD8+ Tc e l l s\n(target), which is supported by a previous report that NECTIN (CD155)\nexpressed on TAM could be immunosuppressive when interacting\nwith surface receptors, TIGIT, on CD8+ T cells in the lung cancer\nTME29,30.\nDeepMAPS identiﬁes speciﬁcG R N si nd i f f u s es m a l ll y m p h o c y t i c\nlymphoma scRNA-seq and scATAC-seq data\nTo further extend the power of DeepMAPS to GRN inference, we used\na single-cell Multiome ATAC + Gene expression dataset available on\nthe 10× Genomics website (10× Genomics online resource). The raw\ndata is derived from 14,566 cells of ﬂash-frozen intra-abdominal\nlymph node tumor from a patient diagnosed with diffuse small\nlymphocytic lymphoma (DSLL) of the lymph node lymph. We inte-\ngrate gene expression and chromatin accessibility by balancing the\nweight of each modality of a gene in a cell based on RNA velocity\n(Fig. 5a and Method). To build TF-gene linkages, we considered gene\nexpression, gene accessibility, TF-motif binding afﬁnity, peak-to-\ngene distance, and TF-coding gene expression. Genes found to be\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 6\nregulated by the same TF in a cell cluster are grouped as a regulon.\nWe considered regulons with higher centrality scores to have more\nsigniﬁcant inﬂuences on the characterization of the cell cluster.\nRegulons regulated by the same TF across different cell clusters are\ncompared for differential regulon activities. Those with signiﬁcantly\nhigher regulon activity scores (RAS) are considered as the cell-type-\nspeciﬁc regulons in the cell cluster.\nDeepMAPS identiﬁed 11 cell clusters in the DSLL data. All clusters\nwere manually annotated based on curated gene markers (Fig.5ba n d\nSupplementary Data 4). Two DSLL-like cell clusters (DSLL state-1 and\na\nb\ni Resource Target\nNECTIN-TIGIT signaling pathway\nCD6-ALCAM signaling pathway\nd\nUMAP 1\nUMAP 2\nUMAP 1\nUMAP 2\nUMAP 1\nUMAP 2\nUMAP 1\nUMAP 2\ng\nc\nf\nPlasma vs Memory B\nEM CD8+ T vs TRM CD8+ \nT\nSpearman \ncorrelation\n1.0\n-1.0\n0\nSpearman \ncorrelation\n1.0\n-1.0\n0\nSpearman \ncorrelation\n1.0\n-1.0\n0\nHGT \nembedding\n0.10\n0\n0.05\nHGT \nembedding\n0.10\n0\n0.05\nHGT \nembedding\n0.04\n-0.02\n0.02\nHGT \nembedding\n0.04\n-0.02\n0.02\nCM CD8+ T\nTRM CD8+ T\nPlasma\nMemory B\nCM CD8+ T\nTRM CD8+ T\nPlasma\nMemory B\nHGT embedding\nGene expressions\nHGT embedding\n0.00 0.05 0.10\n0.060.040.020.00-0.02\n-2 - 1 01 2 -2 -1 0 1 2\nGene expressions\nPlasma\nMemory B\nNK\nTAM\nDC\nMonocytes 1&2\nNormalized protein \nabundance\n4-2 0 4-2 0Normalized protein \nabundance\n4-2 0 Normalized RNA \nexpression\n4-2 0\n+ T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocytes 1\nPlasma\nMemory B\nNK\nTreg\nTAM\nDC\nMonocytes 2\nProtein Gene\nCD3E\nCD4\nCD8A\nCCR7\nCD69\nIL7R\nFOXP3\nITGAE\nIL2RA\nNCAM1\nGNLY\nNKG7\nCD19\nMS4A1\nIGHD\nCD38\nIGHM\nCD27\nTNFRSF17\nIRF4\nXBP1\nITGAM\nCD14\nFCGR1A\nCD68\nFCGR3A\nCCR2\nCD163\nMARCO\nCSF1R\nITGAX\nCD1A\nCD1C\nCD80\nCD86\nCLEC9A\nTCRab\nCD3\nCD4\nCD62L\nCD127\nCD8\nCD69\nCD45RO\nCD103\nCD25\nCD56\nCD24\nCD19\nCD31\nHLA-DR\nCD11b\nCD14\nCD274\nCD1a\nCD1c\nCD80\nProtein cell clustering\nNaïve CD4 + T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocyte-1\nPlasma-1\nMemory B \ncells\nNK\nUnknown-2\nTreg-1\nMonocyte-3\nUnknown-1\nPlasma-2\nUMAP 1\nUMAP 2\nNaïve CD4 + T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocyte-1\nPlasma-1\nMemory B \ncells\nNK\nUnknown-2\nTreg-1\nMonocyte-3\nUnknown-1\nPlasma-2\nUMAP 1\nUMAP 2\nMonocyte-2\nProtein cell clustering\nNaïve CD4 + T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocyte-1\nPlasma-1\nMemory B \ncells\nNK\nUnknown-2\nTreg-1\nMonocyte-3\nUnknown-1\nPlasma-2\nUMAP 1\nUMAP 2\nMonocyte-2\nRNA cell clustering\nNaïve CD4 + T\nMemory \nCD4+ T\nTRM CD8+ T\nTAM\nPlasma\nMemory B \ncells\nNK\nMonocyte-1\nMonocyte-2\nUMAP 1\nUMAP 2\nNaïve CD4 + T\nMemory \nCD4+ T\nTRM CD8+ T\nTAM\nPlasma\nMemory B \ncells\nNK\nMonocyte-1\nMonocyte-2\nUMAP 1\nUMAP 2\nRNA cell clustering\nNaïve CD4 + T\nMemory \nCD4+ T\nTRM CD8+ T\nTAM\nPlasma\nMemory B \ncells\nNK\nMonocyte-1\nMonocyte-2\nUMAP 1\nUMAP 2\nIntegrated cell clustering\nNaïve CD4 + T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocyte-2\nPlasma\nMemory B \ncells\nNK\nTreg\nTAM\nDC\nMonocyte-1\nUMAP 1\nUMAP 2\nNaïve CD4 + T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocyte-2\nPlasma\nMemory B \ncells\nNK\nTreg\nTAM\nDC\nMonocyte-1\nUMAP 1\nUMAP 2\nIntegrated cell clustering\nNaïve CD4 + T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocyte-2\nPlasma\nMemory B \ncells\nNK\nTreg\nTAM\nDC\nMonocyte-1\nUMAP 1\nUMAP 2\ne\nHGT embedding 56 HGT embedding 56HGT embedding 56 HGT embedding 56\nHGT embedding 51 HGT embedding 51HGT embedding 51 HGT embedding 51\nh\n0.00\n2CD83\nHLA-DRA\nHLA-DRB1\nCD141\nEpCAM\n2\nCD45RA\nTRM CD8+ T\nCM CD8+ T\nTreg\nTRM CD4+ T\nCM CD4+ T\nNaïve CD4 + T\nNumber of cells\nTreg-2\na\nb\ni Resource Target\nNECTIN-TIGIT signaling pathway\nCD6-ALCAM signaling pathway\nd\nUMAP 1\nUMAP 2\nUMAP 1\nUMAP 2\ng\nc\nf\nPlasma vs Memory B\nEM CD8+ T vs TRM CD8+ \nT\nSpearman \ncorrelation\n1.0\n-1.0\n0\nSpearman \ncorrelation\n1.0\n-1.0\n0\nHGT \nembedding\n0.10\n0\n0.05\nHGT \nembedding\n0.04\n-0.02\n0.02\nCM CD8+ T\nTRM CD8+ T\nPlasma\nMemory B\nCM CD8+ T\nTRM CD8+ T\nPlasma\nMemory B\nHGT embedding\nGene expressions\nHGT embedding\n0.00 0.05 0.10\n0.060.040.020.00-0.02\n-2 - 1 01 2 -2 -1 0 1 2\nGene expressions\nPlasma\nMemory B\nNK\nTAM\nDC\nMonocytes 1&2\nNormalized protein \nabundance\n4-2 0 Normalized RNA \nexpression\n4-2 0\n T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocytes 1\nPlasma\nMemory B\nNK\nTreg\nTAM\nDC\nMonocytes 2\nProtein Gene\nCD3E\nCD4\nCD8A\nCCR7\nCD69\nIL7R\nFOXP3\nITGAE\nIL2RA\nNCAM1\nGNLY\nNKG7\nCD19\nMS4A1\nIGHD\nCD38\nIGHM\nCD27\nTNFRSF17\nIRF4\nXBP1\nITGAM\nCD14\nFCGR1A\nCD68\nFCGR3A\nCCR2\nCD163\nMARCO\nCSF1R\nITGAX\nCD1A\nCD1C\nCD80\nCD86\nCLEC9A\nTCRab\nCD3\nCD4\nCD62L\nCD127\nCD8\nCD69\nCD45RO\nCD103\nCD25\nCD56\nCD24\nCD19\nCD31\nHLA-DR\nCD11b\nCD14\nCD274\nCD1a\nCD1c\nCD80\nProtein cell clustering\nNaïve CD4 + T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocyte-1\nPlasma-1\nMemory B \ncells\nNK\nUnknown-2\nTreg-1\nMonocyte-3\nUnknown-1\nPlasma-2\nUMAP 1\nUMAP 2\nMonocyte-2\nRNA cell clustering\nNaïve CD4 + T\nMemory \nCD4+ T\nTRM CD8+ T\nTAM\nPlasma\nMemory B \ncells\nNK\nMonocyte-1\nMonocyte-2\nUMAP 1\nUMAP 2\nIntegrated cell clustering\nNaïve CD4 + T\nCM CD4+ T\nTRM CD4+ T\nCM CD8+ T\nTRM CD8+ T\nMonocyte-2\nPlasma\nMemory B \ncells\nNK\nTreg\nTAM\nDC\nMonocyte-1\nUMAP 1\nUMAP 2\ne\nHGT embedding 56 HGT embedding 56\nHGT embedding 51 HGT embedding 51\nh\n0.00\n2CD83\nHLA-DRA\nHLA-DRB1\nCD141\nEpCAM\n2\nCD45RA\nTRM CD8+ T\nCM CD8+ T\nTreg\nTRM CD4+ T\nCM CD4+ T\nNaïve CD4 + T\nNumber of cells\nTreg-2\nNaïve CD4\nFig. 4 | DeepMAPS identiﬁcation of heterogeneity in CITE-seq data of PBMC and\nlung tumor leukocytes. aUMAPs for DeepMAPS cell clustering results from\nintegrated RNA and protein data, protein data only, and RNA data only. Cell clusters\nwere annotated based on curated marker proteins and genes.b Heatmap of cura-\nted marker proteins and genes that determine the cell clustering and annotation.\nc Heatmap of the Spearman correlation comparison of top differentially expressed\ngenes and proteins in plasma cells and memory B cells.d UMAP is colored by the 51\nst\nembedding, indicating distinct embedding representations in plasma cells and\nmemory B cells.e Expression of top differentially expressed genes and proteins inc\nas a function of the 51st embedding to observe the pattern relations between plasma\ncells and memory B cells. Each line represents a gene/protein, colored by cell types.\nFor each gene, a line was drawn using a loess smoothing function based on the\ncorresponding embedding and scaled gene expression in a cell.f–h Similar visua-\nlization was conducted for the 56th embedding to compare EM CD8+ T cells and\nTRM CD8+ T cellsc–e. i Two signaling pathways, NECTIN and ALCAM, are shown to\nindicate the predicted cell–cell communications between two cell clusters. A link\nbetween aﬁlled circle (resource cluster with highly expressed ligand coding genes)\nand an unﬁlled circle (target cluster with highly expressed receptor coding genes)\nindicates the potential cell-cell communication of a signaling pathway. Circle colors\nrepresent different cell clusters, and the size represents the number of cells. The\ntwo monocyte groups were merged. TRM tissue-resident memory, CM central\nmemory, TAM tumor-associated macrophage, HGT heterogeneous graph\ntransformer.\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 7\nstate-2) were observed. The RNA velocity-based pseudotime analysis\nperformed on the three B cell clusters (normal B cell and two DSLL\nstates) assumed that the two DSLL states were derived from normal B\ncells, and state-1 was derived earlier than state-2, although the two\nstates seemed to be partially mixed (Fig.\n5c). We further selected the\ntop 20 TFs with the highest regulon centrality scores in each of the\nthree cell clusters (Fig.5d and Source Data 13). Interestingly, these TFs\nshowed distinctions between the normal and the two DSLL states and\ninferred variant regulatory patterns within the two DSLL states. For\nregulons shared by all three B cell clusters, EGR1, MEF2B, and FOS were\ntranscriptionally active in both normal B and DSLL cells and respon-\nsible for regulating B cell development, proliferation, and germinal\nExhausted \nCD4+ T cell\nExhausted \nCD8+ T cell\nMacrophage\nNaïve \nCD8+ T cell\nDSLL \nstate-2\nDSLL \nstate-1\nNormal B cell\nEffector-like \nCD8+ T cell\nDC\nEffector-like \nCD4 T cell\nEffector-like \nCD4 T cell\nUMAP-1\nUMAP-2\nExhausted \nCD4+ T cell\nExhausted \nCD8+ T cell\nMacrophage\nNaïve \nCD8+ T cell\nDSLL \nstate-2\nDSLL \nstate-1\nNormal B cell\nEffector-like \nCD8+ T cell\nDC\nEffector-like \nCD4 T cell\nEffector-like \nCD4 T cell\nUMAP-1\nUMAP-2\nab\nd e\nc\nf\nGenei velocityFor velocity > 0,\nmore regulatory \ncontribution\nFor velocity < 0,\nless regulatory \ncontribution\nGene-wise ranking\nCell-wise ranking\nJUN 37 \ngenesJUN 37 \ngenes\nKLF16 210 \ngenesKLF16 210 \ngenes\nFOS 180 \ngenesFOS 180 \ngenes\nGATA1 32 \ngenesGATA1 32 \ngenes\nKLF16KLF16\nGATA1GATA1\nFOSFOS\nJUNJUN\nDSLL state -2\nNormal B cell\nDSLL state -1\nKLF16\nELF3\nEGR1\nE2F6\nMEF2B\nFOS\nCTCF GABPA\nELF1\nZEB1\nETV1\nIRF2\nCDX2\nIRF1\nMAFK SP1\nFOXP1\nSP2\nSNAI2\nSCRT2MAFG\nJUN NR2C2\nTBX21\nBCL6\nGATA1\nHNF1A\nEHF\nESR1\nGATA2\nESRRA\nGATA4\nNFKB1\nHNF4A\nELK3ELK1\nMEF2C NFIA\nFLI1 FOXA1\nMYB\nJUND\nSREBF1NR3C1\nDSLL state-2DSLL state-2DSLL state-1DSLL state-1Normal B cellNormal B cell\nUnspliced\nSpliced\nUnspliced\nSpliced\nVelocity\nCellk\nGenei\nVelocity\nCellk\nGenei\nRNA\nRNA\nThe HGT framework\nDSLL state-2\nNormal B cell\nDSLL state-1\nTACI (TNFRSF13B)\nPeak RNA\ni\nGAS\nTF Gene1TF Gene1\nGene1 Gene2 Gene3 Gene4\nDSLL state-2\nDSLL state-1\nNormal B cell\nDSLL state-2\nDSLL state-1\nNormal B cell\nCell clusters\nGene \nmodules\nWith high \nattention \nscores and \nremained \nin SLP \nmodel\n\u0001/g3Gene expression\n\u0001/g3gene accessibility\n\u0001/g3TF-motif binding affinity \n\u0001/g3peak to gene distance \n\u0001/g3TF coding gene expression\nRegulons \nand GRN\nGene5\nTF\nBuild TF-gene \nlinkage\nOnly consider + or \n̢ velocity ranks \nh\nMacrophage\nBAFF\nDSLL\nState-1 & 2\nTACI\nBAFF \ncommunication \npathway\ng\nPTP4A2MAX\nGPR132\nU2AF2TTYH3STIM1\nSTAT1\nWDR81\nCFL1\nVPS9D1VPS37B\nMCTP2MBNL1\nBATF\nTMSB4X\nST8SIA1\nAPRT CD247 JAK3\nNormal B DSLLstate -2DSLL state -1\nJUN\nCSNK1G2\nZC3H4\nHLA-CCHST11\nIGF2R\nCDK6\nKIAA2026\nVMP1\nCD6\nRGL1\nTBC1D2B\nMAPK11\nRUNX1 UBASH3A\nZNF217\nIL18\nJUN\nNCK2\nGIMAP8\nMIR4435-\n2HGLINC00963\nCD3E\nUTP11\nCD300A\nITGB2-AS1\nCOTL1\nFTL\nSLC19A1\nJUN\nGene activity score \nmatrix\nGG\n i\nGene activity score \nmatrix\nATAC\nATAC Pseudotime\nFig. 5 | DeepMAPS identiﬁes speciﬁc GRNs in DSLL subnetworks. aConceptual\nillustration of DeepMAPS analysis of scRNA-ATAC-seq data. Modalities areﬁrst\nintegrated based on a velocity-weighted balance. The integrated GAS matrix was\nthen used to build a heterogeneous graph as input into the HGT framework. The\ncell cluster and gene modules with high attention scores were then used for\nbuilding TF-gene linkages and determining regulons in each cell cluster.b The\nUMAP shows the clustering results of DeepMAPS. Cell clusters were manually\nannotated based on curated marker genes.c The observed and extrapolated future\nstates (arrows) based on the RNA velocity of the normal B cell and the two DSLL\nstates are shown (top panel). Velocity-based trajectory analysis shows the pseu-\ndotime from the top to the bottom right (bottom panel).d Selected 20 TF in each of\nthe three clusters, representing the top 20 regulons with the highest centrality\nscores. Colors represent regulons uniquely identiﬁed in each cluster or shared\nbetween different clusters.e Regulons in DSLL state-1 showed a signiﬁcant differ-\nence in regulon activity compared to the other clusters. Motif shape and number of\nregulated genes are also shown.f Violin plots of regulon activities of the four\nregulons compared between the three clusters.g The downstream-regulated genes\nof JUN (the most differentially active regulon in DSLL state-1) in the three clusters.\nh An illustration of the BAFF signaling pathway identiﬁed from GAS-based cell-cell\ncommunication prediction using CellChat. The BAFF signaling pathway was found\nto exist between macrophage and both DSLL states. It further activates the JUN\nregulon and enables the transcription of genes likeCDK6. Figure created with\nBioRender.com.i The ATAC peak, RNA expression, and GAS level ofTNFRSF13B(the\ncoding gene of TACI, the receptor in the BAFF signaling pathway). Source data are\nprovided as a Source Dataﬁle.\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 8\ncenter formation31–34. E2F6, ELF3, and KLF16 were identiﬁed as shared\nonly in the two DSLL states, with reported roles in tumorigenesis35–40.\nFurther, JUN, MAFK, and MAFG, which encode the compartments of\nthe activating protein-1 (AP-1),\n34,41,42 were found to be active in DSLL\nstate-1 while NFKB1, coding for a subunit of the NF-κB protein\ncomplex43,44,w a sf o u n dt ob ea c t i v ei nD S L Ls t a t e - 2 .\nWe constructed a GRN consisting of the four cell-type-speciﬁc\nregulons (JUN, KLF16, GATA1, and FOS) (Fig.5e and Supplementary\nFig. 10) in DSLL state-1 with RAS that is signiﬁcantly higher than normal\nB cells and DSLL state-2 (Fig.5f). KLF16 reportedly promotes the pro-\nliferation of both prostate39 and gastric cancer cells40. FOS and JUN are\ntranscription factors in the AP-1 family, regulating the oncogenesis of\nmultiple types of lymphomas\n34,41,42,45, and GATA1 is essential for\nhematopoiesis, the dysregulation implicated in multiple hematologic\ndisorders, and malignancies\n46,47. Distinct regulatory patterns were also\nobserved when we zoomed in on a single regulon (Fig.5ga n dS u p -\nplementary Figs. 11-12). As the most active regulon in DSLL state-1, JUN\nwas found to regulateﬁve unique downstream genes and 12 genes\nshared with DSLL state-2. Downstream genes, includingCDK6\n33,34,\nIGF2R48,a n dRUNX149, are critical for cell proliferation, survival, and\ndevelopment functions in DSLL.\nMoreover, we further built connections between upstream cell-\ncell communication signaling pathways and downstream regulatory\nmechanisms in DSLL cells. We identiﬁed a cell-cell communication\nbetween macrophage and the two DSLL states via the B cell activation\nfactor (BAFF) signaling pathway, based on the integrated GAS matrix\nusing CellChat\n25, which includes BAFF as the ligand on macrophage\ncells and TACI (transmembrane activator and calcium-modulator and\ncyclophilin ligand interactor) as the receptor on DSLL cells (Fig.5h).\nBAFF signaling is critical to the survival and maturation of normal B\ncells\n50,51, while aberrations contribute to the resistance of malignant B\ncells to apoptosis52,53. We observed that the expression of the TACI\ncoding gene,TNFRSF13B, was explicitly higher in the two DSLL states,\nwhile the corresponding chromatin accessibility maintained high\npeaks in state-1 (Fig.5i). Upon engagement with its ligand, TACI has\nbeen reported to transduce the signal and eventually activate the AP-\n1\n54,55 and NF-κB56,57 transcriptional complexes for downstream signaling\nin B cells. JUN (a subunit of AP-1) was identiﬁed as the most speciﬁca n d\nkey regulator in state-1 responsible for cell proliferation and regulating\ndownstream oncogenes, such asCDK6, that has been reported to\npromote the proliferation of cancer cells in multiple types of DSLLs as\nwell as other hematological malignancies\n58–60. It is clear that BAFF\nsignalingﬁrst appears in DSLL state-1 and triggers the activation of the\nJUN regulatory mechanism, leading to a high regulon activity of JUN.\nThe JUN regulon accelerates the proliferation and oncogenesis expli-\ncitly in DSLL, leading to a more terminal differential stage of DSLL\n(state-2). As a result, state-1 includes cells undergoing rapid cell pro-\nliferation and differentiation, transitioning from normal B cells to\nmatured DSLL. In short, DeepMAPS can construct GRNs and identify\ncell-type-speciﬁc regulatory patterns to offer a better understanding of\ncell states and developmental orders in diseased subpopulations.\nDeepMAPS provides a multi-functional and user-friendly web\nportal for analyzing scMulti-omics data\nDue to the complexity of single-cell sequencing data, more webservers\nand dockers have been developed in the past three years61–73 (Sup-\nplementary Data 5). However, most of these tools only provide mini-\nmal functions such as cell clustering and differential gene analysis.\nThey do not support the joint analysis of scMulti-omics data and\nespecially lack sufﬁcient support for biological network inference. On\nthe other hand, we recorded the running time of DeepMAPS and\nbenchmark tools on different datasets with cell numbers ranging from\n1000 to 160,000 (Supplementary Data 6). The deep learning models\n(DeepMAPS and TotalVI) have longer running time than Seurat and\nMOFA + . To these ends, we provided a code-free, interactive, and\nnon-programmatic interface to lessen the programming burden for\nscMulti-omics data (Fig.6a). The webserver supports the analysis of\nmultiple RNA-seq data, CITE-seq data, and scRNA-ATAC-seq data using\nDeepMAPS (Fig. 6b). Some other methods, e.g., Seurat, are also\nincorporated as an alternative approach for the users’ convenience.\nThree major steps—data preprocessing, cell clustering and annotation,\nand network construction—are included in the server. In addition, the\nDeepMAPS server supports real-time computing and interactive graph\nrepresentations. Users may register for an account to have their own\nworkspace to store and share analytical results. Other than the\nadvances mentioned, the DeepMAPS webserver highlights an addi-\ntional function for the elucidation of complex networks in response to\nexternal stimuli in speciﬁc cell types. The user can upload a metadata\nﬁle with phenotype information (e.g., cells with treatment and without\ntreatment), select, and re-label the corresponding cells (e.g., CD8+\nT cells with treatment and CD8+ T cells without treatment). In this way,\nDeepMAPS will predict the treatment-related networks in CD8+ T cells.\nExamples are given in the online tutorial athttps://bmblx.bmi.osumc.\nedu/tutorial.\nDiscussion\nDeepMAPS is a deep-learning framework that implements hetero-\ngeneous graph representation learning and a graph transformer in\nstudying biological networks from scMulti-omics data. By building a\nheterogeneous graph containing both cells and genes, DeepMAPS\nidentiﬁes their joint embedding simultaneously and enables the\ninference of cell-type-speciﬁc biological networks along with cell types\nin an intact framework. Furthermore, the application of a hetero-\ngeneous graph transformer models the cell-gene relation in an inter-\npretable uniform multi-relation. In such a way, the training and\nlearning process in a graph can be largely shortened to consider cell\nimpacts from a further distance.\nBy jointly analyzing gene expression and protein abundance,\nDeepMAPS accurately identiﬁed and annotated 13 cell types in a mixed\nCITE-seq data of PBMC and lung tumor leukocytes based on curated\nmarkers that cannot be fully elucidated using a single modality. We\nhave also proved that the embedding features identiﬁed in DeepMAPS\ncapture statistically signiﬁcant signals and amplify them when the\noriginal signals are noisy. Additionally, we identiﬁed biologically\nmeaningful cell-cell communication pathways between DC and TRM\nCD4\n+ T cells based on the gene association network inferred in the two\nclusters. For scRNA-ATAC-seq, we employed an RNA velocity-based\nmethod to dynamically integrate gene expressions and chromatin\naccessibility that enhanced the prediction of cell clusters. Using this\nmethod, we identiﬁed distinct gene regulatory patterns among normal\nB cells and two DSLL development states. We further elucidated the\ndeep biological connections between cell-cell communications and\nthe downstream GRNs, which helped characterize and deﬁne DSLL\nstates. The identiﬁed TFs and genes can be potential markers for fur-\nther validation and immuno-therapeutical targets in DSLL treatment.\nW h i l et h e r ea r ea d v a n t a g e sa n di m p r o v e dp e r f o r m a n c e sf o ra n a -\nlyzing scMulti-omics data, there is still room to improve the power of\nDeepMAPS further. First, the computational efﬁciency for super-large\ndatasets (e.g., more than 1 million cells) might be a practical issue\nconsidering the complexity of the heterogeneous graph representation\n(which may contain billions of edges). Moreover, DeepMAPS is\nrecommended to be run on GPUs, which leads to a potential problem of\nreproducibility. Different GPU models have differentﬂoating-point\nnumbers that may inﬂuence the precision of loss functions during the\ntraining process. For different GPU models, DeepMAPS may generate\nslightly different cell clustering andnetwork results. Lastly, the current\nversion of DeepMAPS is based on a bipartite heterogeneous graph with\ngenes and cells. Separate preprocessing and integration steps are\nrequired to transfer different modalities to genes for integration into\na cell-gene matrix. To fully achieve an end-to-end framework for\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 9\nscMulti-omics analysis, the bipartite graph can be extended to a mul-\ntipartite graph, where different modalities can be included as disjoint\nnode types (e.g., genes, proteins, orpeak regions). Such a multipartite\nheterogeneous graph can also include knowledge-based biological\ninformation, such as known molecular regulations and more than two\nmodalities in one graph. However,by including more node types, the\ncomputational burden will be increased geometrically, which requires a\ndedicated discovery of model and parameter optimization in the future.\nIn summary, we evaluated DeepMAPS as a pioneer study for the\nintegrative analysis of scMulti-omics data and cell-type-speciﬁc bio-\nlogical network inference. It will likely provide different visions of\ndeep learning deployment in single-cell biology. With the develop-\nment and maintenance of the DeepMAPS webserver, our long-term\ngoal is to create a deep learning-based eco-community for archiving,\nanalyzing, visualizing, and disseminating AI-ready scMulti-\nomics data.\na\nb\nData inputData inputData inputData input\nscRNA (h5, csv, 10X)\nscATAC (fragment, h5)\nCITE-seq (h5, csv)\nCreate DeepMAPS project\nRNA velocity (csv) (opt)\nData preprocessing\nData integration\nDimension reduction and \ncell clustering\nNetwork construction\nReport generation\nJob queueBrowser Front-end Backend\nAuthentication\nUser\nSingle-cell dataSingle-cell data\nDatabaseDatabase\nWorkload orchestration\nConsumer A Consumer CConsumer B\nBioinformatics \npipelines with \nnextflow\nWorkspace\nDeepMAPS\nSeurat\nDeepMAPS\nSeurat\nRemove low quality cells\nVariable gene selection\nGene-gene correlation analysis\nNormalization and gene filtering\nRemove low quality cells\nVariable gene selection\nGene-gene correlation analysis\nNormalization and gene filtering\nCell clustering\nManual cell selection\nCluster re-labeling\nDEG analysis\nCoverage comparison\nCell clustering\nManual cell selection\nCluster re-labeling\nDEG analysis\nCoverage comparison\nBiological network construction\nNetwork centrality\nDifferential regulon analysis\nRegulon activity analysis\nGSEA enrichment analysis\nBiological network construction\nNetwork centrality\nDifferential regulon analysis\nRegulon activity analysis\nGSEA enrichment analysis\nCell cluster UMAP Gene violin plot\nFeature plot Coverage plot\nBasic data statistics Highly variable genes\nnextflow\n&\nPyTorch\nplumber\nMySQL\nredisnest\nAuth0\nVuetify\nECHARTS\nNUXTJS\na\nb\nData inputData input\nscRNA (h5, csv, 10X)\nscATAC (fragment, h5)\nCITE-seq (h5, csv)\nCreate DeepMAPS project\nRNA velocity (csv) (opt)\nData preprocessing\nData integration\nDimension reduction and \ncell clustering\nNetwork construction\nReport generation\nJob queueBrowser Front-end Backend\nAuthentication\nUser\nSingle-cell data\nDatabase\nWorkload orchestration\nConsumer A Consumer CConsumer B\nBioinformatics \npipelines with \nnextflow\nWorkspace\nDeepMAPS\nSeurat\nRemove low quality cells\nVariable gene selection\nGene-gene correlation analysis\nNormalization and gene filtering\nCell clustering\nManual cell selection\nCluster re-labeling\nDEG analysis\nCoverage comparison\nBiological network construction\nNetwork centrality\nDifferential regulon analysis\nRegulon activity analysis\nGSEA enrichment analysis\nloiBoiBo loggi icacal l nnetwetwororksks\nCell cluster UMAP Gene violin plot\nFeature plot Coverage plot\nBasic data statistics Highly variable genes\nnextflow\n&\nPyTorch\nplumber\nMySQL\nredisnest\nAuth0\nVuetify\nECHARTS\nNUXTJS\nFig. 6 | The organization of the DeepMAPS web portal. aSoftware-engineering diagram of DeepMAPS and an overview of the framework.b Pipeline illustration of the\nserver, including major steps (left; colors indicate different steps), detailed analyses (middle), and featuredﬁgures and tables (right).\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 10\nMethods\nData description\nWe included ten public datasets (i.e., R-bench-1-3, C-bench-1-3, and A-\nbench-1-4) for grid-test benchmarking among DeepMAPS and existing\ntools and additionalﬁve datasets (i.e., R-test-1, C-test-1, and A-test-1-3)\nfor independent test with optimized parameters. The human PBMC and\nlung tumor leukocyte CITE-seq data and 10× lymph node scRNA-seq &\nscATAC-seq data were used for the two case studies, respectively. All\ndata are publicly available (Supplementary Data 1 and Data Availability).\nData preprocessing and integration\nThe analysis of DeepMAPS takes the raw counts matrices of multiple\nscRNA-seq (multiple gene expression matrices), CITE-seq (gene and\nsurface protein expressions matrices), and scRNA-ATAC-seq (gene\nexpression and chromatin accessibility matrices) data as input. For\neach data matrix, we deﬁne modality representations as rows (genes,\nproteins, or peak regions) and cells as columns across the paper unless\nexceptions are mentioned. In each data matrix, a row or a column is\nremoved if it contains less than 0.1% non-zero values. The data quality\ncontrol is carried out by Seurat v3, including but not limited to total\nread counts, mitochondrial gene ratio, and blacklist ratio. Additional\ndata preprocessing and integration methods are showcased below.\nMultiple scRNA-seq data. Gene expression matrices are log-normal-\nized, and the top 2000 highly variable genes are selected using Seurat\nv3\n18 from each matrix. If there are less than 2000 genes in the matrix,\nall of them will be selected for integration. We then apply the widely-\nused canonical correlation analysis (CCA) in Seurat to align these\nmatrices and harmonize scRNA-seq data, leading to a matrix\nX = fx\nij∣i = 1,2,... ,I; j = 1,2,... , JÞ for I genes inJ cells.\nCITE-seq data. Gene and surface protein expression matrices are log-\nnormalized. The topI1 highly variable genes (I1 = 2000) andI2 proteins\n(I2 is the total number of proteins in the matrix) are selected. The two\nmatrices are then concatenated vertically, leading to a matrix\nX = ðx\nij∣i = 1,2,... ,ðI1 +I 2Þ; j = 1,2,... , JÞ for I1 genes andI2 proteins inJ\ncells (can be treated asI1 + I2 = I genes inJ cells). A centered log-ratio\n(CLR) transformation is performed onX as follows:\nCLRðxijÞ =l o g 1+ xij\nexp\nP\ni2Zj\nlog 1 +xijðÞ\n∣Zj ∣\n0\n@\n1\nA\n0\nBB\nBBB\nB\n@\n1\nCC\nCCC\nC\nA\n0\nBB\nB\nBBB\nB\n@\n1\nCC\nC\nCCC\nC\nA\nð1Þ\nwhere Z\nj represents the set of indices for non-zero genes in cellj,\nand |∙| means the number of elements in the set.\nscRNA-ATAC-seq data . The gene expression matrix\nXR = fxR\nij ∣i = 1,2,... ,I; j = 1,2,... , Jg with I genes and J cells is log-\nnormalized. Then a left-truncated mixture Gaussian (LTMG) model is\nused to provide a qualitative representation of each gene over all cells,\nthrough the modeling of how underlying regulatory signals control\ngene expressions in a cell population\n74.S p e c iﬁcally, if genei can be\nrepresented byGi Gaussian distributions over allJ cells, that means\nthere are potentiallyGi regulatory signals regulating this gene. A matrix\nXR’ = fxR’\nij g with the same dimension asXR can be generated, where the\ngene expressions are labeled by discrete values ofxR’\nij = 1,2,... Gi.\nThe chromatin accessibility matrix is represented as\nXA = fxA\nkj ∣k = 1,2,... ,K; j = 1,2,... , Jg for K peak regions inJ cells. We\nannotate peak regions inXA into corresponding genes based on the\nmethod described in MAESTRO24.S p e c iﬁcally, a regulatory potential\nweightwik for peakk to genei is calculated conditional to the distance\nof peakk to genei in the genome:\nwik =\n0, dik > 150 kb or peak k located in any nearby genes\n1\nLengthðexonÞ ,p e a kk located at the exon regions of the genej\n2\n/C0\ndik\nd0 , else\n8\n>><\n>>:\nð2Þ\nwhere dik is the distance between the center of peakk and the tran-\nscription start site of genei,a n dd0 is the half-decay of the distance (set\nto be 10 kb). The regulatory potential weightwik of peakk to genej is\nnormally calculated by 2\n/C0\ndik\nd0 . For peaks withdik >1 5 0kb, wik will be less\nthan 0.0005, and thus we set it to 0 for convenience. In MAESTRO, for\npeaks located in the exon region,d0 is 0, so thatwik should be 1\naccording to the formula, andwik is normalized by the total exon\nlength of gene i. The reason is that, in bulk ATAC-seq data, it is\nobserved that many highly expressed genes will also have ATAC-seq\npeaks in the exon regions, mainly due to the temporal PolII and other\ntranscriptional machinery bindings. Based on that observation, to\nbetterﬁt the model with gene expression, MAESTRO added the signals\nfrom the exon regions. However, as reads tend to be located in longer\nexons more easily than shorter exons, to normalize the possibility of\nbackground reads, it normalizes the total reads on exons by the total\nexon length for each gene. Eventually, a regulatory potential score of\npeak k to gene i in cell j can be calculated asr\nik∣j = wik × xA\nkj .T h e\nscATAC-seq matrixXA c a nt h e nb et r a n s f o r m e di n t oag e n er e g u l a t o r y\npotential matrix by summing up the regulatory potential scores of\npeaks that regulate the same gene:\nx\nA0\nij =0+\nX\nk\nrik∣j, ð3Þ\ngiving rise to the regulatory potential matrix XA0\n= fxA0\nij ∣i =\n1,2, ... ,I; j = 1,2,... , Jg for sameI genes inJ cells withXR.\nWe assume that the activity of a gene in a cell is determined by\ngene expression and gene regulatory activity with different contribu-\ntions. Unlike the contribution weights determined directly based on\nthe expression and chromatin accessibility values in Seurat v4\n(weighted nearest neighbor)\n5, we hypothesize that the relative con-\ntribution of the expression and chromatin accessibility of a gene to a\ncell is dynamic rather than static and not accurately determined with a\nsnapshot of the cell. RNA velocity is determined by the abundance of\nunspliced and spliced mRNA in a cell. The amount of unspliced mRNA\nis determined by gene regulation and gene transcription rate, and the\na m o u n to fs p l i c e dm R N Ai sd e t e r m i n e db yt h ed i f f e r e n c eb e t w e e n\nunsliced mRNA and degraded mRNA. We reasoned that for genes with\npositive RNA velocities in a cell, there are higher potentials to drive\ngene transcription. Thus, their regulatory activity related to chromatin\naccessibility has a greater inﬂuence than the gene expression in\ndeﬁning the overall transcriptional activity in the cell of the current\nsnapshot. For genes with negative velocities, the transcription rate\ntends to be decelerated; hence chromatin accessibility has less inﬂu-\nence on transcriptional activity than gene expression.\nA velocity matrixX\nV = fxV\nij ∣i =1 ,2 ,... I; j =1 ,2 ,... , Jg is generated\nusing scVelo with the default parameters75. Considering that some\ngenes may fail to obtain valid velocity or regulatory potential values,\nwe simultaneously remove the genes that have all-zero rows inXA’ or\nXV from the four matricesXR, XR’, XA’, XV : Without loss of generality,\nwe still useI and J represent the size of these new matrices. Further-\nmore, considering the potential bias when interpreting the velocity of\na gene in a cell, we use the LTMG representationsxR’\nij 2f 1,2, ... ,Gig to\ndiscretize xV\nij .F o rg e n ei,l e tJ g be the cell set where genei has the\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 11\nsame LTMG signalg 2f 1, 2,... ,Gig.F o rt h ec e l l si nJ g ,w eu s et h em e a n\nvelocity of genei in these cells to replace the original velocities. To\ncalculate a velocity weight β of gene i in cell j,w e ﬁrst extract\nXV\ni = ðxV\ni1, xV\ni2, ... xV\niJ Þ for the velocity of gene i in all cells and\nXV\nj = ðxV\n1j, xV\n2j, ... xV\nI2jÞ for the velocity of all genes in cellj.T h e n ,f o rXV\ni ,\nlet XV +\ni = fxV\nij ∣xV\nij >0 ,j =1 ,2 ,... ,Jg for all cells with positive velocities\nof genei and XV/C0\ni = fxV\nij ∣xV\nij <0 ,j = 1,2,... ,Jg for all cells with negative\nvelocities of genei.S i m i l a r l y ,f o rXV\nj ,l e tXV +\nj = fxV\nij ∣xV\nij >0 ; i = 1,2,... Ig\nfor all genes with positive velocities in celli and XV/C0\nj = fxV\nij ∣xV\nij <0 ;\ni = 1,2,... Ig for all genes with negative velocities in celli.F o rxV\nij >0 ,\nrank XV +\ni and XV +\nj from high to low based on velocity values with the\nranking starting from 1 and calculate the velocity weight as:\nβ+ =\nﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ\nð∣XV +\ni ∣ /C0 a /C0 1Þ\n2\n+ ∣XV +\nj ∣ /C0 b /C0 1\n/C16/C17 2\nr\nð4Þ\nwhere a is the rank ofxV\nij in XV +\ni , b is the rank ofxV\nij in XV +\nj .\nSimilarly, forxV\nij < 0, rankXV/C0\ni and XV/C0\nj from high to low based on\nabsolute value of velocities with ranking starting from 0 and calculate\nthe velocity weight as:\nβ/C0 =\nﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ\nXV/C0\nj ∣ /C0 a /C0 1Þ2 + ∣XV/C0\nj ∣ /C0 b /C0 1\n/C16/C17 2\nr\nð5Þ\nwhere a is the rank ofxV\nij in XV/C0\ni and b is the rank ofxV\nij in XV/C0\nj .\nWe now generate a gene activity matrixXG = fxG\nij g, integrating\ngene expression and chromatin accessibility based on the velocity\nweight. x\nG\nij is the gene activity score (GAS) of genei in cellj:\nxG\nij =\nxR\nij +1 + β+/C0/C1\nxA’\nij ,f o rxV\nij >0\nxR\nij +1 /C0 β/C0ðÞ xA’\nij ,f o rxV\nij <0\nxR\nij + xA’\nij ,f o rxV\nij =0\n8\n>>>\n<\n>>\n>:\nð6ÞConstruction of gene-cell heterogeneous graph\nTo simplify notations, we now redeﬁne any integrative matrix gener-\nated in the previous section asX = fxij∣i =1 ,2 ,... , I; j = 1,2,... ,Jg with I\ngenes and J cells. xij represents either normalized expressions (for\nmultiple scRNA-seq and CITE-seq) or GAS (for scRNA-ATAC-seq) of\ngene i in cellj. We calculate initial embeddings for genes and cells via\ntwo autoencoders. We used two autoencoders to generate the initial\nembeddings for cells and genes, respectively. The cell autoencoder\nreduces gene dimensions for each cell from I dimensions to 512\ndimensions and eventually to 256 dimensions; a gene autoencoder\nreduces cell dimensions for each gene from J dimensions to 512 and\n256 dimensions. So that, each cell and gene have the same initial\nembedding of 256 dimensions. The number of lower dimensions is\noptimized as a hyperparameter that differs for each dataset. The out-\nput layer is a reconstructed matrix^X with the same dimension asX.\nThe loss function of cell autoencoder is the mean squared error (MSE)\nof X and ^X:\nloss = MSEðX, ^XÞ =\nX\ni\nðX /C0 ^XÞ\n2\nð7Þ\nThe gene autoencoder learns low dimensional features of genes\nfrom all cells, which has an encoder, latent space, and a decoder similar\nto the cell autoencoder, while the inputX\nT is the transposed matrix of\nX. The loss function of gene autoencoder is\nloss = MSE X T , ^XT\n/C16/C17\n=\nX\nj\nXT /C0 ^XT\n/C16/C17 2\n, ð8Þ\nwhere ^XT is the reconstructed matrix in the output layer with the same\ndimensions asXT .\nDeﬁnition 1(Heterogeneous graph): A heterogeneous graph is a\ng r a p hw i t hm u l t i p l et y p e so fn o d e sa n d / o rm u l t i p l et y p e so fe d g e s .W e\ndenote a heterogeneous graph asG = ðV, E, A, RÞ,w h e r eV represents\nnodes, E represents edges,A represents the node type union, andR\nr e p r e s e n t st h ee d g et y p eu n i o n .\nDeﬁnition 2(Node type and edge type mapping function): We\ndeﬁne τ vðÞ : V ! A and ϕ eðÞ : E ! R as the mapping function for node\ntypes and edge types, respectively.\nDeﬁnition 3(Node meta relation): For a node pair ofv1 and v2\nlinked by an edgee1,2, the meta relation betweenvi and vj is denoted\nas langle τðviÞ ,ϕðei,jÞ,τðvjÞi.\nGiving the integrated matrixX, we construct a bipartite gene-cell\nheterogeneous graphG with two node types (cell and gene) and one\nedge type (gene-cell edge).V = VC ∪ VG,w h e r eVG = vG\ni ∣i =1 ,2 ,... ,I\n/C8/C9\ndenotes all genes, andVC =\n/C8\nvC\nj ∣ j =1 ,2 ,... ,J\n/C9\ndenotes all cells.E =\n/C8\nei,j\n/C9\nrepresents the edge betweenvG\ni and vC\nj .F o rxij >0 ,t h ew e i g h t o ft h e\ncorresponding edgeωðei,jÞ =1 ,o t h e r w i s e ,ωðei,jÞ =0 .\nJoint embedding via a heterogeneous graph transformer\nWe propose an unsupervised HGT framework12,13 to learn graph\nembeddings of all the nodes and mine relationships between genes\nand cells. The input of HGT is the integrated matrixX, and the outputs\nare the embeddings of cells and genes and attention scores repre-\nsenting the importance of genes to cells.\nDeﬁnition 4(Target node and source node): A node inV is con-\nsidered as a target node, represented asv\nt , when performing HGT to\naggregate information and update embeddings of this node. A node is\nconsidered as a source node, represented asv\ns,vs ≠ vt , if there is an\nedge betweenvs and vt in E, denoted ases,t for convenience.\nDeﬁnition 5 (Neighborhood graph of target node): A neigh-\nborhood graph of a target nodevt is induced fromG and denoted\nas G′ =( V′, E′, A′, R′), where V0 = fvt g ∪ N vt\n/C0/C1\n, N vt\n/C0/C1\nis the com-\nplete set of neighbors of vt , E0 = fei,j 2 E∣vi,vj 2 V’g, A′ marks the\ntarget and source node types, andR′ represents the target-source\nedge. es,t ∈ E′ represents the edge between vs and vt .A so n l y\no n ee d g et y p ei si n c l u d e di nG, the node meta relation ofvs and vt\nis denoted as τ vs\n/C0/C1\n,ϕ es,t\n/C0/C1\n,τ vt\n/C0/C1/C10/C11\n.\n1. Multi-head attention mechanism and linear mapping of vectors.\nLet Hl denotes the embedding of thelth HGT layer (l = 1,2,... ,L).\nThe embedding ofvt and vs on thelth layer is denoted asHl½vt/C138\nand Hl½vs/C138. A multi-head mechanism is applied to equally divide\nboth Hl½vt/C138and Hl½vs/C138into H heads. Multi-head attention allows\nthe model to jointly attend to information from different\nembedding subspaces, and each head can run through an\nattention mechanism in parallel to reduce computational time.\nFor theh\nth head in thelth HGT layer, theHl½vt/C138is updated from\nHl/C0 1½vt/C138 and Hl/C0 1½vs/C138.T h eH0½vt/C138 and H0½vs/C138 are the initial\nembedding of vt and vs, respectively. Three linear projection\nfunctions are applied to map node embeddings into thehth\nvector. Speciﬁcally, the Qlinearh\nτ vtðÞ function mapsvt into thehth\nquery vectorQh vt\n/C0/C1\n,w i t hd i m e n s i o nRd ! R\nd\nH ,w h e r ed is the\ndimension ofHl/C0 1½vt/C138and d\nH is the vector dimension per head.\nSimilarly, the Klinearh\nτ vsðÞ and V linearh\nτ vsðÞ function map the\nsource nodevs into thehth key vectorKh vs\n/C0/C1\nand thehth value\nvector Vh vs\n/C0/C1\n.\nQh vt\n/C0/C1\n= Qlinear\nh\nτ vtðÞ H l/C0 1ðÞ vt\n/C2/C3/C16/C17\nð9Þ\nKh vs\n/C0/C1\n= K linearh\nτ vsðÞ H l/C0 1ðÞ vs\n/C2/C3/C16/C17\nð10Þ\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 12\nVh vs\n/C0/C1\n= V linearh\nτ vsðÞ H l/C0 1ðÞ vs\n/C2/C3/C16/C17\nð11Þ\nEach type of node has a unique linear projection to maximally\nmodel the distribution differences.\n2. Heterogeneous mutual attention\nTo calculate the mutual attention betweenvt and vs, we intro-\nduce the Attention operator which estimates the importance of\neach v\ns to vt :\nAttention vs, es, t , vt\n/C0/C1\n=S o f t m a x\n8v2N vtðÞ\nk\nH\nATT headh vs, es, t , vt\n/C0/C1/C16/C17/C18/C19\nð12Þ\nThe attention function can be described as mapping a\nquery vector and a set of key-value pairs to an output for\neach node paire = ðv\ns, vt Þ. The overall attention ofvt and vs is the\nconcatenation of the attention weights in all heads, followed by a\nsoftmax function. ∣∣\nH\nð/C1Þ is the concatenation function. The\nATT_headh vs, es, t , vt\n/C0/C1\nterm is the hth head attention weight\nbetween thevt and vs, which can be calculated by:\nATT headh vs, es, t , vt\n/C0/C1\n= Kh vs\n/C0/C1\nWATT\nϕ es,tðÞ Qh vt\n/C0/C1T/C16/C17\n/C1 μτ vs\n/C0/C1\n,ϕ es, t\n/C0/C1\n, τ vt\n/C0/C1/C10/C11\nﬃﬃﬃ\nd\np ,\nð13Þ\nThe similarity between the queries and keys was measured\nwhere WATT\nϕ es,tðÞ 2 R\nd\nH × d\nH is a transformation matrix to capture\nmeta-relation features.ð/C1Þ T is the transposal function andμ is a\nprior tensor to denote the signiﬁcance for each the node meta\nrelation τ vs\n/C0/C1\n, ϕ es,t\n/C0/C1\n, τ vt\n/C0/C1/C10/C11\n, serving as an adaptive scaling to\nthe attention. The concatenation of attention heads results in\nthe attention coefﬁcients between v\ns and vt , followed by a\nSoftmax function in Eq.12.\n3. Heterogeneous message passing\nA Message operator is used to extract the message ofvs that can\nbe passed tovt . The multi-headMessage is deﬁned by:\nMessage vs, es, t , vt\n/C0/C1\n= k\nH\nMSGhead h vs, es, t , vt\n/C0/C1/C16/C17\nð14Þ\nThe hth head message MSG_headh vs, es, t , vt\n/C0/C1\nfor each edge\nvs,vt\n/C0/C1\nis deﬁned as:\nMSGhead h vs, es, t , vt\n/C0/C1\n= Vh vs\n/C0/C1\nWMSG\nϕ es,tðÞ ð15Þ\nwhere each source nodevs in the headh was mapped into a message\nvector by a linear projectionVh vs\n/C0/C1\n: Rd ! × R\nd\nH . WMSG\nϕ eðÞ 2 R\nd\nH × d\nH is also\na transformation matrix similar toWATT\nϕ es,tðÞ .\n4. Target speciﬁca g g r e g a t i o n\nTo update the embedding ofvt ,t h eﬁnal step in thelth HGT layer\nis to Aggregate the neighbor information obtained in this layerfHl vt\n/C2/C3\ninto the target node embeddingHl/C0 1 vt\n/C2/C3\n.\nfHl vt\n/C2/C3\n= Aggregate\n8vs 2N vtðÞ\nAttention vs, es, t , vt\n/C0/C1\n/C1 Message vs, es, t , vt\n/C0/C1/C0/C1\nð16Þ\nHl vt\n/C2/C3\n= θ ReLUðfHl vt\n/C2/C3\nÞ\n/C18/C19\n+ θ /C0 1ðÞ Hl/C0 1 vt\n/C2/C3\n, ð17Þ\nwhere θ is a trainable parameter andReLU is the activation function.\nThe ﬁnal embedding ofvt is obtained by stacking information via allL\nHGT layers, andL is set to be 2 in DeepMAPS.\n5. Determination of gene to cell attention\nWe call out theﬁnal attention scoreai,j of genei to cellj in the last\nHGT layer after the completion of the HGT process:\nai,j =\nﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃX\nh\nATT headh i, jðÞ\n2\ns\nð18Þ\nHGT training on subgraphs\nTo improve the efﬁciency and capability of the HGT model on a giant\nheterogeneous graph (tens of thousands of nodes and millions of\nedges), we deploy a modiﬁed HGSampling method for subgraph\nselection and HGT training on multiple mini-batches\n12.F o rt h eg r a p hG\nwith I genes andJ cells, the union of subgraphs should covera%( s e tt o\nbe 30%) nodes of gene and cell nodes to ensure the training power. As\nsuch, the sampler constructs a number of small subgraphs (50 in\nDeepMAPS) from the given heterogeneous graphG,a n df e e d st h e\nsubgraphs into the HGT model in different batches using multiple\nGPUs. Each graph should includea%× I=50 genes, anda%× J=50 cells.\nTake a cellj as a target nodev\nt and its neighborvs2N vt\n/C0/C1\n, corre-\nsponding to genei, as source nodes, we calculate the probability on\nthe edgees,t as:\nProb es,t\n/C0/C1\n= xðvs, vt ÞP\nv2N vtðÞ xðv, vt Þ , ð19Þ\nwherexðvs,vt Þ = xij refers to the expression or GAS value of the genei in\ncell j in the integrated matrixX. Thus, for each target nodevt ,w e\nrandomly select a%× I=50\na%× J=50 neighbor genes for vt based on sampling\nprobabilityProb es,t\n/C0/C1\n. HGT hyperparameters, such asWATT\nϕ es,tðÞ , WMSG\nϕ es,tðÞ ,\nand θ, will be trained and inherited sequentially from subgraphs 1 to 50\nin one epoch. The subgraph training is performed in an unsupervised\nway with a graph autoencoder (GAE). The HGT is the encoder layer,\nand the inner product of embeddings is the decoder layer. We calcu-\nlate the loss function of the GAE as the Kullback-Leibler divergence\n(KL) of reconstructed matrix^X and the integrated matrixX:\nloss = KL softmax ð^XÞ, softmaxðXÞ\n/C16/C17\nð20Þ\nThe subgraph training will be completed if the loss is restrained or\nreaches 100 epochs, whichever happensﬁrst.\nDetermination of active genes module in cell clusters\nPredict cell clusters. We deploy a Louvain clustering (Seurat v3) to\npredict cell clusters cell embeddingsHL vc\n/C2/C3\ngenerated from theﬁnal\nHGT layer. The resolution of Louvain clustering is determined by a\ngrid-search test of multiple HGT hyperparameter combinations, and\nwe set the clustering resolution of 0.4 as the default.\nIdentify cell cluster-active gene association network. We used an\nSFP model\n17 to select genes that highly contribute to cell cluster\ncharacterization and construct cell cluster-active gene association\nnetworks. De ﬁne a new heterogeneous graph eG = V, eE\n/C16/C17\n,\nV 2 VG ∪ VC,eE 2 eE\n1\n∪ eE\n2\n,w h e r eeE\n1\nrepresents the gene-gene relations,\nand eE\n2\nrepresents the gene-cell relations. The weight of the corre-\nsponding edgeωðee1\ni1,i2\nÞ of vG\ni1\n2 VG and vG\ni 2 VG is the Pearson’s corre-\nlation of the HGT embeddings betweenvG\nj1\nand vG\nj2\n. The weight of\nthe corresponding edge ω ee2\ni,j\n/C16/C17\nof vG\ni 2 VG and vG\nj 2 VC is the\nﬁnal attention score ai,j.O n l ye d g e sw i t hω ee1\ni1,i2\n/C16/C17\n>0 :5a n d\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 13\nω ee2\ni,j\n/C16/C17\n> μ ai,j\n/C16/C17\n+ sdðai,jÞ,w h e r eμ() represents the mean and sdðÞ\nrepresents the standard deviation ofai,j,w i l lb ek e p tw i t h i nac e l l\ncluster. The weight of the remaining edges will then be max-min nor-\nm a l i z e dt oe n s u r ea ne d g ew i t ht h el a r g e s tw e i g h tb e i n gr e s c a l e dt ob e\n0 and an edge with the smallest weight being rescaled to be 1.\nLet Z be the number of clusters predicted via Louvain clustering,\nand V\nCz½/C138 = fvC½z/C138g be the node set corresponding with the cell set in\ncluster label ofz = 1,2,... ,Z. We then formulate this problem using a\ncombinatorial optimization model deﬁned below\nmin\neE\nL\n/C18 eE\n1\n∪eE\n2\nX\ne2eE\nL\nω eðÞ\ns.t.\nL vC\ni1\n, vC\ni2\n/C16/C17\n=1 ,8vC\ni1\n, vC\ni2\n2 VCz½/C138 , z = 1,2,... ,Z ð21Þ\nwhereLðvC\nj1\n,vC\nj2\nÞ is a binary indicator function representing whether two\ncell nodes,vC\nj1\nand vC\nj2\n, can be connected (1) or not (0) ineG via a\neE\nL\nj1,j2\n= fee2\ni1,j1\n, ee1\ni1,i2\n,ee1\ni2,i3\n... ,ee1\nit/C0 1,it\n,ee2\nit ,j2\ng path. Denote eE\nL\n= feE\nL\nj1,j2\ng as the\ncomplete collection ofeE\nL\nj1,j2\nconnectingvC\nj1\nand vC\nj2\n. The combinatorial\noptimization model aims to identify the path connectingvC\nj1\nand vC\nj2\nwith the minimum summed edge weight. We consider the gene net-\nworks remained in an SFP result of clusterz as the cluster-active gene\nassociation networks.\nConstruct GRNs from scRNA-ATAC-seq data\nFor genes in a cell cluster-active gene association network resulting\nfrom SFP, a set of TFsq = 1,2,... ,Q can then be assigned to genes. The\nTF-peak relations are retrieved byﬁnding alignments between the TF\nbinding sites with peak regions in the scATAC-seq data, and the peak-\ngene relations are established previously when calculating the potential\nregulation scoresr\nik∣j (Eq.3). We design a regulatory intensity (RI) score\nsi,j,q to quantify the intensity of TFq in regulating genei in the cellj:\nsij∣q =\nX\nk\nbA\nqk /C1 rik∣j ð22Þ\nwhere bA\nqk is the binding afﬁnity score of TFq to peakk.T h eb i n d i n g\nafﬁnity score is calculated by three steps: (a) We retrieved the genome\nbrowser trackﬁle from JASPAR, which stores all known TF binding sites\nof each TF. Ap-value score was calculated as -log10 (p)×1 0 0i nJ A S P A R ,\nwhere 0 corresponds to ap-value of 1 and 1,000 corresponds to ap-\nvalue <10−10.W er e m o v e dT Fb i n d i n gs i t e sw i t hp-value scores smaller\nthan 500. (b) If a TF binding site overlaps with any peak regions in the\nscATAC-seq proﬁle, it will be kept, otherwise, it will be removed. (c)\nDivide the correspondingp-value score by 100. We claim that a gene\nset regulated by the same TF is a regulon.\nWe calculate a regulon activity score (RAS)r q,zðÞ of a regulon with\ngenes regulated by TFq in cell clusterz as:\nr q, zðÞ =\nP\ni2Iq\nP\nj2Cz½/C138\nxij /C1 sij∣q\nI /C1 J\nð23Þ\nwhere Iq denotes genes regulated by TFq in cell clusterz.W eu s e dt h e\nWilcoxon rank-sum test to identify differentially active regulons in a\ncluster based on RAS. If the BH-adjustedp-value is less than 0.05\nbetween different cell clusters and the log fold change larger than 0.10,\nwe consider the regulon to be differentially active in this cluster, and it\nis deﬁned as a cell-type-speciﬁc regulon (CTSR).\nA GRN in a cell cluster is constructed by merging regulons in a cell\ncluster. The eigenvector centrality (c\nv)o faT Fn o d ev in GRN was\ndeﬁned as:\ncv = αmax vðÞ ð 24Þ\nwhere αmax is the eigenvector corresponding to the largest eigenvalue\nof the weighted adjacency matrix of a GRN. TFs with highercv ranks\nwere regarded as master TFs (top 10 by default).\nBenchmarking quantiﬁcation and statistics\nGrid-search parameter test for cell clustering on benchmark data.\nTo determine the default parameters of HGT on different data types,\nwe performed a grid-search test on HGT parameters, including the pair\nof number of embeddings and number of heads (91/13, 104/13, 112/16,\nand 128/16), learning rate (0.0001, 0.001, and 0.01), and training\nepochs (50, 75, and 100). Altogether, 36 parameter combinations were\ntested. For each of the three data types, the HGT parameter training\nwere performed on three benchmark data, and the default parameter\ncombination was selected based on the highest median score (ARI for\nmultiple scRNA-seq data and CITE-seq data with benchmark labels and\nAWS for scRNA-ATAC-seq data without benchmark labels) of the three\ndatasets.\nTo assess the performance of DeepMAPS alongside other pro-\nposed scMulti-omics benchmark tools, we compared DeepMAPS with\nSeurat (v3.2.3 and v4.0,https://github.com/satijalab/seurat), MOFA +\n(v1.0.0, https://github.com/bioFAM/MOFA2), Harmony (v0.1,https://\ngithub.com/immunogenomics/harmony), TotalVI (v0.10.0, https://\ngithub.com/YosefLab/scvi-tools), and GLUE (v0.3.2, https://github.\ncom/gao-lab/GLUE). Because of the integration capability for differ-\nent data types, DeepMAPS was compared with Seurat v 3.2.3 and\nHarmony on multiple scRNA-seq data, with Seurat v4.0.0, MOFA+, and\nTotalVI on CITE-seq data, and with Seurat v4.0.0, MOFA+, and GLUE on\nscRNA-ATAC-seq data. For each benchmarking tool, grid-search tests\nwere also applied to a combination of parameters, such as the number\nof dimensions for cell clustering and clustering resolution.\nThe default HGT parameter combination selected for each data\ntype was then applied to additional datasets (one multiple scRNA-seq,\none CITE-seq, and three scRNA-ATAC-seq data) for independent tests.\nAll benchmarking tools use their default parameters.\nTo showcase the rationale for selecting integrative methods\nand cell clustering methods in DeepMAPS, we evaluated the cell\nclustering performances by replacing the methods with several\nothers. Speciﬁcally, for data integration, we replaced the CCA\nmethod with Harmony integration(multiple scRNA-seq), replaced\nthe CLR method with Seurat weighted nearest neighbor method\n(CITE-seq), and replaced the velocity-weighted method with Seurat\nweighted nearest neighbor method and without using velocity\n(scRNA-ATAC-seq). For the cell clustering method, we replaced\nL o u v a i nc l u s t e r i n gw i t hL e i d e na n dt h es m a r tl o c a lm o v i n g( S L M )\nmethod. We also compared the inﬂuence of clustering resolution\n(use 0.4, 0.8, 1.2, and 1.6) to the cell clustering results in Deep-\nMAPS. Each comparison was performed on all 36 parameter com-\nbinations as used in the grid-search test. For DeepMAPS without\nv e l o c i t y ,w es i m p l ya d du pt h eg e n ee x p r e s s i o nm a t r i xf r o ms c R N A -\nseq data and the gene potential activity matrix derived from\nscATAC-seq data, considering the balance weight introduced by\nvelocity for genej in celli as 1.\nAdjusted rand index (ARI). ARI is used to compute similarities by\nconsidering all pairs of the samples assigned in clusters in the current\nand previous clustering adjusted by random permutation. A con-\ntingency table is built to summarize the overlaps between the two cell\nlabel lists with b elements (cells) to calculate the ARI. Each entry\ndenotes the number of objects in common between the two label lists.\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 14\nThe ARI can be calculated as:\nARI =\nJa + Jb\nC2\nn\n/C0 E Ja + Jb\nC2\nn\nhi\nmax Ja + Jb\nC2\nn\n/C16/C17\n/C0 E Ja + Jb\nC2\nn\nhi ð25Þ\nWhere E :½/C138 is the expectation,Ja is the number of cells assigned to the\nsame cell cluster as benchmark labels;Jb is the number of cells assigned\nto different cell clusters as benchmark labels;C2\nn is the combination of\nselecting two cells from the total ofn cells in the cluster.\nAverage Silhouette Width (ASW). Unlike ARI, which requires known\nground truth labels, a silhouette score refers to a method of inter-\npretation and validation of consistency within clusters of data. The\nsilhouette weight indicates how similar an object is to its cluster\n(cohesion) compared to other clusters (separation). The silhouette\nwidth ranges from−1 to +1, where a high value indicates that the object\nis well-matched to its cluster. The silhouette score sil(j) can be calcu-\nlated by:\nsil jðÞ =\n∣njðÞ /C0 mjðÞ ∣\nmax mjðÞ , njðÞ\n/C8/C9 ð26Þ\nwheremðjÞ is the average distance between a cellj and all other cells in\nthe same cluster, andnjðÞ is the average distance ofi to all cells in the\nnearest cluster to whichj does not belong. We calculated the mean\nsilhouette score of all cells as the ASW to represent the silhouette score\nof the dataset.\nCalinski-Harabasz index. The CH index calculates the ratio of the sum\nof between-clusters dispersion and inter-cluster dispersion for all\nclusters. A higher CH index indicates a better performance. For a set of\ndata E of sizen\nE with k clusters, the CH index is deﬁned as:\nCH = tB k\n/C0/C1\ntW k\n/C0/C1× nE /C0 k\nk /C0 1 ð27Þ\nWk =\nXk\nq =1\nX\nx2Cq\nx /C0 cq\n/C16/C17\nðx /C0 cqÞT ð28Þ\nBk =\nXk\nq =1\nnqðcq /C0 cE Þðcq /C0 cqÞT ð29Þ\nwhere tB k\n/C0/C1\nis the trace of the between group dispersion matrix, and\ntW k\n/C0/C1\nis the trace of the within-cluster dispersion matrix.Cq is the set\nof points in clusterq, cq is the center of clusterq, cE is the center of E,\nand nq is the number of points in clusterq. T refers to the matrix\ntransformation.\nDavies-Bouldin index. The DB index signiﬁes the average‘similarity’\nbetween clusters, where the similarity is a measure that compares the\ndistance between clusters with the size of the clusters themselves. A\nlower DB index relates to a model with better separation between the\nclusters. For data withk clusters, i 2 k and j 2 k, the DB index is\ndeﬁned as:\nDB =\n1\nk\nXk\ni =1\nmax\ni≠j\nRij ð30Þ\nRij = si + sj\ndij\nð31Þ\nwhere si and sj are the average distance between each point within the\ncluster to the cluster centroid.dij is the distance of cluster centroids of\ni and j.\nGene association network evaluations.W ee v a l u a t e dt h ep e r f o r -\nmance of the gene association network identiﬁed in DeepMAPS by\ncomparing it with IRIS315 and a normal gene co-expression network\ninference using all genes. We calculated the closeness centrality and\neigenvector centrality for the network generated in each tool. The\nformulations are given below.\nCloseness centrality (CC). The closeness centrality (CC)\n76 of a vertex\nu is deﬁned by the inverse of the sum length of the shortest paths to all\nthe other verticesv in the undirected weighted graph. The formulation\nis deﬁned as:\nCC uðÞ = 1P\nv2V\ndw u,vðÞ ð32Þ\nwheredw u, vðÞ is the shortest weighted path betweenu and v.I ft h e r ei s\nno path between vertex u and v, the total number of vertices is used in\nthe formula instead of the path length. A higher CC indicates a node is\nmore centralized in the network, reﬂecting a more important role of\nthis gene in the network. The CC is calculated using igraph R package\nwith function igraph::betweenness. We take the average CC of all\nnodes in a network to represent the network CC.\nEigenvector centrality (EC). Eigenvector centrality (EC)\n77 scores cor-\nrespond to the values of theﬁrst eigenvector of the graph adjacency\nmatrix. The EC score ofu is deﬁned as:\nEC uðÞ = λ\nX\nv2G\nauvxv ð33Þ\nwhere λ is inverse of the eigenvalue of eigenvectorx = ðx1,x2, ... ,xnÞ,\nauv is the adjacent weighted matrix of undirect graphG. A node with a\nhigh eigenvector centrality score means that it is connected to many\nnodes which themselves have high scores. The EC is calculated using\nigraph R package with function igraph::evcent. We take the average EC\nof all nodes in a network to represent the network EC.\nEvaluations on GRN. For scRNA-ATAC-seq data, we compared cell-\ntype-speciﬁcG R N si n f e r r e df r o mD e e p M A P Sw i t h(i)I R I S 3a n dS C E N I C\non the scRNA-seq matrix, (ii) IRIS3 and SCENIC on GAS matrix, (iii)\nMAESTRO on scATAC-seq matrix, and (iv) MAESTRO on original\nscRNA-seq and scATAC-seq matrix. For each dataset comparison, we\nset the cell clusters used in the benchmarking tool the same as gen-\nerated in DeepMAPS to ensure fairness. GRNs generated from each\ntool were compared with three public functional databases, including\nReactome\n21, DoRothEA22,a n dT R R U S Tv 223. Only human sample data-\nsets were used for comparison as these databases are all human-\nrelated. We performed hypergeometric tests for GRN resulting in each\ntool to each database and compared the precision, recall, and F1 score\nof enriched GRNs and functional terminologies.\nCell cluster leave-out test\nFor a benchmark dataset with a real cell type label, we removed all cells\nin one cell type and ran DeepMAPS. Then, we traversed all cell types\n(one at a time) to evaluate the robustness of ARI. We removed cells in\npredicted cell clusters from DeepMAPS and other benchmark tools for\ndata without benchmark labels.\nDeepMAPS server construction\nDeepMAPS is hosted on an HPE XL675d RHEL system with 2 × 128-\ncore AMD EPYC 7H12 CPU, 64GB RAM, and 2×NVIDIA A100 40GB\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 15\nGPU. The backend server is written in TypeScript using the NestJs\nframework. Auth0 is used as an independent module to provide\nuser authentication and authorization services. Redis houses a\nqueue of all pending analysis jobs. There are two types of jobs in\nDeepMAPS: The stateful jobs are handled by the Plumber R pack-\nage to provide real-time interactive analysis; and the stateless jobs,\nsuch as CPU-bound bioinformatics pipelines and GPU training\ntasks that could take a very long time, are constructed\nusing Nextﬂow. All running jobs are orchestrated using Nomad,\nallowing each job to be assigned with proper cores and storage and\nkeeping jobs scalable based on the server load. The job results are\ndeposited into a MySQL database. The front-end is built with\nNUXT, Vuetify as the UI library, Apache ECharts, and Cytoscape.js\nfor data visualization. The frontend server and backend server are\ncommunicated using REST API.\nReporting summary\nFurther information on research design is available in the Nature\nPortfolio Reporting Summary linked to this article.\nData availability\nAll data used in this study are from public domain. The raw data are\ndownloaded from the GEO database with the accession numbers for:\nhuman pancreatic islets scRNA-seq dataGSE84133 and healthy bone\nmarrow mononuclear cell CITE-seq data:GSE194122. The following\ndatasets were obtained fromﬁgshare: the human pancreas scRNA-seq\ndata [https://ﬁgshare.com/articles/dataset/Benchmarking_atlas-level_\ndata_integration_in_single-cell_genomics_-_integration_task_datasets_\nImmune_and_pancreas_/12420968/8], the mouse bladder from the\nTabula Muris scRNA-seq data [https://doi.org/10.6084/m9.ﬁgshare.\n5968960.v1], and the human lung adenocarcinoma PBMC CITE-seq\ndata [https://doi.org/10.6084/m9.ﬁgshare.c.5018987.v1]. The follow-\ning paired scRNA-seq and scATAC-seq datasets were obtained from the\n10X Genomics website: 3k healthy PBMC data [ https://www.\n10xgenomics.com/resources/datasets/pbmc-from-a-healthy-donor-\nno-cell-sorting-3-k-1-standard-2-0-0], 10k healthy PBMC data [https://\nwww.10xgenomics.com/resources/datasets/pbmc-from-a-healthy-\ndonor-granulocytes-removed-through-cell-sorting-10-k-1-standard-2-\n0-0], frozen human healthy brain data [https://www.10xgenomics.\ncom/resources/datasets/frozen-human-healthy-brain-tissue-3-k-1-\nstandard-2-0-0], 10k human PBMC data [https://www.10xgenomics.\ncom/resources/datasets/10-k-human-pbm-cs-multiome-v-1-0-\nchromium-x-1-standard-2-0-0], healthy PBMC data [ https://www.\n10xgenomics.com/resources/datasets/pbmc-from-a-healthy-donor-\ngranulocytes-removed-through-cell-sorting-3-k-1-standard-2-0-0],\nfresh embryonic data [ https://www.10xgenomics.com/resources/\ndatasets/fresh-embryonic-e-18-mouse-brain-5-k-1-standard-2-0-0], and\nlymph node data [https://www.10xgenomics.com/resources/datasets/\nfresh-frozen-lymph-node-with-b-cell-lymphoma-14-k-sorted-nuclei-1-\nstandard-2-0-0]. The scRNA-seq and scATAC-seq cancer cell line data\nwas downloaded from CNGB Nucleotide Sequence Archive with an\naccession code ofCNP0000213. All datasets are publicly available\nwithout restrictions. Details of data information can be found in Sup-\nplementary Data 1. Source data are provided with this paper.\nCode availability\nThe python source code of DeepMAPS Docker is freely available at\nhttps://github.com/OSU-BMBL/deepmapsand the DeepMAPS web-\nserver is freely available athttps://bmblx.bmi.osumc.edu/.T h es o u r c e\ncode is also available on Zenodo\n78.\nReferences\n1 . S t u a r t ,T .&S a t i j a ,R .I n t e g r a t i v es i n g l e - c e l la n a l y s i s .Nat. Rev. Genet.\n20,2 5 7–272 (2019).\n2 . M a ,A . ,M c D e r m a i d ,A . ,X u ,J . ,C h a n g ,Y .&M a ,Q .I n t e g r a t i v e\nmethods and practical challenges for single-cell multi-omics.\nTrends Biotechnol.38,1 0 0 7–1022 (2020).\n3. Argelaguet, R., Cuomo, A. S. E., Stegle, O. & Marioni, J. C. Com-\nputational principles and challenges in single-cell data integration.\nNat. Biotechnol.39,1 2 0 2–1215 (2021).\n4. S Teichmann, M. E. Method of the year 2019: single-cell multimodal\nomics. Nat. Methods17, 1 (2020).\n5. Hao, Y. et al. Integrated analysis of multimodal single-cell data.Cell\n184,3 5 7 3–3587.e3529 (2021).\n6. Argelaguet, R. et al. MOFA+: a statistical framework for compre-\nhensive integration of multi-modal single-cell data.Genome Biol.\n21, 111 (2020).\n7. Korsunsky, I. et al. Fast, sensitive and accurate integration of single-\ncell data with Harmony.Nat. Methods16,1 2 8 9–1296 (2019).\n8. Gayoso, A. et al. Joint probabilistic modeling of single-cell multi-\nomic data with totalVI.Nat. Methods18,2 7 2–282 (2021).\n9. Li, Y. et al. Elucidation of biological networks across complex dis-\neases using single-cell omics.Trends Genet.36,9 5 1–966 (2020).\n10. Ma, Q. & Xu, D. Deep learning shapes single-cell data analysis.Nat.\nRev. Mol. Cell Biol.23,3 0 3–304 (2022).\n11. Wang, J. et al. scGNN is a novel graph neural network framework for\nsingle-cell RNA-Seq analyses.Nat. Commun.12, 1882 (2021).\n12. Hu, Z., Dong, Y., Wang, K. & Sun, Y. In Proceedings of The Web\nConference 2020 2704–2710 (Association for Computing Machin-\nery, Taipei, Taiwan; 2020).\n13. Wang, X. et al. In The World Wide Web Conference 2022–2032\n(Association for Computing Machinery, San Francisco, CA,\nUSA; 2019).\n14. Aibar, S. et al. SCENIC: single-cell regulatory network inference and\nclustering.Nat. Methods14,1 0 8 3–1086 (2017).\n15. Ma, A. et al. IRIS3: integrated cell-type-speciﬁc regulon inference\nserver from single-cell RNA-Seq.Nucleic Acids Res.48,\nW275–W286 (2020).\n16. Han, P., Gopalakrishnan, C., Yu, H. & Wang, E. Gene regulatory\nnetwork rewiring in the immune cells associated with cancer.\nGenes (Basel)8\n, 308 (2017).\n17. Gassner, E. The Steiner Forest Problem revisited.J. Discret. Algo-\nrithms 8,1 5 4–163 (2010).\n1 8 . B u t l e r ,A . ,H o f f m a n ,P . ,S m i b e r t ,P . ,P a p a l e x i ,E .&S a t i j a ,R .I n t e -\ngrating single-cell transcriptomic data across different conditions,\ntechnologies, and species.Nat. Biotechnol.36,4 1 1–420 (2018).\n1 9 . C a o ,Z . - J .&G a o ,G .M u l t i - o m i c ssingle-cell data integration and\nregulatory inference with graph-linked embedding.Nat. Biotechnol.\n40,1 4 5 8–1466 (2022).\n20. Iacono, G., Massoni-Badosa,R. & Heyn, H. Single-cell tran-\nscriptomics unveils gene regulatory network plasticity.Genome\nBiol. 20, 110 (2019).\n21. Joshi-Tope, G. et al. Reactome: a knowledgebase of biological\npathways.Nucleic Acids Res.33,D 4 2 8–D432 (2005).\n22. Garcia-Alonso, L., Holland, C. H., Ibrahim, M. M., Turei, D. & Saez-\nRodriguez, J. Benchmark and integration of resources for the esti-\nmation of human transcription factor activities.Genome Res.29,\n1363–1375 (2019).\n23. Han, H. et al. TRRUST v2: an expanded reference database of human\nand mouse transcriptional regulatory interactions.Nucleic Acids\nRes. 46,D 3 8 0–D386 (2018).\n24. Wang, C. et al. Integrative analyses of single-cell transcriptome and\nregulome using MAESTRO.Genome Biol.21, 198 (2020).\n25. Jin, S. et al. Inference and analysis of cell-cell communication using\nCellChat.Nat. Commun.12, 1088 (2021).\n26. Ampudia, J. et al. CD6-ALCAM signaling regulates multiple effec-\ntor/memory T cell functions.J. Immunol.204,\n150.113–150.113 (2020).\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 16\n27. Skonier, J. E. et al. Mutational analysis of the CD6 ligand binding\ndomain. Protein Eng. Des. Selection10, 943–947 (1997).\n2 8 . G i m f e r r e r ,I .e ta l .R e l e v a n c eo fC D 6 - m e d i a t e di n t e r a c t i o n si nTc e l l\nactivation and proliferation.J. Immunol. (Baltim., Md.: 1950)173,\n2262–2270 (2004).\n2 9 . J o h n s t o n ,R .J . ,L e e ,P .S . ,S t r o p ,P .&S m y t h ,M .J .C a n c e ri m m u -\nnotherapy and the nectin family.Annu. Rev. Cancer Biol.5,\n203–219 (2021).\n30. Li, X.-Y. et al. CD155 loss enhances tumor suppression via combined\nhost and tumor-intrinsic mechanisms.J. Clin. Invest.128,\n2613–2625 (2018).\n31. Gururajan, M. et al. Early growth response genes regulate B cell\ndevelopment, proliferation, and immune response.J. Immunol.\n(Baltim., Md.: 1950)181,4 5 9 0–4602 (2008).\n32. Oh, Y.-K., Jang, E., Paik, D.-J. & Youn, J. Early growth response-1\nplays a non-redundant role in thedifferentiation of B cells into\nplasma cells.Immune Netw.15,1 6 1–166 (2015).\n33. Brescia, P. et al. MEF2B instructs germinal center development and\nacts as an oncogene in B cell lymphomagenesis.Cancer Cell34,\n453–465.e459 (2018).\n34. Trøen, G. et al. Constitutive expression of the AP-1 transcription\nfactors c-jun, junD, junB, and c-fos and the marginal zone B-cell\ntranscription factor Notch2 in splenic marginal zone lymphoma.J.\nMol. Diagn.6,2 9 7–307 (2004).\n35. Sánchez-Beato, M. et al. Abnormal PcG protein expression in\nHodgkin’s lymphoma. Relation with E2F6 and NFkappaB transcrip-\ntion factors.J. Pathol.204,5 2 8–537 (2004).\n36. Saha, A., Robertson, E. S. & Goodrum, F. Mechanisms of B-cell\noncogenesis induced by Epstein-Barr virus.J. Virol.93,\ne00238–00219 (2019).\n37. Yachida, S. et al. Genomic sequencing identiﬁes ELF3 as a driver of\nampullary carcinoma.Cancer Cell29, 229–240 (2016).\n38. Wang, H. et al. Overexpression of ELF3 facilitates cell growth and\nmetastasis through PI3K/Akt and ERK signaling pathways in non-\nsmall cell lung cancer.Int. J. Biochem. Cell Biol.94,9 8–106 (2018).\n39. Zhang, J. et al. KLF16 affects the MYC signature and tumor growth in\nprostate cancer.Onco Targets Ther.\n13,1 3 0 3–1310 (2020).\n40. Ma, P. et al. KLF16 promotes proliferation in gastric cancer cells via\nregulating p21 and CDK4.Am. J. Transl. Res.9,3 0 2 7–3036 (2017).\n41. Mathas, S. et al. Aberrantly expressed c-Jun and JunB are a hallmark\nof Hodgkin lymphoma cells, stimulate proliferation and synergize\nwith NF-κB. EMBO J.21, 4104–4113 (2002).\n4 2 . E f e r l ,R .&W a g n e r ,E .F .A P - 1 :ad o u b l e - e d g e ds w o r di nt u m o r -\nigenesis.Nat. Rev. Cancer3,8 5 9–868 (2003).\n43. Nagel, D., Vincendeau, M., Eitelhuber, A. C. & Krappmann, D.\nMechanisms and consequences of constitutive NF-κB activation in\nB-cell lymphoid malignancies.Oncogene33,5 6 5 5–5665 (2014).\n44. Jost, P. J. & Ruland, J. R. Aberrant NF-κB signaling in lymphoma:\nmechanisms, consequences, and therapeutic implications.Blood\n109,2 7 0 0–2707 (2006).\n45. Garces de Los Fayos Alonso, I. et al. The role of activator protein-1\n(AP-1) family members in CD30-positive lymphomas.Cancers\n(Basel) 10,9 3( 2 0 1 8 ) .\n46. Crispino, J. D. & Horwitz, M. S. GATA factor mutations in hemato-\nlogic disease.Blood 129,2 1 0 3–2110 (2017).\n47. Shimizu, R., Engel, J. D. & Yamamoto, M. GATA1-related leukaemias.\nNat. Rev. Cancer8,2 7 9–287 (2008).\n48. Mosquera Orgueira, A. et al. Detection of new drivers of frequent\nB-cell lymphoid neoplasms using an integrated analysis of whole\ngenomes.PLoS ONE16,e 0 2 4 8 8 8 6( 2 0 2 1 ) .\n49. Blyth, K. et al. Runx1 promotes B-cell survival and lymphoma\ndevelopment.Blood Cells Mol. Dis.43,1 2–19 (2009).\n5 0 . M a c k a y ,F . ,S c h n e i d e r ,P . ,R e n n e r t ,P .&B r o w n i n g ,J .B A F FA N D\nAPRIL: a tutorial on B cell survival.Annu Rev. Immunol.21,\n231–264 (2003).\n51. Smulski, C. R. & Eibel, H. BAFF and BAFF-receptor in B cell selection\nand survival.Front. Immunol.9, 2285 (2018).\n52. Yang, S., Li, J. Y. & Xu, W. Role of BAFF/BAFF-R axis in B-cell non-\nHodgkin lymphoma.Crit. Rev. Oncol. Hematol.91, 113–122 (2014).\n53. He, B. et al. Lymphoma B cells evade apoptosis through the TNF\nfamily members BAFF/BLyS and APRIL.\nJ. Immunol. (Baltim., Md.:\n1950) 172,3 2 6 8–3279 (2004).\n54. Xia, X. Z. et al. TACI is a TRAF-interacting receptor for TALL-1, a\ntumor necrosis factor family member involved in B cell regulation.\nJ. Exp. Med192,1 3 7–143 (2000).\n55. Laâbi, Y., Egle, A. & Strasser, A. TNF cytokine family: more BAFF-ling\ncomplexities.Curr. Biol.11, R1013–R1016 (2001).\n56. Mackay, F. & Schneider, P. TACI, an enigmatic BAFF/APRIL receptor,\nwith new unappreciated biochemical and biological properties.\nCytokine Growth Factor Rev.19,2 6 3–276 (2008).\n57. Rihacek, M. et al. B-cell activating factor as a cancer biomarker and\nits implications in cancer-related Cachexia.Biomed. Res. Int.2015,\n792187–792187 (2015).\n58. Su, H., Chang, J., Xu, M., Sun, R. & Wang, J. CDK6 overexpression\nresulted from microRNA‑320d downregulation promotes cell pro-\nliferation in diffuse large B‑cell lymphoma.Oncol. Rep.42,\n321–327 (2019).\n5 9 . L e e ,C . ,H u a n g ,X . ,D iL i b e r t o ,M . ,M a r t i n ,P .&C h e n - K i a n g ,S .T a r -\ngeting CDK4/6 in mantle cell lymphoma.Ann. Lymphoma4,\n1( 2 0 2 0 ) .\n60. Otto, T. & Sicinski, P. Cell cycle proteins as promising targets in\ncancer therapy.Nat. Rev. Cancer17,9 3–115 (2017).\n61. Li, K. et al. cellxgene VIP unleashes full power of interactive visua-\nlization, plotting and analysis of scRNA-seq data in the scale of\nmillions of cells.bioRxiv, 2020.2008.2028.270652 (2020).\n6 2 . P e r e i r a ,W .e ta l .A s c - S e u r a t– Analytical single-cell Seurat-based\nweb application.bioRxiv, 2021.2003.2019.436196 (2021).\n6 3 . G a r d e u x ,V . ,D a v i d ,F .P .A . ,S h a j k o f c i ,A . ,S c h w a l i e ,P .C .&\nDeplancke, B. ASAP: a web-based platform for the analysis and\ninteractive visualization of single-cell RNA-seq data.Bioinformatics\n33,3 1 2 3–3125 (2017).\n64. Li, B. et al. Cumulus provides cloud-based data analysis for large-\nscale single-cell and single-nucleus RNA-seq.Nat. Methods17,\n793–798 (2020).\n65. Hillje, R., Pelicci, P. G. & Luzi, L. Cerebro: interactive visualization of\nscRNA-seq data.Bioinformatics36,2 3 1 1–2313 (2019).\n66. Prompsy, P. et al. Interactive analysis of single-cell epigenomic\nlandscapes with ChromSCape.Nat. Commun.11, 5702 (2020).\n6 7 . B o l i s e t t y ,M .T . ,S t i t z e l ,M .L .& Robson, P. CellView: Interactive\nexploration of high dimensional single cell RNA-seq data.bioRxiv,\n123810 (2017).\n68. Mohanraj, S. et al. CReSCENT: CanceR Single Cell ExpressioN\nToolkit.Nucleic Acids Res.48,W 3 7 2–W379 (2020).\n69. Patel, M. V. iS-CellR: a user-friendly tool for analyzing and visualiz-\ning single-cell RNA sequencing data.Bioinformatics34,\n4305–4306 (2018).\n70. Yousif, A., Drou, N., Rowe, J., Khalfan, M. & Gunsalus, K. C. NASQAR:\na web-based platform for high-throughput sequencing data ana-\nlysis and visualization.BMC Bioinforma.21, 267 (2020).\n71. Zhu, Q. et al. PIVOT: platform for interactive analysis and visuali-\nzation of transcriptomics data.BMC Bioinforma.19, 6 (2018).\n72. Innes, B. & Bader, G. scClustViz - Single-cell RNAseq cluster\nassessment and visualization.F1000Res. 7,I S C BC o m m\nJ-1522 (2018).\n73. Granja, J. M. et al. ArchR is a scalable software package for inte-\ngrative single-cell chromatin accessibility analysis.Nat. Genet.53,\n403–411 (2021).\n74. Wan, C. et al. LTMG: a novel statistical modeling of transcriptional\nexpression states in single-cell RNA-Seq data.Nucleic Acids Res.\n47, e111 (2019).\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 17\n7 5 . B e r g e n ,V . ,L a n g e ,M . ,P e i d l i ,S . ,W o l f ,F .A .&T h e i s ,F .J .G e n e r a l i z i n g\nRNA velocity to transient cell states through dynamical modeling.\nNat. Biotechnol.38,1 4 0 8–1414 (2020).\n7 6 . L i ,G .S . ,L i ,M . ,W a n g ,J .X . ,L i ,Y .H .&P a n ,Y .U n i t e dN e i g h b o r h o o d\nCloseness Centrality and Orthology for Predicting Essential.Pro-\nteins Ieee Acm T Comput Bi17,1 4 5 1–1458 (2020).\n77. Parisutham, N. & Rethnasamy, N. Eigenvector centrality based\nalgorithm forﬁnding a maximal common connected vertex\ninduced molecular substructure of two chemical graphs.J. Mol.\nStruct. 1244,1 3 0 9 8 0( 2 0 2 1 ) .\n78. Ma, A. et al. Single-cell biological network inference using a het-\nerogeneous graph transformer.Zenodo https://doi.org/10.5281/\nzenodo.7559037(2023).\nAcknowledgements\nThis work was supported by awards R01-GM131399 (Q.M.), R35-\nGM126985 (D.X.), and U54-AG075931 (Q.M.) from the National Institutes\nof Health. The work was also supported by the award NSF1945971 (Q.M.)\nfrom the National Science Foundation. This work was supported by the\nPelotonia Institute of Immuno-Oncology (PIIO). The content is solely the\nresponsibility of the authors and does not necessarily represent the\nofﬁcial views of the PIIO. In addition, we thank Dr. Fei He from the\nNortheast Normal University for his valued suggestions in framework\nconstruction and data testing.\nAuthor contributions\nQ.M., B.L., and D.X. conceived the basic idea and designed the frame-\nwork. X.W. wrote the backbone code of DeepMAPS. C.W. and H.C. built\nthe backend and front-end servers. S.G. designed the interactiveﬁgures\non the server. Y.Liu carried out RNA velocity calculations. Y.Li designed\nthe SFP model for gene module predictions. A.M, X.W., and J.L. carried\nout benchmark experiments. X.W., Y.C., and B.L. performed robustness\ntests. A.M., J.L., X.W., G.X., Z.L. and T.X. carried out the case study. J.W.,\nD.W., Y.J., J.L., and L.S. performed tool optimizations. A.M. and Q.M. led\nthe ﬁgure design and manuscript writing. All authors participated in the\ninterpretation and writing of the manuscript.\nCompeting interests\nThe authors declare no competing interests.\nAdditional information\nSupplementary informationThe online version contains\nsupplementary material available at\nhttps://doi.org/10.1038/s41467-023-36559-0.\nCorrespondenceand requests for materials should be addressed to\nBingqiang Liu, Dong Xu or Qin Ma.\nPeer review informationNature Communicationsthanks Saugato Rah-\nman Dhruba and the other anonymous reviewer(s) for their contribution\nto the peer review of this work. Peer review reports are available.\nReprints and permissions informationis available at\nhttp://www.nature.com/reprints\nPublisher’s noteSpringer Nature remains neutral with regard to jur-\nisdictional claims in published maps and institutional afﬁliations.\nOpen AccessThis article is licensed under a Creative Commons\nAttribution 4.0 International License, which permits use, sharing,\nadaptation, distribution and reproduction in any medium or format, as\nlong as you give appropriate credit to the original author(s) and the\nsource, provide a link to the Creative Commons license, and indicate if\nchanges were made. The images or other third party material in this\narticle are included in the article’s Creative Commons license, unless\nindicated otherwise in a credit line to the material. If material is not\nincluded in the article’s Creative Commons license and your intended\nuse is not permitted by statutory regulation or exceeds the permitted\nuse, you will need to obtain permission directly from the copyright\nholder. To view a copy of this license, visithttp://creativecommons.org/\nlicenses/by/4.0/.\n© The Author(s) 2023\nArticle https://doi.org/10.1038/s41467-023-36559-0\nNature Communications|          (2023) 14:964 18",
  "topic": "Inference",
  "concepts": [
    {
      "name": "Inference",
      "score": 0.707544207572937
    },
    {
      "name": "Computer science",
      "score": 0.6534705758094788
    },
    {
      "name": "Graph",
      "score": 0.4903014004230499
    },
    {
      "name": "Biological network",
      "score": 0.4566972553730011
    },
    {
      "name": "Transformer",
      "score": 0.4436004161834717
    },
    {
      "name": "Computational biology",
      "score": 0.4369819462299347
    },
    {
      "name": "Theoretical computer science",
      "score": 0.27669474482536316
    },
    {
      "name": "Artificial intelligence",
      "score": 0.22928684949874878
    },
    {
      "name": "Biology",
      "score": 0.18171441555023193
    },
    {
      "name": "Physics",
      "score": 0.08173522353172302
    },
    {
      "name": "Voltage",
      "score": 0.0
    },
    {
      "name": "Quantum mechanics",
      "score": 0.0
    }
  ],
  "institutions": [
    {
      "id": "https://openalex.org/I52357470",
      "name": "The Ohio State University",
      "country": "US"
    },
    {
      "id": "https://openalex.org/I154099455",
      "name": "Shandong University",
      "country": "CN"
    },
    {
      "id": "https://openalex.org/I2799885155",
      "name": "The Ohio State University Comprehensive Cancer Center – Arthur G. James Cancer Hospital and Richard J. Solove Research Institute",
      "country": "US"
    },
    {
      "id": "https://openalex.org/I76835614",
      "name": "University of Missouri",
      "country": "US"
    }
  ],
  "cited_by": 143
}