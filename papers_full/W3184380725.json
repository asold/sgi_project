{
  "title": "Learning Attributed Graph Representations with Communicative Message Passing Transformer",
  "url": "https://openalex.org/W3184380725",
  "year": 2022,
  "authors": [
    {
      "id": "https://openalex.org/A1657766396",
      "name": "Chen Jianwen",
      "affiliations": []
    },
    {
      "id": "https://openalex.org/A4281242655",
      "name": "Zheng, Shuangjia",
      "affiliations": []
    },
    {
      "id": "https://openalex.org/A1963820444",
      "name": "Song Ying",
      "affiliations": []
    },
    {
      "id": "https://openalex.org/A4281242654",
      "name": "Rao, Jiahua",
      "affiliations": []
    },
    {
      "id": "https://openalex.org/A2227551622",
      "name": "Yang Yuedong",
      "affiliations": []
    }
  ],
  "references": [
    "https://openalex.org/W2766453196",
    "https://openalex.org/W2991425343",
    "https://openalex.org/W2986232138",
    "https://openalex.org/W2173027866",
    "https://openalex.org/W2962876364",
    "https://openalex.org/W2972693922",
    "https://openalex.org/W2964051675",
    "https://openalex.org/W2290847742",
    "https://openalex.org/W2594183968",
    "https://openalex.org/W3000478925",
    "https://openalex.org/W2968734407",
    "https://openalex.org/W2785720803",
    "https://openalex.org/W3007488165",
    "https://openalex.org/W2947722296",
    "https://openalex.org/W1738019091",
    "https://openalex.org/W3034772996",
    "https://openalex.org/W3034516664"
  ],
  "abstract": "Constructing appropriate representations of molecules lies at the core of numerous tasks such as material science, chemistry and drug designs. Recent researches abstract molecules as attributed graphs and employ graph neural networks (GNN) for molecular representation learning, which have made remarkable achievements in molecular graph modeling. Albeit powerful, current models either are based on local aggregation operations and thus miss higher-order graph properties or focus on only node information without fully using the edge information. For this sake, we propose a Communicative Message Passing Transformer (CoMPT) neural network to improve the molecular graph representation by reinforcing message interactions between nodes and edges based on the Transformer architecture. Unlike the previous transformer-style GNNs that treat molecules as fully connected graphs, we introduce a message diffusion mechanism to leverage the graph connectivity inductive bias and reduce the message enrichment explosion. Extensive experiments demonstrated that the proposed model obtained superior performances (around 4$\\%$ on average) against state-of-the-art baselines on seven chemical property datasets (graph-level tasks) and two chemical shift datasets (node-level tasks). Further visualization studies also indicated a better representation capacity achieved by our model.",
  "full_text": "Proceedings of the Thirtieth International Joint Conference on Artiﬁcial Intelligence (IJCAI-21)\nLearning Attributed Graph Representations with Communicative Message\nPassing Transformer\nJianwen Chen1†, Shuangjia Zheng1,4†∗, Ying Song2 , Jiahua Rao1,4 and Yuedong Yang1,3∗\n1School of Computer Science and Engineering, Sun Yat-sen University\n2School of Systems Science and Engineering, Sun Yat-sen University\n3Key Laboratory of Machine Intelligence and Advanced Computing, Sun Yat-sen University\n4Galixir Technologies Ltd, Beijing\n{chenjw48, zhengshj9, songy75, raojh6}@mail2.sysu.edu.cn, yangyd25@mail.sysu.edu.cn\nAbstract\nConstructing appropriate representations of\nmolecules lies at the core of numerous tasks such\nas material science, chemistry and drug designs.\nRecent researches abstract molecules as attributed\ngraphs and employ graph neural networks (GNN)\nfor molecular representation learning, which have\nmade remarkable achievements in molecular graph\nmodeling. Albeit powerful, current models either\nare based on local aggregation operations and thus\nmiss higher-order graph properties or focus on\nonly node information without fully using the edge\ninformation. For this sake, we propose a Commu-\nnicative Message Passing Transformer (CoMPT)\nneural network to improve the molecular graph\nrepresentation by reinforcing message interactions\nbetween nodes and edges based on the Transformer\narchitecture. Unlike the previous transformer-style\nGNNs that treat molecules as fully connected\ngraphs, we introduce a message diffusion mecha-\nnism to leverage the graph connectivity inductive\nbias and reduce the message enrichment explosion.\nExtensive experiments demonstrated that the\nproposed model obtained superior performances\n(around 4 % on average) against state-of-the-art\nbaselines on seven chemical property datasets\n(graph-level tasks) and two chemical shift datasets\n(node-level tasks). Further visualization studies\nalso indicated a better representation capacity\nachieved by our model.\n1 Introduction\nAccurate characterization of molecular properties remains\nlargely an open challenge, and its solution may unlock a\nwidespread use of deep learning in the drug discovery indus-\ntry [Wu et al., 2018]. Traditionally, this has involved trans-\nlating a molecule m to a dense feature vector with a repre-\nsentation function, h= g(m), and then applying a variety of\n†These two authors contributed equally.\n*Corresponding authors.\n‡https://github.com/jcchan23/CoMPT\ntechniques to predict the targeted property based on the rep-\nresentation by y= f(h).\nEarly predictive modeling methods such as quantitative\nstructure-property relationships (QSPR) have been performed\nbased on ﬁxed representations such as expert-crafted physico-\nchemical descriptors and molecular ﬁngerprints [Rogers and\nHahn, 2010 ]. However, descriptor-based methods presume\nthat all target property-related information is covered by the\nchosen descriptor set, limiting the capability for a model to\nmake problem-speciﬁc decisions.\nMore naturally, a molecular structure can be abstracted as\na topological graph with attributed nodes and edges, where\nnode features correspond to atom properties like atomic iden-\ntity and degree, edge features correspond to bond properties,\nlike bond type and aromaticity. In this sense, graph repre-\nsentation models, especially Graph Neural Networks (GNN),\ncan be intuitively introduced to learn the representations of\nmolecules. Generally, the procedure of GNN framework\ncan be summarized in three main steps: (1) Initialization\nstep, where nodes are initialized with their initial attributes or\nstructural features; (2) Message Passing step, where the fea-\ntures at each node are transmitted from its neighbors across\nthe molecular graph into a message vector; (3) Read-out\nstep, where the node messages are aggregated or pooled into\na ﬁxed-length feature vector. Under the above framework,\nmany GNN architectures have been proposed for effective\ngraph representation learning, that achieve promising results\nin many property prediction tasks [Duvenaud et al. , 2015;\nYang et al., 2019; Song et al., 2020].\nDespite the fruitful progress, several issues still impede\nthe performance of the current GNN in the molecular graph.\nFirst, common graph convolutional operations aggregate only\nlocal information and suffer from the suspended animation\nproblem when stacking excessive GNN layers [Zhang and\nMeng, 2019], so these models are naturally difﬁcult to learn\nlong-range dependencies and the global chemical environ-\nment of each atom. Second, main-stream GNN and its vari-\nants mainly focus on obtaining effective nodes embedding\nbut weaken the information carried by edges that is also im-\nportant for informative graph representations [Shang et al.,\n2018]. Meanwhile, the node representations obtained by such\ndeep models tend to be over-smoothed and hard to distinguish\n[Li et al., 2018]. Such issues greatly hinder the applications\nof GNNs for molecular representation learning tasks.\narXiv:2107.08773v2  [cs.LG]  28 Jul 2021\nProceedings of the Thirtieth International Joint Conference on Artiﬁcial Intelligence (IJCAI-21)\nTo address the above problems, many efforts have been\nmade from different directions. On the one hand, with\nthe emerging of Transformer [Vaswani et al. , 2017 ] in se-\nquence modeling, several Transformer-style GNNs [Chen et\nal., 2019; Maziarka et al. , 2020 ] have been introduced to\nlearn the long-range dependencies in graph-structured data.\nThese methods can be viewed as a variant of the Graph At-\ntention Network (GAT) [Veliˇckovi´c et al., 2017 ] on a fully\nconnected graph constructed by all atoms, which ignore the\ngraph connectivity inductive bias. As a result, they perform\npoorly in the tasks where graph topology plays an important\nrule. On the other hand, the directed message passing neu-\nral network [Yang et al., 2019] and its variants [Song et al.,\n2020] have been proposed to transmit messages through di-\nrected edges rather than vertices. Such methods make use of\nthe edge information explicitly and avoid unnecessary loops\nin the message passing trajectory, but they still cannot deal\nwith the long-range dependencies.\nBased on these observations, we propose a Communica-\ntive Message Passing Transformer (CoMPT) neural network\nfor molecular representation learning. In contrast to the previ-\nous Transformer-style GNNs that emphasize the node infor-\nmation, CoMPT invokes a communicative message-passing\nparadigm by strengthening the message interactions between\nedges and nodes. In our framework, both the edge and node\nembeddings are updated during the training process. Besides,\nwe reﬁne the message passing process by using the topolog-\nical connection matrix with a diffusion mechanism to reduce\nthe message enrichment explosion. By selectively propagat-\ning information within a molecular graph, CoMPT is able to\nextract more expressive representation for down-stream tasks.\nThe main contributions of this work include:\n• We propose a novel communicative message passing\ntransformer, namely CoMPT, that explicitly captures the\natom and bond information of molecular graphes and in-\ncorporates both local and global structural information.\n• Our model includes an elegant way to fuse topology\nconnection matrix using the message diffusion mech-\nanism inspired by the thermal diffusion phenomenon,\nwhich was further demonstrated to alleviate the over-\nsmoothing problem.\n• Numerical experiments are conducted on both graph-\nlevel and node-level public datasets to demonstrate the\neffectiveness of our method. CoMPT surpasses the state-\nof-the art models on all nine tasks by up-to 4% improve-\nment in the average performance.\n2 Related Work\nMolecular representation learning. One of the most pop-\nular representations of molecules is the ﬁxed representations\nthrough chemical ﬁngerprints, such as Extended Connectiv-\nity Fingerprints (ECFP) [Rogers and Hahn, 2010] and chemi-\ncal descriptors. The heuristics integrated in descriptor gener-\nation algorithms typically embed high-level chemistry prin-\nciples, attempting to maximize the information content of\nthe resulting feature vectors. While these methods can be\nclearly successful, they always feature a trade-off by em-\nphasizing certain molecular features, while neglecting oth-\ners. The selections of features are hard-coded in the algo-\nrithm and not amenable to problem-speciﬁc tuning. Recent\nworks started to explore the molecular graph representation.\nEarly studies learned to only encode the node features [Du-\nvenaud et al., 2015 ] without considering bond information.\nTo gain supplementary information from edges, [Kearnes et\nal., 2016 ] proposed to utilize attributes of both atoms and\nbonds, and [Gilmer et al., 2017] summarized it into a MPNN\nframework. Though a few more studies used the informa-\ntion of the edges through network modules such as the edge\nmemory module [Withnall et al., 2020], these models were\nmainly built upon the node-based MPNN and thus still suf-\nfered from the information redundancy during message ag-\ngregations. DMPNN [Yang et al., 2019] was introduced as\nan alternative as it abstracted the molecular graph as an edge-\noriented directed graph, avoiding the unnecessary loops in\nmessage passing procedure. CMPNN [Song et al., 2020] fur-\nther extend this work by strengthening the message interac-\ntions between nodes and edges through a communicative ker-\nnel. Our work is closely related to CMPNN, while our model\nbuilt on Transformer is more elegant to capture long-range\ndependencies and structural variety.\nTransformer-style graph neural network. Several at-\ntempts have been made to integrate transformer and graph\nneural network. [Chen et al. , 2019 ] introduced the Path-\nAugmented Graph Transformer Networks to explicitly take\naccount for longer-range dependencies in molecular graph.\nOne closely related work is [Maziarka et al., 2020 ], which\nproposed a Molecule Attention Transformer by augmenting\nthe attention mechanism in Transformer using inter-atomic\ndistances and the molecular graph structure. Another work\nworth to note is GROVER [Rong et al., 2020 ], which pro-\nvided a self-supervised pre-trained transformer-style message\npassing neural network for molecular representation learn-\ning. While our model also builds on Transformer [Vaswani\net al., 2017] to encode graphs, we contribute new techniques\nto leverage the graph connectivity inductive bias.\n3 Methods\nIn this section, we ﬁrst brieﬂy review basic concepts of the\nTransformer model [Vaswani et al., 2017]. Then, we focus\non our contributions, describing our alternative in the Trans-\nformer encoder framework that uses node-edge message in-\nteraction module instead of the self-attention mechanism to\npass the message and learn expressive representations for at-\ntributed molecular graphs. Finally, we introduce a message\ndiffusion mechanism for leveraging the graph connectivity in-\nductive bias and reducing the message enrichment explosion.\n3.1 Preliminary\nNotation and problem deﬁnition. A molecular structure\ncan be considered as an attributed graph G = (V,E), where\n|V|= ndenotes a set of natoms (nodes) and |E|= mde-\nnotes a set of mbonds (edges). Nv is utilized to denote the\nset of node v’s neighbors. For each node and edge, we use\nfnode and fedge represents the feature dimensions, respec-\ntively. Following [Yang et al., 2019 ] that passing message\nProceedings of the Thirtieth International Joint Conference on Artiﬁcial Intelligence (IJCAI-21)\nMessage\nUpdate\nNorm\nMessage\nInteract\nNorm\nNorm\nMultihead\nAttention\nNorm\nNode\nUpdate\nMessage\nAggregate\nNorm\nAttention\nUpdate\nNorm\nFeed\nForward\nMPNN Transformer CoMPT\nNode Attribute Edge Attribute\n⊕ ⊕\n⊕\n⊕\n⊕⊕\n⊕ Feed\nForward\nFeed\nForward\nFigure 1: Comparing message passing procedure among MPNN\n(left), Transformer (middle) and CoMPT (right).\nwith directed edges, we treat molecular structures as directed\ngraphs to avoid messages being passed along any unneces-\nsary loops in the aggregation procedure. As such, we use\nxv ∈Rfnode to represent the initial features of node v, and\neuv ∈Rfedge are the initial features of the edge (u,v) with\ndirection u →v. X ∈Rn×fnode and E ∈Rn×n×fedge are\nthe matrices form for all nodes and edges. Besides, there are\ngenerally two categories of supervised tasks in the molecular\ngraph learning problems: i) Graph classiﬁcation/regression,\nwhere a set of molecular graphs {G1,...,G N}and their la-\nbels/targets {y1,...,y N}are given, and the task is to pre-\ndict the label/target of a new graph. ii) Node classiﬁca-\ntion/regression, where each node v in multiple graphs has a\nlabel/target yv, and the task is to predict the labels/targets of\nnodes in the unseen graphs.\nAttention mechanism. Our CoMPT model are built on the\ntransformer encoder framework, in which the attention mod-\nule is the main building block. The usual implementation of\nthe attention module is the dot product self-attention, which\ntakes inputs with a set of queries, keys, and values (q,k,v )\nthat are projected from hidden node features h(X). Then\nit computes the dot product of the query with all keys and\napplies a softmax function to obtain weights on the values.\nBy stacking the set of (q,k,v ) s into matrices (Q,K,V ),\nit allows highly optimized matrix multiplication operations.\nSpeciﬁcally, the outputs can be formulated as:\n{ [Q,K,V ] =h(X)[WQ,WK,WV]\nAttention(Q,K,V ) =softmax(QKT/\n√\nd)V (1)\nwhere d is the dimension of q and k. Furthermore, we fo-\ncus on the multi-head attention, where l attention layers are\nstacked together. The output matrix can be extended as,\n{ Multihead(Q, K, V) =Cat(head1, . . . , headl)WO\nheadi = Attention(h(X)WQ\ni , h(X)WK\ni , h(X)WV\ni ) (2)\nwhere WQ\ni ,WK\ni ,WV\ni are the projection matrices of head i.\n3.2 The Framework of CoMPT\nEncoding for node position and edge direction. Com-\npared to the Transformer encoder that only takes node at-\ntributes, our CoMPT takes three inputs: node features X,\nedge features E, and the topology connection matrix A ∈\nRn×n that is computed by using the length of the shortest\npath between any two nodes. Since the initial node and edge\nfeatures (more details are listed in the Appendix) do not in-\nvolve information related to the node position and the edge\ndirection, we need to add annotations explicitly with these\nfeatures before being fed into the CoMPT model. Speciﬁ-\ncally, for any node vi(i = 1,2,...,n ) and its correspond-\ning initial feature xi, we train a learnable position embedding\nvector posi according to the atomic index of the node, and\nthen add the initial features to get the hidden features, which\ncan be formulated as:\nh(xi) =node_embedding(xi) +posi (3)\nwhere node_embedding() projects the initial feature to the\ncorresponding dimension. For any directed edge euv, we fol-\nlowed the previous method in [Song et al., 2020] by adding\nthe source node feature to the initial feature. It could be for-\nmulated as:\nh(euv) =edge_embedding(euv) +h(xu) (4)\nwhere edge_embedding() also projects the initial feature to\nthe corresponding dimension. For convenience, we set the\nsame dimension f for all hidden features.\nNode-Edge message interaction module. The key idea be-\nhind CoMPT is that we use hidden node features h(X) and\nhidden edge features h(E) to compute a message interaction\nscores M, which replaces the self-attention scores in the orig-\ninal encoder layer. Speciﬁcally, three matrices Q,K,V are\nﬁrstly calculated by the formula:{\n[Q,V ] =h(X)[WQ,WV]\nK = h(E)WK (5)\nwhere WQ,WK,WV are the projection matrices. The mes-\nsage interaction matrix T is generated by the inner product:\nT = matmul(Q,K.tranpose(−2,−1)) (6)\nor equivalently in each position\nT[i,u,v ] =matmul(qi,kuv) (7)\nwhere qi and kuv denote the hidden vector of node iand di-\nrected edge (u,v), respectively. The intuition behind this ten-\nsor product is straight-forward: we compute the scalar prod-\nuct between each node and edge in order to generate the struc-\ntural message related to the molecule for the ﬁnal prediction.\nSubsequently, a selection step is applied to the message inter-\naction matrix T to preserve the molecular graph connectiv-\nity. Here, we select three types of matrices according to the\nnode’s neighbors: the node interacts with its outgoing edges\n(Mo), incoming edges ( Mi) and the self-loop edge ( Md).\nFor convenience, the generation and the selection step could\nbe merged by einsum operation with the formula below:\n{ Mo = einsumnf,nmf→nm(Q,K)\nMi = einsumnf,mnf→nm(Q,K)\nMd = diag(Mo) =diag(Mi)\n(8)\nAfter computing three matrices, we normalize them to sum up\nto 1.0 in each row with the softmax function σ, and compute\nthe ﬁnal message by:\nM = σ(Mo) +σ(Mi) −σ(Md) (9)\nProceedings of the Thirtieth International Joint Conference on Artiﬁcial Intelligence (IJCAI-21)\nThis operation eliminates the double-counted self-loop mes-\nsage and avoids the information explosion. This ﬁnal mes-\nsage is further utilized to update the node hidden features\nh(X) and edge hidden features h(E) in each encoder layer.\nFurthermore, in the situation of multi-head attention, similar\nto the original transformer framework, we also stack all lat-\ntention blocks at the end of each layer.\nResidual message update module. In the original trans-\nformer encoder framework, the self-attention scores are uti-\nlized to compute the weighted sum of vectors for each node,\nwhich could be regarded as an updated operation that is ap-\nplied to all nodes. In contrast, we utilize the message inter-\naction scores M to update the node hidden features h(X).\nBesides, inspired by [Song et al., 2020], the edge hidden fea-\ntures are also updated according to the rich information that\ncomes from M. The update operation is concluded as:\n{\nh(X) =matmul(M,V )\nh(E) =M ⊙K (10)\nwhere ⊙ denotes the element-wise operation. Besides,\nCoMPT model has multiple stacked layers, where each en-\ncoder layer consists of a multi-head message interaction mod-\nule, message update module and a position-wise forward\nmodule. To make the training step more stable, we adopt\nthe post layer norm module [Xiong et al., 2020] before get-\nting into each module. Furthermore, residual connections be-\ntween any two encoder layers are added for reducing the van-\nishing of the gradient, which can be formulated as:\n{\nhk+1(X) =hk(X) +Encoder(hk(X),hk(E))\nhk+1(E) =hk(E) +Encoder(hk(X),hk(E)) (11)\nwhere k represents the index of the encoder layer,\nEncoder(·) denotes the whole encoder layer with the vari-\nous modules mentioned above.\n3.3 Message Diffusion and Global Pooling\nThe key to accurately predict the properties on the graph-\nlevel/node-level tasks is how to keep the message inter-\nacting correctly. Previous studies have shown that deep\nmessage aggregation of GNN will lead to an over-smooth\nphenomenon[Li et al. , 2018 ], where the features of nodes\nwithin the graph will converge to the same values.\nTo alleviate this issue, we design a simple attenuation\nmechanism for message passing during iteration to delay the\nprocess of aggregating redundant information to nodes. In\nparticular, each hidden vector in message interaction scores\nM could be regarded as the prepared message sent from the\nrow index of the node to the column index of the node, and the\ntopology connection matrix Ashows the distance of shortest\npath between two nodes. We add the attenuation coefﬁcient\nby using the Gaussian kernel function with the formula:\nM(u,v) =M(u,v)e−αA(u,v) (12)\nwhere M(u,v) denotes the message sending from u to v,\nA(u,v) means the shortest path betweenuand v, α∈[0,1] is\na trainable coefﬁcient to control the attenuation level. It is ob-\nvious that with the increase of distance, the message will de-\ncay rapidly in the beginning, and then turn smooth for a long\ndistance. After applying this mechanism, we can defer the\nover-smoothness of the aggregating process to a certain de-\ngree. The ablation study in the section 4.3 also shows that the\nattenuation mechanism improves the prediction performance.\nFinally, for the graph-level tasks, a readout opera-\ntor/generation layer is added to obtain a ﬁxed feature vec-\ntor for the molecule. Here, we adopt a Gated Recurrent\nUnit (GRU) for global pooing following[Gilmer et al., 2017;\nSong et al., 2020] as:\nz=\n∑\nx∈V\nGRU(h(x)) (13)\nwhere h(x) is the set of atom representations in the molec-\nular graph, and GRU is the Gated Recurrent Unit. Finally,\nwe perform downstream property prediction ˆy= f(h) where\nf(·) is a fully connected layer.\n4 Experiments\nIn this section, we evaluate the proposed model CoMPT on\nthree kinds of tasks. We aim to answer the following research\nquestions:\n• RQ1: How does CoMPT model perform compared with\nstate-of-the-art molecular property prediction methods?\n• RQ2: How do different components (i.e, node position,\nedge direction, and message diffusion mechanism) af-\nfect CoMPT?\n• RQ3: Can CoMPT model provide better representations\nfor the attributed molecular graphs?\n4.1 Experiment Setups\nBenchmark Datasets\nTo enable head-to-head comparisons of CoMPT to exist-\ning molecular representation methods, we evaluated our pro-\nposed model on nine benchmark datasets across three kinds\nof tasks from [Wu et al., 2018] and [Jonas and Kuhn, 2019],\neach kind of which consists of 2 to 4 public benchmark\ndatasets, including BBBP, Tox21, Sider, and ClinTox for\nGraph Classiﬁcation tasks, ESOL, FreeSolv and Lipophilic-\nity for Graph Regression tasks, chemical shift prediction of\nhydrogen and carbon for Node Regression tasks. The statis-\ntics of datasets are shown in Table S1.\nIn the graph-level task, following the previous works, we\nutilized a 5-fold cross-validation and replicate experiments\non each task ﬁve times. Note that we adopted the scaffold\nsplit method recommended by [Yang et al., 2019] to split the\ndatasets into training, validation, and test, with a 0.8/0.1/0.1\nratio. Scaffold Split is a more challenging and realistic eval-\nuation setting in molecular property prediction tasks by guar-\nanteeing the high molecular scaffold diversity of the training,\nvalidation, and test sets.\nIn the node-level task, we follow the previous study[Jonas\nand Kuhn, 2019] by randomly splitting the dataset into 80%\nas the training set and 20% as the test set, and then use 95%\nof training data to train the model and the remaining 5% to\nvalidate the model for early stopping. All methods report the\nmean and standard deviation of corresponding metrics. To\nimprove model performance, we applied the grid search to\nobtain the best hyper-parameters of the models.\nProceedings of the Thirtieth International Joint Conference on Artiﬁcial Intelligence (IJCAI-21)\nTask Graph Classiﬁcation(ROC-AUC) Graph Regression(RMSE)\nDataset BBBP Tox21 Sider ClinTox ESOL FreeSolv Lipophilicity\nTF_Robust 0.860 ± 0.087 0.698 ± 0.012 0.607 ± 0.033 0.765 ± 0.085 1.722 ± 0.038 4.122 ± 0.085 0.909 ± 0.060\nGCN 0.877 ± 0.036 0.772 ± 0.041 0.593 ± 0.035 0.845 ± 0.051 1.068 ± 0.050 2.900 ± 0.135 0.712 ± 0.049\nWeave 0.837 ± 0.065 0.741 ± 0.044 0.543 ± 0.034 0.823 ± 0.023 1.158 ± 0.055 2.398 ± 0.250 0.813 ± 0.042\nSchNet 0.847 ± 0.024 0.767 ± 0.025 0.545 ± 0.038 0.717 ± 0.042 1.045 ± 0.064 3.215 ± 0.755 0.909 ± 0.098\nN-Gram 0.912 ± 0.013 0.769 ± 0.027 0.632 ± 0.005 0.855 ± 0.037 1.100 ± 0.160 2.512 ± 0.190 0.876 ± 0.033\nAttentiveFP 0.908 ± 0.050 0.807 ± 0.020 0.605 ± 0.060 0.933 ± 0.020 0.853 ± 0.060 2.030 ± 0.420 0.650 ± 0.030\nMPNN 0.913 ± 0.041 0.808 ± 0.024 0.595 ± 0.030 0.879 ± 0.054 1.167 ± 0.430 2.185 ± 0.952 0.672 ± 0.051\nMGCN 0.850 ± 0.064 0.707 ± 0.016 0.552 ± 0.018 0.634 ± 0.042 1.266 ± 0.147 3.349 ± 0.097 0.650 ± 0.030\nDMPNN 0.919 ± 0.030 0.826 ± 0.023 0.632 ± 0.023 0.897 ± 0.040 0.980 ± 0.258 2.177 ± 0.914 0.653 ± 0.046\nCMPNN 0.927 ± 0.017 0.806 ± 0.016 0.616 ± 0.003 0.902 ± 0.008 0.798 ± 0.112 2.007 ± 0.442 0.614 ± 0.029\nSmiles Transformer 0.900 ± 0.053 0.706 ± 0.021 0.559 ± 0.017 0.905 ± 0.064 1.144 ± 0.118 2.246 ± 0.237 1.169 ± 0.031\nGROVER 0.911 ± 0.008 0.803 ± 0.020 0.624 ± 0.006 0.884 ± 0.013 0.911 ± 0.116 1.987 ± 0.072 0.643 ± 0.030\nCoMPT 0.938 ± 0.021 0.809 ± 0.014 0.634 ± 0.030 0.934 ± 0.019 0.774 ± 0.058 1.855 ± 0.578 0.592 ± 0.048\nTable 1: Prediction results of CoMPT and baselines on seven chemical graph datasets. We used a 5-fold cross validation with scaffold split\nand replicated experiments on each tasks for ﬁve times. Mean and standard deviation of AUC or RMSE values are reported.\nBaselines Comparison\nWe comprehensively compared CoMPT against with 12 base-\nline methods in the graph level task. These models were most\nshown in the MoleculeNet [Wu et al., 2018] and GROVER\nas follows: TF_Robust [Ramsundar et al., 2015] is a DNN-\nbased multitask framework taking the molecular ﬁngerprints\nas the input. GCN, Weave, and SchNet [Duvenaud et al. ,\n2015; Kearnes et al. , 2016 ] are three graph convolutional\nmodels. N-Gram [Liu et al., 2019] is a state-of-the-art unsu-\npervised representation method for molecular property pre-\ndiction. AttentiveFP [Xiong et al., 2019] is an extension of\nthe graph attention network. MPNN and its variants MGCN\n[Lu et al., 2019], DMPNN and CMPNN are models consid-\nering the edge features during message passing. Speciﬁcally,\nto demonstrate the power of the message-interaction mod-\nule, we also compare CoMPT with two transformer model:\nSmiles Transformer [Honda et al., 2019] and GROVER. For\na fair comparison, we only report the results without the pre-\ntrained strategy.\nIn the node level task, we compared our CoMPT model\nwith the other 3 proposed methods in this benchmark. The\nﬁrst one is HOSE codes, which attempted to summarize the\nneighborhood around each atom in concentric spaces, and\nthen use a nearest-neighbor approach to predict the particu-\nlar shift value. The rest baselines include GCN [Jonas and\nKuhn, 2019 ] and MPNN [Kwon et al. , 2020 ], where they\nused different deep graph neural networks to improve the per-\nformance of prediction.\n4.2 Performance Comparison (RQ1)\nPerformance in graph level task. Table 1 displays the\ncomplete results of each model on all datasets, where cells\nin the gray shadow denote the previous best methods, and\ncells with the bold style show the best result achieved by\nCoMPT. Table 1 presents some observations: (1) Both the\nmessage passing neural network and transformer framework\nperform better than graph neural network on most datasets,\nand CoMPT combines the advantages of them to achieve\nthe best performances on 6 out of 7 datasets. Compared\nto the previous best message passing method CMPNN and\ntransformer method GROVER, the general improvements are\nTask Node Regression(MAE)\nDataset 1H-NMR 13C-NMR\nHOSE 0.33 2.85\nGCN 0.28 1.43\nMPNN 0.229 ±0.002 1.355 ±0.022\nCoMPT 0.214 ±0.003 1.321 ±0.012\nTable 2: Performance on Node-level tasks\n3.4% (2.0% on classiﬁcation tasks and 3.4% on regression\ntasks) and 4.7% (2.7% on classiﬁcation tasks and 4.7% on\nregression tasks), respectively. This notable incresing sug-\ngests the effectiveness of the structural representation learned\nby CoMPT for graph level prediction tasks. (2) The message\npassing neural network performs better than the transformer\nneural network, indicating the importance of edge features\nrelative to only an adjacency matrix or distance matrix. (3) In\nthe situation of small dataset, such as the Freesolv task with\nonly 642 labeled molecules, CoMPT gains a 6.6% relative\nimprovement over previous SOTAs, conﬁrming that CoMPT\nmodel could enhance the performance on the task with few\nlabeled data.\nPerformance in node level task. Table 2 shows the com-\nparison results of the baseline and CoMPT on the predic-\ntion of 1H-NMR and 13C-NMR spectra in terms of MAE.\nWe performed experiments 5 times independently with dif-\nferent random seeds and report the average and standard de-\nviation over the 5 repetitions. The average values over the 5\nrepetitions for 1H-NMR and 13C-NMR are 0.214 and 1.321\nppm per NMR-active atom, respectively. This indicates that\nour CoMPT model could extract the meaningful latent node\nrepresentations and thus enable more accurate predictions of\nNMR spectra for new molecules.\n4.3 Ablation Study (RQ2)\nWe conducted ablation studies on three benchmark datasets\nto investigate factors that inﬂuence the performance of the\nproposed CoMPT framework.\nAs shown in Table 3, CoMPT with the node position, edge\ndirection, and message diffusion shows the best performance\nProceedings of the Thirtieth International Joint Conference on Artiﬁcial Intelligence (IJCAI-21)\nCMPNN CoMPT (without diffusion) CoMPT\nFigure 2: T-SNE visualization of atom embeddings for three similar molecules (in three colors) that have a common scaffold but various\nside-chains in ClinTox dataset. Ideally, the scaffold atom embeddings of these three molecules should be mixed together while the unique\nside-chains’ embeddings should be distinguishable.\nDataset ClinTox Lipophilicity 1H-NMR\nWithout All 0.862 0.653 0.231\nWithout message diffusion 0.868 0.651 0.221\nWithout node position 0.903 0.614 0.217\nWithout edge direction 0.902 0.612 0.218\nCoMPT 0.934 0.592 0.214\nTable 3: Ablation results on three kinds of datasets\namong all architectures. The exclusion of all three modules in\nthe “without All” variant performed the worst. The exclusion\nof the message diffusion mechanism caused larger decreases\nin performances than the ones excluding two other modules,\nshowing the importance of reducing the message enrichment\nexplosion. Additionally, the uses of node position and edge\ndirection are both helpful for the ﬁnal performance.\n4.4 Atomic Representation Visualization (RQ3)\nAs shown in [Li et al., 2018], the node embeddings obtained\nby deep GNNs tend to be over-smoothed and become indis-\ntinguishable, while shallow GNNs cannot capture atom po-\nsitions within the broader context of the molecular graph.\nTo investigate whether the CoMPT alleviated these issues as\nexpected, we used t-distributed stochastic neighbor embed-\nding (t-SNE) to visualize the atom embedding distributions\nof three similar compounds that have a common scaffold (the\nfour-membered ring) but different side-chains. Ideally, the\nscaffold atom embeddings of these three molecules should\nbe mixed together while the unique side-chains’ embeddings\nshould be distinguishable.\nFigure 2 shows the projected atomic embeddings extracted\nfrom different models using the t-SNE with default settings.\nOverall, three methods provide reasonable results. MPNN in-\nherits the over-smoothness issue from the GNN, making the\natom embeddings indistinguishable within the graph . In con-\ntrast, both CoMPT models (with or without diffusion) can\nscatter the atoms well with distinguishable node embeddings.\nRelative to CoMPT without diffusion, CoMPT could exactly\nmix the scaffold atom embeddings and differentiate the side\nchains. More interestingly, CoMPT can distinguish the same\nfunctional groups in different chemical environments (the\nHydroxy Ketones in green and in yellow, respectively). These\nresults suggest that CoMPT can not only alleviate the over-\nsmoothness but also capture better representations within the\nbroader context of the molecular graph as expected.\nIn the node-level tasks, our CoMPT model reaches 0.214\nMAE that many molecules with densely packed 1H-NMR\nspectra can be resolved at these levels of accuracy. As an ex-\nample, Figure S1 depicts the structure of the 3-Formylbenzoic\nacid, which has 6 hydrogen atoms, labeled from 11 to 16 with\npeaks within the 4-14 ppm range. The small difference be-\ntween the ground truth and the prediction further proves that\nour model has a good capability in the node-level tasks.\n5 Conclusions\nIn this paper, we propose a Communicative Message Pass-\ning Transformer (CoMPT) neural network to improve the\nmolecular representation by reinforcing the message inter-\nactions between nodes and edges based on the Transformer\nmodel. Further, we introduce a message diffusion mechanism\nto decay the message enrichment explosion as well as over-\nsmoothness during the message passing process. Extensive\nexperiments demonstrate that our CoMPT model obtains su-\nperior performance against state-of-the-art baselines on both\ngraph-level tasks and node-level tasks.\nAcknowledgments\nThis work has been supported by the National Key R&D\nProgram of China(2020YFB0204803), National Natural Sci-\nence Foundation of China(61772566), Guangdong Key Field\nR&D Plan(2019B020228001, 2018B010109006), Introduc-\ning Innovative and Entrepreneurial Teams(2016ZT06D211),\nGuangzhou S&T Research Plan(202007030010).\nReferences\n[Chen et al., 2019] Benson Chen, Regina Barzilay, and\nTommi Jaakkola. Path-augmented graph transformer net-\nwork. arXiv preprint arXiv:1905.12712, 2019.\nProceedings of the Thirtieth International Joint Conference on Artiﬁcial Intelligence (IJCAI-21)\n[Duvenaud et al., 2015] David K Duvenaud, Dougal\nMaclaurin, Jorge Iparraguirre, Rafael Bombarell, Tim-\nothy Hirzel, Alán Aspuru-Guzik, and Ryan P Adams.\nConvolutional networks on graphs for learning molecular\nﬁngerprints. In Advances in neural information processing\nsystems, pages 2224–2232, 2015.\n[Gilmer et al., 2017] Justin Gilmer, Samuel S Schoenholz,\nPatrick F Riley, Oriol Vinyals, and George E Dahl. Neural\nmessage passing for quantum chemistry. InProceedings of\nthe 34th International Conference on Machine Learning-\nVolume 70, pages 1263–1272. JMLR. org, 2017.\n[Honda et al., 2019] Shion Honda, Shoi Shi, and Hiroki R\nUeda. Smiles transformer: Pre-trained molecular ﬁn-\ngerprint for low data drug discovery. arXiv preprint\narXiv:1911.04738, 2019.\n[Jonas and Kuhn, 2019] Eric Jonas and Stefan Kuhn. Rapid\nprediction of nmr spectral properties with quantiﬁed un-\ncertainty. Journal of cheminformatics, 11(1):1–7, 2019.\n[Kearnes et al., 2016] Steven Kearnes, Kevin McCloskey,\nMarc Berndl, Vijay Pande, and Patrick Riley. Molecular\ngraph convolutions: moving beyond ﬁngerprints. Jour-\nnal of computer-aided molecular design , 30(8):595–608,\n2016.\n[Kwon et al., 2020] Youngchun Kwon, Dongseon Lee,\nYoun-Suk Choi, Myeonginn Kang, and Seokho Kang.\nNeural message passing for nmr chemical shift predic-\ntion. Journal of Chemical Information and Modeling ,\n60(4):2024–2030, 2020.\n[Li et al., 2018] Qimai Li, Zhichao Han, and Xiao-Ming Wu.\nDeeper insights into graph convolutional networks for\nsemi-supervised learning. In Proceedings of the AAAI\nConference on Artiﬁcial Intelligence, volume 32, 2018.\n[Liu et al., 2019] Shengchao Liu, Mehmet F Demirel, and\nYingyu Liang. N-gram graph: Simple unsupervised rep-\nresentation for graphs, with applications to molecules.\nIn Advances in Neural Information Processing Systems ,\npages 8464–8476, 2019.\n[Lu et al., 2019] Chengqiang Lu, Qi Liu, Chao Wang,\nZhenya Huang, Peize Lin, and Lixin He. Molecular prop-\nerty prediction: A multilevel quantum interactions model-\ning perspective. In Proceedings of the AAAI Conference\non Artiﬁcial Intelligence , volume 33, pages 1052–1060,\n2019.\n[Maziarka et al., 2020] Łukasz Maziarka, Tomasz Danel,\nSławomir Mucha, Krzysztof Rataj, Jacek Tabor, and\nStanisław Jastrz˛ ebski. Molecule attention transformer.\narXiv preprint arXiv:2002.08264, 2020.\n[Ramsundar et al., 2015] Bharath Ramsundar, Steven\nKearnes, Patrick Riley, Dale Webster, David Konerding,\nand Vijay Pande. Massively multitask networks for drug\ndiscovery. arXiv preprint arXiv:1502.02072, 2015.\n[Rogers and Hahn, 2010] David Rogers and Mathew Hahn.\nExtended-connectivity ﬁngerprints. Journal of chemical\ninformation and modeling, 50(5):742–754, 2010.\n[Rong et al., 2020] Yu Rong, Yatao Bian, Tingyang Xu,\nWeiyang Xie, Ying Wei, Wenbing Huang, and Junzhou\nHuang. Self-supervised graph transformer on large-scale\nmolecular data. Advances in Neural Information Process-\ning Systems, 33, 2020.\n[Shang et al., 2018] Chao Shang, Qinqing Liu, Ko-Shin\nChen, Jiangwen Sun, Jin Lu, Jinfeng Yi, and Jinbo Bi.\nEdge attention-based multi-relational graph convolutional\nnetworks. arXiv preprint arXiv:1802.04944, 2018.\n[Song et al., 2020] Ying Song, Shuangjia Zheng, Zhang-\nming Niu, Zhang-Hua Fu, Yutong Lu, and Yuedong\nYang. Communicative representation learning on at-\ntributed molecular graphs. In Proceedings of the Twenty-\nNinth International Joint Conference on Artiﬁcial Intelli-\ngence,(IJCAI 2020), pages 2831–2838, 2020.\n[Vaswani et al., 2017] Ashish Vaswani, Noam Shazeer, Niki\nParmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez,\nŁukasz Kaiser, and Illia Polosukhin. Attention is all you\nneed. In Advances in neural information processing sys-\ntems, pages 5998–6008, 2017.\n[Veliˇckovi´c et al., 2017] Petar Veliˇckovi´c, Guillem Cucurull,\nArantxa Casanova, Adriana Romero, Pietro Lio, and\nYoshua Bengio. Graph attention networks. arXiv preprint\narXiv:1710.10903, 2017.\n[Withnall et al., 2020] M Withnall, E Lindelöf, O Engkvist,\nand H Chen. Building attention and edge message pass-\ning neural networks for bioactivity and physical–chemical\nproperty prediction. Journal of Cheminformatics, 12(1):1,\n2020.\n[Wu et al., 2018] Zhenqin Wu, Bharath Ramsundar, Evan N\nFeinberg, Joseph Gomes, Caleb Geniesse, Aneesh S\nPappu, Karl Leswing, and Vijay Pande. Moleculenet: a\nbenchmark for molecular machine learning. Chemical sci-\nence, 9(2):513–530, 2018.\n[Xiong et al., 2019] Zhaoping Xiong, Dingyan Wang, Xi-\naohong Liu, Feisheng Zhong, Xiaozhe Wan, Xutong Li,\nZhaojun Li, Xiaomin Luo, Kaixian Chen, Hualiang Jiang,\net al. Pushing the boundaries of molecular representation\nfor drug discovery with the graph attention mechanism.\nJournal of Medicinal Chemistry, 2019.\n[Xiong et al., 2020] Ruibin Xiong, Yunchang Yang, Di He,\nKai Zheng, Shuxin Zheng, Chen Xing, Huishuai Zhang,\nYanyan Lan, Liwei Wang, and Tie-Yan Liu. On layer nor-\nmalization in the transformer architecture. arXiv preprint\narXiv:2002.04745, 2020.\n[Yang et al., 2019] Kevin Yang, Kyle Swanson, Wengong\nJin, Connor Coley, Philipp Eiden, Hua Gao, Angel\nGuzman-Perez, Timothy Hopper, Brian Kelley, Miriam\nMathea, et al. Are learned molecular representations ready\nfor prime time? arXiv preprint arXiv:1904.01561, 2019.\n[Zhang and Meng, 2019] Jiawei Zhang and Lin Meng. Gres-\nnet: Graph residual network for reviving deep gnns from\nsuspended animation. arXiv preprint arXiv:1909.05729 ,\n2019.\nProceedings of the Thirtieth International Joint Conference on Artiﬁcial Intelligence (IJCAI-21)\nLearning Attributed Graph Representations with Communicative Message\nPassing Transformer\nAppendix\nJianwen Chen1†, Shuangjia Zheng1,4†∗, Ying Song2 , Jiahua Rao1,4 and Yuedong Yang1,3∗\n1School of Computer Science and Engineering, Sun Yat-sen University\n2School of System Science and Engineering, Sun Yat-sen University\n3Key Laboratory of Machine Intelligence and Advanced Computing, Sun Yat-sen University\n4Galixir Technologies Ltd, Beijing\n{chenjw48, zhengshj9, songy75, raojh6}@mail2.sysu.edu.cn, yangyd25@mail.sysu.edu.cn\n1 Dataset Description\nBBBP: The Blood-brain barrier penetration dataset includes\nbinary labels for 2035 compounds on their permeability prop-\nerties.Tox21: The Tox21 dataset was created in the Tox21\ndata challenge, which contained qualitative toxicity measure-\nments for 7821 compounds on 12 different targets, including\nnuclear receptors and stress response pathways. Sider: The\nSide Effect Resource grouped drug side-effects for 1379 ap-\nproved drugs into 27 system organ classes. ClinTox: The\nClinTox dataset includes 1468 drug molecules that are ap-\nproved through the FDA and compounds that failed during\nclinical trials due to toxicity. ESOL: The ESOL is a small\ndataset consisting of water solubility data for 1128 com-\npounds.FreeSolv: The Free Solvation Database provides 642\nexperimental and calculated hydration free energy of small\nmolecules in water. Lipophilicity: The Lipophilicity dataset\nprovides the experimental result of octanol/water distribution\ncoefﬁcient (logD at pH 7.4) of 4198 compounds. 1H/13C-\nNMR: The chemical shift dataset were collected from nmr-\nshiftdb2. We excluded molecules with more than 100 atoms\nor failing to pass the sanitizing process in the RDKit.\n2 Featurization Extraction\nThe feature extraction contains three parts: 1) Node feature\nextraction. 2) Bond feature extraction. 3) Topology connec-\ntion matrix. We use RDKit to extract all features as the input\nof CoMPT. Table S2 and Table S3 show the atom and bond\nfeatures we used in CoMPT.\nDataset Tasks Type Molecule Metric\nBBBP 1 GC 2,035 ROC-AUC\nTox21 12 GC 7,821 ROC-AUC\nSider 27 GC 1,379 ROC-AUC\nClinTox 2 GC 1,468 ROC-AUC\nESOL 1 GR 1,128 RMSE\nFreeSolv 1 GR 642 RMSE\nLipophilicity 1 GR 4,198 RMSE\n1H-NMR 1 NR 12800 MAE\n13C-NMR 1 NR 26859 MAE\nTable S1: Statistics of datasets. GC for Graph Classiﬁcation, GR for\nGraph Regression, NR for Node Regression\nFeatures Size Description\nAtom type 101 type of atom (e.g C,N,O)\nHybridization 6 sp, sp2, sp3, sp3d, sp3d2 or un-\nknown\nNumber of H 1 number of bond hydrogen atoms\nDegrees 1 number of neighbor atoms\nFormal\nCharges 1 number of formal charge\nValences 1 number of valences\nGasteiger\nCharges 1 value of Marsilli-Gasteiger partial\ncharges\nGasteiger\nHCharges 1 value of Marsilli-Gasteiger hydro-\ngen partial charges\nAromaticity 1 whether this atom is part of an aro-\nmatic system\nIn ring 1 whether the atom is part of a ring\nTable S2: Atom features\nFeatures Size Description\nBond type 4 single, double, triple, aromatic\nStereo 6 none, any, E/Z or cis/trans\nIn ring 1 whether the bond is part of a ring\nconjugated 1 whether the bond is conjugated\nTable S3: Bond features\nFigure S1: Measured and predicted spectra for 3-Formylbenzoic\nacid\narXiv:2107.08773v2  [cs.LG]  28 Jul 2021",
  "topic": "Computer science",
  "concepts": [
    {
      "name": "Computer science",
      "score": 0.7147018909454346
    },
    {
      "name": "Message passing",
      "score": 0.6157968044281006
    },
    {
      "name": "Theoretical computer science",
      "score": 0.5756893157958984
    },
    {
      "name": "Inductive bias",
      "score": 0.5089807510375977
    },
    {
      "name": "Feature learning",
      "score": 0.4927566349506378
    },
    {
      "name": "Leverage (statistics)",
      "score": 0.47958770394325256
    },
    {
      "name": "Transformer",
      "score": 0.47574517130851746
    },
    {
      "name": "Graph",
      "score": 0.46400728821754456
    },
    {
      "name": "Molecular graph",
      "score": 0.43824487924575806
    },
    {
      "name": "Artificial intelligence",
      "score": 0.35019630193710327
    },
    {
      "name": "Distributed computing",
      "score": 0.24326986074447632
    },
    {
      "name": "Multi-task learning",
      "score": 0.12598124146461487
    },
    {
      "name": "Voltage",
      "score": 0.0
    },
    {
      "name": "Management",
      "score": 0.0
    },
    {
      "name": "Task (project management)",
      "score": 0.0
    },
    {
      "name": "Quantum mechanics",
      "score": 0.0
    },
    {
      "name": "Economics",
      "score": 0.0
    },
    {
      "name": "Physics",
      "score": 0.0
    }
  ]
}