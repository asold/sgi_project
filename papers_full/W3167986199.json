{
  "title": "Constrained transformer network for ECG signal processing and arrhythmia classification",
  "url": "https://openalex.org/W3167986199",
  "year": 2021,
  "authors": [
    {
      "id": "https://openalex.org/A2121210156",
      "name": "Chao Che",
      "affiliations": [
        "Dalian University"
      ]
    },
    {
      "id": "https://openalex.org/A2330439543",
      "name": "Peiliang Zhang",
      "affiliations": [
        "Dalian University"
      ]
    },
    {
      "id": "https://openalex.org/A2100597338",
      "name": "Min Zhu",
      "affiliations": [
        "Zhejiang Institute of Special Equipment Inspection"
      ]
    },
    {
      "id": "https://openalex.org/A2097807684",
      "name": "Yue Qu",
      "affiliations": [
        "Dalian University of Technology"
      ]
    },
    {
      "id": "https://openalex.org/A2067389965",
      "name": "Bo Jin",
      "affiliations": [
        "Dalian University of Technology"
      ]
    },
    {
      "id": "https://openalex.org/A2121210156",
      "name": "Chao Che",
      "affiliations": [
        "Dalian University of Technology",
        "Ministry of Education"
      ]
    },
    {
      "id": "https://openalex.org/A2330439543",
      "name": "Peiliang Zhang",
      "affiliations": [
        "Dalian University of Technology",
        "Ministry of Education"
      ]
    },
    {
      "id": "https://openalex.org/A2100597338",
      "name": "Min Zhu",
      "affiliations": []
    },
    {
      "id": "https://openalex.org/A2097807684",
      "name": "Yue Qu",
      "affiliations": [
        "Dalian University",
        "Dalian University of Technology"
      ]
    },
    {
      "id": "https://openalex.org/A2067389965",
      "name": "Bo Jin",
      "affiliations": [
        "Dalian University",
        "Dalian University of Technology"
      ]
    }
  ],
  "references": [
    "https://openalex.org/W2412702708",
    "https://openalex.org/W2887171948",
    "https://openalex.org/W2551949036",
    "https://openalex.org/W2162693370",
    "https://openalex.org/W2291961022",
    "https://openalex.org/W2168028135",
    "https://openalex.org/W3126872424",
    "https://openalex.org/W3046046632",
    "https://openalex.org/W2132300419",
    "https://openalex.org/W2103308415",
    "https://openalex.org/W2768799535",
    "https://openalex.org/W2211945929",
    "https://openalex.org/W1971134780",
    "https://openalex.org/W2315988266",
    "https://openalex.org/W2902644322",
    "https://openalex.org/W2803832415",
    "https://openalex.org/W2902519742",
    "https://openalex.org/W2953193031",
    "https://openalex.org/W2134144792",
    "https://openalex.org/W2951632519",
    "https://openalex.org/W3005487465",
    "https://openalex.org/W2731010577",
    "https://openalex.org/W2888456553",
    "https://openalex.org/W3158755681",
    "https://openalex.org/W2962734274",
    "https://openalex.org/W2526050071",
    "https://openalex.org/W4245502741",
    "https://openalex.org/W1981276685",
    "https://openalex.org/W1895577753",
    "https://openalex.org/W6632223199",
    "https://openalex.org/W2047422067",
    "https://openalex.org/W2159891289",
    "https://openalex.org/W3099916295",
    "https://openalex.org/W2949117887",
    "https://openalex.org/W2333414777",
    "https://openalex.org/W1535810436",
    "https://openalex.org/W2794865285"
  ],
  "abstract": null,
  "full_text": "Che et al. BMC Med Inform Decis Mak          (2021) 21:184  \nhttps://doi.org/10.1186/s12911-021-01546-2\nRESEARCH\nConstrained transformer network for ECG \nsignal processing and arrhythmia classification\nChao Che1*, Peiliang Zhang1, Min Zhu2, Yue Qu3 and Bo Jin3 \nAbstract \nBackground: Heart disease diagnosis is a challenging task and it is important to explore useful information from the \nmassive amount of electrocardiogram (ECG) records of patients. The high-precision diagnostic identification of ECG \ncan save clinicians and cardiologists considerable time while helping reduce the possibility of misdiagnosis at the \nsame time.Currently, some deep learning-based methods can effectively perform feature selection and classification \nprediction, reducing the consumption of manpower.\nMethods: In this work, an end-to-end deep learning framework based on convolutional neural network (CNN) is pro-\nposed for ECG signal processing and arrhythmia classification. In the framework, a transformer network is embedded \nin CNN to capture the temporal information of ECG signals and a new link constraint is introduced to the loss function \nto enhance the classification ability of the embedding vector.\nResults: To evaluate the proposed method, extensive experiments based on real-world data were conducted. \nExperimental results show that the proposed model achieve better performance than most baselines. The experi-\nment results also proved that the transformer network pays more attention to the temporal continuity of the data and \ncaptures the hidden deep features of the data well. The link constraint strengthens the constraint on the embedded \nfeatures and effectively suppresses the effect of data imbalance on the results.\nConclusions: In this paper, an end-to-end model is used to process ECG signal and classify arrhythmia. The model \ncombine CNN and Transformer network to extract temporal information in ECG signal and is capable of performing \narrhythmia classification with acceptable accuracy. The model can help cardiologists perform assisted diagnosis of \nheart disease and improve the efficiency of healthcare delivery.\nKeywords: ECG signal, CNNs, Transformer, Link constraints\n© The Author(s) 2021. Open Access This article is licensed under a Creative Commons Attribution 4.0 International License, which \npermits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the \noriginal author(s) and the source, provide a link to the Creative Commons licence, and indicate if changes were made. The images or \nother third party material in this article are included in the article’s Creative Commons licence, unless indicated otherwise in a credit line \nto the material. If material is not included in the article’s Creative Commons licence and your intended use is not permitted by statutory \nregulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. To view a copy of this \nlicence, visit http:// creat iveco mmons. org/ licen ses/ by/4. 0/. The Creative Commons Public Domain Dedication waiver (http:// creat iveco \nmmons. org/ publi cdoma in/ zero/1. 0/) applies to the data made available in this article, unless otherwise stated in a credit line to the data.\nBackground\nHeart disease is one of the most pervasive causes of \nhuman death [1]. An electrocardiogram (ECG) is a tech -\nnique for graphical representation of heart activity over \ntime. An ECG reflects the regularity of the heart’s activity \nand physiological state of each body part. Therefore, an \nECG is a significant reference for the diagnosis of heart \ndisease [2]. The difficulties in diagnosing heart disease \nare mainly related to its paroxysmal and complex nature. \nIn a clinical manner, doctors usually diagnose it based \non the morphological waveform of an ECG, although it \nis usually difficult to make a clinical judgment, especially \nwhen the signals are mixed with noise. This stresses the \nsignificance of developing methods to accurately identify \nheart disease with support from machine learning.\nIn the past few decades, many machine learning meth -\nods have been employed to perform intelligent analysis of \nECG signals. Given the morphological characteristics of \nan ECG waveform, such as the shape of the QRS and P \nwaveforms, traditional machine learning approaches usu-\nally employ fixed features and classical signal processing \nOpen Access\n*Correspondence:  chechao@gmail.com\n1 Key Laboratory of Advanced Design and Intelligent Computing, Ministry \nof Education, Dalian University, Dalian 116622, China\nFull list of author information is available at the end of the article\nPage 2 of 13Che et al. BMC Med Inform Decis Mak          (2021) 21:184 \ntechniques [3, 4]. However, even the same patient exhib -\nits different waveforms in different environments. There -\nfore, using fixed features are not sufficient to accurately \ndistinguish different types of diseases [5, 6]. Moreover, \nmost of the existing models require manually crafted \nfeatures. In these cases, the selection of features for the \ninputs would significantly affect the performance of \nimplemented classifiers.\nIn recent years, end-to-end deep-learning methods \nhave led to substantial breakthroughs in image classi -\nfication, speech recognition, and other tasks. It is also a \nsignificant research problem to effectively apply related \ntechniques in the fields of medicine and healthcare. Cao \net al. combined Brownian multi-verse optimizer (BMVO) \nalgorithm [7] and a Damping Multi-Verse Optimizer \n(DMVO) algorithm [8] with DNA storage to show us \nhow closely future disease prediction is linked to DNA \nstorage. Recently, deep-learning methods have been \napplied for ECG signal processing and heart disease diag-\nnosis. Research on ECG signals has traditionally been a \nhot research topic. Here, the general framework of ECG \ndiagnosis is introduced, and then previous work on auto -\nmatic ECG diagnosis in the literature is reviewed. Earlier, \nlarge, rich ECG datasets were not available. Therefore, it \nis not particularly time-consuming to capture ECG fea -\ntures manually, such as the QRS wave group and S and T \nwaves. Chazal et al. proposed an algorithm for personal -\nized heartbeat classification based on ECG morphology \nand discriminant analysis using time-interval feature lin -\nearity [9]. In 2004, Chazal et  al. proposed a method for \nautomatically processing heartbeat classification, which \ndivides the manually detected heartbeat into six catego -\nries: normal pulsation, ventricular ectopic beat (VEB), \nsupraventricular ectopic beat (SVEB), normal and VEB \nfusion, and unknown beat type. A statistical classification \nmodel with a supervised method has been used, but the \ndetection effect on the SVEB type is relatively weak [10]. \nVaratharajan et al. performed pre-processing of some fil -\ntering, such as FIR and IIR, on ECG signals, and the fil -\ntered signals were input into an improved support vector \nmachine (SVM) for pattern recognition through a linear \ndiscriminator [11]. Shadmand also proposed an artificial \nneural network based on particle swarm optimization \nto classify specific patient heartbeats. Compared to the \nabove algorithms, Shadmand’s algorithm has superior \nclassification performance [12]. All of these methods use \nmanual features to train models and only achieve limited \nperformance. Thus, they cannot help doctors play a sup -\nporting role.\nIn 2010, Zhang et al. constructed an ECG database, the \nChina Cardiovascular Disease Database (CCDD), includ -\ning both 12-lead ECG and detailed diagnostic data. It \ncontains more than 190,000 12-lead ECG records and \neach record has at least one tag [13]. Using this database, \nJin and Dong proposed a CNN model and designed a \nthree-layer convolution layer followed by the fully con -\nnected layer. The model reached an accuracy of 83.66% \non classification experiment [14]. Recently, a research \nteam at Stanford University (California, USA) developed \na deep neural network (DNN) to classify a broad range \nof distinct arrhythmias from single-lead ECGs with high \ndiagnostic performance, which outperformed the diagno-\nses of cardiologists [15]. Shashiku et al. designed a convo-\nlutional de-noising autoencoders model to identify ECG \nheartbeat classifications [16]. Jun et  al. used a remote \nECG database to create a new dataset and proposed an \nend-to-end deep CNN to identify short-term 12-lead \nECG signals. They improved the residual module, which \nis more expressive than a doctor’s judgment for disease \nidentification in six categories [17]. Yao et  al. proposed \nattention-based time-incremental convolutional neural \nnetwork (ATI-CNN) [18], a deep neural network model \nachieving both spatial and temporal fusion of informa -\ntion from ECG signals by integrating CNN, recurrent \ncells and attention module. The above algorithms all use \nCNNs to identify the types of ECG signals [19, 20].\nAlthough CNNs have achieved great success in the rec-\nognition of arrhythmias, at the same time, the ECG signal \nis also a time series of data, and a recurrent neural net -\nwork (RNN) can be used to solve the time-series prob -\nlem. In recent years, for example, Mostayedl et al. used a \ntwo-way RNN to identify multiple categories of arrhyth -\nmia. He pre-processed the ECG signal to obtain charac -\nteristic information of ECG signals such as the positions \nof the R peak and of the QRS complex. The information \nof these features is then input into the bidirectional RNN \nmodel to obtain the identification classification of ECG \nsignals [21]. For example, Saadatnejad et  al. designed \nboth a class of network-recognition ECGs based on the \nwavelet transform and multiple Long Short-Term Mem -\nory (LSTM) models for ECG signals of personal wearable \ndevices [22]. Considering the specificity of ECG signals, \nChen et  al. completed the arrhythmias classification \nby fusing CNN and RNN models with excellent perfor -\nmance on the dataset we used [23].\nThe most representative work was reported by Han -\nnun et al. [24]. They collected single-lead ECG data from \nwearable displays and used a 34-layer residual CNN to \ndiagnose the signals. The approach demonstrated high \ndiagnostic performance, even exceeding the average \nlevel of cardiologists in F1 score. However, it ignored \nthe characteristics of ECG as temporal signals. A trans -\nformer network can capture temporal features and focus \non context vectors using an attention mechanism [17, \n22]. To this end, an end-to-end deep-learning model \nthat can effectively process arbitrary-length 12-lead ECG \nPage 3 of 13\nChe et al. BMC Med Inform Decis Mak          (2021) 21:184 \n \nsignal sequences by extending the transformer model is \nproposed herein. Specifically, the model splits an ECG \nrecord into different segments using a window of 6-s \nduration, which are used as inputs of the model, and \nthen it captures the valuable features by a CNN and feeds \nthem into the transformer network. The transformer \nnetwork employs a multi-head attention mechanism to \npay more attention to different segments of ECG signals. \nImportantly, a new constraint for classifying the ECG sig-\nnals has been designed, which leads to the prior knowl -\nedge, i.e., the labels of ECG signals. The main role of the \nlink constraint is to make the embedding vectors of the \nECG signals from the same class as similar as possible. \nOwing to the extraction of valid and significant features, \nthe link constraint can result in enhanced performance \nfor the downstream tasks.\nOverall, the main contribution of this paper are the \nfollowing.\n• A transformer network is embedded in the CNN \nframework for the identification of ECG signals. The \nintegration of the transformer compensates for the \nshortcomings of the CNN for poor performance of \ntemporal features.\n• A new link constraint is introduced in the loss func -\ntion. In the previous schemes, the embedding fea -\ntures were not evaluated; however, the proposed \nmodel constrained the features with the new link \nconstraints to ensure that the network extracts better \nfeature information.\n• The time window was designed to process unequal \nECG signals so as not to lose the temporal informa -\ntion of the signal.\nThe rest of this paper is organized as follows. In Sec -\ntion 2, related work is summarized. In Section 3, a formal \nproblem statement is provided and the data pre-process -\ning issues are introduced. The proposed methodology \nis discussed in Section  4. The experimental settings are \ndiscussed in Section 5, and results are presented. Finally, \nconclusions are drawn in Section 6.\nMethods\nProblem statement and data processing\nBefore discussing methodology, the diagnosis problem \nthat is the aim of this paper is clarified and the data char -\nacteristics discussed.\nProblem statement\nECG data used in this paper were acquired from a cardi -\nology challenge [25], which was collected from 11 hospi -\ntals and covering a total of 6877 individuals. These data \nhave been de-sensitized, with a total of 3699 records for \nmen and 3178 for women. The duration of the signal is \nbetween 6 and 60 s, with an average duration of 15.79 \ns. The data were recorded by a 12-lead ECG, with a fre -\nquency of the electrocardiogram recording of 500 Hz. \nThe 12 waveforms of an ECG signal sample are presented \nin Fig. 1.\nEach sample has a tag (label) for its category. There \nare nine categories in total, including one normal type \nof heart disease and eight abnormal types.The data cate -\ngory description are shown in Table 1. The main problem \nto be solved in this work can be formulated as follows: \ngiven 12-lead ECG signal data, the data are segmented \nthrough a time window and fed into a model for learning, \nand finally the classification scores of the 9 categories are \nobtained using the classification model.\nData pre‑processing\nNoise is inevitable in collecting ECG signals. Noise \nincludes baseline drift and high-frequency noise. There \nare many ways to de-noise ECG signals, such as design -\ning high-pass or median filters to eliminate baseline drift. \nIn this paper, we apply the difference method and wave -\nlet transform in signal processing to improve the quality \nof the signal. For the abnormal values that appear in the \nECG signals, it is found that the abnormal values have \nrelatively larger voltage values than the normal signals, so \nwe use the difference method to remove these abnormal \nvalues. First, we set the threshold values after traversing \nthe complete ECG signals, and replace the abnormal val -\nues with the threshold value when the voltage values is \ngreater than the threshold values. Then, we can obtain \nECG data with no abnormal values. For the ECG sig -\nnals containing noise, we performed six layers of wave -\nlet decomposition on the ECG signals and selected the \nbior2.6 wavelet function to obtain the detail coefficients \nand approximation coefficients of each layer. The EMG \ninterference noise is distributed in the high-frequency \ncomponents of the first layers of decomposition, while \nthe noise of baseline offset is distributed in the low-fre -\nquency components of the sixth layer. Therefore, we set \nall the detail coefficient components in the first and sec -\nond layers to 0, and set the approximate coefficient com -\nponents in the sixth layer to 0. Finally, we reconstruct the \nsignal layer by layer. After the reconstruction, we obtain \nthe ECG signal without outliers and noise. The combina -\ntion of difference method and wavelet transform method \ncan eliminate noise interference and outliers.\nSince the length of the ECG signals is not equal, we \nsplit the ECG signals into segments of fixed length \naccording to the given window size and step size. The size \nof each window is set to match the integrity of the regular \nheartbeat. All experimental parameters will be given in \n“Experimental settings” section.\nPage 4 of 13Che et al. BMC Med Inform Decis Mak          (2021) 21:184 \nModel architecture\nA new end-to-end model for ECG classification was \ndesigned that combines the advantages of a CNN and \ntransformer networks. The architecture of the proposed \nmodel, which is designed to handle variable-length \n12-leads ECG data, is shown in Fig.  2. An ECG record is \ndivided into equal-length ECG signal segments according \nto the window size and step size given in the pre-process-\ning stage. The 12-lead data are then passed to the CNN to \ncapture the hidden deep features in the ECG signal.\nNext, the linear network structure is used to fur -\nther capture the feature information, which was \nthen sent to the transformer network in the form \nX cnn =[ x[0 ],x[1], ...,x[n]] . The transformer network can \noutput the embedding vector of the input ECG signal \nXembed , which is finally fed into the classification layer \nto obtain the class probability of the ECG signal.\nAs shown in Fig. 2, the proposed model consists of four \ncomponents: (1) the link constraints, (2) feature-extrac -\ntion units, (3) transformer network, and (4) classification \nlayers.\nFig. 1 Twelve-lead ECG sample\nTable 1 Data category description\nType Description\nAtrial fibrillation (AF) Atrial fibrillation (AF) is characterized by the fibrillatory atrial waves and irregular conduction of QRS\nFirst-degree atrioventricular block (I-AVB) First-degree atrioventricular block (I-AVB) is defined as constant PR intervals longer than 0.2 s\nLeft bundle branch block (LBBB) Left bundle branch block (LBBB) is diagnosed by the distinct QRS morphology at leads I, aVL, V1, V2, V5, and \nV6\nRight bundle branch block (RBBB) Right bundle branch block (RBBB) is diagnosed by the rsR0pattern at V1 and V2\nPremature atrial contraction (PAC) The premature atrial contraction (PAC) indicate the electrical impulse from an abnormal site; specifically, the \nP wave or QRS morphology of PAC differs from that in normal heart beats\nPremature ventricular contraction (PVC) The premature ventricular contraction (PVC) indicate the electrical impulse from an abnormal site; specifi-\ncally, the P wave or QRS morphology of PVC differs from that in normal heart beats\nST-segment depression (STD) ST segment is abnormal if either ST-segment depression (STD) is greater than 0.1 mV\nST-segment elevated (STE) ST segment is abnormal if either ST-segment elevation (STE) is greater than 0.1 mV\nPage 5 of 13\nChe et al. BMC Med Inform Decis Mak          (2021) 21:184 \n \nLink constraints\nTo improve the quality of embedding features for down -\nstream task, the following assumption on the embedding \nfeatures is made.\nIf the correlation coefficient between embedding fea -\ntures of two samples are large ( max = 1 ), which means \npositive correlation, the classifier will predict that they \nbelong to the same category with a high probability. If the \ncorrelation coefficient is small ( min =− 1 ), the classifier \nwill predict different categories with a high probability.\nBased on the above assumptions, the correlation coeffi-\ncient between the samples of the same class is made a \nlarger value by min\nX i\nembed − X j\nembed\n\n2\n2\n . In contrast, the \ncorrelation coefficient between the samples of different \nclasses is made smaller by min\nX i\nembed + X j\nembed\n\n2\n2\n . In \nthe extreme condition, X i\nembed = X j\nembed  when the corre -\nlation coefficient equals 1, and X i\nembed =− 1X j\nembed  when \nthe correlation coefficient equals −1.\nBorrowing the idea of [26], link constraints are added \nto the loss function. There are two types of links between \nthe samples: a Must-link and a No-link. For the task of \nclassification, the links between the samples of the same \nclass are Must-links and the links between the samples of \nthe different classes are No-links. Figure  3 shows that the \nembedding vectors of two samples are similar when they \nhave a Must-link. Thus, the embedding vectors can better \ncontribute to downstream tasks such as classification. It \nis essentially a regular term, and its formula is:\nBased on Eqs. (1)–(3), the link constraints can make the \nembedding vectors of the same class closer and those \nof different classes. In the experiment, the embedding \n(1)Loss = min f(β) + /afii9838I(β)\n(2)I(β) =\n∑\npq\n1\n2\nβ p − e(pq )β (q)\n\n2\n2\n(3)e(ij) =\n{\n1 A must-link between i hboxand j\n−1 A cannot-link betweeniand j\nFig. 2 Architecture of proposed model\nPage 6 of 13Che et al. BMC Med Inform Decis Mak          (2021) 21:184 \nvector β is Xembed and the function f the classifier net -\nwork (a linear network) after the transformer network. \nMoreover, the link constraints can only be applied in the \ntraining process like other regularization terms, such \nas L1 and L2. The specific process of link constraints is \ndetailed in Algorithm 1.\nAlthough the outputs Xcnn of the CNN [27], such as β \ncan be used, since Xcnn sometimes has temporal informa-\ntion, i.e., the first element may have the information from \nthe early time and the last element may have the late-\ntime information, we cannot use outputs from a CNN \nas embedding vectors directly. Therefore, several layers \nare needed to disorganize the temporal information and \nFig. 3 Schematic diagram of link constraints\nFig. 4 CNN layer parameters\nPage 7 of 13\nChe et al. BMC Med Inform Decis Mak          (2021) 21:184 \n \nusually take the outputs of BiLSTM or a transformer as \nthe embedding vectors.\nFeature extraction\nCNNs have shown outstanding performance in image-\nclassification tasks due to their translation-invariance and \nability to capture local features [28, 29]. The essence of \nthe convolution kernel is a filter, which is especially suit -\nable for feature extraction of ECG signals. A CNN net -\nwork with seven convolution layers, which have different \nkernel sizes to capture various features, was designed in \nthe present study. Each convolution layer is composed of \na convolution filter, batch normalization layer [30], active \nlayer, and pooling layer. The parameters of the CNN’s lay-\ners are shown in Fig. 4.\nTransformer layers\nThe transformer network [31] was developed based \non the attention mechanism, which is composed of an \nencoder and decoder. In the ECG signal classification \nproblem, only the encoder part is used, the structure of \nwhich is shown in Fig.  5. The transformer network con -\ntains eight identical layer stacks and each layer has two \nsub-layers. The first sub-layer is the multi-head atten -\ntion and the second is a simple fully connected for -\nward neural network. The two sub-layers are connected \nby a residual network structure followed by a norm \nlayer. The output of each sub-layer can be expressed by \nout = LayerNorm(x + Sublayer(x)) , where each sub-\nlayer is constructed independently. To facilitate the \nresidual connection between layers, the sub-layers in the \nmodel are fixed output with 256 dimensions. These sub-\nlayers are described as follows.\n• Scaled dot-product attention. The input of the atten -\ntion function Q, K, and V represents query, key, and \nvalue, respectively. The attention weight is calcu -\nlated according to the similarity of the query key. The \nattention context is obtained according to the atten -\ntion weights. The model uses scaled dot-product \nattention, which is calculated as follows: \n• Multi-head attention. The multi-head attention \nmechanism projects Q, K, and V through h differ -\nent linear transformations, and finally splices differ -\nent attention results. Q, K, and V have the same val -\nues in the self-attention mechanism. The formula is \nexpressed as follows: \n(4)\nAttention(Q, K , V ) = softmax(QK T /\n√\ndkV )\n(5)\nMultiHead(Q ,K ,V ) = Concat(head1 , ...,headh)\n where MultiHead(Q, K, V) is the contact of head i.\n• Position-wise feed-forward networks. In addition \nto the attention sub-layer, each layer of the encoder \ncontains a fully connected feed-forward network and \na two-layer linear transformation using a ReLU acti -\nvation function: \n While the linear transformations are the same across \ndifferent positions, they use different parameters \nfrom layer to layer. The input size of the model is 256 \nand the size of the hidden layer is 1024.\n• Positional encoding. To make use of the order of \nsequence, “position encoding, ” i.e., the relative or \nabsolute position of the sequence, is added to the \ninput embedding at the top of encoder. The posi -\n(6)headi = Attention(QWQ\ni , KW K\ni , VW V\ni )\n(7)FFN(x) = max(0,xW1 + b1 )W 2 + b2\nFig. 5 Structure of transformer-network encoder\nPage 8 of 13Che et al. BMC Med Inform Decis Mak          (2021) 21:184 \ntional encoding (PE) dimension is dmodel=256 , the \nsame as input embedding: \n where pos is the position and i the dimension.\nClassification layers\nThe transformer network is connected to the classifica -\ntion layer for multi-classification. The classification layer \n(8)PE (pos,2i) = sin(pos/10000 2i/dmodel )\n(9)PE (pos,2i+1) = sin(pos/10000 2i/dmodel )\nis composed of linear layers and activation layers. The \nclassification network outputs the probability that each \npatient may have for each type of heart disease.\nResults\nExperimental settings\nThe ECG data of 6877 patients were divided into training \nand test sets in a ratio of 9:1. The experimental param -\neters are shown in the Table 2. The model is trained using \nAdam optimizer. A cross-entropy function was employed \nas the loss function.\nEvaluation metrics\nIn medical diagnosis, a lower misdiagnosis rate relative to \ncorrect diagnoses is optimal, so F1 score is employed as \nthe evaluation metric. F1 score is the harmonic mean of \nthe positive predictive value and sensitivity, and is com -\nputed as follows:\nwhere N i,j indicates the number of samples in the ith \nclass that are classified into the jth class, and F 1,j is the \nvalue of macro-F1 of the jth class.\nExperimental results\nTrends in accuracy and F1\nFigure 6 illustrates that the training data increase in accu-\nracy and recall as the number of iterations increases. \nThese results show that the model can extract not only \neffective features in the training data, but also extract the \nsame effective hidden features from the unknown test \ndata for classification. The results verify the generalizabil-\nity of the proposed algorithm.\nComparisons of classification performance\nFive SOTA deep-learning models were employed as base-\nlines to compare with CNN_Trans- former_LC: A CNN \n[32], ResNet [33], Multi_channelCNN [34], BiRNN [21], \nand CNN_BiLSTM [30]. We applied the methods of these \n(10)F1,j = 2N ii\n/ 9∑\nj−1\n(N i,j+ N j,i)\nTable 2 Experimental parameter settings\nExperimental parameters Size Experimental parameters Size\nECG window size 3000 Step size 1500\nInput size 150 Hidden layer size 1024\nBatch size 100 Epoch 150\nLearning rate 0.001\nFig. 6 Accuracy and F1 of CNN_Transformer_LC in 150 epochs\nTable 3 Comparison of classification results of CNN_Transformer_LC and baselines on different Arrhythmia classifications\nBold values indiate the best experimental results under this category\nMethods Normal AF I-AVF LBBB RBBB PAC PVC STD STE F1\nCNN 0.578 0.709 0.753 0.773 0.825 0.207 0.376 0.562 0.389 0.574\nResNet 0.578 0.787 0.833 0.757 0.847 0.324 0.407 0.610 0.260 0.601\nMutil_channelCNN 0.666 0.733 0.827 0.8 0.821 0.421 0.648 0.575 0.32 0.646\nBiRNN 0.738 0.768 0.742 0.705 0.821 0.59 0.807 0.658 0.294 0.742\nCNN_BiLSTM 0.723 0.826 0.851 0.829 0.893 0.600 0.818 0.692 0.529 0.751\nCNN_Transformer_LC 0.817 0.858 0.878 0.800 0.872 0.618 0.830 0.711 0.686 0.786\nPage 9 of 13\nChe et al. BMC Med Inform Decis Mak          (2021) 21:184 \n \nmodels to the dataset of the paper and obtained experi -\nmental results for different models. The experimen -\ntal results are reported in Table  3. As can be seen from \nthe table, Multi_channelCNN outperforms CNN-based \nmodels in multiple disease categories. The experimental \nresults of the CNN_Transformer_LC model in the verifi -\ncation set are better than those of CNN, ResNet, Multi_\nchannelCNN, and BiRNN. As the CNN can only input \nfixed-length time-series vectors, some feature informa -\ntion will be lost, leading to a performance decrease. RNN \ninputs all the signal information, so the RNN experimen -\ntal results are better than those of the CNN. At the same \ntime, the performance of the CNN_Transformer_LC \nmodel is better than that of the CNN and BiRNN. The \nCNN and BiRNN classify the extracted artificial features, \nwhile CNN_Transformer_LC can extract more effec -\ntive feature vectors than artificial features. CNN_Trans -\nformer_LC significantly improves the recognition rate of \nI-AVF, LBBB, and STE.\nTo investigate the effectiveness of different parts of \nthe proposed model, ablation experiments were con -\nducted, the results of which are reported in Table  4. As \ncan be seen from the table, the CNN_BiLSTM model \nsignificantly outperform the CNN. This is because the \noutput of convolutional neural layer is time-serially \nrelated in the ECG signal classification problem. After \nTable 4 Results of ablation experiments on different Arrhythmia classifications\nBold values indiate the best experimental results under this category\nMethods Normal AF I-AVF LBBB RBBB PAC PVC STD STE F1\nCNN 0.578 0.709 0.753 0.773 0.825 0.207 0.376 0.562 0.389 0.574\nCNN_BiLSTM 0.723 0.826 0.851 0.829 0.893 0.600 0.818 0.692 0.529 0.751\nCNN_BiLSTM_Attention 0.739 0.867 0.851 0.829 0.889 0.617 0.823 0.679 0.538 0.759\nCNN_BiLSTM_LC 0.794 0.857 0.894 0.722 0.870 0.672 0.787 0.688 0.700 0.776\nCNN_Transformer 0.810 0.855 0.912 0.769 0.873 0.635 0.750 0.704 0.571 0.764\nCNN_Transformer_LC 0.817 0.858 0.878 0.800 0.872 0.618 0.830 0.711 0.686 0.786\nFig. 7 Embedding vectors of nine classes of heart disease\nPage 10 of 13Che et al. BMC Med Inform Decis Mak          (2021) 21:184 \nusing a RNN to process the relevant output of the \nCNN, the result obtained is better. This also reflects \nthat the RNN can further extract effective features. \nOwing to the dependency of ECG signals , the per -\nformance of the CNN with the transformer is greatly \nimproved compared with that of a single CNN. This \nalso proves that a transformer can effectively extract \nsuch features. However, it is also found in Table  4 that \nthe F1 scores of PAC, STE, and STD are not as good \nas those of other categories, because the limited data \ndistribution of the three categories in this dataset \nresults in low performance. At the same time, Table  4 \nshows that using a link constraint can effectively sup -\npress the influence of data imbalance and improve the \nperformance to some extent in the PVC, STD, and STE \ncategories.\nVisualization of embedding vectors\nTo confirm the ability of feature extraction of the pro -\nposed model, dimensionality reduction was performed \non the embedding vectors using principal components \nanalysis (PCA) and the results visualized in Fig.  7. \nIt can be seen that the embedding representation \nobtained by the proposed model can effectively sepa -\nrate most categories. Because of the link constraints, \nthe samples belonging to the same categories are close \nto each other and the samples belonging to different \ncategories are far from each other, which can help dis -\ntinguish the vectors in different categories.\nEmbedding similarity matrix\nTo demonstrate the effect more concretely, center vectors \nX class i, i = 1, 2, ..., 9 , are defined for each class, which are \nthe closest vectors of each embedding vector in all classes \nin the training set. The nine vectors X class i, i = 1, 2, ..., 9 , \nare calculated as follows.\nThen, the similarity matrix of the nine vectors is obtained \nby the Pearson correlation coefficient. Figure 8 shows the \nconfusion matrix of the proposed method in the testing \nset and the embedding similarity matrix in the train -\ning set. An interesting rule is found from the confusion \nmatrix, namely, if classes i and j have a large similarity \nvalue (correlation coefficient), the examples in classes i \nor j have a high probability of being classified into other \nclasses. The smaller the similarity values between two \nclasses, the less likely it is that the instances of two classes \nwill be misclassified. If two classes have negative simi -\nlarity, almost no misclassification occurs between them. \nThis is the same as the proposed assumption in “” section, \nwhich confirms the correctness of using link constraints.\nFigure 7 shows that the embedding vectors of the nor -\nmal and STE classes are very similar, the T waveforms of \nwhich are morphologically difficult to distinguish. This \nleads to the confusion between the two classes. Similarly, \nthe embedding vectors of classes STD and STE are very \n(11)\nX class i= argmin\nx\n∑\n�x − X h\nembed �2\n2, sampleh ∈ class i\nFig. 8 Confusion matrix and embedding similarity matrix\nPage 11 of 13\nChe et al. BMC Med Inform Decis Mak          (2021) 21:184 \n \ndifferent and their T waveforms are quite different, which \nmakes it very easy to distinguish classes STD and STE.\nEffectiveness of Feature Extraction for CNN\nThe features extracted by the CNN from the ECG signal \nwere visualized and are shown in Fig.  9. One sample of \nfirst-degree atrioventricular block (I-AVB) was chosen \nand the features output by different CNN layers from the \nsample. I-AVB is a disease of the electrical conduction \nsystem of the heart, which can be indicated on the ECG \nby a prolonged PR interval larger than 0.20 s [35]. The \nPR interval is marked by a red rectangle on the feature \ncaptured by different CNN layers in Fig.  9. It can be seen \nfrom the figure that most CNN layers can capture the \nPR interval when inputting an ECG signal of I-AVB. This \nproves that the CNN can effectively extract the features \nof heart disease from ECG signals for diagnosis.\nFrom Fig. 9, we can see that most CNN layers can cap -\nture the PR interval when input a ECG signal of I-AVB. \nThis prove that CNN can effectively extract the feature of \nheart disease from ECG signals for diagnosis.\nConclusions\nAn end-to-end model combining a CNN and trans -\nformer to classify ECG signals is proposed in this paper. \nIn the model, a window function is employed to divide \nthe ECG signal into different numbers of ECG seg -\nments. The feature information extracted by the CNN \nstill has temporal characteristics. The combination of the \nCNN and improved transformer finally achieved an F1 \nscore of 78.6%, which can be of great assistance to doc -\ntors or cardiologists [25]. In the future, our focus will \nbe on the identification of more types of heart disease, \nsuch as myocardial infarction. It is hoped that the pro -\nposed model can be applied to low-cost ECG devices to \nfacilitate diagnosis of heart disease in areas in medically \nunderserved areas.\nFig. 9 Features extracted by different CNN layers from ECG signals\nPage 12 of 13Che et al. BMC Med Inform Decis Mak          (2021) 21:184 \nAcknowledgements\nNot applicable.\nAuthor’s contribution\nCC, MZ, and BJ contributed during the process of proposal development. \nPLZ handled the data collection process. PLZ, MZ, and YQ were involved \nduring data analysis and write up. PLZ and MZ prepared the draft. Then CC \nand BJ revised the draft of the paper. All authors read and approved the final \nmanuscript.\nFunding\nThe work is supported by the Program of National Key R&D Program of \nChina (2018YFC0910500), the National Natural Science Foundation of China \n(No. 62076045, No. 61772110), the Guidance Program of Liaoning Natural \nScience Foundation (No. 2019-ZD-0569), the CERNET Innovation Project \n(NGII20170711), the Introducing Talents of Discipline to Universities (Plan 111) \n(No. B20070).\nAvailability of data and materials\nThe datasets used and analyzed during the current study are available from \nthe corresponding author on reasonable request.\nDeclarations\nEthics approval and consent to participate\nNot applicable. \nConsent for publication\nNot applicable.\nCompeting interests\nThe authors declare that they have no competing interests.\nAuthor details\n1 Key Laboratory of Advanced Design and Intelligent Computing, Ministry \nof Education, Dalian University, Dalian 116622, China. 2 Zhejiang Institute \nfor Quality Inspection of Light Industrial Products, Hangzhou 310000, China. \n3 School of Innovation and Entrepreneurship, Dalian University of Technology, \nDalian 116024, China. \nReceived: 27 March 2021   Accepted: 25 May 2021\nReferences\n 1. Feigin VL, Roth GA, Naghavi M, Parmar P , Krishnamurthi R, Chugh S, Men-\nsah GA, Norrving B, Shiue I, Ng M, et al. Global burden of stroke and risk \nfactors in 188 countries, during 1990–2013: a systematic analysis for the \nglobal burden of disease study 2013. Lancet Neurol. 2016;15(9):913–24.\n 2. Rubin J, Parvaneh S, Rahman A, Conroy B, Babaeizadeh S. Densely con-\nnected convolutional networks for detection of atrial fibrillation from \nshort single-lead ECG recordings. J Electrocardiol. 2018;51(6):18–21.\n 3. Teijeiro T, Félix P , Presedo J, Castro D. Heartbeat classification using \nabstract features from the abductive interpretation of the ECG. IEEE J \nBiomed Health Inform. 2018;22(2):409–20.\n 4. Ince T, Kiranyaz S, Gabbouj M. A generic and robust system for auto-\nmated patient-specific classification of ECG signals. IEEE Trans Biomed \nEng. 2009;56(5):1415–26.\n 5. Kiranyaz S, Ince T, Gabbouj M. Real-time patient-specific ECG classifica-\ntion by 1-D convolutional neural networks. IEEE Trans Biomed Eng. \n2015;63(3):664–75.\n 6. Hoekema R, Uijen GJ, Van Oosterom A. Geometrical aspects of the inter-\nindividual variability of multilead ECG recordings. IEEE Trans Biomed Eng. \n2001;48(5):551–9.\n 7. Cao B, Zhang X, Wu J, Wang B, Zhang Q, Wei X. Minimum free energy \ncoding for DNA storage. IEEE Trans Nanobiosci. 2021;20(2):212–22. \nhttps:// doi. org/ 10. 1109/ TNB. 2021. 30563 51.\n 8. Cao B, Li X, Zhang X, Wang B, Zhang Q, Wei X. Designing uncorrelated \naddress constrain for DNA storage by DMVO algorithm. IEEE/ACM Trans \nComput Biol Bioinform. 2020. https:// doi. org/ 10. 1109/ TCBB. 2020. 30115 \n82.\n 9. De Chazal P , Reilly RB. A patient-adapting heartbeat classifier using ECG \nmorphology and heartbeat interval features. IEEE Trans Biomed Eng. \n2006;53(12):2535–43.\n 10. De Chazal P , O’Dwyer M, Reilly RB. Automatic classification of heartbeats \nusing ECG morphology and heartbeat interval features. IEEE Trans \nBiomed Eng. 2004;51(7):1196–206.\n 11. Varatharajan R, Manogaran G, Priyan M. A big data classification approach \nusing LDA with an enhanced SVM method for ECG signals in cloud com-\nputing. Multimed Tools Appl. 2018;77(8):10195–215.\n 12. Shadmand S, Mashoufi B. A new personalized ECG signal classification \nalgorithm using block-based neural network and particle swarm optimi-\nzation. Biomed Signal Process Control. 2016;25:12–23.\n 13. Zhang J-w, Wang L-P , Liu X, Zhu H-H, Dong J. Chinese cardiovascular \ndisease database (CCDD) and its management tool. In: IEEE international \nconference on bioinformatics and bioengineering. IEEE; 2010. p. 66–2\n 14. Jin L, Dong J. Deep learning research on clinical electrocardiogram analy-\nsis. Sci Sin Inform. 2015;45(3):398.\n 15. Hannun AY, Rajpurkar P , Haghpanahi M, Tison GH, Bourn C, Turakhia \nMP , Ng AY. Cardiologist-level arrhythmia detection and classification in \nambulatory electrocardiograms using a deep neural network. Nat Med. \n2019;25(1):65.\n 16. Shashikumar SP , Shah AJ, Clifford GD, Nemati S. Detection of paroxysmal \natrial fibrillation using attention-based bidirectional recurrent neural net-\nworks. In: Proceedings of the 24th ACM SIGKDD international conference \non knowledge discovery and data mining. ACM; 2018. p. 715–23\n 17. Ribeiro AH, Ribeiro MH, Paixão G, Oliveira D, Gomes PR, Canazart JA, \nPifano M, Meira Jr W, Schön TB, Ribeiro AL. Automatic diagnosis of short-\nduration 12-lead ECG using a deep convolutional network. 2018. arXiv \npreprint arXiv:1811.12194\n 18. Yao Q, Wang R, Fan X, Liu J, Li Y. Multi-class arrhythmia detection from \n12-lead varied-length ECG using attention-based time-incremental \nconvolutional neural network. Inform Fusion. 2020;53:174–82.\n 19. Jun TJ, Nguyen HM, Kang D, Kim D, Kim D, Kim Y-H. ECG arrhythmia clas-\nsification using a 2-d convolutional neural network. 2018. arXiv preprint \narXiv:1804.06812\n 20. Li P , Wang Y, He J, Wang L, Tian Y, Zhou T-S, Li T, Li J-S. High-performance \npersonalized heartbeat classification model for long-term ECG signal. IEEE \nTrans Biomed Eng. 2016;64(1):78–86.\n 21. Mostayed A, Luo J, Shu X, Wee W. Classification of 12-lead ECG signals \nwith bi-directional LSTM network. 2018. arXiv preprint arXiv:1811.02090\n 22. Saadatnejad S, Oveisi M, Hashemi M. LSTM-based ECG classification for \ncontinuous monitoring on personal wearable devices. IEEE J Biomed \nHealth Inform. 2019;24:515–23.\n 23. Chen T-M, Huang C-H, Shih ES, Hu Y-F, Hwang M-J. Detection and clas-\nsification of cardiac arrhythmias by a challenge-best deep learning neural \nnetwork model. Iscience. 2020;23(3):100886.\n 24. Rajpurkar P , Hannun AY, Haghpanahi M, Bourn C, Ng AY. Cardiologist-level \narrhythmia detection with convolutional neural networks. 2017. arXiv \npreprint arXiv:1707.01836\n 25. Liu F, Liu C, Zhao L, Zhang X, Wu X, Xu X, Liu Y, Ma C, Wei S, He Z, et al. An \nopen access database for evaluating the algorithms of electrocardiogram \nrhythm and morphology abnormality detection. J Med Imaging Health \nInform. 2018;8(7):1368–73.\n 26. Qu Y, Liu C, Zhang K, Xiao K, Jin B, Xiong H. Diagnostic sparse connectivity \nnetworks with regularization template. IEEE Trans Knowledge Data Eng. \nhttps:// doi. org/ 10. 1109/ TKDE. 2021. 30756 68.\n 27. Qin C, Schlemper J, Caballero J, Price AN, Hajnal JV, Rueckert D. Convolu-\ntional recurrent neural networks for dynamic MR image reconstruction. \nIEEE Trans Med Imaging. 2019;38(1):280–90.\n 28. Hershey S, Chaudhuri S, Ellis DP , Gemmeke JF, Jansen A, Moore RC, Plakal \nM, Platt D, Saurous RA, Seybold B, et al. CNN architectures for large-scale \naudio classification. In: IEEE international conference on acoustics, speech \nand signal processing (ICASSP). IEEE; 2017. p. 131–35\n 29. Shang L, Yang Q, Wang J, Li S, Lei W. Detection of rail surface defects \nbased on CNN image recognition and classification. In: 20th International \nconference on advanced communication technology (ICACT). IEEE; 2018. \np. 45–51\nPage 13 of 13\nChe et al. BMC Med Inform Decis Mak          (2021) 21:184 \n \n•\n \nfast, convenient online submission\n •\n  \nthorough peer review by experienced researchers in your ﬁeld\n• \n \nrapid publication on acceptance\n• \n \nsupport for research data, including large and complex data types\n•\n  \ngold Open Access which fosters wider collaboration and increased citations \n \nmaximum visibility for your research: over 100M website views per year •\n  At BMC, research is always in progress.\nLearn more biomedcentral.com/submissions\nReady to submit y our researc hReady to submit y our researc h  ?  Choose BMC and benefit fr om: ?  Choose BMC and benefit fr om: \n 30. Ioffe S, Szegedy C. Batch normalization: accelerating deep network \ntraining by reducing internal covariate shift. 2015. arXiv preprint \narXiv:1502.03167\n 31. Vaswani A, Shazeer N, Parmar N, Uszkoreit J, Jones L, Gomez AN, Kaiser Ł, \nPolosukhin I. Attention is all you need. In: Advances in neural information \nprocessing systems. 2017. p. 5998–6008\n 32. Qin C, Schlemper J, Caballero J, Price AN, Hajnal JV, Rueckert D. Convolu-\ntional recurrent neural networks for dynamic MR image reconstruction. \nIEEE Trans Med Imaging. 2018;38(1):280–90.\n 33. Vinyals O, Toshev A, Bengio S, Erhan D. Show and tell: a neural image \ncaption generator. In: Proceedings of the IEEE conference on computer \nvision and pattern recognition. 2015, p. 3156–3164\n 34. Widrow B, Hoff ME. Adaptive switching circuits. Cambridge: MIT Press; \n1988. p. 123–34.\n 35. Cheng S, Keyes MJ, Larson MG, McCabe EL, Newton-Cheh C, Levy D, \nBenjamin EJ, Vasan RS, Wang TJ. Long-term outcomes in individuals \nwith prolonged PR interval or first-degree atrioventricular block. JAMA. \n2009;301(24):2571–7.\nPublisher’s Note\nSpringer Nature remains neutral with regard to jurisdictional claims in pub-\nlished maps and institutional affiliations.",
  "topic": "Computer science",
  "concepts": [
    {
      "name": "Computer science",
      "score": 0.758875846862793
    },
    {
      "name": "Convolutional neural network",
      "score": 0.6423901915550232
    },
    {
      "name": "Artificial intelligence",
      "score": 0.623369038105011
    },
    {
      "name": "Deep learning",
      "score": 0.6187446713447571
    },
    {
      "name": "Transformer",
      "score": 0.488078236579895
    },
    {
      "name": "Machine learning",
      "score": 0.4693782329559326
    },
    {
      "name": "Pattern recognition (psychology)",
      "score": 0.4573816955089569
    },
    {
      "name": "Data mining",
      "score": 0.44046926498413086
    },
    {
      "name": "Engineering",
      "score": 0.07612723112106323
    },
    {
      "name": "Voltage",
      "score": 0.0
    },
    {
      "name": "Electrical engineering",
      "score": 0.0
    }
  ],
  "institutions": [
    {
      "id": "https://openalex.org/I4210092944",
      "name": "Dalian University",
      "country": "CN"
    },
    {
      "id": "https://openalex.org/I4210115152",
      "name": "Zhejiang Institute of Special Equipment Inspection",
      "country": "CN"
    },
    {
      "id": "https://openalex.org/I27357992",
      "name": "Dalian University of Technology",
      "country": "CN"
    }
  ],
  "cited_by": 142
}