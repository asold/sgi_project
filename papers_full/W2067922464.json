{
  "title": "Real-Time Audio Transformer Emulation for Virtual Tube Amplifiers",
  "url": "https://openalex.org/W2067922464",
  "year": 2011,
  "authors": [
    {
      "id": "https://openalex.org/A2154634097",
      "name": "Paiva Rafael",
      "affiliations": [
        "Aalto University",
        "AC Camargo Hospital"
      ]
    },
    {
      "id": "https://openalex.org/A4292501162",
      "name": "Pakarinen Jyri",
      "affiliations": [
        "Aalto University"
      ]
    },
    {
      "id": "https://openalex.org/A2289494094",
      "name": "Välimäki, Vesa",
      "affiliations": [
        "Nokia (Finland)"
      ]
    },
    {
      "id": null,
      "name": "Tikander, Miikka",
      "affiliations": [
        "Nokia (Finland)"
      ]
    }
  ],
  "references": [
    "https://openalex.org/W2103525130",
    "https://openalex.org/W2102146334",
    "https://openalex.org/W2026061145",
    "https://openalex.org/W2142852645",
    "https://openalex.org/W2119212591",
    "https://openalex.org/W2099587991",
    "https://openalex.org/W2126890599",
    "https://openalex.org/W2131793107",
    "https://openalex.org/W2123688315",
    "https://openalex.org/W2098988753",
    "https://openalex.org/W2014439042",
    "https://openalex.org/W2734806584",
    "https://openalex.org/W2317180826",
    "https://openalex.org/W1588209443",
    "https://openalex.org/W2166546105",
    "https://openalex.org/W1928039117",
    "https://openalex.org/W2116763969",
    "https://openalex.org/W1530339963",
    "https://openalex.org/W4285719527",
    "https://openalex.org/W1870359674",
    "https://openalex.org/W2028247401",
    "https://openalex.org/W1591493420",
    "https://openalex.org/W1539562971",
    "https://openalex.org/W1972580129",
    "https://openalex.org/W2155132052",
    "https://openalex.org/W2112545765"
  ],
  "abstract": "An audio transformer is used in a guitar amplifier to match the impedances of the power amplifier and a loudspeaker. It is important to understand the influence of the audio transformer on the overall sound quality for realistic tube amplifier emulation. This paper proposes to simulate the audio transformer using a wave digital filter model, which is based on the gyrator-capacitor analogy. The proposed model is two-directional in the sense that it outputs the loudspeaker current, but it also connects backward to the power amplifier thus affecting its behavior in a nonlinear manner. A practical parameter estimation procedure is introduced, which requires only the measurement of basic electrical quantities but no knowledge of material properties. Measurements of a Fender NSC041318 and a Hammond T1750V transformer are presented as case studies, as well as parameter fitting and simulation for the Fender transformer. The results show that these practical transformer designs introduce distortion at low frequencies only, below about 100 Hz for the Fender and 30 Hz for the Hammond transformer, and that the proposed model faithfully reproduces this effect. The proposed audio transformer model is implemented in real time using the BlockCompiler software. Parametric control allows varying and also exaggerating the model nonlinearities.",
  "full_text": "Hindawi Publishing Corporation\nEURASIP Journal on Advances in Signal Processing\nV olume 2011, Article ID 347645, 15 pages\ndoi:10.1155/2011/347645\nResearch Article\nReal-Time Audio T ransformer Emulation for\nVirtual T ube Ampliﬁers\nRafael Cauduro Dias de Paiva, 1, 2 Jyri Pakarinen, 1 V esa V¨alim¨aki,3 and Miikka Tikander 3\n1 Department of Signal Processing and Acoustics, School of Electrical Engineering, Aalto University, 02150 Espoo, Finland\n2 Nokia Institute of Technology (INdT), SCS 1 Ed. Camargo Corr ˆea, 6th ﬂoor, 70397900 Brasilia, Brazil\n3 Nokia Gear, It ¨amerenkatu 11, 00180 Helsinki, Finland\nCorrespondence should be addressed to Rafael Cauduro Dias de Paiva, rcdpaiva@yahoo.com.br\nReceived 14 October 2010; Accepted 28 January 2011\nAcademic Editor: Jonathan Abel\nCopyright © 2011 Rafael Cauduro Dias de Paiva et al. This is an open access article distributed under the Creative Commons\nAttribution License, which permits unrestricted use, distributio n, and reproduction in any medium, provided the original work is\nproperly cited.\nAn audio transformer is used in a guitar ampliﬁer to match the impedances of the power ampliﬁer and a loudspeaker. It is\nimportant to understand the inﬂuence of the audio transformer on the overall sound quality for realistic tube ampliﬁer emulation.\nThis paper proposes to simulate the audio transformer using a wave digital ﬁlter model, which is based on the gyrator-capacitor\nanalogy. The proposed model is two-directional in the sense that it outputs the loudspeaker current, but it also connects backward\nto the power ampliﬁer thus a ﬀecting its behavior in a nonlinear manner. A practical parameter estimation procedure is introduced,\nwhich requires only the measurement of basic electrical quantiti es but no knowledge of material properties. Measurements of a\nFender NSC041318 and a Hammond T1750V transformer are presented as case studies, as well as parameter ﬁtting and simulation\nfor the Fender transformer. The results show that these practical transformer designs introduce distortion at low frequencies only,\nbelow about 100 Hz for the Fender and 30 Hz for the Hammond transformer, and that the proposed model faithfully reproduces\nthis e ﬀect. The proposed audio transformer model is implemented in real time using the BlockCompiler software. Parametric\ncontrol allows varying and also exaggerating the model nonlinearities.\n1. Introduction\nAlthough there are new and cheaper technologies for guitar\neﬀects and ampliﬁcation, vacuum tube ampliﬁers remain\nextremely popular. Some reasons for this popularity are the\nsoft clipping characteristics of tubes, which nicely enhance\nguitar timbre, and also that many guitar players strive for the\nsame sound as their idols from the 60s and 70s. Despite their\nnice sound characteristics, vacuum tube ampliﬁers rely on\nheavy and bulky components, and they typically are much\nmore expensive than their solid-state counterparts.\nAudio transformers represent an important part of guitar\npower ampliﬁers. They are responsible for the impedance\nmatching between ampliﬁcation circuits and the loud-\nspeaker, but they also have an e ﬀect on the ampliﬁed\nsignal. Audio transformers by themselves do not have a\nﬂat frequency response. This is caused by the magnetizing\ninductance, parasitic reactances, such as leakage inductance,\nwinding capacitances, and by frequency-dependent losses\npresent in magnetic components. These losses include ohmic\nlosses, caused by winding resistances; eddy current losses,\ncaused by parasitic currents induced in the magnetic material\ndue to varying magnetic ﬂux; hysteresis losses. The latter\ntwo are caused by the fact that magnetic materials change\ntheir behavior every time the magnetic ﬂux is reversed\ncausing a small amount of energy to be dissipated at every\ncycle, resulting in frequency-dependent losses. Additionally,\nthe magnetic material in audio transformers may present a\nfrequency-dependent saturation, which di ﬀers signiﬁcantly\nfrom the saturation caused by vacuum tube ampliﬁer stages.\nMany studies have been performed in recent years on\nthe emulation of vacuum tube ampliﬁers [ 1], which are\noften implemented in low-cost guitar e ﬀects. Some popular\napproaches derive from static waveshaping, which does not\nsimulate the nonlinear dynamics of the full ampliﬁcation\nsystem. Additionally it is possible to use nonlinear ﬁlters,\n2 EURASIP Journal on Advances in Signal Processing\nsuch as V olterra techniques [ 2], which can be matched to the\ndesired nonlinear response characteristic, and physics-based\napproaches, which are chosen for this work. Among physical\nmodeling techniques, some works focus on directly modeling\nand solving the di ﬀerential equations of the nonlinear\ncircuits [ 3–5], nodal analysis and state-space approaches\n[6, 7], and wave digital ﬁlters (WDFs) [ 8–11]. WDFs provide\na simple approach for circuit emulation, which enables\neﬃcient implementation in real time.\nAudio transformer models in the literature include\nlinear models implemented in SPICE [ 12], WDFs [ 10],\nextended state-space techniques [ 13], and di ﬀerential equa-\ntion approximation [ 14]. Additionally, a nonlinear model\nfor o ﬄine vacuum tube guitar simulation is proposed in\n[15] using the Jiles and Atherton model [ 16]f o rm a g n e t i c\nlosses. Di ﬀerent models for magnetic behavior are available\nin the literature. The Jiles and Atherton model includes\nimplicit di ﬀerential equations used to determine the behav-\nior of magnetic hysteresis. This is successful for modeling\nmagnetic behavior, although parameter ﬁtting may not be\nstraightforward, and the concept complexity tends to push\ndesigners/engineers to simpler solutions. A hyperbolic curve\nﬁ t t i n gp r o c e d u r ei sp r o p o s e di n[17], where the function can\nbe easily ﬁtted by parameters available in magnetic material\ndatasheets. However, the determination of the curve shape\nis based on ﬂux maximum and minimum values and would\nneed to be dynamically changed as the waveform varies. This\nis usually not a problem for power electronics simulations\nin which the signal amplitude and frequency are kept nearly\nconstant but would be for audio signals, which have a wide\nbandwidth and varying amplitudes.\nOther models have emerged from the gyrator-capacitor\n(GC) analogy, which provides an intuitive approach for\nunderstanding magnetic behavior [ 18]. This approach makes\nunderstanding the behavior of highly complex magnetic\ncircuits possible [ 19], and a complete model including core\nsaturation and hysteresis may be obtained with a nonlinear\ncapacitor and resistor [ 20]. Additionally, the elements used in\nthis model make it an excellent candidate for implementation\nusing WDFs. Preisach and other multistate transformer\nmodels [ 21] are cumbersome and costly and may not be\nappropriate for real-time implementation. Therefore, the GC\nmodel was chosen.\nThis paper proposes a WDF implementation of a nonlin-\near audio transformer model for real-time guitar ampliﬁer\nemulation. The complete model for audio transformer\nincludes, in addition to the nonlinear transformer behavior,\nparasitic phenomena such as leakage inductance, winding\nresistance, and input/output capacitance, which are impor-\ntant for matching the transformer’s frequency response.\nNonlinear behavior is modeled using a GC approach [ 20],\nand a parameter ﬁtting procedure is proposed requiring\nonly simple measurements instead of prior knowledge of\nmaterial properties, since in many cases detailed information\nis not available for the material and core type. A WDF\nmodel is proposed to enable realistic simulation of the\ninteraction between the transformer’s varying impedance\nand the backward connected circuitry, which changes its\ndistortion behavior with the nonlinear load represented by\nthe transformer. A real-time implementation of a complete\noutput chain of a single-ended guitar ampliﬁer is described,\nwhich proves the feasibility of the method.\nSection 2 reviews some basic concepts of transformer\nbehavior, as well as magnetic quantities. A short introduction\non WDFs is presented in Section 3 , focusing on the imple-\nmentation aspects used in this paper. Section 4 presents the\ntransformer model using the GC approach, while Section 4.2\npresents a new ﬁtting procedure for the proposed model.\nIn Section 4.3 a new WDF implementation of the audio\ntransformer is presented. In Section 4.4 a measurement setup\nis proposed for parameter ﬁtting and testing the proposed\nmodel, while in Section 4.5 simulated and measurement\nresults are compared. In Section 5\nthe proposed model is\nincluded in the output chain of a single-ended vacuum tube\nampliﬁer implemented in real time using WDFs. Section 6\nconcludes the paper.\n2. T ransformer Characteristics\nand Nonlinearity\nThe nonlinear behavior of an audio transformer has some\npeculiar characteristics which di ﬀer from other components\nin vintage analog circuits. Since saturation-like distortion\noccurs in the magnetic domain, it does not manifest itself\nas simple clipping in the electrical domain. Additionally,\nmagnetic distortion is dependent on previous values of the\nmagnetic ﬁeld, and the distortion cannot be modeled with\nsimple static nonlinearities.\nElectrical signals are related to magnetic signals by the\nfollowing well-known relationships. The voltage Eis the time\nderivative of the magnetic ﬂux Φ,\nE\n= −NdΦ\ndt ;( 1 )\nwhere N is the number of turns. The magnetic ﬂux is related,\nin turn, to the magnetic ﬁeld, or ﬂux density, B by the area\nintegral\nΦ=\n∫\nBda=BAe,( 2 )\nwhere Ae is the core’s e ﬀective area. The ﬂux density B is\nmost often used in magnetic material speciﬁcations, since\nmagnetic properties using Φ are related to the transformer’s\ncore geometry. The magnetizing force H is related to the\ncurrent ﬂowing in a winding of a transformer by simply\nconsidering its number of turns N so that\nH\n=Ni, (3)\nwhere iis the current through the winding.\nFor linear magnetic materials, Bis linearly related to H as\nB =μH, (4)\nwhere μrepresents the permeability of the material. However,\nthis relationship is not followed for high values of B or H,\nEURASIP Journal on Advances in Signal Processing 3\nB\nHHC\nBr\nFigure 1: Basic theoretical B versus H curve showing hysteresis.\nas shown in Figure 1 , where it can be seen that, for high\nexcursions in H, saturation occurs in B.T h i se ﬀect is caused\nby the inherent properties of magnetic materials, which can\nbe interpreted as decreased permeability for high values of\nH. Additionally, a loop can be observed in the B versus H\ncurve, which means that the Bvalue not only depends on the\nH value but also on its previous magnetic history. This loop\nis related to losses occurring in the magnetic material which\nincreases with frequency.\nFigure 2(a) shows an example of how distortion would\noccur in an audio transformer. In this example assuming a\n1 : 1 turns ratio, the output voltage would be expected to be\nthe same as the input when no magnetic saturation takes\nplace. Observing the 50 Hz example, shows that distortion\noccurs after the input voltage has reached its peak and lingers\nafter the input voltage has begun to decrease. This happens\nbecause the magnetic ﬂux Φrelates to voltage via a derivative\noperation, and hence for a sinusoidal input there is a 90\ndegree shift between the ﬂux and voltage. As saturation\noccurs in the B versus H mapping, maximum B would be\nreached at a voltage near zero, where maximum distortion is\nobserved.\nThe same transformer produces di ﬀerent saturation\nbehavior at di ﬀerent frequencies for the same characteristics\nof the input signal. Figure 2(a) shows the expected behavior\nat 50 and 100 Hz. As can be observed, with doubled fre-\nquency almost no distortion is present in the output signal.\nAs Φ is proportional to the integral of E in ( 1), it will have\na higher amplitude when the frequency is lower. Additional\ninput/output voltage relationships can be observed in Figure\n2(c), where at 100 Hz a nearly linear relationship is seen,\nwhile it changes as frequency is decreased. The shape of the\ninput/output mapping is also seen to change with frequency.\nThus, electric transformers have combined frequency-\ndependent losses and nonlinearity which causes them to\nhave a bandpass characteristic. On one hand, high-frequency\nsignals would have a small amount of nonlinear distortion\nand high magnetic losses. This frequency-dependent loss is\nrelated to the amount of energy transfer and will cause a\ndecreased output voltage. On the other hand, although low-\nfrequency signals would have lower magnetic losses, they\nwould vanish from the high distortion caused by magnetic\nbehavior.\nIn addition to the input/output voltage relationships,\nthe impedance observed from input circuit changes when\nthe transformer reaches saturation. As shown in Figure 2(b) ,\na high current surge at the primary of the transformer\nis observed during saturation periods. In this period, the\nequivalent inductance in the primary winding is lower, and\nthe coupling between the primary and the secondary is lower.\nHence, the equivalent impedance in the primary is also lower,\ncausing this kind of current surge. In guitar ampliﬁer circuits,\nas shown in Figure 3 , the series impedance of the primary\nconnected to the valves will be lower at saturation, which\nwill change the behavior of the ampliﬁer circuit. Thus, the\nsaturation of a transformer has an e ﬀect not only on its\ninput/output relationship but it also modiﬁes the behavior\nof the electronic components connected to it.\n3. W ave Digital Filters\nWFDs, introduced by Fettweis [ 22], o ﬀer a modular and\nrelatively light approach for real-time circuit simulation. The\nmain di ﬀerence between WDFs and most other modeling\nmethods is that WDFs represent all signals and states as wave\nvariables and use local discretization for the circuit compo-\nnents instead of the physical quantities themselves. Di ﬀerent\nelectrical components are represented as elementary blocks,\nand they are connected to each other via adaptor blocks. Only\na brief introduction to WDFs is presented in the following.\nFor more thorough tutorials, see, for example, [ 22, 23].\n3.1. Wave Digital Filter Components. WDF components con-\nnect to each other using ports. Each port has two terminals,\none for transporting incoming and another for transporting\noutgoing waves. Also, each port has an additional parameter,\nthe port resistance, which is used to implement proper\nimpedance coupling between components. The relationship\nbetween the Kirchho ﬀ pair (e.g., voltage U and current I)\nand wave variables Aand B is given by\n⎡\n⎣A\nB\n⎤\n⎦=\n⎡\n⎣1 Rp\n1 −Rp\n⎤\n⎦\n⎡\n⎣U\nI\n⎤\n⎦⇐⇒\n⎡\n⎣U\nI\n⎤\n⎦\n= 1\n2\n⎡\n⎢⎢⎣\n11\n1\nRp\n− 1\nRp\n⎤\n⎥⎥⎦\n⎡\n⎣A\nB\n⎤\n⎦,\n(5)\nwhere Rp denotes the port resistance.\nIt should be noted that this port resistance is purely\na computational parameter and it should not be confused\nwith the electrical resistance. Some elementary circuit\ncomponents, such as resistors, capacitors, and inductors,\ncan be represented using WDF one-port elements. Other\nelectric components, such as transformers and gyrators, are\nrepresented with two-port elements. The linear electrical\ncomponents used in this paper are presented together with\n4 EURASIP Journal on Advances in Signal Processing\n0 0.005 0.01 0.015 0.02 0.025 0.03 0.035 0.04\n−1\n−0.8\n−0.6\n−0.4\n−0.2\n0\n0.2\n0.4\n0.6\n0.8\n1\nOutput 100 Hz\nOutput 50 Hz\nTime (s)\nVoltage (V)\n(a)\n0 0.005 0.01 0.015 0.02 0.025 0.03 0.035 0.04\nTime (s)\n−8\n−6\n−4\n−2\n0\n2\n4\n6\n8\nCurrent 100 Hz\nCurrent 50 Hz\nCurrent (A)\n(b)\n−1\n−0.8\n−0.6\n−0.4\n−0.2\n0\n0.2\n0.4\n0.6\n0.8\n1\n−1 −0.50 0 . 5 1\nInput voltage (V)\nOutput voltage (V)\n10 Hz\n20 Hz\n50 Hz\n100 Hz\n(c)\nFigure 2: Example of saturation in a power transformer. (a) Output voltage and (b) current at 50 and 100 Hz and (c) the input versus output\nvoltage.\ntheir WDF counterparts in Figure 4 . The port resistances of\nthe one-port elements in Figure 4 can be given as follows:\nRp =\n⎧\n⎪⎪⎪⎪\n⎪⎪⎨\n⎪⎪⎪\n⎪⎪⎪\n⎩\nR, for resistance,\n1\n(2CFs) , for capacitance,\n2LFs, for inductance,\n(6)\nwhere R, C,a n d L are the electrical resistance (Ohms),\ncapacitance (Farads), and inductance (Henrys), respectively,\nwhile F\ns stands for the sample rate (Hertz). Similar to the\nWDF resistor, the port resistance of a voltage source is\nequivalent to the physical resistance. The port resistance of a\ngyrator is equal to its transformation ratio, and it is the same\nfor both ports. The port resistances of a transformer are not\nidentical but are related by the square of the turns ratio, as\ngiven in Figure 4(g) .\n3.2. Adaptors. The WDF circuit components connect to each\nother via adaptors. In practice, the adaptors direct signal\nrouting inside the WDF circuit model and implement the\ncorrect impedance coupling via port resistances. Although\nthe number of ports in an adaptor is unlimited in principle,\nEURASIP Journal on Advances in Signal Processing 5\nVcc\nVin\n−Vin\nAudio\ntransformer\nFigure 3: Typical guitar ampliﬁer output stage using a push-pull\ntopology.\n3-port adaptors are typically used since any N-port adaptor\n(N> 3) can be expressed using a connection of 3-\nport adaptors so that the whole WDF circuit becomes a\nbinary tree structure [ 24]. There are two types of WDF\nadaptors, series and parallel, which implement the series and\nparallel connection between elements, respectively. The port\nresistance values for the adaptors must be set equal to the\nport resistances of the elements they are connected to.\nThe outgoing wave B\nn at port n = 1, 2, 3 of a 3-port\nadaptor can generally be expressed as\nBn =\n⎧\n⎪⎪⎪⎪⎨\n⎪⎪\n⎪⎪⎩\nAn −2Rn(A1 + A2 + A3)\n(R1 + R2 + R3) , for a series adaptor,\n2(G1A1 + G2A2 + G3A3)\n(G1 + G2 + G3) −An\n, for a parallel adaptor,\n(7)\nwhere An denotes the incoming wave at port nand Gn =1/Rn\nis the port conductance. Equation ( 7) shows that in principle\nall waves leaving the adaptor depend on all incoming waves\nand all port resistances. This poses a computability problem\nwith such WDF components that have instantaneous depen-\ndencies between the port terminals, such as transformers,\ngyrators, and nonlinear components.\nAs a remedy, one WDF one-port component must be\nchosen as a root of the binary tree so that each simulation\ncycle starts by ﬁrst evaluating the waves propagating towards\nthe root after which the waves propagating away from the\nroot are evaluated. This is enabled by properly selecting\nthe adaptors’ port resistances for the ports facing the root\nso that the waves traveling towards the root can be made\nindependent of the waves traveling away from the root.\nFor example, if the port facing the root element is named\nas port one, and its port resistance is set to R\n1 =R2 +R3 when\nit is a series adaptor, or its port conductance to G 1 =G2 + G3\nwhen it is a parallel adaptor, then ( 7) simpliﬁes to\nB1 =\n⎧\n⎪⎪\n⎪⎨\n⎪⎪⎪⎩\n−\nA2 −A3, for a series connection,\nG2/(G2 + G3)A2 + G3\n(G2 + G3)A3\n, for a parallel connection,\n(8)\nfor the wave components traveling towards the root. In this\nexample, port one would be called adapted, or reﬂection-\nfree, since the outgoing wave does not depend on the\nincoming (reﬂected) wave. Such adapted ports are typically\ndenoted by a “T-shaped” ending for the outward terminal.\n3.3. Nonlinearities in WDFs. Nonlinear resistors can be mod-\neled by deﬁning the outgoing wave B as [ 25]\nB\n= R−Rp\nR+ Rp\nA, (9)\nwhere R is the electrical resistance of the root, Rp is the\nport resistance set by the adapted port connected to the\nresistor, and Ais the wave entering the resistor. Since the port\nresistance of the adapted port is independent of the electrical\nresistance of the root, the latter can freely be varied during\nsimulation without encountering computability problems.\nWith nonlinear resistors, the resistance value depends on\nthe voltage across the resistor, which in turn depends on the\nincoming and outgoing waves. As deﬁned by ( 5)a n d( 9), this\ncreates an additional local implicit loop, which in principle\nshould be solved iteratively. A practical remedy, however, is\nto insert a unit delay inside the loop. This approximation\nmay a ﬀect stability under heavily saturating nonlinearities,\nbut its e ﬀect is typically negligible under normal operating\nconditions (see, e.g., [ 11]).\nNonlinear electrical components can often be approxi-\nmated using voltage-controlled voltage and current sources\nby reading the voltage across the source as the input\nsignal, or by using an ideal variable-turns-ratio transformer\nconnected to a constant element. The latter approach has the\nadvantage of maintaining the energy balance when energy\nstoring nonlinear elements are used. In the case of inductors\nand capacitors, the equivalent component value is easily\ndetermined by\nL\ne = L\nN2 ,\nCe =CN2,\n(10)\nwhere L and C are the original inductances and capacitance\nvalues, respectively, and N is the turns ratio of the time-\nvarying transformer.\nThese circuit components also su ﬀer from the above-\nmentioned local feedback loop, but artiﬁcial unit delays will\nusually solve this problem. Since a nonlinear WDF element\nshould be connected as the root of the binary tree due to\npreviously discussed computability issues, having multiple\nnonlinear components within a tree creates another problem.\nIn principle, multiple nonlinearities would require global\n6 EURASIP Journal on Advances in Signal Processing\nH(z)UI\nA\nB\n(a)\n0\nRP\nR\nA\nB\n(b)\nC\nRP\nA\nB\nZ−1\n(c)\nL\nRP\nA\nB\n−1\nZ−1\n(d)\nR\nE\nE\nRP\nA\nB\n2\n∼\n(e)\nRP RP\nA\nBA\nB\n−1\nI1 I2 U2U1\nN =RP\n(f)\nA\nAB\nB\nRP2 =N2RP1RP1\nI1 I2 U2U1\n1/N\n1/N\nN\n(g)\nFigure 4: Linear WDF elements used in this paper: (a) a generic one-port with voltage U across and current I at the terminals, (b) a resistor,\n(c) capacitor, (d) inductor, (e) voltage source, (f) gyrator, and (g) an ideal transformer. Here, A represents an incoming wave for each\nelement, while B denotes an outgoing wave. Rp stands for the port resistance. This ﬁgure is adapted from [ 11].\nN1 N2\nV2H1 H2V1\nCc\nCl1 Cl2\n+\n−\n+\n−\n+\n−\n+\n−\n••••\n˙Φ2˙Φ1\nFigure 5: Basic gyrator-capacitor model of a transformer.\niteration on the subtree connecting the nonlinear elements,\ndramatically increasing the computational cost. As before,\ninserting a unit delay between the nonlinearities solves the\ncomputability issue but may create instabilities. As a general\nrule, by increasing the number of artiﬁcial unit delays, one\nincreases the risk of encountering stability problems [ 26].\nHowever, preliminary experimental tests suggest that, as long\nas the model stays stable, the unit delays do not result in\naudible artifacts.\n4. Audio T ransformer Model\n4.1. Gyrator-Capacitor Model. The model used in this paper\nis based on a gyrator-capacitor (GC) approach [ 18]. This\nkind of model has been used in power electronics to model\nmultiple-winding elements for its simplicity. By using this\napproach, the relationship between physical quantities can\nbe easily visualized; hence, it also serves as a tool for\nunderstanding the magnetic behavior of the system.\nA basic transformer model is shown in Figure 5 . In this\nﬁgure, gyrators, also known as dualizers, with transforma-\ntion ratio N are used to model the conversion between\nelectrical and magnetic quantities. The input/output relation\nof the gyrator is summarized by ( 11)a n d( 12), which\nassures energy-conserving properties, since v\n1i1 = v2i2.\nAdditionally, the gyrator interchanges the behavior of the\ncapacitors/inductors and the current/voltage source:\nv\n1 =i2N, (11)\ni1 = v2\nN. (12)\nBy using the GC approach, the current and voltage in\nthe electrical domain are related to the magnetizing force\nand magnetic ﬂux in the magnetic domain by the same\nrelations given in ( 1)a n d( 3). The gyrator is used to convert\nthe electrical quantities to the magnetic domain, where the\nelectrical voltage V is related to the magnetic ﬂux density\nderivative dΦ/dtas in ( 1)a n d( 11), and the electrical current\nI is related to the magnetizing force H as in ( 3)a n d( 12),\nwhere N is the number of turns of the winding a gyrator\nis representing. In Figure 5 , two windings with N\n1 and N2\nturns are represented by the gyrators, and capacitances are\nrelated to possible magnetic paths, since ( 4) may be modiﬁed\nas\nΦ=BAe =μHAe, (13)\ndΦ\ndt =μAe\ndH\ndt , (14)\nwhere ( 14) can be interpreted as the equation of a capacitor\nwith current d Φ/dt, voltage H, and capacitance μAe.I n\nFigure 5 , Cc represents the core permeance, which couples\nthe primary and the secondary, while Cl1 and Cl2 represent\nthe primary and secondary winding’s leakage inductances,\nwhich model the uncoupled magnetic ﬂux. Other parasitic\nelements may be included by adding series resistances R\n1\nand R2 to each winding, representing the ohmic losses\nexperienced by the transformer, and parallel capacitances C1\nand C2, which a ﬀect the overall frequency response of the\ntransformer.\nThe GC model can be extended by including a nonlinear\ncapacitor, representing the core’s nonlinear permeance [ 18],\nand a nonlinear resistor, modeling magnetic loss due to the\nhysteresis loop [ 20], as shown in Figure 6(a) . By modiﬁcation\nof the nonlinear capacitance C\nc, it is possible to model the\nsaturation e ﬀect in the B versus H curve. This model is\noften represented using a capacitor in series with a voltage-\ncontrolled voltage source, with the voltage E\nC(vc)d e ﬁ n e da s\nEC(vc) =a|vc|n sign(vc), (15)\nEURASIP Journal on Advances in Signal Processing 7\nCe Rc\nN1 N2\nV1 H1 H2 V2Cl1 Cl2C1 C2\nR1 R2\n+\n−\n+\n−\n+\n−\n+\n−\n••••\n˙Φ2˙Φ1\n(a)\n+− ••\n˙Φ2˙Φ1\nV1 H1 H2 V2Cl1 Cl2C1 C2\nR1\n+\n−\n+\n−\n+\n−\n+\n−\nR2EC\nr\nIR\nCc\n(b)\nFigure 6: Nonlinear gyrator-capacitor model of a transformer (a)\nwith nonlinear capacitance and resistance and (b) the equivalent\ncircuit using voltage-dependent voltage and current sources.\nwhere vc is the voltage over the capacitance CC,a n de q u i v a -\nlent capacitance\nCe(vc) = Cc\n1+ a|vc|n−1 , (16)\nwhere CC represents the core permeance in the linear region,\nn controls the sharpness of the saturation curve, and a\ncontrols the position of the saturation knee.\nIn addition to the saturation e ﬀect, the hysteresis loop\nis modeled by a nonlinear resistance. This resistance has\nhyperbolic relationship between voltage and current, hence\nkeeping a nearly constant voltage across its terminals. This\nis responsible for shifting H and therefore modeling the\nhysteresis loop. The nonlinear resistance is often represented\nby a linear resistor in parallel with a voltage-dependent\ncurrent source deﬁned as\nI\nR(vr) =b|vr|m sign(vr), (17)\nwhere vr is the voltage over the resistor r, which leads to an\nequivalent resistance of\nRc(vr) = r\n1+ b|vr|m−1 . (18)\nPlease notice that together the nonlinear capacitor and\nresistor in the model comprise a nonlinear impedance, which\ndepends on Φ and d Φ/dt and has memory. Hence, the\ncombination of elements is able to represent the dependency\non past states of the magnetic material over the current state.\nAdditionally, the same model is able to represent di ﬀerent\ntypes of H-versus-Φ loops, for example, asymmetric loops\nwhen current ﬂows in only one direction, loops close to\nsaturation when input voltage is high, or loops without\nsaturation when input voltage is low.\n4.2. Parameter Fitting. In this section, the parameters for the\nnonlinear magnetic behavior of the transformer are shown to\nbe easily determined by an open circuit measurement. In this\napproach, a sine wave is fed to the primary of the transformer\nwith no load in the secondary. In this case, by observing\nFigure 6(a) , the open load in the secondary has the e ﬀect of a\nshort circuit before the gyrator at H\n2, and the e ﬀect of leakage\ninductance Cl2 of the secondary can be ignored. Hence, Φ\nand H can be simply obtained from the input current i1 and\nthe output voltage V2 measurements via ( 3)a n d( 1), which\nare integrated to obtain Φ:\nH =N1i1,\nΦ=− 1\nN2\n∫\nV2dt.\n(19)\nOnce measurements of Φ and H have been obtained, an\noptimization procedure is needed to determine the nonlinear\ncapacitance and resistance parameters in the model. In the\nﬁrst step, a static saturation model is used to determine the\nnonlinear capacitance, while the hysteresis e ﬀects of Φand H\nare ignored. Calculation of the static Φ\ns and Hs is performed\nby determining the center of the hysteresis loop in the Φ\nversus H curve. Using a nonlinear voltage source model for\nthe nonlinear resistance, it is possible to derive the following\nΦand H relationship:\nˆHs = Φs\nC + a\n⏐⏐⏐⏐\nΦs\nC\n⏐\n⏐⏐⏐\nn\nsign\n(Φs\nC\n)\n, (20)\nwhich can be represented in matrix form using the measure-\nment points Φs[0], ... , Φs[K]a s\nˆHs =Φα, (21)\nwhere ˆHs is a vector with estimated H values for each mea-\nsurement point k,\nΦ=\n⎡\n⎢⎢⎢⎢\n⎢⎢⎢⎢⎢\n⎢⎢⎢⎣\nΦs[0] |Φs[0]|n sign(Φs[0])\n..\n.\n..\n.\nΦ\ns[k] |Φs[k]|n sign(Φs[k])\n... ...\nΦs[K] |Φs[K]|n sign(Φs[K])\n⎤\n⎥⎥⎥⎥\n⎥⎥⎥⎥⎥\n⎥⎥⎥⎦\n(22)\nrepresents the matrix containing the measured Φvalues, and\nα=\n[1\nC\na\nCn\n]T\n(23)\nis a vector with the parameters to be optimized.\nHence, it is possible to deﬁne a weighted least-squares\nsolution [ 27], by using the cost function\nξa =\n(\nHs −ˆHs\n)T\nWa\n(\nHs −ˆHs\n)\n, (24)\nwhere Hs is a vector with measured H values and Wa\ndetermines the weight each sample has on the optimization\nprocess\nWa =diag\n([\nwa0 ··· wak ··· waK\n])\n. (25)\n8 EURASIP Journal on Advances in Signal Processing\nG1\nRL\nCl1\nG2\nCl2CcC1R1 C2 R2\nCore mode\nWinding modelWinding model\n(a)\nRL\nCc\nCore model\nW\nW\nW\nW\nW\nW\nWinding 1 Winding 2\nWinding 3 Winding 4\nWinding N-1 Winding N\n..\n.\n..\n.\n..\n.\n(b)\nFigure 7: Proposed WDF model of a nonlinear transformer model for (a) two windings and (b) a multiwinding conﬁguration.\nBy analyzing the gradient of the cost function at ∇αξa =0i n\n∇αξa =HT\ns WaHs −2αTΦTWaHs + αTΦTWaΦα, (26)\nit is possible to get the optimum weighted least-squares\nsolution ˆαas\nˆα =\n(\nΦTWaΦ\n)−1\nΦTWaHs. (27)\nDetermination of the parameters, once α is determined, is\ndone as\nC = 1\nˆα[0] ,\na=ˆα[1]Cn.\n(28)\nThe best value of n is obtained by computing solutions for\nseveral nvalues, and the one with the lowest cost ξa is chosen.\nGood results are obtained by using a weight wak,w h i c h\nreduces the solution bias towards high H values and gives\nmore emphasis on the knee part of the Φ versus H curve.\nPrior normalization of the experimental data may be needed\nfor numerical stability of the matrix inverses in ( 27).\nThe nonlinear resistance parameters may be estimated by\nusing the remanence ﬂux density Φ\nr or Br when H =0a s\n0 = ΦR\nC + a\n(ΦR\nC\n)n\n+ vR, (29)\nwhere vR is the voltage across the nonlinear resistor when\nH =0,\nvR = Φr\nC + a\n(Φr\nC\n)n\n=r\n(˙ΦR\n)\n, (30)\nand the coercive force Hc, when Φ=0, is\nHc =vr =r\n(˙Φ+ bvm\nr\n)\n, Φ=0, (31)\nV1\nI1 I2\nRL\nRM\nPower\nampliﬁerVin\n+\n−\nV2\n+\n−\nFigure 8: Measurement setup in which the audio transformer is\nconnected to a power ampliﬁer through a series resistor RM and a\nload resistor RL replacing a loudspeaker.\nshown in Figure 1 as\nr = Hc\n˙Φc −bHmc\n,\nb = Hc −vrc\nHcvmrc −Hmc vrc\n.\n(32)\nWhen no information is available on the number of turns\nof the transformer, it is possible to use an arbitrary number\nof turns for the primary and secondary windings with respect\nto the transformation ratio. This can be easily obtained by\nﬁxing N\n1 and determining N2 = kN1. The transformation\nratio k can be obtained from the measurements of primary\nand secondary inductances as k =\n√\nL2/L1.\nA practical way to determine parasitic elements is to\nuse a normal commercial multimeter with resistance and\ninductance measurements. The resistance responsible for\nohmic losses is determined by directly measuring each\nwinding resistance. Leakage inductances are determined\nby measuring the inductance of the winding while short\ncircuiting other windings. Once the leakage inductance L\nlw\nfor a winding w is determined, the leakage capacitance Clw\nfor the gyrator-capacitor model is determined as\nClw = Llw\nN2w\n. (33)\nEURASIP Journal on Advances in Signal Processing 9\n40\n20\n0\n−20\n−40\n−60\n100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n1\n2\n3\n4\n5\n(a)\n40\n20\n0\n−20\n−40\n−60\n100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n1\n2\n3\n4\n5\n(b)\n40\n20\n0\n−20\n−40\n100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n1\n2 3\n4\n5\n(c)\n40\n20\n0\n−20\n−40\n−60 100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n1\n2\n3\n4\n5\n(d)\nFigure 9: Measurements performed on a Fender transformer using a logarithmic sweep analysis tool [ 28]: (a) input current, (b) input\ncurrent with the loaded transformer, (c) output voltage, and (d) outp ut voltage with the loaded transformer. The numbered curves denote\nthe magnitude of each harmonic component, wher e number 1 refers to the fundamental frequency.\n4.3. Wave Digital Filter Model. This section proposes a\nnew WDF model for a two-winding audio transformer in\naccordance with Figure 7(a) . In this model, it is possible\nto notice common elements for each winding w,w h i c h\ninclude a gyrator G\nw,ac a p a c i t o rClw representing the leakage\ninductance, a capacitor Cw representing winding parasitic\ncapacitance, and a resistor Rw representing ohmic losses.\nEach winding is connected in series with the nonlinear core\nelements C\nc and Rc.\nThe nonlinear elements use the approximations\ndescribed in Section 3 . The nonlinear resistor was calculated\nas in ( 18), and vr was delayed by one time sample. The\nnonlinear capacitance was implemented by using a constant\ncapacitance C\nc connected by a nonlinear transformer with\nthe variable turns ratio calculated based on the delayed\nvoltage v\nc =Φ/Cc as\nNc(vc) =\n√\n1\n1+ a|vc|n−1 . (34)\nThe model in Figure 7(a) can be easily expanded to an N-\nwinding transformer. By connecting each winding’s elements\nin series with the core elements, it is possible to generalize the\nmodel for any number of windings, as shown in Figure 7(b) .\nHence, this model enables a block implementation and easy\nadaptation for any transformer conﬁguration.\nThe nonlinear elements in Figure 7 were implemented\nusing delays. This simpliﬁcation enables connecting several\nnonlinear elements in the WDF network, without the need\nfor iterations between nonlinear elements.\n4.4. Measurement Setup. The practical measurement setup\nused a Fender NSC041318 transformer, connected to a linear\naudio ampliﬁer, Y amaha MX-70, as shown in Figure 8 . This\ntransformer is commonly used in Fender Deluxe and Deluxe\nReverb ampliﬁers. Since possible output voltages in the\npower ampliﬁer are often limited, the transformer secondary,\nwhich is the low-voltage winding on vacuum tube ampliﬁers,\n10 EURASIP Journal on Advances in Signal Processing\n20\n0\n−20\n−40\n−60\n100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n2\n3\n4\n5\n1\n(a)\n40\n20\n0\n−20\n−40\n−60\n100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n2\n34\n5\n1\n(b)\n40\n20\n0\n−20\n−40 100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n2\n3\n4\n5\n1\n(c)\n40\n20\n0\n−20\n−40 100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n2\n3\n4\n5\n1\n(d)\nFigure 10: Measurements performed on a Hammond transformer using a logarithmic sweep analysis tool [ 28]: (a) input current, (b) input\ncurrent with the loaded transformer, (c) output voltage, and (d) outp ut voltage with the loaded transformer. The numbered curves denote\nthe magnitude of each harmonic component, wher e number 1 refers to the fundamental frequency.\nis connected to the power ampliﬁer output. For full load\nmeasurements, a load resistor RL is connected to the high-\nvoltage winding of the transformer. The load resistance value\nwas chosen as\nR\nL =\n(N2\nN1\n)2\nRt, (35)\nwhere N1 and N2 are the primary/secondary number of turns\nand Rt is the usual loudspeaker resistance, for example, 8\nΩ. It is important to notice in practical measurements that\nresistor RL will dissipate all of the transformer power during\nthe measurement, and hence a power resistor must be used.\nAn additional element in the measurement setup\nincludes a series resistance RM. This is used to measure the\ninput current as well as for limiting the input current if\ntransformer saturation is reached. As shown in Section 2 , the\ntransformer impedance is drastically reduced during satu-\nration periods, and hence high current peaks are observed\nduring saturation. The peak limitation is important to avoid\nbreaking of fuses or other protection mechanisms of the\npower ampliﬁer during experimental measurements. The\ninput signal for the power ampliﬁer is generated by a\ncomputer. This enables either simple analysis using ﬁxed\nfrequency sines or square waves as well as complex analysis,\nfor example, with sweep signals.\nOnce the transformer was connected, two main sets of\nmeasurements were conducted. In the ﬁrst one, full load\nwas considered with R\nL,a si n( 35), in order to emulate\nthe transformer load when connected to a loudspeaker. In\nthe second set, no load was connected to the transformer\nprimary, or R\nL =∞ . This open load measurement setup\nwas important to determine the transformer’s magnetic\nelements, as discussed in Section 4 .\n4.5. Transformer Measurements. Measurements with maxi-\nmum voltage amplitudes are shown in Figure 9 . A logarith-\nmic sweep analysis between 20 Hz and 10000 Hz of the DATK\nsoftware tool was used [ 28] for the input current and output\nEURASIP Journal on Advances in Signal Processing 11\nTa bl e1: Parameters used for the Fender transformer model.\nParameter V alue Unit\nN1 100 —\nN2 6.47 —\nC 24.7 m F\na 900 —\nn 7—\nr 0.077 Ω\nb 4.46 —\nm 4—\nCl1 500 n F\nCl2 500 n F\nR1 206 Ω\nR2 0.7 Ω\nC1 1n F\nC2 1n F\nvoltage with and without load. In order to avoid current\nsurges during saturation, an input resistance of 2.4 Ω was\nused, and the input current was measured based on the\nvoltage across this resistor.\nThe distortion is observed, in Figure 9 , to occur at low\nfrequencies, below 100 Hz, since the level of the harmonic\ncomponents 2–5 generally decays with frequency. By analyz-\ning ( 1), it is possible to understand that, for the same input\nvoltage, the magnetic ﬂux Φ is larger when the frequency is\nlower. This explains the strong saturation at low frequencies\nobserved in the results. Comparing the currents and voltages\nshows that the input current su ﬀers from higher distortion\nthan the output voltage. Hence, it is possible to say that\nthe transformer e ﬀect may be in practice enhanced by the\ninteraction between the transformer’s changing impedance\nand the circuitry connected to its primary. Additionally,\none sees that the open load input current and the output\nvoltages increase at high frequencies, which indicates the\ninﬂuence of parasitic capacitances, causing a resonance with\ninductances at high frequencies. The amplitude peaks in\nFigure 9 for the higher harmonics at high frequencies are due\nto the measurement artifacts related to the exponential sweep\ntechnique and are not present in reality.\nMeasurements were conducted for two output load situ-\nations in order to show that the frequency behavior depends\non the type of output load connected to the transformer.\nExperiments have shown some load dependency on the\ntransformer nonlinearity. By comparing Figures 9(a), 9(c) to\nFigures 9(b), 9(d), one may observe that by having a resis-\ntance as the output load there is a decrease in the harmonic\ncontent generated by the transformer’s nonlinearity. This is\nunderstood by analyzing the equivalent transformer circuit\nin Figure 6 under short-circuit and open-circuit conditions.\nIn the case of short circuiting the secondary, the small\nresistance in the secondary of the second gyrator is mapped\n−1 −0.5 0 0.5 1\n−1\n−0.8\n−0.6\n−0.4\n−0.2\n0\n0.2\n0.4\n0.6\n0.8\n1\nNormalized magnetic ﬁeld H\nNormalized magnetic ﬂux Φ\nMeasured Φ×H curve\nStatic Φ×H curve\nModel Φ×H curve\nFigure 11: Normalized Φ versus H curve for the Fender trans-\nformer and model including ﬁtted parameters.\nonto an inﬁnite resistance (or an open circuit) connected in\nparallel to the capacitor Cl2. In the case of an open circuit at\nthe transformer secondary, the inﬁnite resistance is mapped\nonto a short circuit connected in parallel to the capacitor\nC\nl2. Hence, the open circuit case is the one that presents the\nlowest impedance to the voltage representing the primary\nmagnetizing force H\n1, which will cause the highest magnetic\nﬂux Φ.\nFurther measurements were performed for a Hammond\nT1750V transformer, which is used in the V ox AC30 guitar\nampliﬁers, and the results are shown in Figure 10 .I tc a nb e\nseen that this transformer has a lower level of distortion,\nwhich is mostly concentrated at very low frequencies, below\n30 Hz. When comparing it to the Fender transformer in\nFigure 9 , a lower distortion is observed at all frequencies.\nSince the normal tuning for the low E string on the guitar is\n82.4 Hz (E2), this transformer could be approximated using\na linear model.\nParameter ﬁtting of the nonlinear model in Section 4.3\nresulted in the values shown in Ta b l e 1. The accuracy of the\nnonlinear model can be observed in Figures 11 and 12.I n\nFigure 11 , the Φ versus H curve shows good accuracy for\nan 80 Hz sine input between the modeled and measured\nmagnetic behavior, which includes both the transformer\nsaturation and the hysteresis. Please notice that these results\napply only to the periodic test signals used.\nComparing Figures 12 and 9 shows that the frequency\nbehavior of the model resembles the one observed in\npractical measurements. The main di ﬀerences occur in some\nharmonics that stop decreasing their amplitudes beyond\na certain frequency. Those di ﬀerences may be caused by\ntransformer losses that were not included in the model,\nsuch as eddy current losses, which could cause extra energy\ndamping at higher frequencies, as well as inaccuracies in\nthe nonlinear functions for small H and Φ values, since the\n12 EURASIP Journal on Advances in Signal Processing\n40\n20\n0\n−20\n−40\n−60 100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n1\n2 3\n4\n5\n(a)\n40\n20\n0\n−20\n−40\n−60\n100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n1\n2\n34\n5\n(b)\n40\n20\n0\n−20\n−40 100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n1\n2 3\n4\n5\n(c)\n40\n20\n0\n−20\n−40 100 1 k 10 k\nAmplitude (dB)\nFrequency (Hz)\n1\n2\n3\n4 5\n(d)\nFigure 12: Emulated results with the WDF model based on the Fender transformer using a logarithmic sweep analysis tool [ 28]: (a)\ninput current, (b) input current with the loaded transformer, (c) output voltage and (d) output voltage, with the loaded transformer. The\nnumbered curves denote the magnitude of each harmonic comp onent, where number 1 refers to the fundamental frequency.\ntransformer model was optimized for a close-to-saturation\ncondition. Additionally, the high-pass characteristic has\ndiﬀerences to the one observed in measured results. This\ndiﬀerence can be explained by the fact that in practice\nthe input/output capacitances are distributed throughout\nthe input/output windings. These distributed capacitances\ncould be modeled by several interleaved inductances and\ncapacitances, although this kind of model would signiﬁcantly\nincrease the computational complexity and make parameter\nﬁtting harder.\n5. T ube Ampliﬁer Output Chain\nThis section presents a new complete output chain model for\na single-ended vacuum tube guitar ampliﬁer. WDF circuit\nelements connections are presented in Figure 13(a) ,w h i c h\nincludes a connection to a triode, using Koren’s model [ 29],\na linear model for the output speaker shown in Figure\n13(b), and the nonlinear transformer model presented in\nSection 4.3 . The complete circuit is an enhanced version of\nthe single-ended guitar ampliﬁer model presented in [ 10],\nwhile the tube model is the same as that presented in\n[11].\nSimulation results for a sine input are shown in Figure 14 .\nThe output sound pressure is measured in this circuit as\nthe current through the loudspeaker acoustic resistance R\na\nin Figure 13(b) . The transformer parameters used in this\nsimulation are the optimized parameters in Ta b l e 1,e x p e c t\nfor the parameter a, which was modiﬁed to provide di ﬀerent\nlevels of transformer distortion.\nIn the time-domain results shown in Figure 14(a) ,n o\ntransformer saturation is present with a = 9, the output\nsignal is a smoothed squared wave, which indicates that dis-\ntortion results mainly from clipping in the vacuum tube. As\nthe transformer saturation increases, with a\n=90; the output\nwaveform starts to look like a triangular wave. With a=900,\nthe output transformer is already highly saturated, and the\nobserved output pressure is formed by short impulses.\nEURASIP Journal on Advances in Signal Processing 13\n+−\n+−\nTx\nRk\nRp\nRi\nVin\nRgCg\nGrid circuit\nCathode\ncircuit\nPlate\ncircuit\nV+\n(a)\nCm\nTem\nLe\nRe\nLm\nRm\nTma\nCa\nRa\nLoudspeaker\ninput\n(b)\nFigure 13: WDF implementation of the output chain of a vacuum tube ampliﬁer using the proposed transformer model. (a) The complete\ncircuit and (b) the loudspeaker implementation.\n0 0.005 0.01 0.015 0.02\n−0.06\n−0.04\n−0.02\n0\n0.02\n0.04\n0.06\nOutput pressure\nTime (s)\na =9\na =90\na =900\n(a)\n0 500 1000 1500 2000\n−50\n−45\n−40\n−35\n−30\n−25\n−20\n−15\n−10\n−5\n0\n5\na =9\na =90\na =900\nFrequency (Hz)\nNormalized output pressure (dB)\n(b)\nFigure 14: Simulated loudspeaker output pressure for di ﬀerent levels of transformer saturation, for an input consisting of a sine with 200 Hz\nwith 3 di ﬀerent levels of transformer saturation in (a) the time domain and (b) the frequency domain. In (b), a frequency o ﬀset of 30 Hz is\napplied for clarity.\nIn the frequency-domain analysis of the output chain\nresponse in Figure 14(b) , there are little di ﬀerences between\nharmonics for a = 9a n d a = 90. Hence, for a lower\ntransformer saturation, although there would be some\ndiﬀerences in the time-domain waveforms, there would be\nonly subtle audible di ﬀerences. For a=900, there is at least a\n5d Bd i ﬀerence for most of the harmonics when compared to\na = 9. In this case, the transformer saturation contributes\nto guitar coloration signiﬁcantly at lower-frequency notes,\nwhile little e ﬀect should be noticed for higher-frequency\nnotes.\nThe real-time model is implemented using the\nBlockCompiler software [ 30]. Media ﬁles will be updated at\nhttp://www.acoustics.hut.ﬁ/publications/papers/jasp-trafo/ .\nThe real-time model operates at a 96 kHz sampling rate\nin a standard PC with an Intel Core 2 Quad CPU, 3 GHz,\nand 8 GB RAM, and it consumes roughly 7% of CPU time\n(implementation e ﬃciency improvement is still possible by\nusing other programming languages).\n6. Conclusion\nA new model for the audio transformer used in tube\nampliﬁers was proposed. Wave digital ﬁlters were chosen\nas the modeling paradigm. The model is based on the\npreviously proposed gyrator-capacitor analogy, in which the\nnonlinear behavior is represented using voltage-dependent\nvoltage and current sources.\n14 EURASIP Journal on Advances in Signal Processing\nA parameter ﬁtting procedure was introduced. It uses\nan open circuit measurement in which a sinusoidal input\nvoltage is fed into the primary while there is no load in the\nsecondary. By conducting basic electrical measurements of\nthe input current and output voltage of the audio trans-\nformer, the nonlinear capacitance and resistance parameters\ncan be determined. There is no need to know physical\nparameters of the transformer or even the number of\nwindings. The transformation ratio can be calculated based\non the estimated primary and secondary inductances.\nAs a case study, measurements of a Fender NSC041318\ntransformer were presented. It was shown that nonlinear\ndistortion is generated mainly at frequencies below about\n100 Hz. This implies that audible e ﬀects appear only with\nlow guitar tones. A comparison to a Hammond T1750V\nwas made. This transformer presented nonlinear distortion\nonly for frequencies below 30 Hz, which may be inaudible.\nOnce the model parameters were estimated, the WDF model\nreproduced the behavior of the transformers accurately\nat low frequencies but not so well at higher frequencies.\nHowever, the distortion produced by the model at high\nfrequencies was negligible.\nA real-time implementation of the model, which runs\nin a modern PC at the 96 kHz sample rate, was brieﬂy\ndescribed. Parameters of the model can be varied freely to\nchange the distortion characteristics. By exaggerating the\nnonlinearities, a prominent e ﬀect, reminiscent of that of the\nblocking distortion, is obtained.\nFuture research may look, for example, into the non-\nlinearities of loudspeakers used in guitar ampliﬁers and the\ninclusion of frequency-dependent losses in the magnet core\nof the audio transformer, such as modeling of eddy currents.\nAdditionally, the behavior of the GC model under transient\nconditions should be evaluated in future studies.\nAcknowledgment\nThis research was funded by CIMO, Aalto University, and\nAcademy of Finland (Project 122815).\nReferences\n[1] J. Pakarinen and D. T. Y eh, “ A review of digital techniques\nfor modeling vacuum-tube guitar ampliﬁers, ” Computer Music\nJournal, vol. 33, no. 2, pp. 85–100, 2009.\n[2] T. H ´elie, “V olterra series and state transformation for real-\ntime simulations of audio circuits including saturations:\napplication to the Moog ladder ﬁlter, ” IEEE Transactions on\nAudio, Speech and Language Processing , vol. 18, no. 4, pp. 747–\n759, 2010.\n[3] D. T. Y eh, J. S. Abel, A. Vladimirescu, and J. O. Smith,\n“Numerical methods for simulation of guitar distortion\ncircuits, ” Computer Music Journal , vol. 32, no. 2, pp. 23–42,\n2008.\n[4] M. N. Gallo, “Method and apparatus for distortion of audio\nsignals and emulation of vacuum tube ampliﬁers, ” US patent\nApplication 2008/0218259 A1. Filed on March 2007, published\non September 2008.\n[5] J. Macak and J. Schimmel, “Nonlinear circuit simulation\nusing time-variant ﬁlter, ” in Proceedings of the International\nConference on Digital Audio E ﬀects,C o m o ,I t a l y ,S e p t e m b e r\n2009.\n[ 6 ] D .T .Y e h , Digital implementation of musical distortion circuits\nby analysis and simulatio , Ph.D. thesis, Stanford Univer-\nsity, Palo Alto, Calif, USA, 2009, https://ccrma.stanford.edu/\n∼dtyeh/papers/DavidY ehThesissinglesided.pdf.\n[ 7 ]D .T .Y e h ,J .S .A b e l ,a n dJ .O .S m i t h ,“ A u t o m a t e dp h y s i c a l\nmodeling of nonlinear audio circuits for real-time audio\neﬀects - part I: theoretical development, ” IEEE Transactions on\nAudio, Speech and Language Processing , vol. 18, no. 4, pp. 728–\n737, 2010.\n[8] M. Karjalainen and J. Pakarinen, “Wave digital simulation\nof a vacuum-tube ampliﬁer, ” in Proceedings of IEEE Interna-\ntional Conference on Acoustics, Speech and Signal Processing\n(ICASSP ’06), vol. 5, pp. 153–156, T oulouse, France, 2006.\n[9] G. De Sanctis and A. Sarti, “Virtual analog modeling in the\nwave-digital domain, ” IEEE Transactions on Audio, Speech and\nLanguage Processing, vol. 18, no. 4, pp. 715–727, 2010.\n[10] J. Pakarinen, M. Tikander, and M. Karjalainen, “Wave digital\nmodeling of the output chain of a vacuum-tube ampliﬁer, ”\nin Proceedings of the 12th International Conference on Digital\nAudio Eﬀects (DAFx ’09), Como, Italy, September 2009.\n[11] J. Pakarinen and M. Karjalainen, “Enhanced wave digital\ntriode model for real-time tube ampliﬁer emulation, ” IEEE\nTransactions on Audio, Speech and Language Processing , vol. 18,\nno. 4, pp. 738–746, 2010.\n[12] M. V een and P . T ouzelet, “New vacuum tube and output\ntransformer models applied to the Quad II valve ampliﬁer, ” in\nProceedings of the 114th Audio Engineering Society Convention ,\nAmsterdan, The Netherlands, March 2003, preprint 5748.\n[13] I. Cohen and T. H ´elie, “Real-time simulation of a guitar power\nampliﬁer, ” in Proceedings of the 13th International Conference\non Digital Audio E ﬀect (DAFx ’10) ,G r a z ,A u s t r i a ,S e p t e m b e r\n2010.\n[14] J. Macak and J. Schimmel, “Real-time guitar tube ampliﬁer\nsimulation using an approximation of di ﬀerential equations, ”\nin Proceedings of the 13th International Conference on Digital\nAudio Eﬀect (DAFx ’10), Graz, Austria, September 2010.\n[15] P . T ouzelet, “ Accurate non linear models of valve ampliﬁers\nincluding output transformers, ” in Proceedings of the 120th\nAudio Engineering Society Convention , Paris, France, May\n2006, preprint 6830.\n[16] D. C. Jiles and D. L. Atherton, “Theory of ferromagnetic\nhysteresis,” Journal of Magnetism and Magnetic Materials , vol.\n61, no. 1-2, pp. 48–60, 1986.\n[17] J. H. Chan, A. Vladimirescu, X. C. Gao, P . Liebmann,\nand J. V alainis, “Nonlinear transformer model for circuit\nsimulation, ” IEEE Transactions on Computer-Aided Design of\nIntegrated Circuits and Systems , vol. 10, no. 4, pp. 476–482,\n1991.\n[18] D. C. Hamill, “Gyrator-capacitor modeling: a better way\nof understanding magnetic components, ” in Proceedings of\nthe 9th Annual Applied Power Electronics Conference and\nExposition (APEC ’94), vol. 1, pp. 326–332, February 1994.\n[19] Y . S. Lee, L. P . W ong, and D. K. W. Cheng, “Simulation and\ndesign of integrated magnetics for power converters, ” IEEE\nTransactions on Magnetics , vol. 39, no. 2, pp. 1008–1018, 2003.\n[ 2 0 ] Q .C h e n ,L .X u ,X .R u a n ,S .C .W o n g ,a n dC .K .T s e ,\n“Gyrator-capacitor simulation model of nonlinear magnetic\ncore, ” in Proceedings of the 24th Annual IEEE Applied Power\nElectronics Conference and Exposition (APEC ’09) , pp. 1740–\n1746, February 2009.\nEURASIP Journal on Advances in Signal Processing 15\n[21] E. D. T orre, Magnetic Hysteresis , Wiley-IEEE Press, New Y ork,\nNY , USA, 1st edition, 1999.\n[22] A. Fettweis, “Wave digital ﬁlters: theory and practice, ” Proceed-\nings of the IEEE , vol. 74, no. 2, pp. 270–327, 1986.\n[23] V . V ¨alim¨aki, J. Pakarinen, C. Erkut, and M. Karjalainen,\n“Discrete-time modelling of musical instruments, ” Reports on\nProgress in Physics , vol. 69, no. 1, pp. 1–78, 2006.\n[24] A. Sarti and G. De Sanctis, “Systematic methods for the\nimplementation of nonlinear wave-digital structures, ” IEEE\nTransactions on Circuits and Systems I , vol. 56, no. 2, pp. 460–\n472, 2009.\n[25] M. Karjalainen, “BlockCompiler documentation, ” unﬁnished\nreport, http://www.acoustics.hut.ﬁ/software/BlockCompiler/\ndocu.html.\n[26] G. Borin, G. De Poli, and D. Rocchesso, “Elimination of\ndelay-free loops in discrete-time models of nonlinear acoustic\nsystems, ” IEEE Transactions on Speech and Audio Processing ,\nvol. 8, no. 5, pp. 597–604, 2000.\n[27] P . S. R. Diniz, E. A. B. da Silva, and S. L. Netto, Digital Signal\nProcessing: System Analysis and Design , Cambridge University\nPress, Cambridge, UK, 2002.\n[28] J. Pakarinen, “Distortion analysis toolkit—a software tool for\neasy analysis of nonlinear audio systems, ” EURASIP Journal on\nAdvances in Signal Processing , vol. 2010, Article ID 617325, 13\npages, 2010.\n[29] N. Koren, “Improved vacuum-tube models for spice simula-\ntions, ”Glass Audio, vol. 8, pp. 18–27, 1996.\n[30] M. Karjalainen, “BlockCompiler: e ﬃcient simulation of\nacoustic and audio systems, ” in Proceedings of the 114th Audio\nEngineering Society Convention , Amsterdam, The Netherlands,\nMarch 2003, preprint 5756.",
  "topic": "Fender",
  "concepts": [
    {
      "name": "Fender",
      "score": 0.6838534474372864
    },
    {
      "name": "Amplifier",
      "score": 0.6642149686813354
    },
    {
      "name": "Transformer",
      "score": 0.6432533264160156
    },
    {
      "name": "Computer science",
      "score": 0.591559886932373
    },
    {
      "name": "Loudspeaker",
      "score": 0.5272801518440247
    },
    {
      "name": "Sound quality",
      "score": 0.498218297958374
    },
    {
      "name": "Electronic engineering",
      "score": 0.4723335802555084
    },
    {
      "name": "Audio power amplifier",
      "score": 0.4353097379207611
    },
    {
      "name": "Electrical engineering",
      "score": 0.4078708589076996
    },
    {
      "name": "Acoustics",
      "score": 0.35135605931282043
    },
    {
      "name": "Engineering",
      "score": 0.28122591972351074
    },
    {
      "name": "Speech recognition",
      "score": 0.20211094617843628
    },
    {
      "name": "Voltage",
      "score": 0.1516159176826477
    },
    {
      "name": "Physics",
      "score": 0.1130128800868988
    },
    {
      "name": "CMOS",
      "score": 0.0
    },
    {
      "name": "Mechanical engineering",
      "score": 0.0
    }
  ],
  "institutions": [
    {
      "id": "https://openalex.org/I9927081",
      "name": "Aalto University",
      "country": "FI"
    },
    {
      "id": "https://openalex.org/I2738502077",
      "name": "Nokia (Finland)",
      "country": "FI"
    }
  ]
}